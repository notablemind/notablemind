(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){},{}],2:[function(require,module,exports){var base64=require("base64-js");var ieee754=require("ieee754");var isArray=require("is-array");exports.Buffer=Buffer;exports.SlowBuffer=SlowBuffer;exports.INSPECT_MAX_BYTES=50;Buffer.poolSize=8192;var kMaxLength=1073741823;var rootParent={};Buffer.TYPED_ARRAY_SUPPORT=function(){try{var buf=new ArrayBuffer(0);var arr=new Uint8Array(buf);arr.foo=function(){return 42};return 42===arr.foo()&&typeof arr.subarray==="function"&&new Uint8Array(1).subarray(1,1).byteLength===0}catch(e){return false}}();function Buffer(subject,encoding,noZero){if(!(this instanceof Buffer))return new Buffer(subject,encoding,noZero);var type=typeof subject;var length;if(type==="number")length=subject>0?subject>>>0:0;else if(type==="string"){length=Buffer.byteLength(subject,encoding)}else if(type==="object"&&subject!==null){if(subject.type==="Buffer"&&isArray(subject.data))subject=subject.data;length=+subject.length>0?Math.floor(+subject.length):0}else throw new TypeError("must start with number, buffer, array or string");if(length>kMaxLength)throw new RangeError("Attempt to allocate Buffer larger than maximum "+"size: 0x"+kMaxLength.toString(16)+" bytes");var buf;if(Buffer.TYPED_ARRAY_SUPPORT){buf=Buffer._augment(new Uint8Array(length))}else{buf=this;buf.length=length;buf._isBuffer=true}var i;if(Buffer.TYPED_ARRAY_SUPPORT&&typeof subject.byteLength==="number"){buf._set(subject)}else if(isArrayish(subject)){if(Buffer.isBuffer(subject)){for(i=0;i<length;i++)buf[i]=subject.readUInt8(i)}else{for(i=0;i<length;i++)buf[i]=(subject[i]%256+256)%256}}else if(type==="string"){buf.write(subject,0,encoding)}else if(type==="number"&&!Buffer.TYPED_ARRAY_SUPPORT&&!noZero){for(i=0;i<length;i++){buf[i]=0}}if(length>0&&length<=Buffer.poolSize)buf.parent=rootParent;return buf}function SlowBuffer(subject,encoding,noZero){if(!(this instanceof SlowBuffer))return new SlowBuffer(subject,encoding,noZero);var buf=new Buffer(subject,encoding,noZero);delete buf.parent;return buf}Buffer.isBuffer=function(b){return!!(b!=null&&b._isBuffer)};Buffer.compare=function(a,b){if(!Buffer.isBuffer(a)||!Buffer.isBuffer(b))throw new TypeError("Arguments must be Buffers");var x=a.length;var y=b.length;for(var i=0,len=Math.min(x,y);i<len&&a[i]===b[i];i++){}if(i!==len){x=a[i];y=b[i]}if(x<y)return-1;if(y<x)return 1;return 0};Buffer.isEncoding=function(encoding){switch(String(encoding).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"raw":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return true;default:return false}};Buffer.concat=function(list,totalLength){if(!isArray(list))throw new TypeError("Usage: Buffer.concat(list[, length])");if(list.length===0){return new Buffer(0)}else if(list.length===1){return list[0]}var i;if(totalLength===undefined){totalLength=0;for(i=0;i<list.length;i++){totalLength+=list[i].length}}var buf=new Buffer(totalLength);var pos=0;for(i=0;i<list.length;i++){var item=list[i];item.copy(buf,pos);pos+=item.length}return buf};Buffer.byteLength=function(str,encoding){var ret;str=str+"";switch(encoding||"utf8"){case"ascii":case"binary":case"raw":ret=str.length;break;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":ret=str.length*2;break;case"hex":ret=str.length>>>1;break;case"utf8":case"utf-8":ret=utf8ToBytes(str).length;break;case"base64":ret=base64ToBytes(str).length;break;default:ret=str.length}return ret};Buffer.prototype.length=undefined;Buffer.prototype.parent=undefined;Buffer.prototype.toString=function(encoding,start,end){var loweredCase=false;start=start>>>0;end=end===undefined||end===Infinity?this.length:end>>>0;if(!encoding)encoding="utf8";if(start<0)start=0;if(end>this.length)end=this.length;if(end<=start)return"";while(true){switch(encoding){case"hex":return hexSlice(this,start,end);case"utf8":case"utf-8":return utf8Slice(this,start,end);case"ascii":return asciiSlice(this,start,end);case"binary":return binarySlice(this,start,end);case"base64":return base64Slice(this,start,end);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return utf16leSlice(this,start,end);default:if(loweredCase)throw new TypeError("Unknown encoding: "+encoding);encoding=(encoding+"").toLowerCase();loweredCase=true}}};Buffer.prototype.equals=function(b){if(!Buffer.isBuffer(b))throw new TypeError("Argument must be a Buffer");return Buffer.compare(this,b)===0};Buffer.prototype.inspect=function(){var str="";var max=exports.INSPECT_MAX_BYTES;if(this.length>0){str=this.toString("hex",0,max).match(/.{2}/g).join(" ");if(this.length>max)str+=" ... "}return"<Buffer "+str+">"};Buffer.prototype.compare=function(b){if(!Buffer.isBuffer(b))throw new TypeError("Argument must be a Buffer");return Buffer.compare(this,b)};Buffer.prototype.get=function(offset){console.log(".get() is deprecated. Access using array indexes instead.");return this.readUInt8(offset)};Buffer.prototype.set=function(v,offset){console.log(".set() is deprecated. Access using array indexes instead.");return this.writeUInt8(v,offset)};function hexWrite(buf,string,offset,length){offset=Number(offset)||0;var remaining=buf.length-offset;if(!length){length=remaining}else{length=Number(length);if(length>remaining){length=remaining}}var strLen=string.length;if(strLen%2!==0)throw new Error("Invalid hex string");if(length>strLen/2){length=strLen/2}for(var i=0;i<length;i++){var byte=parseInt(string.substr(i*2,2),16);if(isNaN(byte))throw new Error("Invalid hex string");buf[offset+i]=byte}return i}function utf8Write(buf,string,offset,length){var charsWritten=blitBuffer(utf8ToBytes(string,buf.length-offset),buf,offset,length);return charsWritten}function asciiWrite(buf,string,offset,length){var charsWritten=blitBuffer(asciiToBytes(string),buf,offset,length);return charsWritten}function binaryWrite(buf,string,offset,length){return asciiWrite(buf,string,offset,length)}function base64Write(buf,string,offset,length){var charsWritten=blitBuffer(base64ToBytes(string),buf,offset,length);return charsWritten}function utf16leWrite(buf,string,offset,length){var charsWritten=blitBuffer(utf16leToBytes(string,buf.length-offset),buf,offset,length,2);return charsWritten}Buffer.prototype.write=function(string,offset,length,encoding){if(isFinite(offset)){if(!isFinite(length)){encoding=length;length=undefined}}else{var swap=encoding;encoding=offset;offset=length;length=swap}offset=Number(offset)||0;if(length<0||offset<0||offset>this.length)throw new RangeError("attempt to write outside buffer bounds");var remaining=this.length-offset;if(!length){length=remaining}else{length=Number(length);if(length>remaining){length=remaining}}encoding=String(encoding||"utf8").toLowerCase();var ret;switch(encoding){case"hex":ret=hexWrite(this,string,offset,length);break;case"utf8":case"utf-8":ret=utf8Write(this,string,offset,length);break;case"ascii":ret=asciiWrite(this,string,offset,length);break;case"binary":ret=binaryWrite(this,string,offset,length);break;case"base64":ret=base64Write(this,string,offset,length);break;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":ret=utf16leWrite(this,string,offset,length);break;default:throw new TypeError("Unknown encoding: "+encoding)}return ret};Buffer.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function base64Slice(buf,start,end){if(start===0&&end===buf.length){return base64.fromByteArray(buf)}else{return base64.fromByteArray(buf.slice(start,end))}}function utf8Slice(buf,start,end){var res="";var tmp="";end=Math.min(buf.length,end);for(var i=start;i<end;i++){if(buf[i]<=127){res+=decodeUtf8Char(tmp)+String.fromCharCode(buf[i]);tmp=""}else{tmp+="%"+buf[i].toString(16)}}return res+decodeUtf8Char(tmp)}function asciiSlice(buf,start,end){var ret="";end=Math.min(buf.length,end);for(var i=start;i<end;i++){ret+=String.fromCharCode(buf[i]&127)}return ret}function binarySlice(buf,start,end){var ret="";end=Math.min(buf.length,end);for(var i=start;i<end;i++){ret+=String.fromCharCode(buf[i])}return ret}function hexSlice(buf,start,end){var len=buf.length;if(!start||start<0)start=0;if(!end||end<0||end>len)end=len;var out="";for(var i=start;i<end;i++){out+=toHex(buf[i])}return out}function utf16leSlice(buf,start,end){var bytes=buf.slice(start,end);var res="";for(var i=0;i<bytes.length;i+=2){res+=String.fromCharCode(bytes[i]+bytes[i+1]*256)}return res}Buffer.prototype.slice=function(start,end){var len=this.length;start=~~start;end=end===undefined?len:~~end;if(start<0){start+=len;if(start<0)start=0}else if(start>len){start=len}if(end<0){end+=len;if(end<0)end=0}else if(end>len){end=len}if(end<start)end=start;var newBuf;if(Buffer.TYPED_ARRAY_SUPPORT){newBuf=Buffer._augment(this.subarray(start,end))}else{var sliceLen=end-start;newBuf=new Buffer(sliceLen,undefined,true);for(var i=0;i<sliceLen;i++){newBuf[i]=this[i+start]}}if(newBuf.length)newBuf.parent=this.parent||this;return newBuf};function checkOffset(offset,ext,length){if(offset%1!==0||offset<0)throw new RangeError("offset is not uint");if(offset+ext>length)throw new RangeError("Trying to access beyond buffer length")}Buffer.prototype.readUIntLE=function(offset,byteLength,noAssert){offset=offset>>>0;byteLength=byteLength>>>0;if(!noAssert)checkOffset(offset,byteLength,this.length);var val=this[offset];var mul=1;var i=0;while(++i<byteLength&&(mul*=256))val+=this[offset+i]*mul;return val};Buffer.prototype.readUIntBE=function(offset,byteLength,noAssert){offset=offset>>>0;byteLength=byteLength>>>0;if(!noAssert)checkOffset(offset,byteLength,this.length);var val=this[offset+--byteLength];var mul=1;while(byteLength>0&&(mul*=256))val+=this[offset+--byteLength]*mul;return val};Buffer.prototype.readUInt8=function(offset,noAssert){if(!noAssert)checkOffset(offset,1,this.length);return this[offset]};Buffer.prototype.readUInt16LE=function(offset,noAssert){if(!noAssert)checkOffset(offset,2,this.length);return this[offset]|this[offset+1]<<8};Buffer.prototype.readUInt16BE=function(offset,noAssert){if(!noAssert)checkOffset(offset,2,this.length);return this[offset]<<8|this[offset+1]};Buffer.prototype.readUInt32LE=function(offset,noAssert){if(!noAssert)checkOffset(offset,4,this.length);return(this[offset]|this[offset+1]<<8|this[offset+2]<<16)+this[offset+3]*16777216};Buffer.prototype.readUInt32BE=function(offset,noAssert){if(!noAssert)checkOffset(offset,4,this.length);return this[offset]*16777216+(this[offset+1]<<16|this[offset+2]<<8|this[offset+3])};Buffer.prototype.readIntLE=function(offset,byteLength,noAssert){offset=offset>>>0;byteLength=byteLength>>>0;if(!noAssert)checkOffset(offset,byteLength,this.length);var val=this[offset];var mul=1;var i=0;while(++i<byteLength&&(mul*=256))val+=this[offset+i]*mul;mul*=128;if(val>=mul)val-=Math.pow(2,8*byteLength);return val};Buffer.prototype.readIntBE=function(offset,byteLength,noAssert){offset=offset>>>0;byteLength=byteLength>>>0;if(!noAssert)checkOffset(offset,byteLength,this.length);var i=byteLength;var mul=1;var val=this[offset+--i];while(i>0&&(mul*=256))val+=this[offset+--i]*mul;mul*=128;if(val>=mul)val-=Math.pow(2,8*byteLength);return val};Buffer.prototype.readInt8=function(offset,noAssert){if(!noAssert)checkOffset(offset,1,this.length);if(!(this[offset]&128))return this[offset];return(255-this[offset]+1)*-1};Buffer.prototype.readInt16LE=function(offset,noAssert){if(!noAssert)checkOffset(offset,2,this.length);var val=this[offset]|this[offset+1]<<8;return val&32768?val|4294901760:val};Buffer.prototype.readInt16BE=function(offset,noAssert){if(!noAssert)checkOffset(offset,2,this.length);var val=this[offset+1]|this[offset]<<8;return val&32768?val|4294901760:val};Buffer.prototype.readInt32LE=function(offset,noAssert){if(!noAssert)checkOffset(offset,4,this.length);return this[offset]|this[offset+1]<<8|this[offset+2]<<16|this[offset+3]<<24};Buffer.prototype.readInt32BE=function(offset,noAssert){if(!noAssert)checkOffset(offset,4,this.length);return this[offset]<<24|this[offset+1]<<16|this[offset+2]<<8|this[offset+3]};Buffer.prototype.readFloatLE=function(offset,noAssert){if(!noAssert)checkOffset(offset,4,this.length);return ieee754.read(this,offset,true,23,4)};Buffer.prototype.readFloatBE=function(offset,noAssert){if(!noAssert)checkOffset(offset,4,this.length);return ieee754.read(this,offset,false,23,4)};Buffer.prototype.readDoubleLE=function(offset,noAssert){if(!noAssert)checkOffset(offset,8,this.length);return ieee754.read(this,offset,true,52,8)};Buffer.prototype.readDoubleBE=function(offset,noAssert){if(!noAssert)checkOffset(offset,8,this.length);return ieee754.read(this,offset,false,52,8)};function checkInt(buf,value,offset,ext,max,min){if(!Buffer.isBuffer(buf))throw new TypeError("buffer must be a Buffer instance");if(value>max||value<min)throw new RangeError("value is out of bounds");if(offset+ext>buf.length)throw new RangeError("index out of range")}Buffer.prototype.writeUIntLE=function(value,offset,byteLength,noAssert){value=+value;offset=offset>>>0;byteLength=byteLength>>>0;if(!noAssert)checkInt(this,value,offset,byteLength,Math.pow(2,8*byteLength),0);var mul=1;var i=0;this[offset]=value&255;while(++i<byteLength&&(mul*=256))this[offset+i]=value/mul>>>0&255;return offset+byteLength};Buffer.prototype.writeUIntBE=function(value,offset,byteLength,noAssert){value=+value;offset=offset>>>0;byteLength=byteLength>>>0;if(!noAssert)checkInt(this,value,offset,byteLength,Math.pow(2,8*byteLength),0);var i=byteLength-1;var mul=1;this[offset+i]=value&255;while(--i>=0&&(mul*=256))this[offset+i]=value/mul>>>0&255;return offset+byteLength};Buffer.prototype.writeUInt8=function(value,offset,noAssert){value=+value;offset=offset>>>0;if(!noAssert)checkInt(this,value,offset,1,255,0);if(!Buffer.TYPED_ARRAY_SUPPORT)value=Math.floor(value);this[offset]=value;return offset+1};function objectWriteUInt16(buf,value,offset,littleEndian){if(value<0)value=65535+value+1;for(var i=0,j=Math.min(buf.length-offset,2);i<j;i++){buf[offset+i]=(value&255<<8*(littleEndian?i:1-i))>>>(littleEndian?i:1-i)*8}}Buffer.prototype.writeUInt16LE=function(value,offset,noAssert){value=+value;offset=offset>>>0;if(!noAssert)checkInt(this,value,offset,2,65535,0);if(Buffer.TYPED_ARRAY_SUPPORT){this[offset]=value;this[offset+1]=value>>>8}else objectWriteUInt16(this,value,offset,true);return offset+2};Buffer.prototype.writeUInt16BE=function(value,offset,noAssert){value=+value;offset=offset>>>0;if(!noAssert)checkInt(this,value,offset,2,65535,0);if(Buffer.TYPED_ARRAY_SUPPORT){this[offset]=value>>>8;this[offset+1]=value}else objectWriteUInt16(this,value,offset,false);return offset+2};function objectWriteUInt32(buf,value,offset,littleEndian){if(value<0)value=4294967295+value+1;for(var i=0,j=Math.min(buf.length-offset,4);i<j;i++){buf[offset+i]=value>>>(littleEndian?i:3-i)*8&255}}Buffer.prototype.writeUInt32LE=function(value,offset,noAssert){value=+value;offset=offset>>>0;if(!noAssert)checkInt(this,value,offset,4,4294967295,0);if(Buffer.TYPED_ARRAY_SUPPORT){this[offset+3]=value>>>24;this[offset+2]=value>>>16;this[offset+1]=value>>>8;this[offset]=value}else objectWriteUInt32(this,value,offset,true);return offset+4};Buffer.prototype.writeUInt32BE=function(value,offset,noAssert){value=+value;offset=offset>>>0;if(!noAssert)checkInt(this,value,offset,4,4294967295,0);if(Buffer.TYPED_ARRAY_SUPPORT){this[offset]=value>>>24;this[offset+1]=value>>>16;this[offset+2]=value>>>8;this[offset+3]=value}else objectWriteUInt32(this,value,offset,false);return offset+4};Buffer.prototype.writeIntLE=function(value,offset,byteLength,noAssert){value=+value;offset=offset>>>0;if(!noAssert){checkInt(this,value,offset,byteLength,Math.pow(2,8*byteLength-1)-1,-Math.pow(2,8*byteLength-1))}var i=0;var mul=1;var sub=value<0?1:0;this[offset]=value&255;while(++i<byteLength&&(mul*=256))this[offset+i]=(value/mul>>0)-sub&255;return offset+byteLength};Buffer.prototype.writeIntBE=function(value,offset,byteLength,noAssert){value=+value;offset=offset>>>0;if(!noAssert){checkInt(this,value,offset,byteLength,Math.pow(2,8*byteLength-1)-1,-Math.pow(2,8*byteLength-1))}var i=byteLength-1;var mul=1;var sub=value<0?1:0;this[offset+i]=value&255;while(--i>=0&&(mul*=256))this[offset+i]=(value/mul>>0)-sub&255;return offset+byteLength};Buffer.prototype.writeInt8=function(value,offset,noAssert){value=+value;offset=offset>>>0;if(!noAssert)checkInt(this,value,offset,1,127,-128);if(!Buffer.TYPED_ARRAY_SUPPORT)value=Math.floor(value);if(value<0)value=255+value+1;this[offset]=value;return offset+1};Buffer.prototype.writeInt16LE=function(value,offset,noAssert){value=+value;offset=offset>>>0;if(!noAssert)checkInt(this,value,offset,2,32767,-32768);if(Buffer.TYPED_ARRAY_SUPPORT){this[offset]=value;this[offset+1]=value>>>8}else objectWriteUInt16(this,value,offset,true);return offset+2};Buffer.prototype.writeInt16BE=function(value,offset,noAssert){value=+value;offset=offset>>>0;if(!noAssert)checkInt(this,value,offset,2,32767,-32768);if(Buffer.TYPED_ARRAY_SUPPORT){this[offset]=value>>>8;this[offset+1]=value}else objectWriteUInt16(this,value,offset,false);return offset+2};Buffer.prototype.writeInt32LE=function(value,offset,noAssert){value=+value;offset=offset>>>0;if(!noAssert)checkInt(this,value,offset,4,2147483647,-2147483648);if(Buffer.TYPED_ARRAY_SUPPORT){this[offset]=value;this[offset+1]=value>>>8;this[offset+2]=value>>>16;this[offset+3]=value>>>24}else objectWriteUInt32(this,value,offset,true);return offset+4};Buffer.prototype.writeInt32BE=function(value,offset,noAssert){value=+value;offset=offset>>>0;if(!noAssert)checkInt(this,value,offset,4,2147483647,-2147483648);if(value<0)value=4294967295+value+1;if(Buffer.TYPED_ARRAY_SUPPORT){this[offset]=value>>>24;this[offset+1]=value>>>16;this[offset+2]=value>>>8;this[offset+3]=value}else objectWriteUInt32(this,value,offset,false);return offset+4};function checkIEEE754(buf,value,offset,ext,max,min){if(value>max||value<min)throw new RangeError("value is out of bounds");if(offset+ext>buf.length)throw new RangeError("index out of range");if(offset<0)throw new RangeError("index out of range")}function writeFloat(buf,value,offset,littleEndian,noAssert){if(!noAssert)checkIEEE754(buf,value,offset,4,3.4028234663852886e38,-3.4028234663852886e38);ieee754.write(buf,value,offset,littleEndian,23,4);return offset+4}Buffer.prototype.writeFloatLE=function(value,offset,noAssert){return writeFloat(this,value,offset,true,noAssert)};Buffer.prototype.writeFloatBE=function(value,offset,noAssert){return writeFloat(this,value,offset,false,noAssert)};function writeDouble(buf,value,offset,littleEndian,noAssert){if(!noAssert)checkIEEE754(buf,value,offset,8,1.7976931348623157e308,-1.7976931348623157e308);ieee754.write(buf,value,offset,littleEndian,52,8);return offset+8}Buffer.prototype.writeDoubleLE=function(value,offset,noAssert){return writeDouble(this,value,offset,true,noAssert)};Buffer.prototype.writeDoubleBE=function(value,offset,noAssert){return writeDouble(this,value,offset,false,noAssert)};Buffer.prototype.copy=function(target,target_start,start,end){var source=this;if(!start)start=0;if(!end&&end!==0)end=this.length;if(target_start>=target.length)target_start=target.length;if(!target_start)target_start=0;if(end>0&&end<start)end=start;if(end===start)return 0;if(target.length===0||source.length===0)return 0;if(target_start<0)throw new RangeError("targetStart out of bounds");if(start<0||start>=source.length)throw new RangeError("sourceStart out of bounds");if(end<0)throw new RangeError("sourceEnd out of bounds");if(end>this.length)end=this.length;if(target.length-target_start<end-start)end=target.length-target_start+start;var len=end-start;if(len<1e3||!Buffer.TYPED_ARRAY_SUPPORT){for(var i=0;i<len;i++){target[i+target_start]=this[i+start]}}else{target._set(this.subarray(start,start+len),target_start)}return len};Buffer.prototype.fill=function(value,start,end){if(!value)value=0;if(!start)start=0;if(!end)end=this.length;if(end<start)throw new RangeError("end < start");if(end===start)return;if(this.length===0)return;if(start<0||start>=this.length)throw new RangeError("start out of bounds");if(end<0||end>this.length)throw new RangeError("end out of bounds");var i;if(typeof value==="number"){for(i=start;i<end;i++){this[i]=value}}else{var bytes=utf8ToBytes(value.toString());var len=bytes.length;for(i=start;i<end;i++){this[i]=bytes[i%len]}}return this};Buffer.prototype.toArrayBuffer=function(){if(typeof Uint8Array!=="undefined"){if(Buffer.TYPED_ARRAY_SUPPORT){return new Buffer(this).buffer}else{var buf=new Uint8Array(this.length);for(var i=0,len=buf.length;i<len;i+=1){buf[i]=this[i]}return buf.buffer}}else{throw new TypeError("Buffer.toArrayBuffer not supported in this browser")}};var BP=Buffer.prototype;Buffer._augment=function(arr){arr.constructor=Buffer;arr._isBuffer=true;arr._get=arr.get;arr._set=arr.set;arr.get=BP.get;arr.set=BP.set;arr.write=BP.write;arr.toString=BP.toString;arr.toLocaleString=BP.toString;arr.toJSON=BP.toJSON;arr.equals=BP.equals;arr.compare=BP.compare;arr.copy=BP.copy;arr.slice=BP.slice;arr.readUIntLE=BP.readUIntLE;arr.readUIntBE=BP.readUIntBE;arr.readUInt8=BP.readUInt8;arr.readUInt16LE=BP.readUInt16LE;arr.readUInt16BE=BP.readUInt16BE;arr.readUInt32LE=BP.readUInt32LE;arr.readUInt32BE=BP.readUInt32BE;arr.readIntLE=BP.readIntLE;arr.readIntBE=BP.readIntBE;arr.readInt8=BP.readInt8;arr.readInt16LE=BP.readInt16LE;arr.readInt16BE=BP.readInt16BE;arr.readInt32LE=BP.readInt32LE;arr.readInt32BE=BP.readInt32BE;arr.readFloatLE=BP.readFloatLE;arr.readFloatBE=BP.readFloatBE;arr.readDoubleLE=BP.readDoubleLE;arr.readDoubleBE=BP.readDoubleBE;arr.writeUInt8=BP.writeUInt8;arr.writeUIntLE=BP.writeUIntLE;arr.writeUIntBE=BP.writeUIntBE;arr.writeUInt16LE=BP.writeUInt16LE;arr.writeUInt16BE=BP.writeUInt16BE;arr.writeUInt32LE=BP.writeUInt32LE;arr.writeUInt32BE=BP.writeUInt32BE;arr.writeIntLE=BP.writeIntLE;arr.writeIntBE=BP.writeIntBE;arr.writeInt8=BP.writeInt8;arr.writeInt16LE=BP.writeInt16LE;arr.writeInt16BE=BP.writeInt16BE;arr.writeInt32LE=BP.writeInt32LE;arr.writeInt32BE=BP.writeInt32BE;arr.writeFloatLE=BP.writeFloatLE;arr.writeFloatBE=BP.writeFloatBE;arr.writeDoubleLE=BP.writeDoubleLE;arr.writeDoubleBE=BP.writeDoubleBE;arr.fill=BP.fill;arr.inspect=BP.inspect;arr.toArrayBuffer=BP.toArrayBuffer;return arr};var INVALID_BASE64_RE=/[^+\/0-9A-z\-]/g;function base64clean(str){str=stringtrim(str).replace(INVALID_BASE64_RE,"");if(str.length<2)return"";while(str.length%4!==0){str=str+"="}return str}function stringtrim(str){if(str.trim)return str.trim();return str.replace(/^\s+|\s+$/g,"")}function isArrayish(subject){return isArray(subject)||Buffer.isBuffer(subject)||subject&&typeof subject==="object"&&typeof subject.length==="number"}function toHex(n){if(n<16)return"0"+n.toString(16);return n.toString(16)}function utf8ToBytes(string,units){var codePoint,length=string.length;var leadSurrogate=null;units=units||Infinity;var bytes=[];var i=0;for(;i<length;i++){codePoint=string.charCodeAt(i);if(codePoint>55295&&codePoint<57344){if(leadSurrogate){if(codePoint<56320){if((units-=3)>-1)bytes.push(239,191,189);leadSurrogate=codePoint;continue}else{codePoint=leadSurrogate-55296<<10|codePoint-56320|65536;leadSurrogate=null}}else{if(codePoint>56319){if((units-=3)>-1)bytes.push(239,191,189);continue}else if(i+1===length){if((units-=3)>-1)bytes.push(239,191,189);continue}else{leadSurrogate=codePoint;continue}}}else if(leadSurrogate){if((units-=3)>-1)bytes.push(239,191,189);leadSurrogate=null}if(codePoint<128){if((units-=1)<0)break;bytes.push(codePoint)}else if(codePoint<2048){if((units-=2)<0)break;bytes.push(codePoint>>6|192,codePoint&63|128)}else if(codePoint<65536){if((units-=3)<0)break;bytes.push(codePoint>>12|224,codePoint>>6&63|128,codePoint&63|128)}else if(codePoint<2097152){if((units-=4)<0)break;bytes.push(codePoint>>18|240,codePoint>>12&63|128,codePoint>>6&63|128,codePoint&63|128)}else{throw new Error("Invalid code point")}}return bytes}function asciiToBytes(str){var byteArray=[];for(var i=0;i<str.length;i++){byteArray.push(str.charCodeAt(i)&255)}return byteArray}function utf16leToBytes(str,units){var c,hi,lo;var byteArray=[];for(var i=0;i<str.length;i++){if((units-=2)<0)break;c=str.charCodeAt(i);hi=c>>8;lo=c%256;byteArray.push(lo);byteArray.push(hi)}return byteArray}function base64ToBytes(str){return base64.toByteArray(base64clean(str))}function blitBuffer(src,dst,offset,length,unitSize){if(unitSize)length-=length%unitSize;for(var i=0;i<length;i++){if(i+offset>=dst.length||i>=src.length)break;dst[i+offset]=src[i]}return i}function decodeUtf8Char(str){try{return decodeURIComponent(str)}catch(err){return String.fromCharCode(65533)}}},{"base64-js":3,ieee754:4,"is-array":5}],3:[function(require,module,exports){var lookup="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";(function(exports){"use strict";var Arr=typeof Uint8Array!=="undefined"?Uint8Array:Array;var PLUS="+".charCodeAt(0);var SLASH="/".charCodeAt(0);var NUMBER="0".charCodeAt(0);var LOWER="a".charCodeAt(0);var UPPER="A".charCodeAt(0);var PLUS_URL_SAFE="-".charCodeAt(0);var SLASH_URL_SAFE="_".charCodeAt(0);function decode(elt){var code=elt.charCodeAt(0);if(code===PLUS||code===PLUS_URL_SAFE)return 62;if(code===SLASH||code===SLASH_URL_SAFE)return 63;if(code<NUMBER)return-1;if(code<NUMBER+10)return code-NUMBER+26+26;if(code<UPPER+26)return code-UPPER;if(code<LOWER+26)return code-LOWER+26}function b64ToByteArray(b64){var i,j,l,tmp,placeHolders,arr;if(b64.length%4>0){throw new Error("Invalid string. Length must be a multiple of 4")}var len=b64.length;placeHolders="="===b64.charAt(len-2)?2:"="===b64.charAt(len-1)?1:0;arr=new Arr(b64.length*3/4-placeHolders);l=placeHolders>0?b64.length-4:b64.length;var L=0;function push(v){arr[L++]=v}for(i=0,j=0;i<l;i+=4,j+=3){tmp=decode(b64.charAt(i))<<18|decode(b64.charAt(i+1))<<12|decode(b64.charAt(i+2))<<6|decode(b64.charAt(i+3));push((tmp&16711680)>>16);push((tmp&65280)>>8);push(tmp&255)}if(placeHolders===2){tmp=decode(b64.charAt(i))<<2|decode(b64.charAt(i+1))>>4;push(tmp&255)}else if(placeHolders===1){tmp=decode(b64.charAt(i))<<10|decode(b64.charAt(i+1))<<4|decode(b64.charAt(i+2))>>2;push(tmp>>8&255);push(tmp&255)}return arr}function uint8ToBase64(uint8){var i,extraBytes=uint8.length%3,output="",temp,length;function encode(num){return lookup.charAt(num)}function tripletToBase64(num){return encode(num>>18&63)+encode(num>>12&63)+encode(num>>6&63)+encode(num&63)}for(i=0,length=uint8.length-extraBytes;i<length;i+=3){temp=(uint8[i]<<16)+(uint8[i+1]<<8)+uint8[i+2];output+=tripletToBase64(temp)}switch(extraBytes){case 1:temp=uint8[uint8.length-1];output+=encode(temp>>2);output+=encode(temp<<4&63);output+="==";break;case 2:temp=(uint8[uint8.length-2]<<8)+uint8[uint8.length-1];output+=encode(temp>>10);output+=encode(temp>>4&63);output+=encode(temp<<2&63);output+="=";break}return output}exports.toByteArray=b64ToByteArray;exports.fromByteArray=uint8ToBase64})(typeof exports==="undefined"?this.base64js={}:exports)},{}],4:[function(require,module,exports){exports.read=function(buffer,offset,isLE,mLen,nBytes){var e,m,eLen=nBytes*8-mLen-1,eMax=(1<<eLen)-1,eBias=eMax>>1,nBits=-7,i=isLE?nBytes-1:0,d=isLE?-1:1,s=buffer[offset+i];i+=d;e=s&(1<<-nBits)-1;s>>=-nBits;nBits+=eLen;for(;nBits>0;e=e*256+buffer[offset+i],i+=d,nBits-=8);m=e&(1<<-nBits)-1;e>>=-nBits;nBits+=mLen;for(;nBits>0;m=m*256+buffer[offset+i],i+=d,nBits-=8);if(e===0){e=1-eBias}else if(e===eMax){return m?NaN:(s?-1:1)*Infinity}else{m=m+Math.pow(2,mLen);e=e-eBias}return(s?-1:1)*m*Math.pow(2,e-mLen)};exports.write=function(buffer,value,offset,isLE,mLen,nBytes){var e,m,c,eLen=nBytes*8-mLen-1,eMax=(1<<eLen)-1,eBias=eMax>>1,rt=mLen===23?Math.pow(2,-24)-Math.pow(2,-77):0,i=isLE?0:nBytes-1,d=isLE?1:-1,s=value<0||value===0&&1/value<0?1:0;value=Math.abs(value);if(isNaN(value)||value===Infinity){m=isNaN(value)?1:0;e=eMax}else{e=Math.floor(Math.log(value)/Math.LN2);if(value*(c=Math.pow(2,-e))<1){e--;c*=2}if(e+eBias>=1){value+=rt/c}else{value+=rt*Math.pow(2,1-eBias)}if(value*c>=2){e++;c/=2}if(e+eBias>=eMax){m=0;e=eMax}else if(e+eBias>=1){m=(value*c-1)*Math.pow(2,mLen);e=e+eBias}else{m=value*Math.pow(2,eBias-1)*Math.pow(2,mLen);e=0}}for(;mLen>=8;buffer[offset+i]=m&255,i+=d,m/=256,mLen-=8);e=e<<mLen|m;eLen+=mLen;for(;eLen>0;buffer[offset+i]=e&255,i+=d,e/=256,eLen-=8);buffer[offset+i-d]|=s*128}},{}],5:[function(require,module,exports){var isArray=Array.isArray;var str=Object.prototype.toString;module.exports=isArray||function(val){return!!val&&"[object Array]"==str.call(val)}},{}],6:[function(require,module,exports){function EventEmitter(){this._events=this._events||{};this._maxListeners=this._maxListeners||undefined}module.exports=EventEmitter;EventEmitter.EventEmitter=EventEmitter;EventEmitter.prototype._events=undefined;EventEmitter.prototype._maxListeners=undefined;EventEmitter.defaultMaxListeners=10;EventEmitter.prototype.setMaxListeners=function(n){if(!isNumber(n)||n<0||isNaN(n))throw TypeError("n must be a positive number");this._maxListeners=n;return this};EventEmitter.prototype.emit=function(type){var er,handler,len,args,i,listeners;if(!this._events)this._events={};if(type==="error"){if(!this._events.error||isObject(this._events.error)&&!this._events.error.length){er=arguments[1];if(er instanceof Error){throw er}throw TypeError('Uncaught, unspecified "error" event.')}}handler=this._events[type];if(isUndefined(handler))return false;if(isFunction(handler)){switch(arguments.length){case 1:handler.call(this);break;case 2:handler.call(this,arguments[1]);break;case 3:handler.call(this,arguments[1],arguments[2]);break;default:len=arguments.length;args=new Array(len-1);for(i=1;i<len;i++)args[i-1]=arguments[i];handler.apply(this,args)}}else if(isObject(handler)){len=arguments.length;args=new Array(len-1);for(i=1;i<len;i++)args[i-1]=arguments[i];listeners=handler.slice();len=listeners.length;for(i=0;i<len;i++)listeners[i].apply(this,args)}return true};EventEmitter.prototype.addListener=function(type,listener){var m;if(!isFunction(listener))throw TypeError("listener must be a function");if(!this._events)this._events={};if(this._events.newListener)this.emit("newListener",type,isFunction(listener.listener)?listener.listener:listener);if(!this._events[type])this._events[type]=listener;else if(isObject(this._events[type]))this._events[type].push(listener);else this._events[type]=[this._events[type],listener];if(isObject(this._events[type])&&!this._events[type].warned){var m;if(!isUndefined(this._maxListeners)){m=this._maxListeners}else{m=EventEmitter.defaultMaxListeners}if(m&&m>0&&this._events[type].length>m){this._events[type].warned=true;console.error("(node) warning: possible EventEmitter memory "+"leak detected. %d listeners added. "+"Use emitter.setMaxListeners() to increase limit.",this._events[type].length);if(typeof console.trace==="function"){console.trace()}}}return this};EventEmitter.prototype.on=EventEmitter.prototype.addListener;EventEmitter.prototype.once=function(type,listener){if(!isFunction(listener))throw TypeError("listener must be a function");var fired=false;function g(){this.removeListener(type,g);if(!fired){fired=true;listener.apply(this,arguments)}}g.listener=listener;this.on(type,g);return this};EventEmitter.prototype.removeListener=function(type,listener){var list,position,length,i;if(!isFunction(listener))throw TypeError("listener must be a function");if(!this._events||!this._events[type])return this;list=this._events[type];length=list.length;position=-1;if(list===listener||isFunction(list.listener)&&list.listener===listener){delete this._events[type];if(this._events.removeListener)this.emit("removeListener",type,listener)}else if(isObject(list)){for(i=length;i-->0;){if(list[i]===listener||list[i].listener&&list[i].listener===listener){position=i;
break}}if(position<0)return this;if(list.length===1){list.length=0;delete this._events[type]}else{list.splice(position,1)}if(this._events.removeListener)this.emit("removeListener",type,listener)}return this};EventEmitter.prototype.removeAllListeners=function(type){var key,listeners;if(!this._events)return this;if(!this._events.removeListener){if(arguments.length===0)this._events={};else if(this._events[type])delete this._events[type];return this}if(arguments.length===0){for(key in this._events){if(key==="removeListener")continue;this.removeAllListeners(key)}this.removeAllListeners("removeListener");this._events={};return this}listeners=this._events[type];if(isFunction(listeners)){this.removeListener(type,listeners)}else{while(listeners.length)this.removeListener(type,listeners[listeners.length-1])}delete this._events[type];return this};EventEmitter.prototype.listeners=function(type){var ret;if(!this._events||!this._events[type])ret=[];else if(isFunction(this._events[type]))ret=[this._events[type]];else ret=this._events[type].slice();return ret};EventEmitter.listenerCount=function(emitter,type){var ret;if(!emitter._events||!emitter._events[type])ret=0;else if(isFunction(emitter._events[type]))ret=1;else ret=emitter._events[type].length;return ret};function isFunction(arg){return typeof arg==="function"}function isNumber(arg){return typeof arg==="number"}function isObject(arg){return typeof arg==="object"&&arg!==null}function isUndefined(arg){return arg===void 0}},{}],7:[function(require,module,exports){if(typeof Object.create==="function"){module.exports=function inherits(ctor,superCtor){ctor.super_=superCtor;ctor.prototype=Object.create(superCtor.prototype,{constructor:{value:ctor,enumerable:false,writable:true,configurable:true}})}}else{module.exports=function inherits(ctor,superCtor){ctor.super_=superCtor;var TempCtor=function(){};TempCtor.prototype=superCtor.prototype;ctor.prototype=new TempCtor;ctor.prototype.constructor=ctor}}},{}],8:[function(require,module,exports){module.exports=Array.isArray||function(arr){return Object.prototype.toString.call(arr)=="[object Array]"}},{}],9:[function(require,module,exports){(function(process){function normalizeArray(parts,allowAboveRoot){var up=0;for(var i=parts.length-1;i>=0;i--){var last=parts[i];if(last==="."){parts.splice(i,1)}else if(last===".."){parts.splice(i,1);up++}else if(up){parts.splice(i,1);up--}}if(allowAboveRoot){for(;up--;up){parts.unshift("..")}}return parts}var splitPathRe=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/;var splitPath=function(filename){return splitPathRe.exec(filename).slice(1)};exports.resolve=function(){var resolvedPath="",resolvedAbsolute=false;for(var i=arguments.length-1;i>=-1&&!resolvedAbsolute;i--){var path=i>=0?arguments[i]:process.cwd();if(typeof path!=="string"){throw new TypeError("Arguments to path.resolve must be strings")}else if(!path){continue}resolvedPath=path+"/"+resolvedPath;resolvedAbsolute=path.charAt(0)==="/"}resolvedPath=normalizeArray(filter(resolvedPath.split("/"),function(p){return!!p}),!resolvedAbsolute).join("/");return(resolvedAbsolute?"/":"")+resolvedPath||"."};exports.normalize=function(path){var isAbsolute=exports.isAbsolute(path),trailingSlash=substr(path,-1)==="/";path=normalizeArray(filter(path.split("/"),function(p){return!!p}),!isAbsolute).join("/");if(!path&&!isAbsolute){path="."}if(path&&trailingSlash){path+="/"}return(isAbsolute?"/":"")+path};exports.isAbsolute=function(path){return path.charAt(0)==="/"};exports.join=function(){var paths=Array.prototype.slice.call(arguments,0);return exports.normalize(filter(paths,function(p,index){if(typeof p!=="string"){throw new TypeError("Arguments to path.join must be strings")}return p}).join("/"))};exports.relative=function(from,to){from=exports.resolve(from).substr(1);to=exports.resolve(to).substr(1);function trim(arr){var start=0;for(;start<arr.length;start++){if(arr[start]!=="")break}var end=arr.length-1;for(;end>=0;end--){if(arr[end]!=="")break}if(start>end)return[];return arr.slice(start,end-start+1)}var fromParts=trim(from.split("/"));var toParts=trim(to.split("/"));var length=Math.min(fromParts.length,toParts.length);var samePartsLength=length;for(var i=0;i<length;i++){if(fromParts[i]!==toParts[i]){samePartsLength=i;break}}var outputParts=[];for(var i=samePartsLength;i<fromParts.length;i++){outputParts.push("..")}outputParts=outputParts.concat(toParts.slice(samePartsLength));return outputParts.join("/")};exports.sep="/";exports.delimiter=":";exports.dirname=function(path){var result=splitPath(path),root=result[0],dir=result[1];if(!root&&!dir){return"."}if(dir){dir=dir.substr(0,dir.length-1)}return root+dir};exports.basename=function(path,ext){var f=splitPath(path)[2];if(ext&&f.substr(-1*ext.length)===ext){f=f.substr(0,f.length-ext.length)}return f};exports.extname=function(path){return splitPath(path)[3]};function filter(xs,f){if(xs.filter)return xs.filter(f);var res=[];for(var i=0;i<xs.length;i++){if(f(xs[i],i,xs))res.push(xs[i])}return res}var substr="ab".substr(-1)==="b"?function(str,start,len){return str.substr(start,len)}:function(str,start,len){if(start<0)start=str.length+start;return str.substr(start,len)}}).call(this,require("_process"))},{_process:10}],10:[function(require,module,exports){var process=module.exports={};var queue=[];var draining=false;function drainQueue(){if(draining){return}draining=true;var currentQueue;var len=queue.length;while(len){currentQueue=queue;queue=[];var i=-1;while(++i<len){currentQueue[i]()}len=queue.length}draining=false}process.nextTick=function(fun){queue.push(fun);if(!draining){setTimeout(drainQueue,0)}};process.title="browser";process.browser=true;process.env={};process.argv=[];process.version="";function noop(){}process.on=noop;process.addListener=noop;process.once=noop;process.off=noop;process.removeListener=noop;process.removeAllListeners=noop;process.emit=noop;process.binding=function(name){throw new Error("process.binding is not supported")};process.cwd=function(){return"/"};process.chdir=function(dir){throw new Error("process.chdir is not supported")};process.umask=function(){return 0}},{}],11:[function(require,module,exports){module.exports=require("./lib/_stream_duplex.js")},{"./lib/_stream_duplex.js":12}],12:[function(require,module,exports){(function(process){module.exports=Duplex;var objectKeys=Object.keys||function(obj){var keys=[];for(var key in obj)keys.push(key);return keys};var util=require("core-util-is");util.inherits=require("inherits");var Readable=require("./_stream_readable");var Writable=require("./_stream_writable");util.inherits(Duplex,Readable);forEach(objectKeys(Writable.prototype),function(method){if(!Duplex.prototype[method])Duplex.prototype[method]=Writable.prototype[method]});function Duplex(options){if(!(this instanceof Duplex))return new Duplex(options);Readable.call(this,options);Writable.call(this,options);if(options&&options.readable===false)this.readable=false;if(options&&options.writable===false)this.writable=false;this.allowHalfOpen=true;if(options&&options.allowHalfOpen===false)this.allowHalfOpen=false;this.once("end",onend)}function onend(){if(this.allowHalfOpen||this._writableState.ended)return;process.nextTick(this.end.bind(this))}function forEach(xs,f){for(var i=0,l=xs.length;i<l;i++){f(xs[i],i)}}}).call(this,require("_process"))},{"./_stream_readable":14,"./_stream_writable":16,_process:10,"core-util-is":17,inherits:7}],13:[function(require,module,exports){module.exports=PassThrough;var Transform=require("./_stream_transform");var util=require("core-util-is");util.inherits=require("inherits");util.inherits(PassThrough,Transform);function PassThrough(options){if(!(this instanceof PassThrough))return new PassThrough(options);Transform.call(this,options)}PassThrough.prototype._transform=function(chunk,encoding,cb){cb(null,chunk)}},{"./_stream_transform":15,"core-util-is":17,inherits:7}],14:[function(require,module,exports){(function(process){module.exports=Readable;var isArray=require("isarray");var Buffer=require("buffer").Buffer;Readable.ReadableState=ReadableState;var EE=require("events").EventEmitter;if(!EE.listenerCount)EE.listenerCount=function(emitter,type){return emitter.listeners(type).length};var Stream=require("stream");var util=require("core-util-is");util.inherits=require("inherits");var StringDecoder;util.inherits(Readable,Stream);function ReadableState(options,stream){options=options||{};var hwm=options.highWaterMark;this.highWaterMark=hwm||hwm===0?hwm:16*1024;this.highWaterMark=~~this.highWaterMark;this.buffer=[];this.length=0;this.pipes=null;this.pipesCount=0;this.flowing=false;this.ended=false;this.endEmitted=false;this.reading=false;this.calledRead=false;this.sync=true;this.needReadable=false;this.emittedReadable=false;this.readableListening=false;this.objectMode=!!options.objectMode;this.defaultEncoding=options.defaultEncoding||"utf8";this.ranOut=false;this.awaitDrain=0;this.readingMore=false;this.decoder=null;this.encoding=null;if(options.encoding){if(!StringDecoder)StringDecoder=require("string_decoder/").StringDecoder;this.decoder=new StringDecoder(options.encoding);this.encoding=options.encoding}}function Readable(options){if(!(this instanceof Readable))return new Readable(options);this._readableState=new ReadableState(options,this);this.readable=true;Stream.call(this)}Readable.prototype.push=function(chunk,encoding){var state=this._readableState;if(typeof chunk==="string"&&!state.objectMode){encoding=encoding||state.defaultEncoding;if(encoding!==state.encoding){chunk=new Buffer(chunk,encoding);encoding=""}}return readableAddChunk(this,state,chunk,encoding,false)};Readable.prototype.unshift=function(chunk){var state=this._readableState;return readableAddChunk(this,state,chunk,"",true)};function readableAddChunk(stream,state,chunk,encoding,addToFront){var er=chunkInvalid(state,chunk);if(er){stream.emit("error",er)}else if(chunk===null||chunk===undefined){state.reading=false;if(!state.ended)onEofChunk(stream,state)}else if(state.objectMode||chunk&&chunk.length>0){if(state.ended&&!addToFront){var e=new Error("stream.push() after EOF");stream.emit("error",e)}else if(state.endEmitted&&addToFront){var e=new Error("stream.unshift() after end event");stream.emit("error",e)}else{if(state.decoder&&!addToFront&&!encoding)chunk=state.decoder.write(chunk);state.length+=state.objectMode?1:chunk.length;if(addToFront){state.buffer.unshift(chunk)}else{state.reading=false;state.buffer.push(chunk)}if(state.needReadable)emitReadable(stream);maybeReadMore(stream,state)}}else if(!addToFront){state.reading=false}return needMoreData(state)}function needMoreData(state){return!state.ended&&(state.needReadable||state.length<state.highWaterMark||state.length===0)}Readable.prototype.setEncoding=function(enc){if(!StringDecoder)StringDecoder=require("string_decoder/").StringDecoder;this._readableState.decoder=new StringDecoder(enc);this._readableState.encoding=enc};var MAX_HWM=8388608;function roundUpToNextPowerOf2(n){if(n>=MAX_HWM){n=MAX_HWM}else{n--;for(var p=1;p<32;p<<=1)n|=n>>p;n++}return n}function howMuchToRead(n,state){if(state.length===0&&state.ended)return 0;if(state.objectMode)return n===0?0:1;if(n===null||isNaN(n)){if(state.flowing&&state.buffer.length)return state.buffer[0].length;else return state.length}if(n<=0)return 0;if(n>state.highWaterMark)state.highWaterMark=roundUpToNextPowerOf2(n);if(n>state.length){if(!state.ended){state.needReadable=true;return 0}else return state.length}return n}Readable.prototype.read=function(n){var state=this._readableState;state.calledRead=true;var nOrig=n;var ret;if(typeof n!=="number"||n>0)state.emittedReadable=false;if(n===0&&state.needReadable&&(state.length>=state.highWaterMark||state.ended)){emitReadable(this);return null}n=howMuchToRead(n,state);if(n===0&&state.ended){ret=null;if(state.length>0&&state.decoder){ret=fromList(n,state);state.length-=ret.length}if(state.length===0)endReadable(this);return ret}var doRead=state.needReadable;if(state.length-n<=state.highWaterMark)doRead=true;if(state.ended||state.reading)doRead=false;if(doRead){state.reading=true;state.sync=true;if(state.length===0)state.needReadable=true;this._read(state.highWaterMark);state.sync=false}if(doRead&&!state.reading)n=howMuchToRead(nOrig,state);if(n>0)ret=fromList(n,state);else ret=null;if(ret===null){state.needReadable=true;n=0}state.length-=n;if(state.length===0&&!state.ended)state.needReadable=true;if(state.ended&&!state.endEmitted&&state.length===0)endReadable(this);return ret};function chunkInvalid(state,chunk){var er=null;if(!Buffer.isBuffer(chunk)&&"string"!==typeof chunk&&chunk!==null&&chunk!==undefined&&!state.objectMode){er=new TypeError("Invalid non-string/buffer chunk")}return er}function onEofChunk(stream,state){if(state.decoder&&!state.ended){var chunk=state.decoder.end();if(chunk&&chunk.length){state.buffer.push(chunk);state.length+=state.objectMode?1:chunk.length}}state.ended=true;if(state.length>0)emitReadable(stream);else endReadable(stream)}function emitReadable(stream){var state=stream._readableState;state.needReadable=false;if(state.emittedReadable)return;state.emittedReadable=true;if(state.sync)process.nextTick(function(){emitReadable_(stream)});else emitReadable_(stream)}function emitReadable_(stream){stream.emit("readable")}function maybeReadMore(stream,state){if(!state.readingMore){state.readingMore=true;process.nextTick(function(){maybeReadMore_(stream,state)})}}function maybeReadMore_(stream,state){var len=state.length;while(!state.reading&&!state.flowing&&!state.ended&&state.length<state.highWaterMark){stream.read(0);if(len===state.length)break;else len=state.length}state.readingMore=false}Readable.prototype._read=function(n){this.emit("error",new Error("not implemented"))};Readable.prototype.pipe=function(dest,pipeOpts){var src=this;var state=this._readableState;switch(state.pipesCount){case 0:state.pipes=dest;break;case 1:state.pipes=[state.pipes,dest];break;default:state.pipes.push(dest);break}state.pipesCount+=1;var doEnd=(!pipeOpts||pipeOpts.end!==false)&&dest!==process.stdout&&dest!==process.stderr;var endFn=doEnd?onend:cleanup;if(state.endEmitted)process.nextTick(endFn);else src.once("end",endFn);dest.on("unpipe",onunpipe);function onunpipe(readable){if(readable!==src)return;cleanup()}function onend(){dest.end()}var ondrain=pipeOnDrain(src);dest.on("drain",ondrain);function cleanup(){dest.removeListener("close",onclose);dest.removeListener("finish",onfinish);dest.removeListener("drain",ondrain);dest.removeListener("error",onerror);dest.removeListener("unpipe",onunpipe);src.removeListener("end",onend);src.removeListener("end",cleanup);if(!dest._writableState||dest._writableState.needDrain)ondrain()}function onerror(er){unpipe();dest.removeListener("error",onerror);if(EE.listenerCount(dest,"error")===0)dest.emit("error",er)}if(!dest._events||!dest._events.error)dest.on("error",onerror);else if(isArray(dest._events.error))dest._events.error.unshift(onerror);else dest._events.error=[onerror,dest._events.error];function onclose(){dest.removeListener("finish",onfinish);unpipe()}dest.once("close",onclose);function onfinish(){dest.removeListener("close",onclose);unpipe()}dest.once("finish",onfinish);function unpipe(){src.unpipe(dest)}dest.emit("pipe",src);if(!state.flowing){this.on("readable",pipeOnReadable);state.flowing=true;process.nextTick(function(){flow(src)})}return dest};function pipeOnDrain(src){return function(){var dest=this;var state=src._readableState;state.awaitDrain--;if(state.awaitDrain===0)flow(src)}}function flow(src){var state=src._readableState;var chunk;state.awaitDrain=0;function write(dest,i,list){var written=dest.write(chunk);if(false===written){state.awaitDrain++}}while(state.pipesCount&&null!==(chunk=src.read())){if(state.pipesCount===1)write(state.pipes,0,null);else forEach(state.pipes,write);src.emit("data",chunk);if(state.awaitDrain>0)return}if(state.pipesCount===0){state.flowing=false;if(EE.listenerCount(src,"data")>0)emitDataEvents(src);return}state.ranOut=true}function pipeOnReadable(){if(this._readableState.ranOut){this._readableState.ranOut=false;flow(this)}}Readable.prototype.unpipe=function(dest){var state=this._readableState;if(state.pipesCount===0)return this;if(state.pipesCount===1){if(dest&&dest!==state.pipes)return this;if(!dest)dest=state.pipes;state.pipes=null;state.pipesCount=0;this.removeListener("readable",pipeOnReadable);state.flowing=false;if(dest)dest.emit("unpipe",this);return this}if(!dest){var dests=state.pipes;var len=state.pipesCount;state.pipes=null;state.pipesCount=0;this.removeListener("readable",pipeOnReadable);state.flowing=false;for(var i=0;i<len;i++)dests[i].emit("unpipe",this);return this}var i=indexOf(state.pipes,dest);if(i===-1)return this;state.pipes.splice(i,1);state.pipesCount-=1;if(state.pipesCount===1)state.pipes=state.pipes[0];dest.emit("unpipe",this);return this};Readable.prototype.on=function(ev,fn){var res=Stream.prototype.on.call(this,ev,fn);if(ev==="data"&&!this._readableState.flowing)emitDataEvents(this);if(ev==="readable"&&this.readable){var state=this._readableState;if(!state.readableListening){state.readableListening=true;state.emittedReadable=false;state.needReadable=true;if(!state.reading){this.read(0)}else if(state.length){emitReadable(this,state)}}}return res};Readable.prototype.addListener=Readable.prototype.on;Readable.prototype.resume=function(){emitDataEvents(this);this.read(0);this.emit("resume")};Readable.prototype.pause=function(){emitDataEvents(this,true);this.emit("pause")};function emitDataEvents(stream,startPaused){var state=stream._readableState;if(state.flowing){throw new Error("Cannot switch to old mode now.")}var paused=startPaused||false;var readable=false;stream.readable=true;stream.pipe=Stream.prototype.pipe;stream.on=stream.addListener=Stream.prototype.on;stream.on("readable",function(){readable=true;var c;while(!paused&&null!==(c=stream.read()))stream.emit("data",c);if(c===null){readable=false;stream._readableState.needReadable=true}});stream.pause=function(){paused=true;this.emit("pause")};stream.resume=function(){paused=false;if(readable)process.nextTick(function(){stream.emit("readable")});else this.read(0);this.emit("resume")};stream.emit("readable")}Readable.prototype.wrap=function(stream){var state=this._readableState;var paused=false;var self=this;stream.on("end",function(){if(state.decoder&&!state.ended){var chunk=state.decoder.end();if(chunk&&chunk.length)self.push(chunk)}self.push(null)});stream.on("data",function(chunk){if(state.decoder)chunk=state.decoder.write(chunk);if(state.objectMode&&(chunk===null||chunk===undefined))return;else if(!state.objectMode&&(!chunk||!chunk.length))return;var ret=self.push(chunk);if(!ret){paused=true;stream.pause()}});for(var i in stream){if(typeof stream[i]==="function"&&typeof this[i]==="undefined"){this[i]=function(method){return function(){return stream[method].apply(stream,arguments)}}(i)}}var events=["error","close","destroy","pause","resume"];forEach(events,function(ev){stream.on(ev,self.emit.bind(self,ev))});self._read=function(n){if(paused){paused=false;stream.resume()}};return self};Readable._fromList=fromList;function fromList(n,state){var list=state.buffer;var length=state.length;var stringMode=!!state.decoder;var objectMode=!!state.objectMode;var ret;if(list.length===0)return null;if(length===0)ret=null;else if(objectMode)ret=list.shift();else if(!n||n>=length){if(stringMode)ret=list.join("");else ret=Buffer.concat(list,length);list.length=0}else{if(n<list[0].length){var buf=list[0];ret=buf.slice(0,n);list[0]=buf.slice(n)}else if(n===list[0].length){ret=list.shift()}else{if(stringMode)ret="";else ret=new Buffer(n);var c=0;for(var i=0,l=list.length;i<l&&c<n;i++){var buf=list[0];var cpy=Math.min(n-c,buf.length);if(stringMode)ret+=buf.slice(0,cpy);else buf.copy(ret,c,0,cpy);if(cpy<buf.length)list[0]=buf.slice(cpy);else list.shift();c+=cpy}}}return ret}function endReadable(stream){var state=stream._readableState;if(state.length>0)throw new Error("endReadable called on non-empty stream");if(!state.endEmitted&&state.calledRead){state.ended=true;process.nextTick(function(){if(!state.endEmitted&&state.length===0){state.endEmitted=true;stream.readable=false;stream.emit("end")}})}}function forEach(xs,f){for(var i=0,l=xs.length;i<l;i++){f(xs[i],i)}}function indexOf(xs,x){for(var i=0,l=xs.length;i<l;i++){if(xs[i]===x)return i}return-1}}).call(this,require("_process"))},{_process:10,buffer:2,"core-util-is":17,events:6,inherits:7,isarray:8,stream:22,"string_decoder/":23}],15:[function(require,module,exports){module.exports=Transform;var Duplex=require("./_stream_duplex");var util=require("core-util-is");util.inherits=require("inherits");util.inherits(Transform,Duplex);function TransformState(options,stream){this.afterTransform=function(er,data){return afterTransform(stream,er,data)};this.needTransform=false;this.transforming=false;this.writecb=null;this.writechunk=null}function afterTransform(stream,er,data){var ts=stream._transformState;ts.transforming=false;var cb=ts.writecb;if(!cb)return stream.emit("error",new Error("no writecb in Transform class"));ts.writechunk=null;ts.writecb=null;if(data!==null&&data!==undefined)stream.push(data);if(cb)cb(er);var rs=stream._readableState;rs.reading=false;if(rs.needReadable||rs.length<rs.highWaterMark){stream._read(rs.highWaterMark)}}function Transform(options){if(!(this instanceof Transform))return new Transform(options);Duplex.call(this,options);var ts=this._transformState=new TransformState(options,this);var stream=this;this._readableState.needReadable=true;this._readableState.sync=false;this.once("finish",function(){if("function"===typeof this._flush)this._flush(function(er){done(stream,er)});else done(stream)})}Transform.prototype.push=function(chunk,encoding){this._transformState.needTransform=false;return Duplex.prototype.push.call(this,chunk,encoding)};Transform.prototype._transform=function(chunk,encoding,cb){throw new Error("not implemented")};Transform.prototype._write=function(chunk,encoding,cb){var ts=this._transformState;ts.writecb=cb;ts.writechunk=chunk;ts.writeencoding=encoding;if(!ts.transforming){var rs=this._readableState;if(ts.needTransform||rs.needReadable||rs.length<rs.highWaterMark)this._read(rs.highWaterMark)}};Transform.prototype._read=function(n){var ts=this._transformState;if(ts.writechunk!==null&&ts.writecb&&!ts.transforming){ts.transforming=true;this._transform(ts.writechunk,ts.writeencoding,ts.afterTransform)}else{ts.needTransform=true}};function done(stream,er){if(er)return stream.emit("error",er);var ws=stream._writableState;var rs=stream._readableState;var ts=stream._transformState;if(ws.length)throw new Error("calling transform done when ws.length != 0");if(ts.transforming)throw new Error("calling transform done when still transforming");return stream.push(null)}},{"./_stream_duplex":12,"core-util-is":17,inherits:7}],16:[function(require,module,exports){(function(process){module.exports=Writable;var Buffer=require("buffer").Buffer;Writable.WritableState=WritableState;var util=require("core-util-is");util.inherits=require("inherits");var Stream=require("stream");util.inherits(Writable,Stream);function WriteReq(chunk,encoding,cb){this.chunk=chunk;this.encoding=encoding;this.callback=cb}function WritableState(options,stream){options=options||{};var hwm=options.highWaterMark;this.highWaterMark=hwm||hwm===0?hwm:16*1024;this.objectMode=!!options.objectMode;this.highWaterMark=~~this.highWaterMark;this.needDrain=false;this.ending=false;this.ended=false;this.finished=false;var noDecode=options.decodeStrings===false;this.decodeStrings=!noDecode;this.defaultEncoding=options.defaultEncoding||"utf8";this.length=0;this.writing=false;this.sync=true;this.bufferProcessing=false;this.onwrite=function(er){onwrite(stream,er)};this.writecb=null;this.writelen=0;this.buffer=[];this.errorEmitted=false}function Writable(options){var Duplex=require("./_stream_duplex");if(!(this instanceof Writable)&&!(this instanceof Duplex))return new Writable(options);this._writableState=new WritableState(options,this);this.writable=true;Stream.call(this)}Writable.prototype.pipe=function(){this.emit("error",new Error("Cannot pipe. Not readable."))};function writeAfterEnd(stream,state,cb){var er=new Error("write after end");stream.emit("error",er);process.nextTick(function(){cb(er)})}function validChunk(stream,state,chunk,cb){var valid=true;if(!Buffer.isBuffer(chunk)&&"string"!==typeof chunk&&chunk!==null&&chunk!==undefined&&!state.objectMode){var er=new TypeError("Invalid non-string/buffer chunk");stream.emit("error",er);process.nextTick(function(){cb(er)});valid=false}return valid}Writable.prototype.write=function(chunk,encoding,cb){var state=this._writableState;var ret=false;if(typeof encoding==="function"){cb=encoding;encoding=null}if(Buffer.isBuffer(chunk))encoding="buffer";else if(!encoding)encoding=state.defaultEncoding;if(typeof cb!=="function")cb=function(){};if(state.ended)writeAfterEnd(this,state,cb);else if(validChunk(this,state,chunk,cb))ret=writeOrBuffer(this,state,chunk,encoding,cb);return ret};function decodeChunk(state,chunk,encoding){if(!state.objectMode&&state.decodeStrings!==false&&typeof chunk==="string"){chunk=new Buffer(chunk,encoding)}return chunk}function writeOrBuffer(stream,state,chunk,encoding,cb){chunk=decodeChunk(state,chunk,encoding);if(Buffer.isBuffer(chunk))encoding="buffer";var len=state.objectMode?1:chunk.length;state.length+=len;var ret=state.length<state.highWaterMark;if(!ret)state.needDrain=true;if(state.writing)state.buffer.push(new WriteReq(chunk,encoding,cb));else doWrite(stream,state,len,chunk,encoding,cb);return ret}function doWrite(stream,state,len,chunk,encoding,cb){state.writelen=len;state.writecb=cb;state.writing=true;state.sync=true;stream._write(chunk,encoding,state.onwrite);state.sync=false}function onwriteError(stream,state,sync,er,cb){if(sync)process.nextTick(function(){cb(er)});else cb(er);stream._writableState.errorEmitted=true;stream.emit("error",er)}function onwriteStateUpdate(state){state.writing=false;state.writecb=null;state.length-=state.writelen;state.writelen=0}function onwrite(stream,er){var state=stream._writableState;var sync=state.sync;var cb=state.writecb;onwriteStateUpdate(state);if(er)onwriteError(stream,state,sync,er,cb);else{var finished=needFinish(stream,state);if(!finished&&!state.bufferProcessing&&state.buffer.length)clearBuffer(stream,state);if(sync){process.nextTick(function(){afterWrite(stream,state,finished,cb)})}else{afterWrite(stream,state,finished,cb)}}}function afterWrite(stream,state,finished,cb){if(!finished)onwriteDrain(stream,state);cb();if(finished)finishMaybe(stream,state)}function onwriteDrain(stream,state){if(state.length===0&&state.needDrain){state.needDrain=false;stream.emit("drain")}}function clearBuffer(stream,state){state.bufferProcessing=true;for(var c=0;c<state.buffer.length;c++){var entry=state.buffer[c];var chunk=entry.chunk;var encoding=entry.encoding;var cb=entry.callback;var len=state.objectMode?1:chunk.length;doWrite(stream,state,len,chunk,encoding,cb);if(state.writing){c++;break}}state.bufferProcessing=false;if(c<state.buffer.length)state.buffer=state.buffer.slice(c);else state.buffer.length=0}Writable.prototype._write=function(chunk,encoding,cb){cb(new Error("not implemented"))};Writable.prototype.end=function(chunk,encoding,cb){var state=this._writableState;if(typeof chunk==="function"){cb=chunk;chunk=null;encoding=null}else if(typeof encoding==="function"){cb=encoding;encoding=null}if(typeof chunk!=="undefined"&&chunk!==null)this.write(chunk,encoding);if(!state.ending&&!state.finished)endWritable(this,state,cb)};function needFinish(stream,state){return state.ending&&state.length===0&&!state.finished&&!state.writing}function finishMaybe(stream,state){var need=needFinish(stream,state);if(need){state.finished=true;stream.emit("finish")}return need}function endWritable(stream,state,cb){state.ending=true;finishMaybe(stream,state);if(cb){if(state.finished)process.nextTick(cb);else stream.once("finish",cb)}state.ended=true}}).call(this,require("_process"))},{"./_stream_duplex":12,_process:10,buffer:2,"core-util-is":17,inherits:7,stream:22}],17:[function(require,module,exports){(function(Buffer){function isArray(ar){return Array.isArray(ar)}exports.isArray=isArray;function isBoolean(arg){return typeof arg==="boolean"}exports.isBoolean=isBoolean;function isNull(arg){return arg===null}exports.isNull=isNull;function isNullOrUndefined(arg){return arg==null}exports.isNullOrUndefined=isNullOrUndefined;function isNumber(arg){return typeof arg==="number"}exports.isNumber=isNumber;function isString(arg){return typeof arg==="string"}exports.isString=isString;function isSymbol(arg){return typeof arg==="symbol"}exports.isSymbol=isSymbol;function isUndefined(arg){return arg===void 0}exports.isUndefined=isUndefined;function isRegExp(re){return isObject(re)&&objectToString(re)==="[object RegExp]"}exports.isRegExp=isRegExp;function isObject(arg){return typeof arg==="object"&&arg!==null}exports.isObject=isObject;function isDate(d){return isObject(d)&&objectToString(d)==="[object Date]"}exports.isDate=isDate;function isError(e){return isObject(e)&&(objectToString(e)==="[object Error]"||e instanceof Error)}exports.isError=isError;function isFunction(arg){return typeof arg==="function"}exports.isFunction=isFunction;function isPrimitive(arg){return arg===null||typeof arg==="boolean"||typeof arg==="number"||typeof arg==="string"||typeof arg==="symbol"||typeof arg==="undefined"}exports.isPrimitive=isPrimitive;function isBuffer(arg){return Buffer.isBuffer(arg)}exports.isBuffer=isBuffer;function objectToString(o){return Object.prototype.toString.call(o)}}).call(this,require("buffer").Buffer)},{buffer:2}],18:[function(require,module,exports){module.exports=require("./lib/_stream_passthrough.js")},{"./lib/_stream_passthrough.js":13}],19:[function(require,module,exports){var Stream=require("stream");exports=module.exports=require("./lib/_stream_readable.js");exports.Stream=Stream;exports.Readable=exports;exports.Writable=require("./lib/_stream_writable.js");exports.Duplex=require("./lib/_stream_duplex.js");exports.Transform=require("./lib/_stream_transform.js");exports.PassThrough=require("./lib/_stream_passthrough.js")},{"./lib/_stream_duplex.js":12,"./lib/_stream_passthrough.js":13,"./lib/_stream_readable.js":14,"./lib/_stream_transform.js":15,"./lib/_stream_writable.js":16,stream:22}],20:[function(require,module,exports){module.exports=require("./lib/_stream_transform.js")},{"./lib/_stream_transform.js":15}],21:[function(require,module,exports){module.exports=require("./lib/_stream_writable.js")},{"./lib/_stream_writable.js":16}],22:[function(require,module,exports){module.exports=Stream;var EE=require("events").EventEmitter;var inherits=require("inherits");inherits(Stream,EE);Stream.Readable=require("readable-stream/readable.js");Stream.Writable=require("readable-stream/writable.js");Stream.Duplex=require("readable-stream/duplex.js");Stream.Transform=require("readable-stream/transform.js");Stream.PassThrough=require("readable-stream/passthrough.js");Stream.Stream=Stream;function Stream(){EE.call(this)}Stream.prototype.pipe=function(dest,options){var source=this;function ondata(chunk){if(dest.writable){if(false===dest.write(chunk)&&source.pause){source.pause()}}}source.on("data",ondata);function ondrain(){if(source.readable&&source.resume){source.resume()}}dest.on("drain",ondrain);if(!dest._isStdio&&(!options||options.end!==false)){source.on("end",onend);source.on("close",onclose)}var didOnEnd=false;function onend(){if(didOnEnd)return;didOnEnd=true;dest.end()}function onclose(){if(didOnEnd)return;didOnEnd=true;if(typeof dest.destroy==="function")dest.destroy()}function onerror(er){cleanup();if(EE.listenerCount(this,"error")===0){throw er}}source.on("error",onerror);dest.on("error",onerror);function cleanup(){source.removeListener("data",ondata);dest.removeListener("drain",ondrain);source.removeListener("end",onend);source.removeListener("close",onclose);
source.removeListener("error",onerror);dest.removeListener("error",onerror);source.removeListener("end",cleanup);source.removeListener("close",cleanup);dest.removeListener("close",cleanup)}source.on("end",cleanup);source.on("close",cleanup);dest.on("close",cleanup);dest.emit("pipe",source);return dest}},{events:6,inherits:7,"readable-stream/duplex.js":11,"readable-stream/passthrough.js":18,"readable-stream/readable.js":19,"readable-stream/transform.js":20,"readable-stream/writable.js":21}],23:[function(require,module,exports){var Buffer=require("buffer").Buffer;var isBufferEncoding=Buffer.isEncoding||function(encoding){switch(encoding&&encoding.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return true;default:return false}};function assertEncoding(encoding){if(encoding&&!isBufferEncoding(encoding)){throw new Error("Unknown encoding: "+encoding)}}var StringDecoder=exports.StringDecoder=function(encoding){this.encoding=(encoding||"utf8").toLowerCase().replace(/[-_]/,"");assertEncoding(encoding);switch(this.encoding){case"utf8":this.surrogateSize=3;break;case"ucs2":case"utf16le":this.surrogateSize=2;this.detectIncompleteChar=utf16DetectIncompleteChar;break;case"base64":this.surrogateSize=3;this.detectIncompleteChar=base64DetectIncompleteChar;break;default:this.write=passThroughWrite;return}this.charBuffer=new Buffer(6);this.charReceived=0;this.charLength=0};StringDecoder.prototype.write=function(buffer){var charStr="";while(this.charLength){var available=buffer.length>=this.charLength-this.charReceived?this.charLength-this.charReceived:buffer.length;buffer.copy(this.charBuffer,this.charReceived,0,available);this.charReceived+=available;if(this.charReceived<this.charLength){return""}buffer=buffer.slice(available,buffer.length);charStr=this.charBuffer.slice(0,this.charLength).toString(this.encoding);var charCode=charStr.charCodeAt(charStr.length-1);if(charCode>=55296&&charCode<=56319){this.charLength+=this.surrogateSize;charStr="";continue}this.charReceived=this.charLength=0;if(buffer.length===0){return charStr}break}this.detectIncompleteChar(buffer);var end=buffer.length;if(this.charLength){buffer.copy(this.charBuffer,0,buffer.length-this.charReceived,end);end-=this.charReceived}charStr+=buffer.toString(this.encoding,0,end);var end=charStr.length-1;var charCode=charStr.charCodeAt(end);if(charCode>=55296&&charCode<=56319){var size=this.surrogateSize;this.charLength+=size;this.charReceived+=size;this.charBuffer.copy(this.charBuffer,size,0,size);buffer.copy(this.charBuffer,0,0,size);return charStr.substring(0,end)}return charStr};StringDecoder.prototype.detectIncompleteChar=function(buffer){var i=buffer.length>=3?3:buffer.length;for(;i>0;i--){var c=buffer[buffer.length-i];if(i==1&&c>>5==6){this.charLength=2;break}if(i<=2&&c>>4==14){this.charLength=3;break}if(i<=3&&c>>3==30){this.charLength=4;break}}this.charReceived=i};StringDecoder.prototype.end=function(buffer){var res="";if(buffer&&buffer.length)res=this.write(buffer);if(this.charReceived){var cr=this.charReceived;var buf=this.charBuffer;var enc=this.encoding;res+=buf.slice(0,cr).toString(enc)}return res};function passThroughWrite(buffer){return buffer.toString(this.encoding)}function utf16DetectIncompleteChar(buffer){this.charReceived=buffer.length%2;this.charLength=this.charReceived?2:0}function base64DetectIncompleteChar(buffer){this.charReceived=buffer.length%3;this.charLength=this.charReceived?3:0}},{buffer:2}],24:[function(require,module,exports){module.exports=function isBuffer(arg){return arg&&typeof arg==="object"&&typeof arg.copy==="function"&&typeof arg.fill==="function"&&typeof arg.readUInt8==="function"}},{}],25:[function(require,module,exports){(function(process,global){var formatRegExp=/%[sdj%]/g;exports.format=function(f){if(!isString(f)){var objects=[];for(var i=0;i<arguments.length;i++){objects.push(inspect(arguments[i]))}return objects.join(" ")}var i=1;var args=arguments;var len=args.length;var str=String(f).replace(formatRegExp,function(x){if(x==="%%")return"%";if(i>=len)return x;switch(x){case"%s":return String(args[i++]);case"%d":return Number(args[i++]);case"%j":try{return JSON.stringify(args[i++])}catch(_){return"[Circular]"}default:return x}});for(var x=args[i];i<len;x=args[++i]){if(isNull(x)||!isObject(x)){str+=" "+x}else{str+=" "+inspect(x)}}return str};exports.deprecate=function(fn,msg){if(isUndefined(global.process)){return function(){return exports.deprecate(fn,msg).apply(this,arguments)}}if(process.noDeprecation===true){return fn}var warned=false;function deprecated(){if(!warned){if(process.throwDeprecation){throw new Error(msg)}else if(process.traceDeprecation){console.trace(msg)}else{console.error(msg)}warned=true}return fn.apply(this,arguments)}return deprecated};var debugs={};var debugEnviron;exports.debuglog=function(set){if(isUndefined(debugEnviron))debugEnviron=process.env.NODE_DEBUG||"";set=set.toUpperCase();if(!debugs[set]){if(new RegExp("\\b"+set+"\\b","i").test(debugEnviron)){var pid=process.pid;debugs[set]=function(){var msg=exports.format.apply(exports,arguments);console.error("%s %d: %s",set,pid,msg)}}else{debugs[set]=function(){}}}return debugs[set]};function inspect(obj,opts){var ctx={seen:[],stylize:stylizeNoColor};if(arguments.length>=3)ctx.depth=arguments[2];if(arguments.length>=4)ctx.colors=arguments[3];if(isBoolean(opts)){ctx.showHidden=opts}else if(opts){exports._extend(ctx,opts)}if(isUndefined(ctx.showHidden))ctx.showHidden=false;if(isUndefined(ctx.depth))ctx.depth=2;if(isUndefined(ctx.colors))ctx.colors=false;if(isUndefined(ctx.customInspect))ctx.customInspect=true;if(ctx.colors)ctx.stylize=stylizeWithColor;return formatValue(ctx,obj,ctx.depth)}exports.inspect=inspect;inspect.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]};inspect.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"};function stylizeWithColor(str,styleType){var style=inspect.styles[styleType];if(style){return"["+inspect.colors[style][0]+"m"+str+"["+inspect.colors[style][1]+"m"}else{return str}}function stylizeNoColor(str,styleType){return str}function arrayToHash(array){var hash={};array.forEach(function(val,idx){hash[val]=true});return hash}function formatValue(ctx,value,recurseTimes){if(ctx.customInspect&&value&&isFunction(value.inspect)&&value.inspect!==exports.inspect&&!(value.constructor&&value.constructor.prototype===value)){var ret=value.inspect(recurseTimes,ctx);if(!isString(ret)){ret=formatValue(ctx,ret,recurseTimes)}return ret}var primitive=formatPrimitive(ctx,value);if(primitive){return primitive}var keys=Object.keys(value);var visibleKeys=arrayToHash(keys);if(ctx.showHidden){keys=Object.getOwnPropertyNames(value)}if(isError(value)&&(keys.indexOf("message")>=0||keys.indexOf("description")>=0)){return formatError(value)}if(keys.length===0){if(isFunction(value)){var name=value.name?": "+value.name:"";return ctx.stylize("[Function"+name+"]","special")}if(isRegExp(value)){return ctx.stylize(RegExp.prototype.toString.call(value),"regexp")}if(isDate(value)){return ctx.stylize(Date.prototype.toString.call(value),"date")}if(isError(value)){return formatError(value)}}var base="",array=false,braces=["{","}"];if(isArray(value)){array=true;braces=["[","]"]}if(isFunction(value)){var n=value.name?": "+value.name:"";base=" [Function"+n+"]"}if(isRegExp(value)){base=" "+RegExp.prototype.toString.call(value)}if(isDate(value)){base=" "+Date.prototype.toUTCString.call(value)}if(isError(value)){base=" "+formatError(value)}if(keys.length===0&&(!array||value.length==0)){return braces[0]+base+braces[1]}if(recurseTimes<0){if(isRegExp(value)){return ctx.stylize(RegExp.prototype.toString.call(value),"regexp")}else{return ctx.stylize("[Object]","special")}}ctx.seen.push(value);var output;if(array){output=formatArray(ctx,value,recurseTimes,visibleKeys,keys)}else{output=keys.map(function(key){return formatProperty(ctx,value,recurseTimes,visibleKeys,key,array)})}ctx.seen.pop();return reduceToSingleString(output,base,braces)}function formatPrimitive(ctx,value){if(isUndefined(value))return ctx.stylize("undefined","undefined");if(isString(value)){var simple="'"+JSON.stringify(value).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return ctx.stylize(simple,"string")}if(isNumber(value))return ctx.stylize(""+value,"number");if(isBoolean(value))return ctx.stylize(""+value,"boolean");if(isNull(value))return ctx.stylize("null","null")}function formatError(value){return"["+Error.prototype.toString.call(value)+"]"}function formatArray(ctx,value,recurseTimes,visibleKeys,keys){var output=[];for(var i=0,l=value.length;i<l;++i){if(hasOwnProperty(value,String(i))){output.push(formatProperty(ctx,value,recurseTimes,visibleKeys,String(i),true))}else{output.push("")}}keys.forEach(function(key){if(!key.match(/^\d+$/)){output.push(formatProperty(ctx,value,recurseTimes,visibleKeys,key,true))}});return output}function formatProperty(ctx,value,recurseTimes,visibleKeys,key,array){var name,str,desc;desc=Object.getOwnPropertyDescriptor(value,key)||{value:value[key]};if(desc.get){if(desc.set){str=ctx.stylize("[Getter/Setter]","special")}else{str=ctx.stylize("[Getter]","special")}}else{if(desc.set){str=ctx.stylize("[Setter]","special")}}if(!hasOwnProperty(visibleKeys,key)){name="["+key+"]"}if(!str){if(ctx.seen.indexOf(desc.value)<0){if(isNull(recurseTimes)){str=formatValue(ctx,desc.value,null)}else{str=formatValue(ctx,desc.value,recurseTimes-1)}if(str.indexOf("\n")>-1){if(array){str=str.split("\n").map(function(line){return"  "+line}).join("\n").substr(2)}else{str="\n"+str.split("\n").map(function(line){return"   "+line}).join("\n")}}}else{str=ctx.stylize("[Circular]","special")}}if(isUndefined(name)){if(array&&key.match(/^\d+$/)){return str}name=JSON.stringify(""+key);if(name.match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)){name=name.substr(1,name.length-2);name=ctx.stylize(name,"name")}else{name=name.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'");name=ctx.stylize(name,"string")}}return name+": "+str}function reduceToSingleString(output,base,braces){var numLinesEst=0;var length=output.reduce(function(prev,cur){numLinesEst++;if(cur.indexOf("\n")>=0)numLinesEst++;return prev+cur.replace(/\u001b\[\d\d?m/g,"").length+1},0);if(length>60){return braces[0]+(base===""?"":base+"\n ")+" "+output.join(",\n  ")+" "+braces[1]}return braces[0]+base+" "+output.join(", ")+" "+braces[1]}function isArray(ar){return Array.isArray(ar)}exports.isArray=isArray;function isBoolean(arg){return typeof arg==="boolean"}exports.isBoolean=isBoolean;function isNull(arg){return arg===null}exports.isNull=isNull;function isNullOrUndefined(arg){return arg==null}exports.isNullOrUndefined=isNullOrUndefined;function isNumber(arg){return typeof arg==="number"}exports.isNumber=isNumber;function isString(arg){return typeof arg==="string"}exports.isString=isString;function isSymbol(arg){return typeof arg==="symbol"}exports.isSymbol=isSymbol;function isUndefined(arg){return arg===void 0}exports.isUndefined=isUndefined;function isRegExp(re){return isObject(re)&&objectToString(re)==="[object RegExp]"}exports.isRegExp=isRegExp;function isObject(arg){return typeof arg==="object"&&arg!==null}exports.isObject=isObject;function isDate(d){return isObject(d)&&objectToString(d)==="[object Date]"}exports.isDate=isDate;function isError(e){return isObject(e)&&(objectToString(e)==="[object Error]"||e instanceof Error)}exports.isError=isError;function isFunction(arg){return typeof arg==="function"}exports.isFunction=isFunction;function isPrimitive(arg){return arg===null||typeof arg==="boolean"||typeof arg==="number"||typeof arg==="string"||typeof arg==="symbol"||typeof arg==="undefined"}exports.isPrimitive=isPrimitive;exports.isBuffer=require("./support/isBuffer");function objectToString(o){return Object.prototype.toString.call(o)}function pad(n){return n<10?"0"+n.toString(10):n.toString(10)}var months=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function timestamp(){var d=new Date;var time=[pad(d.getHours()),pad(d.getMinutes()),pad(d.getSeconds())].join(":");return[d.getDate(),months[d.getMonth()],time].join(" ")}exports.log=function(){console.log("%s - %s",timestamp(),exports.format.apply(exports,arguments))};exports.inherits=require("inherits");exports._extend=function(origin,add){if(!add||!isObject(add))return origin;var keys=Object.keys(add);var i=keys.length;while(i--){origin[keys[i]]=add[keys[i]]}return origin};function hasOwnProperty(obj,prop){return Object.prototype.hasOwnProperty.call(obj,prop)}}).call(this,require("_process"),typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"./support/isBuffer":24,_process:10,inherits:7}],26:[function(require,module,exports){module.exports=function(dest){for(var i=1;i<arguments.length;i++){if(!arguments[i])continue;for(var name in arguments[i]){dest[name]=arguments[i][name]}}return dest}},{}],27:[function(require,module,exports){var React=require("react"),$__0=require("react-router"),Navigation=$__0.Navigation,State=$__0.State,PT=React.PropTypes,KeysMixin=require("../keys-mixin"),Dropload=require("./dropload"),Importer=require("./importer"),NewFile=require("./new-file"),Morph=require("../helpers/morph"),readFile=require("./read-file");var BrowseHeader=React.createClass({displayName:"BrowseHeader",mixins:[KeysMixin,Morph],propTypes:{onUpdated:PT.func,store:PT.object,fileslib:PT.object,plugins:PT.object,keys:PT.func},statics:{keys:function(){return{"n, c":function(){return this.setState({open:"new"})}.bind(this),i:function(){return this.setState({open:"import"})}.bind(this)}}},getInitialState:function(){return{open:false}},_onNewOpen:function(what,open){this.setState({open:open?what:null})},_onSourced:function(data,source){if("string"===typeof data){try{data=JSON.parse(data)}catch(e){return console.warn("failed to import file")}}this.props.fileslib.importRaw(data,function(err,file){this.props.fileslib.update(file.id,{source:source},function(err){this.props.onUpdated()}.bind(this))}.bind(this))},_onImport:function(files){if(!files.length)return console.warn("no files");var reader=readFile(files[0],function(err,text){if(err){return this.setState({open:null,importError:err.message,importing:false})}this.setState({importError:null,importing:false});this.props.fileslib.importRaw(text,function(err){if(err){return this.setState({open:null,importError:err.message,importing:false})}this.props.onUpdated()}.bind(this))}.bind(this));this.setState({open:null,importing:reader,importError:false})},render:function(){var opener;if(this.state.open==="import"){opener=React.createElement(Importer,{onSourced:this._onSourced,onClose:this._onNewOpen.bind(null,"import",false),keys:this.props.keys})}else if(this.state.open==="new"){opener=React.createElement(NewFile,{onSubmit:this.props.onNewFile,keys:this.props.keys,onClose:this._onNewOpen.bind(null,"new",false)})}else{opener=[React.createElement("div",{key:1,onClick:this._onNewOpen.bind(null,"new",true),className:"NewFile NewFile-closed"},"Create"),React.createElement("h1",{key:2,className:"Browse_title"},"Notablemind"),React.createElement("div",{key:3,onClick:this._onNewOpen.bind(null,"import"),className:"Importer Importer-closed"},"Import")]}return React.createElement("div",{className:"BrowseHeader"},React.createElement("div",{className:"BrowseHeader_opener"+(this.state.open?" BrowseHeader_opener-open":"")},opener),React.createElement(Dropload,{onDrop:this._onImport,message:"Drop anywhere to import"}),this.state.importError&&"Import Error: "+this.state.importError)}});module.exports=BrowseHeader},{"../helpers/morph":63,"../keys-mixin":65,"./dropload":33,"./importer":40,"./new-file":43,"./read-file":44,react:"react","react-router":259}],28:[function(require,module,exports){var React=require("react"),NewFile=require("./new-file"),Dropload=require("./dropload"),Importer=require("./importer"),Tabular=require("./tabular"),Dumper=require("./dumper"),readFile=require("./read-file"),treed=require("treed"),cx=React.addons.classSet,PT=React.PropTypes,history=require("./history"),kernels=require("../kernels"),async=require("async"),files=require("../files"),fuzzyTime=require("./fuzzy-time");var Browse=React.createClass({displayName:"Browse",propTypes:{onUpdated:PT.func.isRequired,onOpen:PT.func.isRequired,files:PT.array.isRequired,keys:PT.func.isRequired},getInitialState:function(){return{configuring:false,menu:null}},componentDidUpdate:function(prevProps,prevState){if(prevState.menu&&!this.state.menu){window.removeEventListener("mousedown",this._windowMouseDown)}else if(this.state.menu&&!prevState.menu){window.addEventListener("mousedown",this._windowMouseDown)}},componentWillUnmount:function(){window.removeEventListener("mousedown",this._windowMouseDown)},_windowMouseDown:function(){if(this.state.menu)this.setState({menu:null})},_onError:function(err){this.setState({loading:false,error:err})},_onNewFile:function(title,repl){this.setState({newing:null,error:null,loading:true});this.props.fileslib.create(title,repl,function(file,pl){return this.props.fileslib.init(file,pl,function(err,store,plugins){if(err){return this._onError(err)}this.props.onLoad(file,store,plugins)}.bind(this))}.bind(this))},_onMenu:function(file,e){e.preventDefault();this.setState({menu:{file:file,x:e.pageX,y:e.pageY}})},_setRepl:function(file,repl){this.props.fileslib.update(file.id,{repl:repl==="null"?null:repl},function(){this.props.onUpdated()}.bind(this))},_openNewTab:function(){var id=this.state.menu.file.id;this.setState({menu:null});window.open("?doc/"+id)},_exportFile:function(){},_deleteFile:function(){var id=this.state.menu.file.id;this.setState({menu:null});this.props.fileslib.remove(id,this.props.onUpdated)},_onRemoveFile:function(file){this.props.fileslib.remove(file.id,this.props.onUpdated)},_onDoneConfig:function(){this.setState({configuring:false})},renderConfig:function(file){return React.createElement("div",{className:"Browse_config"},React.createElement("ul",{className:"Browse_config_repls"},Object.keys(kernels).map(function(key){return React.createElement("li",{onClick:this._setRepl.bind(null,file,key),className:cx({Browse_config_repl:true,"Browse_config_repl-selected":key===file.repl+""})},kernels[key].title)}.bind(this))),React.createElement("button",{className:"Browse_config_remove",onClick:this._onRemoveFile.bind(null,file)},"Remove File"),React.createElement("button",{className:"Browse_config_done",onClick:this._onDoneConfig.bind(null,file)},"Done Config"))},_renderMenu:function(){var items=[{title:"Open in new tab",action:this._openNewTab},{title:"Delete",action:this._deleteFile}];return React.createElement("ul",{className:"Browse_menu",style:{top:this.state.menu.y,left:this.state.menu.x}},items.map(function(item,i){return React.createElement("li",{key:i,onMouseDown:function(e){return e.stopPropagation()},onClick:item.action,className:"Browse_menu_item"},item.title)}))},render:function(){if(this.state.loading){return React.createElement("div",{className:"Browse Browse-loading"},"Loading...")}return React.createElement("div",{className:"Browse"},React.createElement(Tabular,{keys:this.props.keys,items:this.props.files,onSelect:this.props.onOpen,emptyText:"No documents",extraKeys:{"ctrl+return":function(item){return window.open("#/doc/"+item.id)}},onMenu:this._onMenu,searchHeaders:["Name"],initialSort:"Opened",sortHeaders:{Modified:function(file){return-file.modified||0},Opened:function(file){return-file.opened||0}},headers:{Name:function(file){return file.title},Repl:function(file){return["null","none"].indexOf(file.repl)===-1?file.repl:""},Sync:function(file){return file.source?file.source.type:null},Modified:function(file){return file.modified?fuzzyTime(file.modified):null},Opened:function(file){return fuzzyTime(file.opened)}},headerWidths:{Repl:100,Source:100}}),this.state.menu&&this._renderMenu())}});module.exports=Browse},{"../files":61,"../kernels":64,"./dropload":33,"./dumper":34,"./fuzzy-time":37,"./history":39,"./importer":40,"./new-file":43,"./read-file":44,"./tabular":51,async:"async",react:"react",treed:300}],29:[function(require,module,exports){var React=require("react"),$__0=require("react-router"),Navigation=$__0.Navigation,State=$__0.State,PT=React.PropTypes,Dupload=require("./dupload"),Saver=require("./saver");var DocHeader=React.createClass({displayName:"DocHeader",propTypes:{file:PT.object.isRequired,store:PT.object.isRequired,saver:PT.node,savingEnabled:PT.bool,onClose:PT.func},getDefaultProps:function(){return{savingEnabled:false}},_keyDown:function(e){if(e.key==="Enter"||e.key==="Escape"){e.preventDefault();return this._doneEditing()}},render:function(){var headStore=this.props.store.headerView();return React.createElement("div",{className:"DocHeader"},React.createElement("span",{className:"DocHeader_name"},React.createElement("a",{target:"_blank",href:"http://notablemind.github.io"},"Notablemind"),React.createElement("a",{target:"_blank",href:"http://github.com/notablemind/notablemind"},React.createElement("i",{className:"fa fa-github-alt"}))),!!this.props.onClose&&React.createElement("button",{className:"DocHeader_home",onClick:this.props.onClose},"Home"),React.createElement("span",{className:"DocHeader_title"},this.props.file.title),React.createElement(Dupload,{store:this.props.store}),this.props.plugins.map(function(plugin){return plugin.view&&plugin.view.global&&plugin.view.global(headStore)}),React.createElement(Saver,{onFileUpdate:this.props.onFileUpdate,store:this.props.store,file:this.props.file,value:this.props.file.source}))}});module.exports=DocHeader},{"./dupload":35,"./saver":45,react:"react","react-router":259}],30:[function(require,module,exports){var React=require("react"),$__0=require("react-router"),Link=$__0.Link,State=$__0.State,Navigation=$__0.Navigation,treed=require("treed"),KeysMixin=require("../keys-mixin"),TypeSwitcher=require("./type-switcher"),Tree=require("treed/views/tree"),SplitManager=require("./split-manager"),SearchPopper=require("./search-popper"),KeyboardHelper=require("./keyboard-helper"),uuid=require("../../lib/uuid"),PT=React.PropTypes,windowJump=require("./window-jump");function windowPos(windows,fn,pos){pos=pos||[];if(windows.leaf){if(fn(windows.value))return pos;return}var first=windowPos(windows.value.first,fn,pos.concat(["first"]));if(first)return first;var second=windowPos(windows.value.second,fn,pos.concat(["second"]));if(second)return second}function makePaneConfig(store,plugins,keys,root){var config=treed.viewConfig(store,plugins,{root:root});keys.addView(config.view.id,config.keys);return config}function hydrateWindows(windows,store,plugins,keys,windowMap){var id;if(windows.first.leaf){windows.first.value.config=makePaneConfig(store,plugins,keys,windows.first.value.root);id=uuid();windows.first.value.id=id;windowMap[id]=windows.first.value}else{hydrateWindows(windows.first.value,store,plugins,keys,windowMap)}if(windows.second.leaf){windows.second.value.config=makePaneConfig(store,plugins,keys,windows.second.value.root);id=uuid();windows.second.value.id=id;windowMap[id]=windows.second.value}else{hydrateWindows(windows.second.value,store,plugins,keys,windowMap)}}function hydrateInitialWindows(windows,store,plugins,keys){var windowMap={};if(windows.leaf){var id=uuid();windows.value.config=makePaneConfig(store,plugins,keys,windows.value.root);windows.value.id=id;windowMap[id]=windows.value;return windowMap}hydrateWindows(windows.value,store,plugins,keys,windowMap);return windowMap}var DocViewer=React.createClass({displayName:"DocViewer",mixins:[KeysMixin],statics:{keys:function(){return{"w l, w right":this._windowJump.bind(null,"right"),"w j, w down":this._windowJump.bind(null,"down"),"w k, w up":this._windowJump.bind(null,"up"),"w h, w left":this._windowJump.bind(null,"left"),"shift+; v s":this._split.bind(null,"horiz"),"shift+; s p":this._split.bind(null,"vert"),"shift+; q":this._remove,"/":this._startSearching}}},propTypes:{store:PT.object,file:PT.object,plugins:PT.array,keys:PT.object,viewTypes:PT.object,saveWindowConfig:PT.func},_onError:function(err){this.setState({loading:false,error:err})},getInitialState:function(){var windowConfig=this.props.file.windows||{leaf:true,ratio:.5,value:{root:null,type:"tree"}};var windowMap=hydrateInitialWindows(windowConfig,this.props.store,this.props.plugins,this.props.keys);return{windowConfig:windowConfig,windowMap:windowMap,searching:false}},getDefaultProps:function(){return{viewTypes:{tree:require("treed/views/tree"),paper:require("treed/views/paper"),focus:require("treed/views/focus")}}},findCurrentPane:function(){var vid=this.props.store.activeView;return windowPos(this.state.windowConfig,function(value){return value.config.view.view.id===vid})},_split:function(orient){var config=SplitManager.split(this.findCurrentPane(),orient,this.state.windowConfig,this.getNewWindowConfig);this._changeWindowConfig(config)},_remove:function(){var result=SplitManager.remove(this.findCurrentPane(),this.state.windowConfig);if(!result)return;this._onRemovedWindow(result.removed);this._changeWindowConfig(result.config)},_windowJump:function(direction){var currentView=this.props.store.activeView,nextId=windowJump(this.state.windowConfig,currentView,direction);if(false===nextId)return;this.props.store.activeView=nextId;this.props.store.changed(this.props.store.events.activeViewChanged())},getNewWindowConfig:function(currentConfig){var config=makePaneConfig(this.props.store,this.props.plugins,this.props.keys,currentConfig.root),id=uuid(),value={config:config,type:currentConfig.type,id:id,root:currentConfig.root};this.state.windowMap[id]=value;return value},_onRemovedWindow:function(window){var id=window.config.view.view.id;this.props.store.unregisterView(id)},_changeWindowConfig:function(windowConfig){this.props.saveWindowConfig(windowConfig,function(){return this.setState({windowConfig:windowConfig})}.bind(this))},_rebaseView:function(wid,root){var wmap=this.state.windowMap;wmap[wid].root=root;this.props.saveWindowConfig(this.state.windowConfig)},_changeViewType:function(wid,type){var wmap=this.state.windowMap;wmap[wid].type=type;this.setState({windowMap:wmap})},componentDidMount:function(){window.addEventListener("keydown",this._keyDown)},componentWillUnmount:function(){window.removeEventListener("keydown",this._keyDown)},_startSearching:function(e){if(this.props.store.views[this.props.store.activeView].mode==="insert")return true;this.setState({searching:true})},_searchItems:function(needle){var store=this.props.store,blackTypes=["ipython","code-playground"],view=store.views[store.activeView],root=view.root,db=store.db;var frontier=[root],found=[];while(frontier.length&&found.length<20){var next=db.nodes[frontier.shift()];if(next.content.trim().length&&blackTypes.indexOf(next.type)===-1&&(!needle||next.content.match(needle))){found.push(next)}if(next.children){frontier=frontier.concat(next.children)}}return found},_onSearchSelect:function(item,jump){var actions=this.props.store.currentViewActions();if(jump){actions.rebase(item.id)}else{actions.expandToAndSelect(item.id)}this.setState({searching:false})},_canGrabKeyboard:function(e){return this.props.store.views[this.props.store.activeView].mode!=="insert"&&["INPUT","TEXTAREA"].indexOf(e.target.nodeName)===-1},render:function(){var $__0=this.props,store=$__0.store,file=$__0.file,plugins=$__0.plugins;return React.createElement("div",{className:"DocViewer"},React.createElement(SplitManager,{cprops:{viewTypes:this.props.viewTypes,changeViewType:this._changeViewType,onRebase:this._rebaseView},comp:Pane,config:this.state.windowConfig,getNew:this.getNewWindowConfig,onRemove:this._onRemovedWindow,onChange:this._changeWindowConfig}),this.state.searching&&React.createElement(SearchPopper,{matchItems:this._searchItems,onClose:function(){return this.setState({searching:false})}.bind(this),onSelect:this._onSearchSelect}),React.createElement(KeyboardHelper,{canGrabKeyboard:this._canGrabKeyboard,keys:this.props.keys,plugins:this.props.store.allPlugins}))}});var Pane=React.createClass({displayName:"Pane",propTypes:{type:PT.string,viewTypes:PT.object,value:PT.object},_onRebase:function(){var view=this.props.value.config.view;this.props.onRebase(this.props.value.id,view.view.root)},componentDidMount:function(){var view=this.props.value.config.view;view.on(view.events.rootChanged(),this._onRebase)},componentWillUnmount:function(){var view=this.props.value.config.view;view.on(view.events.rootChanged(),this._onRebase)},render:function(){var config=this.props.value.config;var statusbar=[];config.props.plugins.map(function(plugin){if(!plugin.statusbar)return;statusbar.push(plugin.statusbar(config.props.store))});config.props.skipMix=["top"];var View=this.props.viewTypes[this.props.value.type];return React.createElement("div",{className:"App_pane App_pane-"+this.props.value.type},React.createElement("div",{className:"App_pane_top"},statusbar,React.createElement("div",{className:"App_pane_splitters"},React.createElement("button",{onClick:this.props.onSplit.bind(null,this.props.pos,"horiz")},"||"),React.createElement("button",{onClick:this.props.onSplit.bind(null,this.props.pos,"vert")}," = "),React.createElement("button",{onClick:this.props.onRemove.bind(null,this.props.pos)},"x")),React.createElement(TypeSwitcher,{types:this.props.viewTypes,type:this.props.value.type,onChange:this.props.changeViewType.bind(null,this.props.value.id)})),React.createElement("div",{className:"App_pane_scroll"},React.createElement(View,React.__spread({},config.props))))}});module.exports=DocViewer},{"../../lib/uuid":84,"../keys-mixin":65,"./keyboard-helper":41,"./search-popper":46,"./split-manager":48,"./type-switcher":52,"./window-jump":54,react:"react","react-router":259,treed:300,"treed/views/focus":437,"treed/views/paper":439,"treed/views/tree":441}],31:[function(require,module,exports){var React=require("react/addons"),PT=React.PropTypes,cx=React.addons.classSet,Modal=require("../modal"),FormatPicker=require("./format-picker"),convert=require("../convert"),saveAs=require("../../lib/save-as");var Downloader=React.createClass({displayName:"Downloader",propTypes:{nodeContents:PT.func.isRequired,exportMany:PT.func.isRequired,onClose:PT.func.isRequired},getInitialState:function(){return{name:this._getDefaultName(false),whole_notebook:false,format:"notablemind"}},componentDidMount:function(){var inp=this.refs.input.getDOMNode();inp.focus();inp.selectionStart=0;inp.selectionEnd=inp.value.length},_getDefaultName:function(whole_notebook){var id=this.props.ids[0];if(whole_notebook){id=this.props.root}return this.props.nodeContents(id).trim().replace(/[^\w-_.]/g,"-").slice(0,100)},_onKeyDown:function(e){if(e.key!=="Enter")return;this.onDownload()},onDownload:function(){var ids=this.state.whole_notebook?[this.props.root]:this.props.ids,format=this.state.format,trees=this.props.exportMany(ids),data=convert[format].strFromTrees(trees),mime=convert[format].mime,blob=new Blob([data],{type:mime}),url=URL.createObjectURL(blob);saveAs(url,this.fileName());this.props.onClose()},fileName:function(){return this.state.name+"."+convert[this.state.format].ext},_onChangeName:function(e){this.setState({name:e.target.value})},_onChangeFormat:function(format){this.setState({format:format})},_setWhole:function(whole){this.setState({whole_notebook:whole,name:this._getDefaultName(whole)})},render:function(){var ids=this.props.ids,whole_notebook=this.state.whole_notebook,whole=false,what;if(ids.length===1){if(ids[0]===this.props.root){what="the whole notebook";whole=true}else{what="1 item"}}else{what=ids.length+" items"}return React.createElement(Modal,{onClose:this.props.onClose,title:"Download",className:"Modal-download"},whole?React.createElement("span",{className:"Download_what"},"Download the whole notebook"):React.createElement("span",{className:"Download_what"},"Download",React.createElement("button",{onClick:this._setWhole.bind(null,false),className:cx({Download_which:true,"Download_which-selected":!this.state.whole_notebook})},what),React.createElement("button",{onClick:this._setWhole.bind(null,true),className:cx({Download_which:true,"Download_which-selected":this.state.whole_notebook})},"the whole notebook")),React.createElement(FormatPicker,{formats:convert.formats,format:this.state.format,onChange:this._onChangeFormat}),"File name:",React.createElement("input",{ref:"input",className:"Download_name",value:this.state.name,onKeyDown:this._onKeyDown,onChange:this._onChangeName}),React.createElement("span",{className:"Download_ext"},".",convert[this.state.format].ext),React.createElement("br",null),React.createElement("button",{className:"Download_link",onClick:this.onDownload},"Download"))
}});module.exports=Downloader},{"../../lib/save-as":83,"../convert":56,"../modal":66,"./format-picker":36,"react/addons":"react/addons"}],32:[function(require,module,exports){var React=require("react"),PT=React.PropTypes;var DropDown=React.createClass({displayName:"DropDown",propTypes:{items:PT.array,title:PT.node,onSelect:PT.func},getInitialState:function(){return{open:false}},componentDidUpdate:function(prevProps,prevState){if(prevState.open&&!this.state.open){window.removeEventListener("mousedown",this._onClose)}else if(!prevState.open&&this.state.open){window.addEventListener("mousedown",this._onClose)}},componentWillUnmount:function(){window.removeEventListener("mousedown",this._onClose)},_onClick:function(i){this._onClose();if(this.props.items[i].action){this.props.items[i].action()}else{this.props.onSelect(this.props.items[i])}},_onToggle:function(){this.setState({open:!this.state.open})},_onClose:function(){this.setState({open:false})},render:function(){var cls=this.props.className||"";return React.createElement("div",{className:cls+" DropDown",onMouseDown:function(e){return e.stopPropagation()}},React.createElement("div",{onClick:this._onToggle,className:"DropDown_title"},this.props.title),this.state.open&&React.createElement("ul",{className:"DropDown_list"},this.props.items.map(function(item,i){return!!item&&(item.disabled?React.createElement("li",{key:i,className:"DropDown_item DropDown_item-disabled"},item.title||item):React.createElement("li",{key:i,onClick:this._onClick.bind(null,i),className:"DropDown_item"},item.title||item))}.bind(this))))}});module.exports=DropDown},{react:"react"}],33:[function(require,module,exports){var React=require("react"),PT=React.PropTypes;var Dropload=React.createClass({displayName:"Dropload",getDefaultProps:function(){return{message:"Drop anywhere to upload"}},getInitialState:function(){return{dropping:false}},componentDidMount:function(){window.addEventListener("dragenter",this._onDragOver);window.addEventListener("dragover",this._onDragOver);window.addEventListener("dragleave",this._onDragEnd);window.addEventListener("drop",this._onDrop)},componentWillUnmount:function(){window.removeEventListener("dragenter",this._onDragOver);window.removeEventListener("dragleave",this._onDragEnd);window.removeEventListener("dragover",this._onDragOver);window.removeEventListener("drop",this._onDrop)},_onDragOver:function(e){e.preventDefault();this.setState({dropping:true});return false},_onDragEnd:function(e){if(e.target.className.indexOf("Dropload")!==-1){this.setState({dropping:false})}},_onDrop:function(e){e.preventDefault();e.stopPropagation();var files=e.dataTransfer.files;if(!files||!files.length){files=e.dataTransfer.items}this.setState({dropping:false});this.props.onDrop(files);return false},render:function(){return this.state.dropping?React.createElement("div",{className:"Dropload"},this.props.message):null}});module.exports=Dropload},{react:"react"}],34:[function(require,module,exports){var React=require("react/addons"),cx=React.addons.classSet,PT=React.PropTypes,async=require("async");var Dumper=React.createClass({displayName:"Dumper",getInitialState:function(){return{dumping:false,dumpURL:null}},_onExport:function(){this.setState({dumping:true});this.props.files.list(function(files){var tasks=files.map(function(file){return this.props.files.dump.bind(null,file)}.bind(this));async.parallel(tasks,function(err,results){var blob=new Blob([JSON.stringify(results,null,2)],{type:"application/json"});this.setState({dumpURL:URL.createObjectURL(blob)})}.bind(this))}.bind(this))},render:function(){if(this.state.dumping){if(this.state.dumpURL){return React.createElement("a",{download:"notablemind-dump.json",href:this.state.dumpURL},"Click to download")}else{return React.createElement("span",null,"Processing...")}}else{return React.createElement("a",{style:{cursor:"pointer",color:"blue"},onClick:this._onExport},"Dump")}}});module.exports=Dumper},{async:"async","react/addons":"react/addons"}],35:[function(require,module,exports){var React=require("react"),PT=React.PropTypes,Downloader=require("./downloader"),Uploader=require("./uploader"),Dropload=require("./dropload");var Dupload=React.createClass({displayName:"Dupload",propTypes:{store:PT.object.isRequired},getInitialState:function(){return{downloading:false,uploading:false,uploadFile:null}},_onDownload:function(){this.setState({downloading:true,uploading:false,uploadFile:null})},_onUpload:function(){this.setState({downloading:false,uploading:true})},_onClose:function(){this.setState({downloading:false,uploading:false,uploadFile:null})},_onUploaded:function(filename,trees){this.props.store._actions[0].importTrees(null,trees);this._onClose()},_onDrop:function(files){if(files.length){this.setState({uploading:true,uploadFile:files[0]})}},render:function(){var modal=null;if(this.state.downloading){var store=this.props.store;modal=Downloader({exportMany:store.db.exportMany.bind(this.props.store.db),nodeContents:function(id){return store.db.nodes[id].content},ids:store.views[store.activeView].selection||[store.views[store.activeView].active],root:store.db.root,onClose:this._onClose})}else if(this.state.uploading){modal=Uploader({initialFile:this.state.uploadFile,onUploaded:this._onUploaded,store:this.props.store,onClose:this._onClose})}return React.createElement("div",{className:"Dupload"},React.createElement("span",{className:"Dupload_download",onClick:this._onDownload}),React.createElement("span",{className:"Dupload_upload",onClick:this._onUpload}),modal,React.createElement(Dropload,{onDrop:this._onDrop,message:"Drop anywhere to import"}))}});module.exports=Dupload},{"./downloader":31,"./dropload":33,"./uploader":53,react:"react"}],36:[function(require,module,exports){var React=require("react"),PT=React.PropTypes;var FormatPicker=React.createClass({displayName:"FormatPicker",propTypes:{formats:PT.array.isRequired,format:PT.string.isRequired,onChange:PT.func.isRequired},render:function(){return React.createElement("ul",{className:"FormatPicker"},this.props.formats.map(function(format){return React.createElement("li",{className:"FormatPicker_item"+(format[0]===this.props.format?" FormatPicker_item-selected":""),onClick:this.props.onChange.bind(null,format[0])},format[1])}.bind(this)))}});module.exports=FormatPicker},{react:"react"}],37:[function(require,module,exports){module.exports=fuzzyTime;function twelveAm(date){var d=new Date(date);d.setHours(0);d.setMinutes(0);d.setSeconds(0);return d.getTime()}function thisYear(date){var d=new Date(date);d.setHours(0);d.setMinutes(0);d.setSeconds(0);d.setDate(1);d.setMonth(0);return d.getTime()}function fuzzyTime(time){time=new Date(time).getTime();var now=Date.now(),date=new Date(time),_12am=twelveAm(now),jan1st=thisYear(now),diff=(now-time)/1e3;if(diff<120)return"just now";if(time<_12am){if(_12am-time<60*60*24*1e3)return"yesterday";if(time<jan1st){return date.getMonth()+1+"/"+date.getDate()+"/"+date.getFullYear()}return date.getMonth()+1+"/"+date.getDate()}var hours=date.getHours();if(hours>12)hours-=12;if(hours===0)hours=12;var minutes=date.getMinutes();if(minutes<10)minutes="0"+minutes;var ap=date.getHours()>11?"pm":"am";return hours+":"+minutes+ap}},{}],38:[function(require,module,exports){var React=require("react");var GistForm=React.createClass({displayName:"GistForm",getInitialState:function(){return{value:this.props.initialValue||""}},componentWillReceiveProps:function(nextProps){if(this.props.initialValue!==nextProps.initialValue){this.setState({value:nextProps.initialValue})}},isValid:function(){return this.state.value.match(/^[\w-]+\/[0-9a-z]+$/)},onChange:function(e){var val=e.target.value;if(!val.trim())return this.setState({value:val.trim()});var last=val.split("/").slice(-2).join("/");this.setState({value:last})},onSubmit:function(){if(!this.isValid())return;this.props.onSubmit(this.state.value)},render:function(){return React.createElement("div",{className:"GistForm"},"Load from gist:",React.createElement("input",{value:this.state.value,placeholder:"username/id",onChange:function(e){return this.setState({value:e.target.value})}.bind(this),onKeyDown:function(e){return e.key==="Enter"?this.onSubmit():null}.bind(this)}),React.createElement("button",{disabled:this.state.value===this.props.initialValue||!this.isValid(),onClick:this.onSubmit},"Load Gist"))}});module.exports=GistForm},{react:"react"}],39:[function(require,module,exports){module.exports={get:getLocationId,set:setLocationId};function getLocationId(){return window.location.search.slice(1).split("/")[0]}function setLocationId(id){if(getLocationId()===id)return;window.history.pushState(null,null,"?"+id)}},{}],40:[function(require,module,exports){var React=require("react/addons"),cx=React.addons.classSet,sources=require("../sources"),KeysMixin=require("../keys-mixin");var Importer=React.createClass({displayName:"Importer",_importFrom:function(name){sources[name].select(function(err,data,config){if(err)return console.warn("failed to source");this.props.onSourced(data,{config:config,type:name})}.bind(this))},mixins:[KeysMixin],statics:{keys:function(){return{"j, l, down, right, tab":this.goRight,"k, h, up, left, shift+tab":this.goLeft,enter:this.doSelected,escape:this.props.onClose}}},getDefaultProps:function(){return{sources:Object.keys(sources)}},getInitialState:function(){return{selected:0}},doSelected:function(){this._importFrom(this.props.sources[this.state.selected])},goLeft:function(){if(this.state.selected>0){this.setState({selected:this.state.selected-1})}else{this.setState({selected:this.props.sources.length-1})}},goRight:function(){if(this.state.selected<this.props.sources.length-1){this.setState({selected:this.state.selected+1})}else{this.setState({selected:0})}},_onHide:function(){this.props.onClose()},render:function(){return React.createElement("div",{className:"Importer"},React.createElement("button",{className:"Importer_cancel",onClick:this._onHide},"Cancel"),React.createElement("h3",{className:"Importer_title"},"Import Document"),React.createElement("ul",{className:"Importer_list"},this.props.sources.map(function(name,i){return React.createElement("li",{key:name},React.createElement("button",{className:cx({Importer_source:true,"Importer_source-selected":i===this.state.selected}),onClick:this._importFrom.bind(null,name)},sources[name].title))}.bind(this))))}});module.exports=Importer},{"../keys-mixin":65,"../sources":75,"react/addons":"react/addons"}],41:[function(require,module,exports){var React=require("react"),viewKeys=require("treed/views/tree/keys"),KeysMixin=require("../keys-mixin"),KeyboardPopup=require("./keyboard-popup"),PT=React.PropTypes;var KeyboardHelper=React.createClass({displayName:"KeyboardHelper",mixins:[KeysMixin],statics:{keys:function(){return{"shift+/":this.showKey}}},propTypes:{canGrabKeyboard:PT.func.isRequired,plugins:PT.arrayOf(PT.object).isRequired,keys:PT.object.isRequired},getInitialState:function(){return{open:false}},showKey:function(e){if(!this.props.canGrabKeyboard(e))return true;this.show()},show:function(){this.setState({open:true})},hide:function(){this.setState({open:false})},mainPage:function(){return Object.keys(viewKeys).map(function(title){return{title:title,actions:viewKeys[title]}})},pluginsPage:function(){return this.props.plugins.reduce(function(sections,plugin){if(!plugin.keys)return sections;var keys=plugin.keys;if("function"===typeof keys){keys=keys(this.props.plugins)}sections.push({title:plugin.title,actions:keys});return sections}.bind(this),[])},render:function(){if(!this.state.open){return React.createElement(Toaster,{onClick:this.show},"Press ? for keyboard shortcuts")}return React.createElement(KeyboardPopup,{keys:this.props.keys,pages:{Main:this.mainPage(),Plugins:this.pluginsPage()},onClose:this.hide})}});var Toaster=React.createClass({displayName:"Toaster",getInitialState:function(){return{toasted:false}},componentDidMount:function(){setTimeout(function(){return this.setState({toasted:true})}.bind(this),100)},render:function(){var cls="Toaster "+(this.state.toasted?"Toaster-toasted":"");return React.createElement("div",React.__spread({className:cls},this.props),this.props.children)}});module.exports=KeyboardHelper},{"../keys-mixin":65,"./keyboard-popup":42,react:"react","treed/views/tree/keys":443}],42:[function(require,module,exports){var React=require("react"),PT=React.PropTypes;var modes=["insert","visual","normal"];var KeyboardPopup=React.createClass({displayName:"KeyboardPopup",propTypes:{onClose:PT.func.isRequired,pages:PT.objectOf(PT.arrayOf(PT.shape({title:PT.string,actions:PT.objectOf(PT.objectOf(PT.string))}))).isRequired},getInitialState:function(){return{pageIndex:0,fadeIn:false}},componentDidMount:function(){this._resize();this.props.keys.disable();window.addEventListener("keydown",this._onKeyDown);this.setState({fadeIn:true})},componentWillUnmount:function(){this.props.keys.enable();window.removeEventListener("keydown",this._onKeyDown)},_onClose:function(){this.setState({fadeIn:false});setTimeout(function(){return this.props.onClose()}.bind(this),150)},_onKeyDown:function(e){if(e.keyCode===27)return this._onClose();if(e.keyCode!==9)return;e.preventDefault();var selection=this.state.pageIndex,pages=Object.keys(this.props.pages);if(e.shiftKey){selection-=1;if(selection<0)selection=pages.length-1}else{selection+=1;if(selection>pages.length-1)selection=0}this.setState({pageIndex:selection})},_resize:function(){var node=this.refs.body.getDOMNode();node.style.width=node.scrollWidth+"px";for(var i=0;i<10&&node.scrollWidth>node.offsetWidth;i++){node.style.width=node.scrollWidth+"px"}},renderRow:function(action,bindings){var text=bindings.text||bindings.normal||bindings.visual||bindings.insert;if(!text)return;return React.createElement("tr",{key:action},React.createElement("td",{className:"KeyboardPopup_bindings"},text.split(", ").map(function(binding){return React.createElement("span",{key:binding},binding)})),React.createElement("td",{className:"KeyboardPopup_action"},bindings.title||action))},render:function(){var pageNames=Object.keys(this.props.pages),currentName=pageNames[this.state.pageIndex],page=this.props.pages[currentName];return React.createElement("div",{className:"KeyboardPopup"+(this.state.fadeIn?" KeyboardPopup-fade-in":""),onClick:this._onClose},React.createElement("div",{className:"KeyboardPopup_body",onClick:function(e){return e.stopPropagation()}},React.createElement("div",{className:"KeyboardPopup_title"},"Notablemind Keyboard Shortcuts"),React.createElement("div",{className:"KeyboardPopup_pages"},pageNames.map(function(name,i){return React.createElement("button",{disabled:i===this.state.pageIndex,onClick:function(){return this.setState({pageIndex:i})}.bind(this)},name)}.bind(this))),React.createElement("div",{ref:"body",className:"KeyboardPopup_sections"},page.map(function(section,i){return React.createElement("div",{key:i,className:"KeyboardPopup_section"},React.createElement("div",{className:"KeyboardPopup_section_title"},section.title),React.createElement("table",null,React.createElement("tbody",null,Object.keys(section.actions).map(function(action){return this.renderRow(action,section.actions[action])}.bind(this)))))}.bind(this)))))}});module.exports=KeyboardPopup},{react:"react"}],43:[function(require,module,exports){var React=require("react/addons"),cx=React.addons.classSet,kernels=require("../kernels"),KeysMixin=require("../keys-mixin");var repls=Object.keys(kernels);var NewFile=React.createClass({displayName:"NewFile",getInitialState:function(){return{title:"Untitled",repl:"null"}},componentDidMount:function(){var inp=this.refs.input.getDOMNode();inp.focus();inp.selectionStart=0;inp.selectionEnd=inp.value.length},_onChange:function(e){this.setState({title:e.target.value})},_setRepl:function(key){this.setState({repl:key})},_onSubmit:function(e){e.preventDefault();e.stopPropagation();this.props.onSubmit(this.state.title,this.state.repl)},_onKeyDown:function(e){e.stopPropagation();if(e.key==="Enter"){return this._onSubmit(e)}if(e.key==="Escape"){return this.props.onClose()}if(e.key==="Tab"){e.preventDefault();if(e.shiftKey){if(this.state.repl===repls[0]){this.setState({repl:repls[repls.length-1]})}else{this.setState({repl:repls[repls.indexOf(this.state.repl)-1]})}}else{if(this.state.repl===repls[repls.length-1]){this.setState({repl:repls[0]})}else{this.setState({repl:repls[repls.indexOf(this.state.repl)+1]})}}}},repls:function(){return React.createElement("ul",{className:"NewFile_repls"},repls.map(function(key){return React.createElement("li",{onClick:this._setRepl.bind(null,key),className:cx({NewFile_repl:true,"NewFile_repl-selected":key===this.state.repl})},kernels[key].title)}.bind(this)))},_onHide:function(e){e.preventDefault();this.props.onClose()},componentDidUpdate:function(prevProps){if(!this.props.open||prevProps.open)return;var node=this.refs.input.getDOMNode();node.focus();node.selectionStart=0;node.selectionEnd=node.value.length},render:function(){return React.createElement("form",{className:"NewFile",onSubmit:this._onSubmit},React.createElement("button",{className:"NewFile_cancel",onClick:this._onHide},"Cancel"),React.createElement("div",null,React.createElement("h3",{className:"NewFile_head"},"New Document"),React.createElement("input",{type:"text",ref:"input",onKeyDown:this._onKeyDown,className:"NewFile_title",value:this.state.title,onChange:this._onChange}),React.createElement("button",{className:"NewFile_submit",onClick:this._onSubmit},"Create Document")),React.createElement("span",{className:"NewFile_ReplTitle"},"Repl"),this.repls())}});module.exports=NewFile},{"../kernels":64,"../keys-mixin":65,"react/addons":"react/addons"}],44:[function(require,module,exports){module.exports=function readFile(file,done){var reader=new FileReader;reader.onerror=function(){return done(new Error("Failed to load file"))};reader.onabort=function(){return done(new Error("Upload cancelled"))};reader.onload=function(evt){return done(null,evt.target.result)};reader.readAsText(file);return reader}},{}],45:[function(require,module,exports){var React=require("react"),cx=React.addons.classSet,PT=React.PropTypes,sources=require("../sources"),DropDown=require("./dropdown"),sync=require("../sync"),files=require("../files"),assign=require("../assign"),sourceSettings=require("./source-settings");function saveTimer(save,longTime,shortTime){var last=null,longSync=null,shortSync=null;function doSave(){clearTimeout(longSync);clearTimeout(shortSync);save(function(){longSync=setTimeout(doSave,longTime)})}longSync=setTimeout(doSave,longTime);return{dirty:function(){clearTimeout(shortSync);shortSync=setTimeout(doSave,shortTime)},clear:function(){clearTimeout(longSync);clearTimeout(shortSync)}}}var Saver=React.createClass({displayName:"Saver",propTypes:{store:PT.object.isRequired,value:PT.object.isRequired,file:PT.object.isRequired,onFileUpdate:PT.func.isRequired},getInitialState:function(){return{loading:false,error:false}},componentDidMount:function(){this.props.store.on(["changed"],this._onDirty);if(this.props.value&&this.props.value.autosync){this._startTimer();if(this.props.value.dirty)this._saveTimer.dirty()}},componentWillUnmount:function(){this.props.store.off(["changed"],this._onDirty)},componentWillReceiveProps:function(nextProps){if(nextProps.store!==this.props.store){this.props.store.off(["changed"],this._onDirty);nextProps.store.on(["changed"],this._onDirty)}if(nextProps.value&&nextProps.value.autosync&&(!this.props.value||!this.props.value.autosync)){this._startTimer()}if(!nextProps.value||!nextProps.value.autosync){this._clearTimer()}},_startTimer:function(){this._saveTimer=saveTimer(this._onSync,5*60*1e3,15*1e3)},_clearTimer:function(){if(!this._saveTimer)return;this._saveTimer.clear();delete this._saveTimer},_onDirty:function(){if(!this.props.file.source){return files.update(this.props.file.id,{modified:Date.now()},function(file){return this.props.onFileUpdate(file)}.bind(this))}var source=assign({},this.props.file.source,{dirty:true});files.update(this.props.file.id,{source:source,modified:Date.now()},function(file){return this.props.onFileUpdate(file)}.bind(this));if(this._saveTimer)this._saveTimer.dirty()},_onSetup:function(item){this.setState({loading:true});this._realSetup(item.type,function(err){this.setState({error:err,loading:false})}.bind(this))},_onSync:function(done){this.setState({loading:true});this._realSync(function(err){this.setState({error:err,loading:false});done&&done()}.bind(this))},_realSync:function(done){sync.doSync(this.props.file,this.props.store,function(err,file){if(err)return done(err);if(file)this.props.onFileUpdate(file);done()}.bind(this))},_realSetup:function(type,done){var store=this.props.store,exported=sync.exportContents(this.props.file,store),title=store.db.nodes[store.db.root].content;sources[type].saveAs(title,exported,function(err,config,time){if(err)return done(new Error("Failed to set source"));files.update(this.props.file.id,{source:{type:type,config:config,synced:time,dirty:false}},function(file){this.props.onFileUpdate(file);done()}.bind(this))}.bind(this))},_clearSource:function(done){files.update(this.props.file.id,{source:null},done)},_showSettings:function(){sourceSettings(this.props.file.source,function(err,settings){if(err)return console.warn("failed to do settings dialog",err);var source=assign({},this.props.file.source,settings);files.update(this.props.file.id,{source:source},function(file){return this.props.onFileUpdate(file)}.bind(this))}.bind(this))},_showSource:function(){var source=this.props.value;var link=sources[source.type].link(source.config);window.open(link)},render:function(){if(this.state.loading){return React.createElement("div",{className:"Saver Saver-syncing"},React.createElement("i",{className:"fa fa-refresh fa-spin",style:{margin:"5px 10px"}}),"Syncing...")}if(!this.props.value){return React.createElement("div",{className:"Saver Saver-none"},React.createElement(DropDown,{title:"Setup sync",items:Object.keys(sources).map(function(name){return{title:sources[name].title,type:name}}),onSelect:this._onSetup}))}var source=this.props.value;return React.createElement("div",{className:"Saver",style:{display:"flex"}},React.createElement("button",{className:"Saver_sync",onClick:this._onSync.bind(null,false)},React.createElement("i",{className:"fa fa-refresh"})),React.createElement("span",{className:"Saver_message"}," ",this.props.value.dirty?this.props.value.autosync?"":"Unsynced local changes":"Local changes synced"),React.createElement(DropDown,{title:React.createElement("i",{className:"fa fa-cog",style:{margin:"5px 10px"}}),items:[{title:"Configure",action:this._showSettings},sources[source.type].link&&{title:"Open with "+sources[source.type].title,action:this._showSource}]}),this.state.error)}});module.exports=Saver},{"../assign":26,"../files":61,"../sources":75,"../sync":80,"./dropdown":32,"./source-settings":47,react:"react"}],46:[function(require,module,exports){var React=require("react/addons"),PT=React.PropTypes,cx=React.addons.classSet,ensureInView=require("treed/util/ensure-in-view");function toReg(needle){return new RegExp(needle.replace(".","\\.").replace("*",".*?"),"gi")}function highlight(text,needle,maxSize){var rx=toReg(needle);var items=[];var last=0;text.replace(rx,function(matched,pos,full){items.push(full.slice(last,pos));items.push(React.createElement("strong",null,matched));last=pos+matched.length});items.push(text.slice(last));if(text.length>maxSize){var ln=0;if(items[0].length>maxSize/2){items[0]=items[0].slice(-maxSize/2)}ln=items[0].length;for(var i=2;i<items.length;i+=2){if(ln+items[i].length>maxSize){items[i]=items[i].slice(maxSize-ln);return items.slice(0,i+1)}ln+=items[i].length}}return items}var SearchPopper=React.createClass({displayName:"SearchPopper",propTypes:{matchItems:PT.func.isRequired,onSelect:PT.func.isRequired,onClose:PT.func.isRequired},getInitialState:function(){return{needle:""}},componentDidMount:function(){this.refs.input.getDOMNode().focus()},onChange:function(e){var needle=e.target.value;this.setState({needle:needle})},onKeyDown:function(e){e.stopPropagation();if(e.key==="Enter"){e.preventDefault();this.refs.list.handleEnter(!!e.altKey)}if(e.key==="ArrowUp"){e.preventDefault();this.refs.list.handleGoUp()}if(e.key==="ArrowDown"){e.preventDefault();this.refs.list.handleGoDown()}if(e.key==="Escape"){this.props.onClose()}},render:function(){return React.createElement("div",{className:"SearchPopper"},React.createElement(SearchBody,{ref:"list",onSelect:this.props.onSelect,needle:this.state.needle,items:this.props.matchItems(toReg(this.state.needle))}),React.createElement("div",{className:"SearchPopper_input"},React.createElement("input",{ref:"input",autoFocus:true,value:this.state.needle,placeholder:"search",onKeyDown:this.onKeyDown,onChange:this.onChange})))}});var SearchBody=React.createClass({displayName:"SearchBody",propTypes:{items:PT.array,onSelect:PT.func},getInitialState:function(){return{selected:0}},handleEnter:function(jump){return this.props.onSelect(this.props.items[this.state.selected],jump)},handleGoUp:function(){if(this.state.selected<this.props.items.length-1){this.setState({selected:this.state.selected+1})}},handleGoDown:function(){if(this.state.selected>0){this.setState({selected:this.state.selected-1})}},componentWillReceiveProps:function(){this.setState({selected:0})},componentDidMount:function(){if(!this.refs||!this.refs.selected)return;var node=this.refs.selected.getDOMNode();node.offsetParent.scrollTop=node.offsetParent.scrollHeight},componentDidUpdate:function(prevProps,prevState){if(!this.refs||!this.refs.selected)return;var node=this.refs.selected.getDOMNode();if(prevState.selected!==this.state.selected){ensureInView(node)}else{node.offsetParent.scrollTop=node.offsetParent.scrollHeight}},render:function(){var items=[];for(var i=this.props.items.length-1;i>=0;i--){var item=this.props.items[i];items.push(React.createElement("li",{className:cx({SearchPopper_result:true,"SearchPopper_result-selected":i===this.state.selected}),ref:i===this.state.selected?"selected":undefined,onClick:this.props.onSelect.bind(null,item,false),key:i},highlight(item.content,this.props.needle,200)))}return React.createElement("ul",null,items)}});module.exports=SearchPopper},{"react/addons":"react/addons","treed/util/ensure-in-view":426}],47:[function(require,module,exports){var showModal=require("../ui/show-modal");module.exports=function sourceSettings(source,done){showModal("Configure Syncing",{autosync:source.autosync},function(state,set,done){return React.createElement("div",null,React.createElement("label",null,React.createElement("input",{type:"checkbox",onChange:function(e){set({autosync:e.target.checked})},checked:state.autosync})," autosync"),React.createElement("button",{onClick:function(){return done(null,{autosync:state.autosync})}},"Save"))},done)}},{"../ui/show-modal":82}],48:[function(require,module,exports){var React=require("react"),Splitter=require("./splitter"),PT=React.PropTypes;function r(){for(var a="";a.length<5;a+="abcdefg"[parseInt(Math.random()*7)]);return a}function cloneShallow(s){var o={};for(var a in s){o[a]=s[a]}return o}function r(){for(var a="";a.length<5;a+="abcdefg"[parseInt(Math.random()*7)]);return a}function cloneShallow(s){var o={};for(var a in s){o[a]=s[a]}return o}var SplitManager=React.createClass({displayName:"SplitManager",propTypes:{config:PT.object,comp:PT.oneOfType([PT.object,PT.func]),getNew:PT.func,onRemove:PT.func,onChange:PT.func,cprops:PT.object},statics:{split:function(pos,orient,config,getNew){pos=pos.slice();if(config.leaf){return{leaf:false,value:{orient:orient,first:{leaf:true,value:config.value},second:{leaf:true,value:getNew(config.value)}}}}var config=config;var last=pos.pop();var line=pos.reduce(function(config,i){return config[i].value=cloneShallow(config[i].value)},config.value);line[last]={leaf:false,ratio:.5,value:{orient:orient,first:{leaf:true,value:line[last].value},second:{leaf:true,value:getNew(line[last].value)}}};return config},remove:function(pos,config){pos=pos.slice();if(config.leaf)return;var removed;if(pos.length===1){removed=config.value[pos[0]].value;config=config.value[pos[0]==="first"?"second":"first"]}else{leaf=false;config=cloneShallow(config);var last=pos.pop(),sec=pos.pop();var line=pos.reduce(function(config,i){return config[i].value=cloneShallow(config[i].value)},config.value);removed=line[sec].value[last].value;line[sec]=line[sec].value[last=="first"?"second":"first"]}return{removed:removed,config:config}}},getDefaultProps:function(){return{getNew:function(old){return r()}}},changeRatio:function(pos,ratio,done){var config=this.props.config;var line=pos.reduce(function(config,i){return config[i].value=cloneShallow(config[i].value)},config.value);line.ratio=ratio;this.props.onChange(config);done()},split:function(pos,orient){var config=SplitManager.split(pos,orient,this.props.config,this.props.getNew);this.props.onChange(config)},remove:function(pos){var result=SplitManager.remove(pos,this.props.config);if(!result)return;this.props.onRemove(result.removed);this.props.onChange(result.config)},render:function(){var cprops=cloneShallow(this.props.cprops);cprops.onSplit=this.split;cprops.onRemove=this.remove;cprops.onChangeRatio=this.changeRatio;return React.createElement(Splitter,{config:this.props.config,comp:this.props.comp,onChangeRatio:this.changeRatio,cprops:cprops})}});module.exports=SplitManager},{"./splitter":49,react:"react"}],49:[function(require,module,exports){var React=require("react/addons"),cx=React.addons.classSet,PT=React.PropTypes;var Splitter=React.createClass({displayName:"Splitter",getInitialState:function(){return{ratio:this.props.config.value.ratio||.5,moving:null}},getDefaultProps:function(){return{pos:[]}},_onMouseDown:function(e){e.preventDefault();this.setState({moving:true})},_mouseMove:function(e){var full=this.getDOMNode().getBoundingClientRect(),span,perc;if(this.props.config.value.orient==="horiz"){span=full.right-full.left;perc=(e.clientX-full.left)/span}else{span=full.bottom-full.top;perc=(e.clientY-full.top)/span}if(perc<0||perc>1)return;var dist=10/span;if(Math.abs(perc-.33)<dist)perc=.33;if(Math.abs(perc-.67)<dist)perc=.67;if(Math.abs(perc-.5)<dist)perc=.5;this.setState({ratio:perc})},_mouseUp:function(){this.props.onChangeRatio(this.props.pos,this.state.ratio,function(){return this.setState({moving:false})}.bind(this))},componentDidUpdate:function(prevProps,prevState){var doc=this.getDOMNode().ownerDocument;if(prevState.moving&&!this.state.moving){doc.removeEventListener("mousemove",this._mouseMove);doc.removeEventListener("mouseup",this._mouseUp)}else if(this.state.moving&&!prevState.moving){doc.addEventListener("mousemove",this._mouseMove);doc.addEventListener("mouseup",this._mouseUp)}},render:function(){var config=this.props.config,pos=this.props.pos||[],Comp=this.props.comp;var children;if(config.leaf){children=React.createElement("div",{className:"Splitter_only",style:{flex:1}},React.createElement(Comp,React.__spread({},this.props.cprops,{key:config.value.config.view.view.id,pos:pos.concat(["first"]),value:config.value})))}else{var ratio=this.state.moving?this.state.ratio:config.value.ratio||.5;children=[React.createElement("div",{className:"Splitter_first",style:{flex:ratio}},!config.value.first.leaf?React.createElement(Splitter,React.__spread({},this.props,{pos:pos.concat(["first"]),config:config.value.first})):React.createElement(Comp,React.__spread({},this.props.cprops,{key:config.value.first.value.config.view.view.id,pos:pos.concat(["first"]),value:config.value.first.value}))),React.createElement("div",{className:"Splitter_div",onMouseDown:this._onMouseDown}),React.createElement("div",{className:"Splitter_second",style:{flex:1-ratio}},!config.value.second.leaf?React.createElement(Splitter,React.__spread({},this.props,{pos:pos.concat(["second"]),config:config.value.second})):React.createElement(Comp,React.__spread({},this.props.cprops,{key:config.value.second.value.config.view.view.id,pos:pos.concat(["second"]),value:config.value.second.value})))]
}return React.createElement("div",{className:cx({Splitter:true,"Splitter-moving":this.state.moving})+" Splitter-"+config.value.orient},children)}});module.exports=Splitter},{"react/addons":"react/addons"}],50:[function(require,module,exports){var React=require("react/addons"),ensureInView=require("treed/util/ensure-in-view"),cx=React.addons.classSet,PT=React.PropTypes,KeysMixin=require("../keys-mixin");function arEq(a,b){if(a.length!==b.length)return false;for(var i=0;i<a.length;i++){if(a[i]!==b[i])return false}return true}var TableBody=React.createClass({displayName:"TableBody",propTypes:{items:PT.array,headers:PT.object,searchHeaders:PT.array,onSelect:PT.func,keys:PT.func,emptyText:PT.node,extraKeys:PT.object},mixins:[KeysMixin],statics:{keys:function(){return{"g g":this.toTop,"shift+[":this.toTop,"shift+g":this.toBottom,"shift+]":this.toBottom,"j, down":this.goDown,"k, up":this.goUp,enter:this.keySelect}}},componentDidMount:function(){if(this.props.extraKeys){var k={};for(var name in this.props.extraKeys){k[name]=this._extraKeys.bind(null,this.props.extraKeys[name])}this._extra_keys=this.props.keys.add(k)}},componentWillUnmount:function(){if(this._extra_keys){this.props.keys.remove(this._extra_keys);delete this._extra_keys}},componentDidUpdate:function(prevProps,prevState){if(this.state.selected!==prevState.selected){this.refs.selected&&ensureInView(this.refs.selected.getDOMNode())}},componentWillReceiveProps:function(nextProps){if(this._extra_keys&&nextProps.keys){nextProps.keys.remove(this._extra_keys);delete this._extra_keys}if(nextProps.extraKeys){var k={};for(var name in nextProps.extraKeys){k[name]=this._extraKeys.bind(null,nextProps.extraKeys[name])}this._extra_keys=nextProps.keys.add(k)}if(this.state.selected>=nextProps.items.length){if(nextProps.items.length===0){this.setState({selected:0})}else{this.setState({selected:nextProps.items.length-1})}}},getInitialState:function(){return{selected:0}},_extraKeys:function(fn){fn(this.props.items[this.state.selected])},keySelect:function(){var item=this.props.items[this.state.selected];if(!item)return;this.props.onSelect(item)},toTop:function(){this.setState({selected:0})},toBottom:function(){this.setState({selected:this.props.items.length-1})},goUp:function(){if(this.state.selected>0){this.setState({selected:this.state.selected-1})}},goDown:function(){if(this.state.selected<this.props.items.length-1){this.setState({selected:this.state.selected+1})}},_onMenu:function(item,i,e){this.setState({selected:i});this.props.onMenu(item,e)},render:function(){var heads=Object.keys(this.props.headers);return React.createElement("tbody",null,this.props.items.map(function(item,i){return React.createElement("tr",{key:i,ref:i===this.state.selected?"selected":undefined,className:i===this.state.selected?"selected":"",onContextMenu:this._onMenu.bind(null,item,i),onClick:this.props.onSelect.bind(null,item)},heads.map(function(name){return React.createElement("td",{key:name},this.props.headers[name](item))}.bind(this)))}.bind(this)))}});module.exports=TableBody},{"../keys-mixin":65,"react/addons":"react/addons","treed/util/ensure-in-view":426}],51:[function(require,module,exports){var React=require("react/addons"),ensureInView=require("treed/util/ensure-in-view"),cx=React.addons.classSet,PT=React.PropTypes,KeysMixin=require("../keys-mixin"),TableBody=require("./table-body");var Tabular=React.createClass({displayName:"Tabular",propTypes:{items:PT.array,headers:PT.object,sortHeaders:PT.object,searchHeaders:PT.array,onSelect:PT.func,keys:PT.func,emptyText:PT.node,extraKeys:PT.object},mixins:[KeysMixin],statics:{keys:function(){return{"/":this.startSearch}}},componentDidMount:function(){this.resizeHead()},componentDidUpdate:function(prevProps,prevState){this.resizeHead()},getInitialState:function(){return{searching:false,searchtext:"",sorting:this.props.initialSort||Object.keys(this.props.headers)[0],sortDir:this.props.initialSortDir||1}},resizeHead:function(){var table=this.refs.table.getDOMNode();var head=this.refs.head.getDOMNode(),ths=head.getElementsByTagName("th");[].map.call(table.getElementsByTagName("th"),function(th,i){var cs=window.getComputedStyle(th);ths[i].style.width=cs.width})},startSearch:function(){this.setState({searching:true,searchtext:""})},_onChangeSearch:function(e){var text=e.target.value.toLowerCase(),heads=this.props.searchHeaders||Object.keys(this.props.headers),items=text.trim()?this.props.items.filter(function(item){return heads.some(function(name){var res=this.props.headers[name](item);return res&&res.toLowerCase().indexOf(text)!==-1}.bind(this))}.bind(this)):this.props.items;this.setState({searchtext:text})},_onSearchKey:function(e){e.stopPropagation();if(e.key==="Enter"){this.refs.body.keySelect();return e.preventDefault()}if(e.key==="Escape"){e.preventDefault();return this.setState({searching:false,searchtext:""})}if(e.key==="ArrowDown"){this.refs.body.goDown();return e.preventDefault()}if(e.key==="ArrowUp"){this.refs.body.goUp();return e.preventDefault()}},_onBlurSearch:function(){this.setState({searching:false,searchtext:""})},setSort:function(name){if(this.state.sorting===name){return this.setState({sortDir:-this.state.sortDir})}this.setState({sorting:name,sortDir:1})},getItems:function(){var items;if(this.state.searching){items=this.props.items.filter(function(item){return this.props.searchHeaders.some(function(head){return this.props.headers[head](item).toLowerCase().indexOf(this.state.searchtext.toLowerCase())!==-1}.bind(this))}.bind(this))}else{items=this.props.items}var head=this.props.sortHeaders[this.state.sorting]||this.props.headers[this.state.sorting],heads=items.map(function(item,i){return[head(item),i]});heads.sort(function(a,b){return a[0]==b[0]?0:(a[0]>b[0]?1:-1)*this.state.sortDir}.bind(this));return heads.map(function(head){return items[head[1]]})},render:function(){var heads=Object.keys(this.props.headers);return React.createElement("div",{className:"Tabular"},React.createElement("table",{className:"Tabular_header",ref:"head"},React.createElement("thead",null,React.createElement("tr",null,heads.map(function(name){return React.createElement("th",{onClick:this.setSort.bind(null,name),className:this.state.sorting!==name?null:"Tabular_sort "+(this.state.sortDir===1?"":"Tabular_sort-rev"),key:name},name)}.bind(this)))),React.createElement("tbody",null)),React.createElement("div",{className:"Tabular_container"},React.createElement("table",{className:"Tabular_table",ref:"table"},React.createElement("thead",null,React.createElement("tr",null,heads.map(function(name){return React.createElement("th",{key:name},name)}))),React.createElement("tbody",null,this.state.searching?React.createElement("tr",null,React.createElement("td",{colSpan:heads.length},"Search: ",React.createElement("input",{value:this.state.searchtext,autoFocus:true,onBlur:this._onBlurSearch,onChange:this._onChangeSearch,onKeyDown:this._onSearchKey}))):null,!this.props.items.length&&React.createElement("tr",{className:"Tabular_empty"},React.createElement("td",{colSpan:heads.length},this.props.emptyText))),React.createElement(TableBody,{keys:this.props.keys,items:this.getItems(),headers:this.props.headers,onMenu:this.props.onMenu,onSelect:this.props.onSelect,extraKeys:this.props.extraKeys,ref:"body"}))))}});module.exports=Tabular},{"../keys-mixin":65,"./table-body":50,"react/addons":"react/addons","treed/util/ensure-in-view":426}],52:[function(require,module,exports){var React=require("react"),treed=require("treed");var TypeSwitcher=React.createClass({displayName:"TypeSwitcher",propTypes:{types:React.PropTypes.object},getInitialState:function(){return{open:false}},_toggleOpen:function(){this.setState({open:!this.state.open})},_onSelect:function(key){this.setState({open:false});this.props.onChange(key)},render:function(){var keys=Object.keys(this.props.types),current=this.props.type;return React.createElement("div",{className:"TypeSwitcher"},React.createElement("div",{onClick:this._toggleOpen,className:"TypeSwitcher_icon TypeSwitcher_icon-"+current},current),this.state.open&&React.createElement("ul",{className:"TypeSwitcher_dropdown"},keys.map(function(key){return key!==current&&React.createElement("li",{className:"TypeSwitcher_item TypeSwitcher_item-"+key,onClick:this._onSelect.bind(null,key),key:key},key)}.bind(this))))}});module.exports=TypeSwitcher},{react:"react",treed:300}],53:[function(require,module,exports){var React=require("react"),PT=React.PropTypes,Modal=require("../modal"),FormatPicker=require("./format-picker"),readFile=require("./read-file"),convert=require("../convert");var Uploader=React.createClass({displayName:"Uploader",propTypes:{initialFile:PT.object},getInitialState:function(){return{mode:"insert",format:this.props.initialFile&&convert.detect(this.props.initialFile.name)||"nm",file:this.props.initialFile,reader:null,error:null}},componentWillReceiveProps:function(nextProps){if(nextProps.initialFile!==this.props.initialFile){this.setFile(nextProps.initialFile)}},setFile:function(file){var update={file:file};if(file){var format=convert.detect(file.name);if(format){update.format=format}}this.setState(update)},_onChangeFormat:function(format){this.setState({format:format})},_onChangeMode:function(mode){this.setState({mode:mode})},_onChangeFile:function(e){this.setFile(e.target.files[0])},_onClearFile:function(){this.setState({file:null})},_onSubmit:function(){var reader=readFile(this.state.file,function(err,text){if(err){return this.setState({reader:null,error:err.message})}var data=convert[this.state.format].treeFromStr(text);if(data instanceof Error){return this.setState({reader:null,error:data.message})}this.setState({reader:null,error:null});this.props.onUploaded(this.state.file.name,data)}.bind(this));this.setState({reader:reader,error:false})},file:function(){if(this.state.file){return React.createElement("div",{className:"Uploader_file"},React.createElement("span",null,this.state.file.name+" "+this.state.file.size+"kb"),React.createElement("button",{className:"Uploader_clear",onClick:this._onClearFile},""))}return React.createElement("input",{className:"Uploader_input",type:"file",onChange:this._onChangeFile})},render:function(){if(this.state.reader){return React.createElement(Modal,{className:"Modal-upload",onClose:this.props.onClose,title:"Import"},"Loading file...")}return React.createElement(Modal,{className:"Modal-upload",onClose:this.props.onClose,title:"Import"},this.state.error&&React.createElement("div",{className:"Uploader_error"},this.state.error),React.createElement(FormatPicker,{formats:[["replace","Replace notebook"],["insert","Insert at cursor"]],onChange:this._onChangeMode,format:this.state.mode}),this.file(),this.state.file&&React.createElement(FormatPicker,{formats:convert.formats,onChange:this._onChangeFormat,format:this.state.format}),React.createElement("br",null),React.createElement("button",{onClick:this._onSubmit,className:"Uploader_submit"},"Import"))}});module.exports=Uploader},{"../convert":56,"../modal":66,"./format-picker":36,"./read-file":44,react:"react"}],54:[function(require,module,exports){module.exports=findNextActiveId;function findNextActiveId(windows,currentActiveView,direction){var boxes=windowBoxes(windows,{x:0,y:0,w:1e3,h:1e3});var boxMap={};boxes.forEach(function(box){return boxMap[box.id]=box.box});return go(direction,currentActiveView,boxMap)}function windowBoxes(windows,container){if(windows.leaf){return[{box:container,id:windows.value.config.view.view.id}]}var split=splitBox(container,windows.value.orient,windows.value.ratio||.5);return windowBoxes(windows.value.first,split.first).concat(windowBoxes(windows.value.second,split.second))}function splitBox(box,orient,ratio){var w=box.w,h=box.h;if(orient==="horiz"){return{first:{x:box.x,y:box.y,w:w*ratio,h:box.h},second:{x:box.x+w*ratio,y:box.y,w:w*(1-ratio),h:box.h}}}else{return{first:{x:box.x,y:box.y,h:h*ratio,w:box.w},second:{y:box.y+h*ratio,x:box.x,h:h*(1-ratio),w:box.w}}}}function go(dir,id,boxMap){var x0=dir==="up"||dir==="down"?"y":"x",x1=x0==="x"?"y":"x",d0={x:"w",y:"h"}[x0],d1={x:"w",y:"h"}[x1],dr=dir==="down"||dir==="right";var box=boxMap[id],pos={};pos[x0]=box[x0]+(dr?box[d0]:0);pos[x1]=box[x1]+box[d1]/2;for(var oid in boxMap){if(oid==id)continue;var obox=boxMap[oid];if(pos[x0]===obox[x0]+(dr?0:obox[d0])&&obox[x1]<pos[x1]&&pos[x1]<=obox[x1]+obox[d1])return+oid}return false}},{}],55:[function(require,module,exports){module.exports={fromStr:fromStr,toStr:toStr,parseSections:parseSections};function toStr(trees){var sections=treesToSections(trees);return";; gorilla-repl.fileformat = 1\n\n"+sections.map(function(section){return section.join("\n")}).join("\n\n")+"\n"}function treesToSections(trees){var sections=[];trees.forEach(function(tree){sections.push(nodeToSection(tree));if(tree.children.length){sections=sections.concat(treesToSections(tree.children))}});return sections}function nodeToSection(node){if(!node.type||node.type==="base"){return[";; **"].concat(node.content.split("\n").map(function(line){return";;; "+line}),[";; **"])}if(node.type==="ipython"){return[";; @@"].concat(node.content.split("\n"),[";; @@"],outputsToSection(node.outputs))}console.warn("Unknown section type",node.type,node);return[]}function outputsToSection(allOutputs){var streams=[],outputs=[];allOutputs.forEach(function(output){if(output.output_type==="stream"){streams.push(output.text)}else{outputs.push(output)}});var result=[];if(streams.length){result=result.concat([";; ->"],streams,[";; <-"])}if(outputs.length){result=result.concat([";; =>",";;; "+JSON.stringify(convertOutputs(outputs)),";; <="])}return result}function convertOutputs(outputs){var last=outputs[outputs.length-1],result={value:last["text/plain"]};if(last["json/list-like"]){return last["json/list-like"]}else if(last["json/vega"]){result.type="vega";result.content=last["json/vega"]}else if(last["json/latex"]){result.type="latex";result.content=last["json/latex"].content}else if(last["text/html"]){result.type="html";result.content=last["text/html"]}else{result.type="text";result.content=last["text/plain"]}return result}function fromStr(str){var sections=parseSections(str),nodes=[],body,lastCode;for(var i=0;i<sections.length;i++){body=sections[i].slice(1);switch(sections[i][0]){case"md":nodes.push(parseMarkdown(body));break;case"code":nodes.push(lastCode=parseCode(body));break;case"stream":addStream(lastCode,body);break;case"out":addOutput(lastCode,body);break}}return nodes}function dedent(items){return items.map(function(line){return line.slice(4)})}function parseMarkdown(body){return{content:dedent(body).join("\n"),children:[],type:"base"}}function parseCode(body){return{content:body.join("\n"),children:[],type:"ipython",language:"clojure",outputs:[]}}function addStream(node,body){node.outputs.push({output_type:"stream",stream:"stdout",text:dedent(body).join("\n")})}function addOutput(node,body){var value=JSON.parse(dedent(body).join("\n"));var suppressable=value.value==="nil"||value.value.slice(0,2)==="#'";node.outputs.push({output_type:"pyout",suppressable:suppressable,"text/html":value.type==="html"&&value.content,"json/vega":value.type==="vega"&&value.content,"json/list-like":value.type==="list-like"&&value,"json/latex":value.type==="latex"&&value,"text/plain":value.value})}var ENTRY={"":false,";; **":"md",";; @@":"code",";; =>":"out",";; ->":"stream"};var EXIT={md:";; **",code:";; @@",out:";; <=",stream:";; <-"};function parseSections(str){var lines=str.split("\n");var sections=[];var insection=false;var section;var line;for(var i=0;i<lines.length;i++){line=lines[i].trim();if(!insection){if(line in ENTRY){insection=ENTRY[line];if(insection){sections.push(section=[insection])}}else{console.warn("unexpected line outside of a section",line)}continue}if(line===EXIT[insection]){insection=false;continue}section.push(lines[i])}return sections}},{}],56:[function(require,module,exports){var parseGorilla=require("./gorilla");var ipython=require("./ipython");var python=require("./python");var js=require("./javascript");var markdown=require("./markdown");module.exports={markdown:{ext:"md",mime:"text/plain",strFromTrees:markdown.dump,treeFromStr:markdown.parse},notablemind:{ext:"nm",mime:"application/json",strFromTrees:function(trees){return JSON.stringify(trees,null,2)},treeFromStr:function(str){try{var trees=JSON.parse(str)}catch(e){return new Error("Unable to parse file. Are you sure it's the right format?")}if(!Array.isArray(trees)&&trees.content&&trees.children){trees=[trees]}if(!Array.isArray(trees)||!trees.length||!trees[0].content||!trees[0].children){return new Error("This doesn't look like the right format.")}return trees}},ipython:{ext:"ipynb",mime:"application/json",strFromTrees:ipython.toStr,treeFromStr:ipython.fromStr},python:{ext:"py",mime:"text/python",strFromTrees:python.toStr,treeFromStr:python.fromStr},javascript:{ext:"js",mime:"text/javascript",strFromTrees:js.toStr,treeFromStr:js.fromStr},gorilla:{ext:"clj",mime:"text/clojure",strFromTrees:parseGorilla.toStr,treeFromStr:parseGorilla.fromStr},formats:[["notablemind","Notablemind (.nm)"],["ipython","IPython (.ipynb)"],["gorilla","Gorilla (.clj)"],["python","Python (.py)"],["javascript","Javascript (.js)"],["markdown","Markdown (.md)"]],exts:{md:"markdown",nm:"notablemind",py:"python",ipynb:"ipython",clj:"gorilla",js:"javascript"},detect:function(filename){var parts=filename.split("."),ext=parts[parts.length-1],fromExt=module.exports.exts[ext];if(fromExt)return fromExt}}},{"./gorilla":55,"./ipython":57,"./javascript":58,"./markdown":59,"./python":60}],57:[function(require,module,exports){module.exports={fromStr:fromStr,toStr:toStr};function fromStr(str){try{var data=JSON.parse(str)}catch(e){return new Error("Failed to parse document")}var allCells=[].concat.apply([],data.worksheets.map(function(worksheet){return worksheet.cells}));var pedigree=[{node:{children:[]},level:0}];allCells.forEach(function(cell){var node=cellToNode(cell),last=pedigree[pedigree.length-1];if(cell.cell_type!=="heading"){last.node.children.push(node);return}if(cell.level>last.level){last.node.children.push(node);pedigree.push({level:cell.level,node:node});return}for(var i=pedigree.length-2;i>0&&pedigree[i].level<=cell.level;i--){}pedigree[i].node.children.push(node);pedigree=pedigree.slice(0,i+1);pedigree.push({level:cell.level,node:node})});return pedigree[0].node.children}function convertOutput(output){if(output.output_type==="stream"){output.text=output.text.join("");return output}if(output.html){output["text/html"]=output.html.join("\n");delete output.html}if(output.text){output["text/plain"]=output.text.join("\n");delete output.text}if(output.latex){output["text/latex"]=output.latex.join("\n");delete output.latex}if(output.png){output["image/png"]=output.png;delete output.png}return output}function cellToNode(cell){if(cell.cell_type==="code"){return{content:cell.input.join("\n"),type:"ipython",language:cell.language,outputs:cell.outputs.map(convertOutput),children:[]}}if(cell.cell_type==="markdown"){return{type:"base",content:cell.source.join("\n"),children:[]}}if(cell.cell_type==="heading"){return{type:"heading",content:cell.source.join("\n"),children:[]}}console.warn("unknown ipython cell type",cell);return{type:"base",content:cell.source&&cell.source.join("\n"),children:[]}}function toHeading(text,level){var pre="";for(var i=0;i<level;i++){pre+="#"}return pre+" "+text}function toStr(trees){}},{}],58:[function(require,module,exports){module.exports={toStr:toStr,fromStr:fromStr};function toStr(trees){return trees.map(nodeToStr).join("\n\n")}function fromStr(str){return[{content:str,type:"ipython",language:"javascript",children:[]}]}function nodeToStr(node){var str="";if(node.type==="ipython"&&node.language==="javascript"){str+=node.content}else{str+=node.content.replace(/(^|\n)/g,"$1// ")}if(node.children&&node.children.length){str+="\n\n"+node.children.map(nodeToStr).join("\n\n")}return str}},{}],59:[function(require,module,exports){module.exports={parse:parse,dump:dump};function head(level){var t="#";for(var i=0;i<level;i++){t+="#"}return t}function dumpDown(level,node){if(node.type==="ipython"){return"```"+node.language+"\n"+node.content+"\n```"+(node.children?"\n"+node.children.map(dumpDown.bind(null,level)).join("\n\n"):"")}if(node.children.length){return head(level)+" "+node.content+"\n\n"+node.children.map(dumpDown.bind(null,level+1)).join("\n\n")}return node.content}function dump(trees){return trees.map(dumpDown.bind(null,0)).join("\n\n")}function parse(text){return{content:text,children:[]}}},{}],60:[function(require,module,exports){module.exports={toStr:toStr,fromStr:fromStr};function toStr(trees){return trees.map(nodeToStr).join("\n\n")}function fromStr(str){return[{content:str,type:"ipython",children:[]}]}function nodeToStr(node){var str="";if(node.type==="ipython"){str+=node.content}else{str+=node.content.replace(/(^|\n)/g,"$1# ")}if(node.children&&node.children.length){str+="\n\n"+node.children.map(nodeToStr).join("\n\n")}return str}},{}],61:[function(require,module,exports){var IxPL=require("treed/pl/ixdb"),QueuePL=require("treed/pl/queuedb"),treed=require("treed"),kernelConfig=require("./kernels"),Db=require("treed/db"),async=require("async");var uuid=require("../lib/uuid");module.exports={list:listFiles,update:updateFile,remove:removeFile,create:newFile,get:getFile,find:findFile,init:init,populateFile:populateFile,importRaw:importRaw,dump:dump};function dump(file,done){getFile(file.id,function(pl){init(file,pl,function(err,store,plugins){if(err)return done(err);var data={};for(var name in file){data[name]=file[name]}data.root=store.db.exportTree(null,true);done(null,data)})})}function findFile(id,done){listFiles(function(files){var f;files.forEach(function(file){if(file.id!==id)return file;f=file});done(f)})}function updateFile(id,data,done){listFiles(function(files){var f;saveFiles(files.map(function(file){if(file.id!==id)return file;f=file;for(var name in data){file[name]=data[name]}return file}),function(){return done&&done(f)})})}function convertToFile(data){if(!Array.isArray(data)){if(data.root&&data.title){return data}data=[data]}if(data.length===1){return{title:data[0].content,root:data[0],repl:"none"}}return{title:"Imported...",root:{content:"Imported...",children:data},repl:"none"}}function importRaw(data,done){if("string"===typeof data){try{data=JSON.parse(data)}catch(e){return done(new Error("Invalid format"))}}if(Array.isArray(data)&&data[0].title&&data[0].root){async.parallel(data.map(function(one){return function(next){return importOne(one,next)}}),done)}else{importOne(data,done)}}function importOne(data,done){var fileData=convertToFile(data);if(!fileData){return done(new Error("Invalid file format"))}newImport(fileData,function(file,pl){populateFile(pl,fileData.root,function(err){done(err,file)})})}function populateFile(pl,data,done){var db=new Db(pl,[]);db.init(data,function(err){if(err)return done(err);done(null)})}function init(file,pl,defaultData,done){if(arguments.length===3){done=defaultData;defaultData={content:file.title,children:[]}}var config=kernelConfig[file.repl];var plugins=[require("treed/plugins/undo"),require("treed/plugins/todo"),require("treed/plugins/image"),require("treed/plugins/types"),require("treed/plugins/collapse"),require("treed/plugins/clipboard"),require("treed/plugins/lists"),require("treed/plugins/rebase"),require("../treed-plugins/custom-css")];if(config&&config.kernel){plugins.unshift(require("itreed/lib/plugin")(config))}var storeOptions={data:defaultData,pl:pl};treed.initStore(plugins,storeOptions,function(err,store){if(err){return done(err)}done(null,store,plugins)})}function listFiles(done){var val=localStorage["nm:files:list"];if(!val)return done([]);var items;try{items=JSON.parse(localStorage["nm:files:list"])}catch(e){console.warn("Failed to parse files list. Corrupted:");console.warn(localStorage["nm:files:list"]);return done([])}done(items)}function saveFiles(files,done){localStorage["nm:files:list"]=JSON.stringify(files);done&&done()}function getFile(id,isNew,done){if(arguments.length===2){done=isNew;isNew=false}var pl=new QueuePL(new IxPL({prefix:"nm:file:"+id}));done(pl)}function newFile(title,repl,done){var file={id:uuid(),created:Date.now(),opened:Date.now(),title:title,repl:repl};listFiles(function(files){return saveFiles(files.concat([file]),function(){return getFile(file.id,true,function(pl){return done(file,pl)})})})}function newImport(fileData,done){var file={id:uuid()};for(var name in fileData){if(name==="root")continue;file[name]=fileData[name]}listFiles(function(files){return saveFiles(files.concat([file]),function(){return getFile(file.id,true,function(pl){return done(file,pl)})})})}function removeFile(id,done){listFiles(function(files){return saveFiles(files.filter(function(x){return x.id!==id}),done)})}},{"../lib/uuid":84,"../treed-plugins/custom-css":446,"./kernels":64,async:"async","itreed/lib/plugin":119,treed:300,"treed/db":299,"treed/pl/ixdb":400,"treed/pl/queuedb":403,"treed/plugins/clipboard":404,"treed/plugins/collapse":405,"treed/plugins/image":410,"treed/plugins/lists":412,"treed/plugins/rebase":414,"treed/plugins/todo":418,"treed/plugins/types":419,"treed/plugins/undo":420}],62:[function(require,module,exports){var MemPL=require("treed/pl/mem"),files=require("./files");module.exports={load:loadGist};function loadGist(uid,id,done){getGistContents(uid,id,function(err,contents){if(err)return done(err);initGist(contents,done)})}function getGistContents(uid,id,done){var x=new XMLHttpRequest;x.open("get","https://gist.githubusercontent.com/"+uid+"/"+id+"/raw/");x.onreadystatechange=function(){if(x.readyState!==4)return;var data;try{data=JSON.parse(x.responseText)}catch(e){return done(new Error("invalid gist file"))}done(null,data)};x.send()}function initGist(data,done){var pl=new MemPL;var file={title:data.title||"Loaded from gist",repl:data.repl};files.init(file,pl,data.root,function(err,store,plugins){if(err)return done(err);done(null,file,store,plugins)})}},{"./files":61,"treed/pl/mem":402}],63:[function(require,module,exports){var Morph={componentWillUpdate:function(){var node=this.getDOMNode();this._width=node.style.width;this._height=node.style.height;var st=window.getComputedStyle(node);node.style.height=st.height;node.style.width=st.width},componentDidUpdate:function(){var node=this.getDOMNode();var bef=window.getComputedStyle(node),height=bef.height,width=bef.width,owidth=this._width,oheight=this._height;node.style.height=oheight;node.style.width=owidth;var aft=window.getComputedStyle(node),awidth=aft.width,aheight=aft.height;if(awidth===width&&aheight===height){return}node.style.height=height;node.style.width=width;var ooverflow=node.style.overflow,otransition=node.style.transition;node.style.overflow="hidden";node.style.transition="width .5s ease, height .5s ease";node.offsetHeight;node.style.height=aheight;node.style.width=awidth;var done=function(){node.style.transition=otransition;node.style.overflow=ooverflow;node.style.height=oheight;node.style.width=owidth;node.removeEventListener("transitionend",done)};node.addEventListener("transitionend",done)}};module.exports=Morph},{}],64:[function(require,module,exports){var Gorilla=require("itreed/lib/kernels/gorilla"),IPython=require("itreed/lib/kernels/ipython"),IJS=require("itreed/lib/kernels/js"),Rust=require("itreed/lib/kernels/rust"),Go=require("itreed/lib/kernels/go");module.exports={null:{title:"None"},ipython:{type:"ipython",language:"python",remote:true,title:"Python",kernel:IPython},gorilla:{type:"gorilla",language:"clojure",remote:true,title:"Clojure",kernel:Gorilla},ijulia:{type:"ipython",language:"julia",remote:true,title:"Julia",kernel:IPython},ijs:{type:"ijs",language:"javascript",remote:false,title:"Javascript",kernel:IJS},rust:{type:"rust",language:"rust",remote:true,title:"Rust",kernel:Rust},go:{type:"go",language:"go",remote:true,title:"Go",kernel:Go}}},{"itreed/lib/kernels/go":100,"itreed/lib/kernels/gorilla":101,"itreed/lib/kernels/ipython":102,"itreed/lib/kernels/js":107,"itreed/lib/kernels/rust":114}],65:[function(require,module,exports){module.exports={_registerKeys:function(keys,config){if(!arguments.length)keys=this.props.keys;if(!config&&this.constructor.keys){config=this.constructor.keys.call(this)}if(!keys||!config){return}this._keys_id=keys.add(config)},_unregisterKeys:function(kid){if(!this.props.keys||!kid){return}this.props.keys.remove(kid)},componentDidMount:function(){this._registerKeys()},componentWillUnmount:function(){this._unregisterKeys(this._keys_id);delete this._keys_id},componentWillReceiveProps:function(nextProps){if(nextProps.keys!==this.props.keys){this._unregisterKeys(this._keys_id);delete this._keys_id;this._registerKeys(nextProps.keys)}}}},{}],66:[function(require,module,exports){var React=require("react"),PT=React.PropTypes;var Modal=React.createClass({displayName:"Modal",render:function(){return this.transferPropsTo(React.createElement("div",{className:"Modal-container"},React.createElement("div",{className:"Modal_back",onClick:this.props.onClose}),React.createElement("div",{className:"Modal_popup"},React.createElement("div",{className:"Modal_title"},this.props.title),React.createElement("div",{className:"Modal_close",onClick:this.props.onClose},""),React.createElement("div",{className:"Modal_body"},this.props.children))))}});module.exports=Modal},{react:"react"}],67:[function(require,module,exports){var React=require("react"),Navigation=require("react-router").Navigation,keys=require("treed/lib/keys"),files=require("../files"),Browse=require("../components/browse"),BrowseHeader=require("../components/browse-header");function strcmp(a,b){if(a===b)return 0;if(a>b)return 1;return-1}var BrowsePage=React.createClass({displayName:"BrowsePage",mixins:[Navigation],getInitialState:function(){return{keys:null,files:null,error:null,loading:false}},componentWillMount:function(){var kh=keys({});this.setState({keys:kh});window.addEventListener("keydown",this._keyDown)},componentDidMount:function(){this._reloadFiles()},componentWillUnmount:function(){window.removeEventListener("keydown",this.state.keys)},_keyDown:function(e){if(!this.state.keys)return;if(["INPUT","TEXTAREA"].indexOf(e.target.nodeName)!==-1){return}this.state.keys(e)},_reloadFiles:function(){files.list(function(files){files=files.sort(function(a,b){return strcmp(a.title,b.title)});this.setState({files:files,error:null,loading:false})}.bind(this))},_onNewFile:function(title,repl){this.setState({newing:null,error:null,loading:true});files.create(title,repl,function(file,pl){return files.init(file,pl,function(err,store,plugins){if(err){return this._onError(err)}this.transitionTo("doc",{id:file.id})}.bind(this))}.bind(this))},render:function(){return React.createElement("div",{className:"BrowsePage"},React.createElement(BrowseHeader,{fileslib:files,keys:this.state.keys,onNewFile:this._onNewFile,onUpdated:this._reloadFiles}),this.state.files?React.createElement(Browse,{onOpen:function(file){return this.transitionTo("doc",{id:file.id})}.bind(this),onUpdated:this._reloadFiles,keys:this.state.keys,fileslib:files,files:this.state.files}):React.createElement("span",null,"Loading"))}});module.exports=BrowsePage},{"../components/browse":28,"../components/browse-header":27,"../files":61,react:"react","react-router":259,"treed/lib/keys":304}],68:[function(require,module,exports){var React=require("react"),$__0=require("react-router"),Navigation=$__0.Navigation,State=$__0.State,KeyManager=require("treed/key-manager"),keys=require("treed/lib/keys"),files=require("../files"),DocHeader=require("../components/doc-header"),DocViewer=require("../components/doc-viewer");function dehydrateWindows(config){if(config.leaf){return{leaf:true,value:{root:config.value.root,type:config.value.type}}}return{leaf:false,value:{first:dehydrateWindows(config.value.first),second:dehydrateWindows(config.value.second),ratio:config.value.ratio,orient:config.value.orient}}}var DocPage=React.createClass({displayName:"DocPage",mixins:[Navigation,State],componentDidMount:function(){this.loadFile();
window.addEventListener("keydown",this._keyDown)},componentWillUnmount:function(){window.removeEventListener("keydown",this._keyDown);if(this.state.store){this._unlistenToStore(this.state.store)}},getInitialState:function(){return{loading:false,error:null}},_listenToStore:function(store){store.on(["node:"+store.db.root],this._onRootChanged)},_unlistenToStore:function(store){store.off(["node:"+store.db.root],this._onRootChanged)},_onRootChanged:function(){var db=this.state.store.db,title=db.nodes[db.root].content;if(title.length>100){title=title.slice(0,98)+"..";window.document.title=title}this._changeTitle(title)},_changeTitle:function(title){files.update(this.state.file.id,{title:title},function(file){return this.setState({file:file})}.bind(this))},_keyDown:function(e){if(!this.state.keys)return;if(this.state.store.views[this.state.store.activeView].mode!=="insert"&&["INPUT","TEXTAREA"].indexOf(e.target.nodeName)!==-1){return}return this.state.keys.keyDown(e)},_onError:function(err){this.setState({loading:false,error:err})},onFileUpdate:function(file){this.setState({file:file})},saveWindowConfig:function(windows,done){var id=this.getParams().id;files.update(id,{windows:dehydrateWindows(windows)},done)},updateFile:function(update,done){var id=this.getParams().id;files.update(id,update,done)},_onLoad:function(file,store,plugins){window.store=store;window.docPage=this;window.document.title=file.title;this._listenToStore(store);var keys=new KeyManager;keys.attach(store);keys.addKeys({"g q":function(){return this.transitionTo("browse")}.bind(this)});files.update(file.id,{opened:Date.now()},function(file){this.setState({keys:keys,file:file,store:store,plugins:plugins,loading:false})}.bind(this))},loadFile:function(){this.setState({error:null,loading:true});var id=this.getParams().id;files.find(id,function(file){return files.get(id,function(pl){files.init(file,pl,function(err,store,plugins){if(err){return this._onError(err)}this._onLoad(file,store,plugins)}.bind(this))}.bind(this))}.bind(this))},render:function(){if(this.state.loading){return React.createElement("div",{className:"DocPage DocPage-loading"},"Loading")}if(this.state.error){return React.createElement("em",null,"Error loading file ",this.state.error+"")}if(!this.state.store){return React.createElement("em",null,"Loading")}var $__0=this.state,store=$__0.store,file=$__0.file,plugins=$__0.plugins;return React.createElement("div",{className:"DocPage"},React.createElement(DocHeader,{file:file,store:store,plugins:plugins,onFileUpdate:this.onFileUpdate,changeTitle:this._changeTitle,onClose:!this.props.noHome&&function(){return this.transitionTo("browse")}.bind(this)}),React.createElement(DocViewer,{file:file,store:store,plugins:plugins,query:this.getQuery(),saveWindowConfig:this.saveWindowConfig,keys:this.state.keys}))}});module.exports=DocPage},{"../components/doc-header":29,"../components/doc-viewer":30,"../files":61,react:"react","react-router":259,"treed/key-manager":302,"treed/lib/keys":304}],69:[function(require,module,exports){var React=require("react"),$__0=require("react-router"),Navigation=$__0.Navigation,State=$__0.State,KeyManager=require("treed/key-manager"),keys=require("treed/lib/keys"),files=require("../files"),gists=require("../gists"),GistForm=require("../components/gist-form"),DocViewer=require("../components/doc-viewer");var GistPage=React.createClass({displayName:"GistPage",mixins:[Navigation,State],componentDidMount:function(){if(this.getParams().id)this.loadFile();window.addEventListener("keydown",this._keyDown)},componentWillUnmount:function(){window.removeEventListener("keydown",this._keyDown)},componentWillReceiveProps:function(nextProps){var params=this.getParams();if(params.uid+"/"+params.id!==this.state.loadedGist){this.loadFile()}},getInitialState:function(){return{loadedGist:"",loading:!!this.getParams().id,error:null}},_keyDown:function(e){if(!this.state.keys)return;if(this.state.store.views[this.state.store.activeView].mode!=="insert"&&["INPUT","TEXTAREA"].indexOf(e.target.nodeName)!==-1){return}return this.state.keys.keyDown(e)},loadFile:function(){var uid=this.getParams().uid;var id=this.getParams().id;this.setState({loadedGist:uid+"/"+id,error:null,loading:true});gists.load(uid,id,function(err,file,store,plugins){if(err)return this.setState({error:err,loading:false});window.store=store;window.docPage=this;var keys=new KeyManager;keys.attach(store);keys.addKeys({"g q":function(){return this.transitionTo("browse")}.bind(this)});this.setState({keys:keys,file:file,store:store,plugins:plugins,loading:false})}.bind(this))},goToGist:function(gid){var parts=gid.split("/");if(parts.length!==2)return console.warn("tried to load an invalid gist id: "+gid);this.transitionTo("gist",{uid:parts[0],id:parts[1]})},render:function(){if(this.state.loading){return React.createElement("div",{className:"GistPage GistPage-loading"},"Loading")}if(!this.state.file){return React.createElement("div",{className:"GistPage GistPage-form"},React.createElement(GistForm,{initialValue:this.state.loadedGist,onSubmit:this.goToGist}),this.state.error?React.createElement("div",{className:"GistPage_error"},React.createElement("h3",null,"Failed to load gist"),"Make sure ",React.createElement("a",{href:"http://gist.github.com/"+this.state.loadedGist,target:"_blank"},"this gist")," exists and was generated by NotableMind."):null)}var $__0=this.state,store=$__0.store,file=$__0.file,plugins=$__0.plugins;return React.createElement("div",{className:"GistPage"},React.createElement(GistForm,{initialValue:this.state.loadedGist,onSubmit:this.goToGist}),React.createElement(DocViewer,{file:file,store:store,plugins:plugins,query:this.getQuery(),saveWindowConfig:function(config,done){return done()},keys:this.state.keys}))}});module.exports=GistPage},{"../components/doc-viewer":30,"../components/gist-form":38,"../files":61,"../gists":62,react:"react","react-router":259,"treed/key-manager":302,"treed/lib/keys":304}],70:[function(require,module,exports){var Router=require("react-router");var $__0=Router,Route=$__0.Route,DefaultRoute=$__0.DefaultRoute,RouteHandler=$__0.RouteHandler,Link=$__0.Link;var BrowsePage=require("./pages/browse"),DocPage=require("./pages/doc"),GistPage=require("./pages/gist");var App=React.createClass({displayName:"App",render:function(){return React.createElement(RouteHandler,{className:"App"})}});module.exports=React.createElement(Route,{handler:App},React.createElement(DefaultRoute,{name:"browse",handler:BrowsePage}),React.createElement(Route,{name:"doc",path:"doc/:id",handler:DocPage}),React.createElement(Route,{name:"gist",path:"gist/:uid/:id",handler:GistPage}),React.createElement(Route,{name:"gist-browse",path:"gist",handler:GistPage}))},{"./pages/browse":67,"./pages/doc":68,"./pages/gist":69,"react-router":259}],71:[function(require,module,exports){module.exports={post:send.bind(null,"POST"),patch:send.bind(null,"PATCH"),get:function get(url,headers,done){if(arguments.length===2){done=headers;headers={}}send("GET",url,headers,null,done)}};function send(method,url,headers,data,done){var x=new XMLHttpRequest;x.open(method,url);for(var name in headers){x.setRequestHeader(name,headers[name])}x.onreadystatechange=function(){if(this.readyState!==4)return;var data,mime=this.getResponseHeader("content-type");if(mime.indexOf("json")!==-1||mime.indexOf("notablemind")!==-1){try{data=JSON.parse(this.responseText)}catch(e){return done(new Error("Unexpected server response"))}}else{data=this.responseText}done(null,data)};x.onerror=function(){done(new Error("Failed to connect"))};x.onabort=function(){done(new Error("Connection cancelled"))};if(data){x.send(JSON.stringify(data))}else{x.send()}}},{}],72:[function(require,module,exports){(function(process){var ajax=require("./ajax"),googleAuthModal=require("./google-auth-modal"),loadGDriveModal=require("./load-gdrive-modal");module.exports={title:"Google Drive",link:function(config){return"https://drive.google.com/open?id="+config.id},select:function(done){authorize(function(err,token){loadGDriveModal(listFiles,downloadFile,function(err,contents,file){if(err)return done(err);done(null,contents,getConfigFromFile(file))})});done(new Error("import from gdrive not yet supported"))},head:function(config,done){authorize(function(err){if(err)return done(err);var accessToken=gapi.auth.getToken().access_token;ajax.get("https://www.googleapis.com/drive/v2/files/"+config.id,{Authorization:"Bearer "+accessToken},function(err,file){if(err)return done(err);done(null,new Date(file.modifiedDate).getTime(),file.downloadUrl)})})},load:function(config,downloadUrl,done){authorize(function(err){if(err)return done(err);downloadFile(downloadUrl,done)})},save:function(config,title,text,done){authorize(function(err){if(err)return done(err);updateFile(config.id,{title:title+".nm"},text,function(file){return done(null,getConfigFromFile(file),new Date(file.modifiedDate).getTime())})})},saveAs:function(title,text,done){authorize(function(err){if(err)return done(err);uploadFile(title,text,function(file){return done(null,getConfigFromFile(file),new Date(file.modifiedDate).getTime())})})}};var CONFIG={client_id:process.env.GDRIVE_CLIENT_ID,scopes:"https://www.googleapis.com/auth/drive"};function authorize(done){var token=gapi.auth.getToken();if(token&&+token.expires_at*1e3>Date.now())return done(null);gapi.auth.authorize({client_id:CONFIG.client_id,scope:CONFIG.scopes,immediate:true},function(result){if(result&&!result.error){return done(null)}googleAuthModal(function(done){gapi.auth.authorize({client_id:CONFIG.client_id,scope:CONFIG.scopes,immediate:false},function(result){if(result&&!result.error){return done(null)}done(new Error("not authorized"))})},done)})}function getConfigFromFile(file){return{id:file.id,etag:file.etag,created:file.createdDate,modified:file.modifiedDate,link:file.webContentLink,shared:file.shared}}function listFiles(done){var accessToken=gapi.auth.getToken().access_token;ajax.get("https://www.googleapis.com/drive/v2/files?q="+encodeURIComponent("mimeType = 'application/vnd.notablemind'"),{Authorization:"Bearer "+accessToken},function(err,body){if(err||body.error)return done(err||body.error);done(null,body.items)})}function downloadFile(downloadUrl,done){var accessToken=gapi.auth.getToken().access_token;ajax.get(downloadUrl,{Authorization:"Bearer "+accessToken},done)}function uploadFile(title,fileData,done){const boundary="-------314159265358979323846";const delimiter="\r\n--"+boundary+"\r\n";const close_delim="\r\n--"+boundary+"--";var contentType="application/vnd.notablemind";var metadata={title:title+".nm",mimeType:contentType};var base64Data=btoa(fileData);var multipartRequestBody=delimiter+"Content-Type: application/json\r\n\r\n"+JSON.stringify(metadata)+delimiter+"Content-Type: "+contentType+"\r\n"+"Content-Transfer-Encoding: base64\r\n"+"\r\n"+base64Data+close_delim;var request=gapi.client.request({path:"/upload/drive/v2/files",method:"POST",params:{uploadType:"multipart"},headers:{"Content-Type":'multipart/mixed; boundary="'+boundary+'"'},body:multipartRequestBody});request.execute(done)}function updateFile(fileId,fileMetadata,fileData,callback){const boundary="-------314159265358979323846";const delimiter="\r\n--"+boundary+"\r\n";const close_delim="\r\n--"+boundary+"--";var contentType="application/vnd.notablemind";var base64Data=btoa(fileData);var multipartRequestBody=delimiter+"Content-Type: application/json\r\n\r\n"+JSON.stringify(fileMetadata)+delimiter+"Content-Type: "+contentType+"\r\n"+"Content-Transfer-Encoding: base64\r\n"+"\r\n"+base64Data+close_delim;var request=gapi.client.request({path:"/upload/drive/v2/files/"+fileId,method:"PUT",params:{uploadType:"multipart",alt:"json",setModifiedDate:true},headers:{"Content-Type":'multipart/mixed; boundary="'+boundary+'"'},body:multipartRequestBody});request.execute(callback)}}).call(this,require("_process"))},{"./ajax":71,"./google-auth-modal":74,"./load-gdrive-modal":76,_process:10}],73:[function(require,module,exports){(function(process){var saveAsModal=require("./save-as-modal"),loadGistModal=require("./load-gist-modal"),ajax=require("./ajax"),oauth=require("./oauth");module.exports={title:"Github Gist",link:function(config){return"https://gist.github.com/"+config.gist_id},share:function(config){return"https://app.notablemind.org/#/gist/"+config.gist_id},select:function(done){authorize(function(err,token){loadGistModal(loadGist.bind(null,token),function(err,result,gist_id){if(err)return;var parts=gist_id.split("/");if(parts.length===1){parts.unshift(null)}done(err,result,{user:parts[0],gist_id:parts[1]})})})},head:function(config,done){authorize(function(err,token){headGist(token,config.gist_id,function(err,result){if(err)return done(err);if(!result.files["Document.nm"]){return done("Gist has become corrupted")}var content=result.files["Document.nm"].truncated?null:result.files["Document.nm"].content;done(null,new Date(result.updated_at).getTime(),content)})})},load:function(config,headContent,done){if(headContent)return done(headContent);authorize(function(err,token){loadGist(token,config.gist_id,done)})},save:function(config,title,text,done){authorize(function(err,token){if(err)return done(err);var files={};files["Document.nm"]={content:text};upGist(token,config.gist_id,title,files,function(err,result){if(err){clearAuth();return done(err)}done(null,{gist_id:result.id},new Date(result.updated_at).getTime())})})},saveAs:function(title,text,done){authorize(function(err,token){if(err)return done(err);var files={};files["Document.nm"]={content:text};newGist(token,title,files,function(err,result){if(err||!result.id){clearAuth();return done(err||new Error("failed to create gist"))}done(null,{gist_id:result.id},new Date(result.updated_at).getTime())})})}};var LS_KEY="nm_gh_token";var CONFIG={authorize:"https://github.com/login/oauth/authorize",proxy:"https://auth-server.herokuapp.com/proxy",redirect_uri:parent.location.origin+"/connect.html",client_id:process.env.GITHUB_CLIENT_ID,api:"https://api.github.com/gists/"};function headGist(access_token,id,done){if(id.indexOf("/")!==-1){id=id.split("/").slice(-1)[0]}ajax.get(CONFIG.api+id,{Authorization:"token "+access_token},done)}function loadGist(access_token,id,done){ajax.get("https://gist.githubusercontent.com/"+id+"/raw/",{},done)}function clearAuth(){delete window.localStorage[LS_KEY]}function authorize(done){if(window.localStorage[LS_KEY])return done(null,window.localStorage[LS_KEY]);oauth(CONFIG,function(err,data){if(err){clearAuth();return done(err,null)}window.localStorage[LS_KEY]=data.access_token;done(null,data.access_token)})}function newGist(access_token,description,files,done){ajax.post(CONFIG.api.slice(0,-1),{Authorization:"token "+access_token},{description:description,public:true,files:files},done)}function upGist(access_token,id,description,files,done){ajax.post(CONFIG.api+id,{Authorization:"token "+access_token},{description:description,public:true,files:files},done)}function saveToGist(access_token,store,done){var files={"Document.nm":{content:JSON.stringify(store.db.exportTree(),null,2)}};var description=store.db.nodes[store.db.root].content;if(!store._globals.gistId){newGist(access_token,description,files,function(result){store._globals.gistId=result.id;done&&done()})}else{upGist(access_token,store._globals.gistId,description,files,done)}}}).call(this,require("_process"))},{"./ajax":71,"./load-gist-modal":77,"./oauth":78,"./save-as-modal":79,_process:10}],74:[function(require,module,exports){var showModal=require("../ui/show-modal");module.exports=function(authorize,done){showModal("Authorize with Google Drive",function(state,set,done){if(state.loading){return React.createElement("div",null,"Loading...")}var doAuth=function(){set({loading:true});authorize(function(err){if(!err)return this.props.onClose(null);set({error:true,loading:false})}.bind(this))}.bind(this);return React.createElement("div",null,state.error&&"Failed to authorize",React.createElement("button",{onClick:doAuth},"Authorize with Google Drive"))},done)}},{"../ui/show-modal":82}],75:[function(require,module,exports){module.exports={gist:require("./gist"),gdrive:require("./gdrive")}},{"./gdrive":72,"./gist":73}],76:[function(require,module,exports){var showModal=require("../ui/show-modal");module.exports=function(getFiles,loadFile,done){var setIt;getFiles(function(err,files){if(err)return setIt({loadingFiles:false,error:"Failed to load files."});setIt({files:files,loadingFiles:false})});showModal("Import from Google Drive",{loadingFiles:true},function(state,set,done){setIt=set;if(state.loadingFiles){return React.createElement("h2",null,"Loading files from google drive...")}if(state.loading){return React.createElement("h2",null,"Importing file...")}if(state.error){return React.createElement("span",null,state.error)}var importit=function(){set({loading:true});tryImport(state.gist_id,function(err,result){if(err)return set({loading:false,error:true});this.props.onClose(null,result,state.gist_id)}.bind(this))}.bind(this);var _onImport=function(file){set({loading:true});loadFile(file.downloadUrl,function(err,result){if(err)return set({loading:false,error:"Failed to import file"});this.props.onClose(null,result,file)}.bind(this))}.bind(this);return React.createElement("div",{className:"LoadGDrive"},React.createElement("ul",{className:"LoadGDrive_list"},state.files.map(function(file){return React.createElement("li",{onClick:_onImport.bind(null,file)},file.title)})));return React.createElement("div",null,state.error&&"Error loading gist...","Enter the username and gist id to import:",React.createElement("input",{placeholder:"username/gistid",value:state.gist_id,autoFocus:true,onChange:set("gist_id",true)}),React.createElement("button",{onClick:importit},"Import"))},done)}},{"../ui/show-modal":82}],77:[function(require,module,exports){var showModal=require("../ui/show-modal");module.exports=function(tryImport,done){showModal("Import a Gist",function(state,set,done){if(state.loading){return React.createElement("div",null,"Loading...")}var importit=function(){set({loading:true});tryImport(state.gist_id,function(err,result){if(err)return set({loading:false,error:true});this.props.onClose(null,result,state.gist_id)}.bind(this))}.bind(this);return React.createElement("div",null,state.error&&"Error loading gist...","Enter the username and gist id to import:",React.createElement("input",{placeholder:"username/gistid",value:state.gist_id,autoFocus:true,onChange:set("gist_id",true)}),React.createElement("button",{onClick:importit},"Import"))},done)}},{"../ui/show-modal":82}],78:[function(require,module,exports){module.exports=authenticate;function authenticate(CONFIG,done){var rand=uuid();firstStep(CONFIG,rand,function(err,created,params){if(err){created.close();return done(err)}secondStep(created,params,function(err,params){created.close();done(err,params)})})}function firstStep(CONFIG,rand,done){var url=CONFIG.authorize+"?"+params({client_id:CONFIG.client_id,scope:"gist",redirect_uri:CONFIG.redirect_uri,state:JSON.stringify({client_id:CONFIG.client_id,rand:rand,oauth_proxy:CONFIG.proxy,redirect_uri:CONFIG.redirect_uri,oauth:{version:2,auth:"https://github.com/login/oauth/authorize",grant:"https://github.com/login/oauth/access_token",response_type:"code"}})});var created=window.open(url,"Github Auth","width=400,height=400");waitForWindow(created,function(err){if(err)return done(err);done(null,created,params(created.location.search.slice(1)))})}function secondStep(window,searchParams,done){var state=JSON.parse(searchParams.state);searchParams.redirect_uri=state.redirect_uri;var path=state.oauth_proxy+"?"+params(searchParams);window.location.assign(path);waitForWindow(window,function(err){if(err)return done(err);waitFor(20,100,function(){if(window.location.hash.length<2)return false;done(null,params(window.location.hash.slice(1)));return true})})}function waitForWindow(window,initial,step,done){if(arguments.length===2){done=initial;initial=500;step=100}waitFor(initial,step,function(){if(window.closed){done(new Error("User aborder auth"));return true}try{var m=window.location.search}catch(e){return false}if(window.location.href==="about:blank")return false;done();return true})}function waitFor(start,ival,done){setTimeout(function(){if(done())return;var clear=setInterval(function(){if(done()){clearInterval(clear)}},ival)},start)}var chrs="0123456789abcdefghijklmnopqrtsuvwxyz";function uuid(num){num=num||32;var res="";for(var i=0;i<num;i++){res+=chrs[parseInt(Math.random()*chrs.length)]}return res}function params(what){if("string"===typeof what)return parseParams(what);return Object.keys(what).map(function(name){return name+"="+encodeURIComponent(what[name])}).join("&")}function parseParams(what){var obj={};what.split("&").forEach(function(part){var subs=part.split("=");obj[subs[0]]=decodeURIComponent(subs.slice(1).join("="))});return obj}},{}],79:[function(require,module,exports){var showModal=require("../ui/show-modal");module.exports=function(title,placeholder,done){showModal(title,function(state,set,done){return React.createElement("div",null,React.createElement("input",{placeholder:placeholder,value:state.title,onChange:set("title",true)}),React.createElement("button",{onClick:done},"Save"))},function(data,err){return done(err,data.title)})}},{"../ui/show-modal":82}],80:[function(require,module,exports){var SOURCES=require("./sources"),treesToMap=require("treed/util/trees-to-map"),localFiles=require("./files"),deepEqual=require("deep-equal");module.exports={doSync:doSync,exportContents:exportContents};function exportContents(file,store){return JSON.stringify({title:file.title,created:file.created,opened:file.opened,repl:file.repl,root:store.db.exportTree(null,true)},null,2)}function commit(file,store,done){console.log("commit local changes");var source=file.source,src=SOURCES[source.type],text=exportContents(file,store),title=store.db.nodes[store.db.root].content;return src.save(source.config,title,text,function(err,config,time){if(err){return done(err)}source.config=config;source.synced=time;source.dirty=false;localFiles.update(file.id,{source:source},function(file){done(null,file)})})}function maybe_get(headData,file,store,updated_at,fn,done){var source=file.source;SOURCES[source.type].load(source.config,headData,function(err,content){if(err)return done(err);fn(file,store,content,updated_at,done)})}function apply(file,store,content,updated_at,done){console.log("apply remote changes");var data=content;if("string"===typeof data){try{data=JSON.parse(data)}catch(e){return done("Gist has become corrupted (invalid json)")}}var db=store.db;data.root.id=db.root;crawl(data.root,null);file.source.synced=updated_at;localFiles.update(file.id,{source:file.source},function(file){done(null,file)});function crawl(node,pid){node.children=node.children.map(function(child){crawl(child,node.id);return child.id});node.parent=pid;if(!db.nodes[node.id]){return db.save(node.id,node)}if(node.modified===db.nodes[node.id].modified)return;if(deepEqual(node,db.nodes[node.id]))return;db.save(node.id,node);store.changed(store.events.nodeChanged(node.id))}}function merge_and_commit(file,store,content,updated_at,done){console.log("merge and commit");var data=content;if("string"===typeof data){try{data=JSON.parse(data)}catch(e){return done("Gist has become corrupted (invalid json)")}}var db=store.db;var $__0=treesToMap([data.root],null,true),nodes=$__0.nodes,roots=$__0.roots;var ids=Object.keys(nodes);for(var id in db.nodes){if(!nodes[id])ids.push(id)}ids.forEach(function(id){if(!nodes[id]){var pid=db.nodes[id].parent;while(!nodes[pid]&&pid){pid=db.nodes[pid].parent}if(!pid)return console.warn("failed to find a common ancestor...");if(nodes[pid].modified>db.nodes[pid].modified){db.remove(id)}else{}return}if(!db.nodes[id]){var pid=nodes[id].parent;while(!db.nodes[pid]&&pid){pid=nodes[pid].parent}if(!pid)return console.warn("failed to find a common ancestor...");if(nodes[pid].modified>db.nodes[pid].modified||db.nodes[pid].children.indexOf(id)!==-1){db.save(id,nodes[id],nodes[id].modified);store.changed(store.events.nodeChanged(id))}else{}return}if(nodes[id].modified>db.nodes[id].modified){db.save(id,nodes[id],nodes[id].modified);store.changed(store.events.nodeChanged(id))}else{}});commit(file,store,done)}function doSync(file,store,done){var source=file.source,localModified=file.modified,src=SOURCES[source.type];src.head(source.config,function(err,lastModified,headData){if(err){return done(err)}if(lastModified<=source.synced||!source.synced){if(source.dirty){return commit(file,store,done)}else{source.synced=lastModified;return done()}}else{var nextStep;if(!source.dirty&&localModified<=lastModified){nextStep=apply}else{nextStep=merge_and_commit}return maybe_get(headData,file,store,lastModified,nextStep,done)}})}function just_save(title,text,source,done){source.dirty=false;SOURCES[source.type].save(title,text,source.config,function(err,config,time){if(err)return done(new Error("Failed to save"));source.synced=time;done(source)})}function sync(root,nodes,remote){for(var name in remote){}}},{"./files":61,"./sources":75,"deep-equal":85,"treed/util/trees-to-map":430}],81:[function(require,module,exports){var React=require("react"),PT=React.PropTypes;var Modal=React.createClass({displayName:"Modal",propTypes:{title:PT.string.isRequired,onClose:PT.func.isRequired,initialState:PT.object,buttons:PT.object,render:PT.func},getInitialState:function(){return this.props.initialState},onClose:function(){this.props.onClose(null,this.state)},onCancel:function(){this.props.onClose(new Error("Modal cancelled"))},set:function(name,value){var up={};up[name]=value;this.setState(up)},setEvt:function(name,e){var up={};up[name]=e.target.value;this.setState(up)},_onChangeEvt:function(name,e){var up={};up[name]=e.target.value;this.setState(up)},_onChange:function(name,value){var up={};up[name]=value;this.setState(up)},render:function(){var set=function(name,evt){if(evt){return this.setEvt.bind(null,name)}if("string"===typeof name){return this.set.bind(null,name)}this.setState(name)}.bind(this);return React.createElement("div",{className:"Modal_wrapper"},React.createElement("div",{className:"Modal_back",onClick:this.onCancel}),React.createElement("div",{className:"Modal"},React.createElement("div",{className:"Modal_top"},this.props.title),React.createElement("div",{className:"Modal_body"},this.props.renderBody.call(this,this.state,set,this.onClose,this.onCancel)),this.props.buttons?React.createElement("div",{className:"Modal_buttons"},Object.keys(this.props.buttons).map(function(name){return React.createElement("button",{onClick:this.props.buttons[name].bind(this)},name)}.bind(this))):null))}});Modal.show=function(config){var parent=config.parent||document,node=document.createElement("div");parent.body.appendChild(node);var onClose=function(err){node.parentNode.removeChild(node);config.done.apply(null,arguments)};React.render(React.createElement(Modal,{initialState:config.initialState||{},title:config.title||"Modal",onClose:onClose,buttons:config.buttons,renderBody:config.renderBody||config.body}),node)};module.exports=Modal},{react:"react"}],82:[function(require,module,exports){var React=require("react"),Modal=require("./modal");module.exports=showModal;function showModal(title,initialState,body,done){if(arguments.length===3){done=body;body=initialState;initialState={}}var node=document.createElement("div");document.body.appendChild(node);var onClose=function(err){node.parentNode.removeChild(node);done.apply(null,arguments)};React.render(React.createElement(Modal,{initialState:initialState,onClose:onClose,title:title,renderBody:body}),node)}},{"./modal":81,react:"react"}],83:[function(require,module,exports){module.exports=saveAs;function saveAs(uri,filename){var link=document.createElement("a");if(typeof link.download==="string"){document.body.appendChild(link);link.download=filename;link.href=uri;link.click();document.body.removeChild(link)}else{location.replace(uri)}}},{}],84:[function(require,module,exports){module.exports=uuid;var CHARS="0123456789abcdefghijklmnopqrstuvwxyz";function uuid(ln){ln=ln||32;var id="";for(var i=0;i<ln;i++){id+=CHARS[parseInt(Math.random()*CHARS.length)]}return id}},{}],85:[function(require,module,exports){var pSlice=Array.prototype.slice;var objectKeys=require("./lib/keys.js");var isArguments=require("./lib/is_arguments.js");var deepEqual=module.exports=function(actual,expected,opts){if(!opts)opts={};if(actual===expected){return true}else if(actual instanceof Date&&expected instanceof Date){return actual.getTime()===expected.getTime()}else if(typeof actual!="object"&&typeof expected!="object"){return opts.strict?actual===expected:actual==expected}else{return objEquiv(actual,expected,opts)}};function isUndefinedOrNull(value){return value===null||value===undefined}function isBuffer(x){if(!x||typeof x!=="object"||typeof x.length!=="number")return false;if(typeof x.copy!=="function"||typeof x.slice!=="function"){return false}if(x.length>0&&typeof x[0]!=="number")return false;return true}function objEquiv(a,b,opts){var i,key;if(isUndefinedOrNull(a)||isUndefinedOrNull(b))return false;if(a.prototype!==b.prototype)return false;if(isArguments(a)){if(!isArguments(b)){return false}a=pSlice.call(a);b=pSlice.call(b);return deepEqual(a,b,opts)}if(isBuffer(a)){if(!isBuffer(b)){return false}if(a.length!==b.length)return false;for(i=0;i<a.length;i++){if(a[i]!==b[i])return false}return true}try{var ka=objectKeys(a),kb=objectKeys(b)}catch(e){return false}if(ka.length!=kb.length)return false;ka.sort();kb.sort();for(i=ka.length-1;i>=0;i--){if(ka[i]!=kb[i])return false}for(i=ka.length-1;i>=0;i--){key=ka[i];if(!deepEqual(a[key],b[key],opts))return false}return true}},{"./lib/is_arguments.js":86,"./lib/keys.js":87}],86:[function(require,module,exports){var supportsArgumentsClass=function(){return Object.prototype.toString.call(arguments)}()=="[object Arguments]";exports=module.exports=supportsArgumentsClass?supported:unsupported;exports.supported=supported;function supported(object){return Object.prototype.toString.call(object)=="[object Arguments]"}exports.unsupported=unsupported;function unsupported(object){return object&&typeof object=="object"&&typeof object.length=="number"&&Object.prototype.hasOwnProperty.call(object,"callee")&&!Object.prototype.propertyIsEnumerable.call(object,"callee")||false}},{}],87:[function(require,module,exports){exports=module.exports=typeof Object.keys==="function"?Object.keys:shim;exports.shim=shim;function shim(obj){var keys=[];for(var key in obj)keys.push(key);return keys}},{}],88:[function(require,module,exports){var React=require("react"),uuid=require("../lib/uuid"),_objs={};module.exports={mime:"js/dom",format:function(obj,window){if(obj instanceof window.HTMLElement){var id=uuid();_objs[id]=obj;return id}},display:function(id){if(!_objs[id])return React.createElement("em",null,"Re-evaluate this block to see the DOM element");return React.createElement(DomViewer,{value:_objs[id]})}};function clean(node){while(node.lastChild)node.removeChild(node.lastChild)}var DomViewer=React.createClass({displayName:"DomViewer",componentDidMount:function(){this.inject()},componentDidUpdate:function(prevProps){this.inject()},inject:function(){var node=this.getDOMNode();clean(node);node.appendChild(this.props.value)},render:function(){return React.createElement("div",null)}})},{"../lib/uuid":130,react:"react"}],89:[function(require,module,exports){module.exports=getAllProperties;function getAllProperties(obj){var allProps=[],curr=obj;if(Array.isArray(obj)){for(var i=0;i<obj.length;i++){allProps.push(i)}allProps.push("length");return allProps}do{var props=Object.getOwnPropertyNames(curr);props.forEach(function(prop){if(allProps.indexOf(prop)===-1)allProps.push(prop)})}while((curr=Object.getPrototypeOf(curr))&&Object.getPrototypeOf(curr));return allProps}},{}],90:[function(require,module,exports){module.exports=makeGorilla;function makeGorilla(data,nextid){var rich={};
nextid=nextid||0;if(data.type==="vega"){var id=nextid++;rich[id]=data;return['<span class="rich-'+id+'"></span>',nextid,rich]}if(data.type==="html"){return[data.content,nextid,{}]}if(data.type!=="list-like"){return[escape(data.value),nextid,{}]}var items=data.items.map(function(item){var data=makeGorilla(item,nextid);nextid=data[1];for(var id in data[2]){rich[id]=data[2][id]}return data[0]});var html=data.open+items.join(data.separator)+data.close;return[html,nextid,rich]}},{}],91:[function(require,module,exports){var getAllProperties=require("./get-all-properties");module.exports=isComplex;function isComplex(value,path){if(path.indexOf(value)!==-1)return true;var npath=path.concat([value]);if(Array.isArray(value)){return value.some(function(sub){return isComplex(sub,npath)})}if("function"===typeof value)return false;if("object"===typeof value&&value){if(null!==Object.getPrototypeOf(value)&&"object"===typeof Object.getPrototypeOf(value)&&Object.getPrototypeOf(Object.getPrototypeOf(value))){return true}return getAllProperties(value).some(function(key){return isComplex(value[key],npath)})}return false}},{"./get-all-properties":89}],92:[function(require,module,exports){var React=require("react"),isComplex=require("./is-complex"),getAllProperties=require("./get-all-properties"),uuid=require("../lib/uuid");var _objs={};module.exports={mime:"js/obj",format:function(obj){if(isComplex(obj,[],window)){var id=uuid();_objs[id]=obj;return id}},display:function(id){if(!_objs[id])return false;return React.createElement(ObjViewer,{value:_objs[id]})}};function viewValue(value){if(value&&"object"===typeof value)return ObjViewer({value:value});try{return JSON.stringify(value,null,2)||value+""}catch(e){}try{return value+""}catch(e){}return"Undisplayable"}function objName(val){return Array.isArray(val)?"Array":val.constructor?val.constructor.name:"Object"}var ObjViewer=React.createClass({displayName:"ObjViewer",getInitialState:function(){return{open:false}},_onToggle:function(){this.setState({open:!this.state.open})},render:function(){var val=this.props.value;return React.createElement("div",{className:"ObjViewer"},React.createElement("div",{className:"ObjViewer_head",onClick:this._onToggle},React.createElement("span",{className:"ObjViewer_name"},objName(val)),!this.state.open&&summary(val)),this.state.open&&React.createElement("table",{className:"ObjViewer_props"},React.createElement("tbody",null,getAllProperties(val).sort().map(function(name){return React.createElement("tr",{className:"ObjViewer_prop"},React.createElement("td",{className:"ObjViewer_attr"},name),React.createElement("td",{className:"ObjViewer_val"},viewValue(val[name])))}))))}});function summary(obj){var names=Object.getOwnPropertyNames(obj);return React.createElement("span",{className:"ObjViewer_smallprops"}," { ",names.slice(0,5).map(function(name){return name+": "+small(obj[name])}).join(", "),names.length>5&&"..."," }")}function small(val){if("number"===typeof val)return""+val;if("function"===typeof val)return(val.name||"fn")+"(){...}";if(Array.isArray(val)){var text=val.map(function(e){return e+""}).join(", ");if(text.length<20)return"["+text+"]";return"[..]"}if(!val)return val+"";if("string"===typeof val){return JSON.stringify(val.slice(0,20)+(val.length>20?"...":""))}if("object"===typeof val&&val.constructor){return val.constructor.name}return"unknown type"}},{"../lib/uuid":130,"./get-all-properties":89,"./is-complex":91,react:"react"}],93:[function(require,module,exports){var React=require("react");var katex=require("katex");var LatexViewer=React.createClass({displayName:"LatexViewer",getInitialState:function(){return{error:null}},shouldComponentUpdate:function(nextProps,nextState){return nextProps.data!==this.props.data||nextState.error!==this.state.error},componentWillReceiveProps:function(nextProps){if(nextProps.data!==this.props.date){this.setState({error:false})}},componentDidMount:function(){this._renderKatex()},componentDidUpdate:function(){this._renderKatex()},_renderKatex:function(){try{katex.render(this.props.data,this.getDOMNode())}catch(e){this.setState({error:e})}},render:function(){if(this.state.error){return React.createElement("div",{className:"m_IPython_output m_IPython_output_latex"},"Error while rendering latex.")}return React.createElement("div",{className:"m_IPython_output m_IPython_output_latex"})}});module.exports={mime:"text/latex",display:function(value,store){return React.createElement(LatexViewer,{data:value})}}},{katex:166,react:"react"}],94:[function(require,module,exports){var React=require("react"),makeGorilla=require("./gorilla");module.exports={mime:"json/list-like",display:function(value,meta){return ListLikeViewer({data:value})}};var ListLikeViewer=React.createClass({displayName:"ListLikeViewer",componentDidMount:function(){this.doThings(this.props.data)},doThings:function(data){var parts=makeGorilla(data,0);var node=this.getDOMNode();node.innerHTML=parts[0];var rich=parts[2];for(var id in rich){var dest=node.getElementsByClassName("rich-"+id)[0];var renderer={vega:renderVega}[rich[id].type];if(!renderer){console.warn("skipping the render of",rich[id].type,rich[id]);continue}renderer(rich[id].content,dest)}},render:function(){return React.createElement("div",{className:"m_IPython_output_list-like"})}});function renderVega(data,node){vg.parse.spec(data,function(chart){chart({el:node,renderer:"svg"}).update()})}},{"./gorilla":90,react:"react"}],95:[function(require,module,exports){var React=require("react");var LiveButton=React.createClass({displayName:"LiveButton",_onClick:function(e){e.preventDefault();this.props.store.globals.kernel.sendLive(this.props.live_id,true)},render:function(){return React.createElement("button",{onClick:this._onClick},this.props.label)}});module.exports={mime:"live/button",display:function(value,store,meta){return LiveButton({label:value.label,store:store,live_id:meta&&meta.live_id})}}},{react:"react"}],96:[function(require,module,exports){var React=require("react"),PT=React.PropTypes,format=require("../lib/plugin/format");var LiveWatcher=React.createClass({displayName:"LiveWatcher",propTypes:{id:PT.string},render:function(){return React.createElement("div",{className:"LiveWatcher"},format.display(null,this.props.value,this.props.store,{live_id:this.props.id}))}});module.exports={mime:"json/live",display:function(value,store){var id=value.id;return LiveWatcher({id:value.id,store:store,value:value.value})}}},{"../lib/plugin/format":118,react:"react"}],97:[function(require,module,exports){var React=require("react"),uuid=require("../lib/uuid"),_cache={};module.exports={mime:"js/react",display:function(value,meta){if(_cache[value]){return React.createElement(Sandbox,{comp:_cache[value]})}return React.createElement("em",null,"Evaluate to see React Component")},format:function(value){if(React.isValidComponent(value)){var id=uuid();_cache[id]=value;return id}}};var Sandbox=React.createClass({displayName:"Sandbox",getInitialState:function(){return{error:null}},componentDidMount:function(){this._renderSandbox()},componentDidUpdate:function(prevProps){if(prevProps.comp===this.props.comp)return;this._renderSandbox()},_renderSandbox:function(){try{React.render(this.props.comp,this.refs.sandbox.getDOMNode())}catch(e){return this.setState({error:"Failed to render component: "+e.message+"\n"+e.stack})}this.setState({error:null})},render:function(){return React.createElement("div",{className:"sandbox"},React.createElement("div",{ref:"sandbox"}),this.state.error&&React.createElement("div",{className:"sandbox_error"},this.state.error))}})},{"../lib/uuid":130,react:"react"}],98:[function(require,module,exports){var React=require("react");module.exports={mime:"json/vega",display:function(value,meta){return React.createElement(VegaViewer,{data:value})},format:function(value){}};var VegaViewer=React.createClass({displayName:"VegaViewer",componentDidMount:function(){this._vegaRender()},componentDidUpdate:function(){this._vegaRender()},_vegaRender:function(){var node=this.getDOMNode();vg.parse.spec(this.props.data,function(chart){chart({el:node,renderer:"svg"}).update()})},render:function(){return React.createElement("div",{className:"m_IPython_output m_IPython_output-vega"})}})},{react:"react"}],99:[function(require,module,exports){module.exports=extend;function extend(dest){for(var i=1;i<arguments.length;i++){for(var name in arguments[i]){dest[name]=arguments[i][name]}}return dest}},{}],100:[function(require,module,exports){var extend=require("../../extend"),request=require("majax"),EventEmitter=require("eventemitter3"),CodeMirror=require("codemirror");module.exports=Go;function Go(){this.session="not-session-based";this.status="disconnected";this.type="go"}Go.prototype=extend(Object.create(EventEmitter.prototype),{init:function(host,done){this.host=host;request({url:"http://"+this.host},function(response){if(response.status==="running"&&response.lang==="go"){this.status="done";this.emit("status");done()}else{done("Invalid server response")}}.bind(this),function(xhr){done("Failed to connect")})},disconnect:function(){},sendShell:function(content,callbacks){callbacks.start();request({data:JSON.stringify({optimize:0,version:"master",code:content}),method:"POST",url:"http://"+this.host,type:"json"},function(response){if(response.stdout){callbacks.output({type:"stream",stream:"stdout",text:response.stdout})}if(response.stderr){callbacks.output({type:"stream",stream:"stderr",text:response.stderr})}callbacks.end()},function(_,xhr){try{var response=JSON.parse(xhr.responseText);callbacks.output({type:"error",name:"CompilerError",message:response.error,traceback:response.error})}catch(e){callbacks.output({type:"error",name:"ConnectionError",message:"Failed to connect",traceback:"Failed to connect"})}callbacks.end()})}});Go.prototype.constructor=Go},{"../../extend":99,codemirror:"codemirror",eventemitter3:"eventemitter3",majax:"majax"}],101:[function(require,module,exports){var request=require("majax"),async=require("async"),EventEmitter=require("eventemitter3"),uuid=require("../../uuid"),extend=require("../../extend");module.exports=Gorilla;function Gorilla(docid){EventEmitter.call(this);this._running={};this.status="disconnected";this.session=null;this.type="gorilla"}Gorilla.prototype=extend(Object.create(EventEmitter.prototype),{_gotMessage:function(e){var message=JSON.parse(e.data);var op;if(message.status){op="status:"+message.status[0];if(message.status[0]==="done"){delete this._running[message.id];if(!Object.keys(this._running).length){this.status="done";this.emit("status")}}}if(message.value)op="value";if(message.out)op="out";if(message.err)op="err";console.log("message",message.id+":"+op,message);this.emit(message.id+":"+op,message)},interrupt:function(){console.warn("NOT IMPLEMENTED")},disconnect:function(){if(this.sock){this.sock.removeEventListener("message");this.sock.close();this.status="disconnected";this.emit("status");this.sock=null}this.session=null;this.emit("session")},init:function(host,done){var sock;try{sock=new WebSocket("ws://"+host+"/repl")}catch(e){this.status="error";this.emit("status");return done(e)}this.host=host;this.status="connecting";this.emit("status");sock.addEventListener("open",function(){var id=uuid();this.send({id:id,op:"clone"});this.once(id+":status:done",function(message){this.session=message["new-session"];this.status="done";this.emit("session");this.emit("status");done()}.bind(this))}.bind(this));sock.addEventListener("close",function(){if(this.status!=="error"){this.status="disconnected";this.session=null;this.sock=null;this.emit("session");this.emit("status")}}.bind(this));sock.addEventListener("error",function(){this.status="error";this.emit("status")}.bind(this));sock.addEventListener("message",this._gotMessage.bind(this));this.sock=sock},send:function(payload){this.sock.send(JSON.stringify(payload))},sendShell:function(code,callbacks){var id=uuid();callbacks.start();this._running[id]=true;this.status="running";this.emit("status");this.send({code:code,op:"eval",session:this.session,id:id});var out=function(message){callbacks.stream&&callbacks.stream({content:{name:"stdout",data:message.out}})};var value=function(message){var value=JSON.parse(JSON.parse(message.value));var suppressable=value.value==="nil"||value.value.slice(0,2)==="#'";callbacks.output({type:"output",suppressable:suppressable,"text/html":value.type==="html"&&value.content,"json/vega":value.type==="vega"&&value.content,"json/list-like":value.type==="list-like"&&value,"json/latex":value.type==="latex"&&value,"text/plain":value.value})};var err=function(message){callbacks.output({type:"error",name:"Clojure error",message:"Something failed",traceback:message.err})};this.on(id+":out",out);this.on(id+":value",value);this.on(id+":err",err);this.once(id+":status:done",function(){this.off(id+":out",out);this.off(id+":value",value);this.off(id+":err",err);callbacks.end()}.bind(this))}})},{"../../extend":99,"../../uuid":130,async:"async",eventemitter3:"eventemitter3",majax:"majax"}],102:[function(require,module,exports){var request=require("majax"),async=require("async"),EventEmitter=require("eventemitter3"),uuid=require("../../uuid"),extend=require("../../extend");module.exports=Kernel;function Kernel(docid,username){EventEmitter.call(this);this.username=username||"username";this.status="disconnected";this.session_id=docid;this.ssession=uuid();this.pseudo_filename=this.session_id;this.type="ipython"}Kernel.prototype=extend(Object.create(EventEmitter.prototype),{useKernel:function(kernel,done){this.kernel=kernel.id;this.session=this.kernel+this.session_id;this.emit("session");this.setupSockets(function(){this.status="done";this.emit("status");done&&done()}.bind(this))},asyncComplete:true,complete:function(line,pos,done){var id=uuid();this._send("shell",{header:{msg_id:id,msg_type:"complete_request",session:this.ssession,username:this.username},content:{text:"",line:line.slice(0,pos.ch),block:null,cursor_pos:pos},metadata:{},parent_header:{}});var response=function(message){this.off(id+":complete_reply",response);if(message.content.status!=="ok"||!message.content.matches.length)return;done({list:message.content.matches,from:{line:pos.line,ch:pos.ch-message.content.matched_text.length},to:pos})};this.on(id+":complete_reply",response)},interrupt:function(){request({url:"http://"+this.host+"/api/kernels/"+this.kernel+"/interrupt",method:"POST"},function(){return console.log("Interrupted!")})},newKernel:function(done){request({data:JSON.stringify({notebook:{name:this.pseudo_filename,path:""}}),url:"http://"+this.host+"/api/sessions",method:"POST",type:"json"},function(session){this.useKernel(session.kernel,done)}.bind(this),function(error){this.status="error";this.emit("status");done(new Error("Failed to start a new session"))}.bind(this))},init:function(host,done){this.host=host;this.status="connecting";this.emit("status");request({url:"http://"+host+"/api/sessions",method:"GET",type:"json"},function(sessions){var matches=sessions.filter(function(session){return session.notebook.name===this.session_id}.bind(this));if(matches.length>1){this.available_kernels=matches;this.status="available-kernels";this.emit("status");return done()}if(matches.length==1){return this.useKernel(matches[0].kernel,done)}this.newKernel(done)}.bind(this))},setupSockets:function(done){async.parallel({stdin:function(next){return this.newSocket("stdin",this._onStdin,next)}.bind(this),shell:function(next){return this.newSocket("shell",this._onShell,next)}.bind(this),iopub:function(next){return this.newSocket("iopub",this._onIO,next)}.bind(this)},function(err,sockets){this.sockets=sockets;done()}.bind(this))},disconnect:function(){for(var name in this.sockets){this.sockets[name].close()}this.sockets=null;this.status="disconnected";this.emit("status");this.session=null;this.emit("session")},onLive:function(lid,handler){this.on(lid+":live_update",function(message){handler(message.content)})},sendLive:function(lid){this._send("shell",{header:{msg_id:uuid(),msg_type:"live_update"},content:{args:[].slice.call(arguments,1)},metadata:{},parent_header:{msg_id:lid}})},sendShell:function(content,callbacks){this._sendShell(content,{pyout:function(m){var data=m.content.data;data.type="output";data.suppressable=m.suppressable;callbacks.output(data)},stream:function(m){return callbacks.output({type:"stream",stream:m.content.name,text:m.content.data})},pyerr:function(m){return callbacks.output({type:"error",name:m.content.ename,message:m.content.evalue,format:"ansi",traceback:m.content.traceback})},display_data:function(m){var data=m.content.data;data.type="display";data.metadata=m.content.metadata,data.suppressable=m.suppressable;callbacks.output(data)},status:function(m){if(m.content.execution_state!=="busy")return;callbacks.start()}},callbacks.end)},_sendShell:function(code,callbacks,done){var id=uuid();this._send("shell",{header:{msg_id:id,msg_type:"execute_request",session:this.ssession,username:this.username},content:{allow_stdin:!!callbacks.stdin,code:code,silent:false,store_history:true,user_expressions:{},user_variables:[]},metadata:{},parent_header:{}});this.status="running";this.emit("status");for(var name in callbacks){this.on(id+":"+name,callbacks[name])}var status=function(message){if(message.content.execution_state==="busy"){this.status="running";this.emit("status");return}};var finisher=function(message){if(message.content.payload&&message.content.payload.length){for(var i=0;i<message.content.payload.length;i++){callbacks["pyout"]({content:{data:{"text/ansi":message.content.payload[i].text}}})}}for(var name in callbacks){this.off(id+":"+name,callbacks[name])}this.off(id+":status",status);this.off(id+":execute_reply",finisher);this.status="done";this.emit("status");done&&done(message)};this.on(id+":status",status);this.on(id+":execute_reply",finisher)},_send:function(where,payload){this.sockets[where].send(JSON.stringify(payload))},_onStdin:function(e){var message=JSON.parse(e.data);this.emit(message.parent_header.msg_id+":"+message.msg_type,message)},_onShell:function(e){var message=JSON.parse(e.data);this.emit(message.parent_header.msg_id+":"+message.msg_type,message)},_onIO:function(e){var message=JSON.parse(e.data);this.emit(message.parent_header.msg_id+":"+message.msg_type,message);this.emit(message.msg_type,message);if(message.msg_type==="shutdown_reply"&&!message.content.restart){this.disconnect()}},newSocket:function(endpoint,onMessage,done){var sock=new WebSocket("ws://"+this.host+"/api/kernels/"+this.kernel+"/"+endpoint);sock.addEventListener("open",function(){sock.send(this.ssession+":no_cookies=wat");done(null,sock)}.bind(this));sock.addEventListener("close",function(){if(this.status!=="error"){this.status="disconnected";this.session=null;this.emit("session");this.emit("status")}}.bind(this));sock.addEventListener("error",function(){this.status="error";this.emit("status")}.bind(this));sock.addEventListener("message",onMessage.bind(this))}});Kernel.prototype.constructor=Kernel},{"../../extend":99,"../../uuid":130,async:"async",eventemitter3:"eventemitter3",majax:"majax"}],103:[function(require,module,exports){arguments[4][71][0].apply(exports,arguments)},{dup:71}],104:[function(require,module,exports){module.exports=function(tree){var tracker=newScope();crawlScope(tree,function(node,scope,parent,param,path){var fn=crawls[node.type];if(fn)fn(node,scope,parent,param,path)},tracker,newScope);return tracker};module.exports.walk=walkTopScope;var crawls={Identifier:function(node,scope,parent,param,path){if(parent.type==="VariableDeclarator")return;if(parent.type==="MemberExpression"&&param==="property")return;if(parent.type==="CatchClause"&&param==="param")return;if(parent.type==="Property"&&param==="key")return;if((parent.type==="FunctionDeclaration"||parent.type==="FunctionExpression")&&(param==="params"||param==="id"))return;scope.used.push({name:node.name,path:path})},VariableDeclarator:function(node,scope){scope.declared.push(node.id.name)},FunctionDeclaration:function(node,scope){scope.declared.push(node.id.name)}};function scopeName(node){if(node.type==="FunctionDeclaration")return node.id.name;return"<anon>"}function newScope(node,path){return{path:path,name:node&&scopeName(node),declared:node?node.params.map(function(n){return n.name}):[],children:[],used:[]}}var needNewScope={FunctionDeclaration:["body"],FunctionExpression:["body"]};function walkTopScope(tree,visitor,parent,parentParam,path){var black=needNewScope[tree.type]||[];path=path||[];visitor(tree,parent,parentParam,path);var thisScope;for(var name in tree){if(black.indexOf(name)!==-1){continue}if(Array.isArray(tree[name])){tree[name].map(function(item,i){walkTopScope(item,visitor,tree[name],i,path.concat([name,i]))})}else if("object"===typeof tree[name]&&tree[name]!==null&&tree[name].type){walkTopScope(tree[name],visitor,tree,name,path.concat([name]))}}}function crawlScope(tree,visitor,scope,newScope,parent,parentParam,path){var black=needNewScope[tree.type]||[];path=path||[];visitor(tree,scope,parent,parentParam,path);var thisScope;for(var name in tree){if(black.indexOf(name)!==-1){thisScope=newScope(tree,path);scope.children.push(thisScope)}else{thisScope=scope}if(Array.isArray(tree[name])){tree[name].map(function(item,i){crawlScope(item,visitor,thisScope,newScope,tree,name,path.concat([name,i]))})}else if("object"===typeof tree[name]&&tree[name]!==null&&tree[name].type){crawlScope(tree[name],visitor,thisScope,newScope,tree,name,path.concat([name]))}}}},{}],105:[function(require,module,exports){var esprima=require("esprima"),escodegen=require("escodegen"),jsx=require("./jsx"),uniquity=require("./uniquity"),makeOutput=require("./make-output");module.exports=execute;function outError(e){return{type:"error",name:e.name,message:e.message,traceback:e.stack}}function goAndDo(content,window,callbacks,local){window._wwEval(local?window.lworker:window.worker,callbacks.output,content,function(result){callbacks.output(makeOutput(result,window));callbacks.end()},function(){callbacks.end()})}function injectCSS(content,window){var div=document.createElement("div");div.innerHTML="<style>"+content+"</style>";div.firstChild.className="injected-magic";window.document.head.appendChild(div.firstChild)}function execute(content,window,callbacks){var num=window._ih.length;window._ih.push(content);callbacks.start();var firstLine=content.split("\n",1)[0];if(firstLine.slice(0,2)==="%%"){var magic=firstLine.slice(2).trim().toLowerCase();if(magic==="work"||magic==="ww"){return goAndDo(content.slice(firstLine.length+1),window,callbacks)}else if(magic==="lwork"||magic==="lww"){return goAndDo(content.slice(firstLine.length+1),window,callbacks,true)}else if(magic==="jsx"){content=content.slice(firstLine.length+1)}else if(magic==="css"){window.addInjectCSS(content.slice(firstLine.length+1));callbacks.end();return}else if(magic==="html"){callbacks.output(makeOutput(content.slice(firstLine.length+1),window,"text/html"));callbacks.end();return}else{callbacks.output({type:"error",name:"SyntaxError",message:"Invalid magic: "+magic,traceback:"Invalid magic: "+magic});callbacks.end();return}}try{content=jsx(content)}catch(e){callbacks.output(outError(e));callbacks.end();return}try{var body=preprocess(content,window,callbacks,num)}catch(e){callbacks.output(outError(e));callbacks.end();return}window.display=function(what,mime){return callbacks.output(makeOutput(what,window,mime))},window.console={log:function(){callbacks.output({type:"output",suppressable:false,"json/log":[].map.call(arguments,function(arg){return makeOutput(arg,window)})})}};try{var res=window.eval(body)}catch(e){callbacks.output(outError(e));callbacks.end();return}if(undefined!==res){window._oh[num]=res;window.___=window.__;window.__=window._;window._=res;callbacks.output(makeOutput(res,window))}callbacks.end()}function inject(tree,window,suffix,injecting){var replace={};for(var name in injecting){replace[name]=name+suffix}var needed=uniquity(tree,replace);needed.forEach(function(name){window[replace[name]]=injecting[name]})}function preprocess(content,window,callbacks,num){var tree=esprima.parse(content);inject(tree,window,"$"+num,{lwork:window._work.bind(null,window.lworker,callbacks.output),lwwEval:window._wwEval.bind(null,window.lworker,callbacks.output),work:window._work.bind(null,window.worker,callbacks.output),wwEval:window._wwEval.bind(null,window.worker,callbacks.output),loadJS:window._loadJS.bind(null,window,callbacks.output),loadParentJS:window._loadJS.bind(null,window.parent,callbacks.output),loadCSS:window._loadCSS.bind(null,window,callbacks.output),loadParentCSS:window._loadCSS.bind(null,window.parent,callbacks.output),display$:function(what,mime){return callbacks.output(makeOutput(what,window,mime))},console$:{log:function(){callbacks.output(makeOutput([].slice.call(arguments),window))}}});return escodegen.generate(tree)}},{"./jsx":109,"./make-output":110,"./uniquity":113,escodegen:131,esprima:148}],106:[function(require,module,exports){var _frames={},uuid=require("../../uuid");module.exports=getFrame;function getFrame(id){if(!_frames[id]){_frames[id]=newFrame()}return _frames[id]}function initWorker(window){var worker=new window.Worker("/bootworker.js");worker._cbs={};worker._i=0;worker.onmessage=function(evt){var message=evt.data,data=message.data;if(data.error){worker._cbs[data.id].out({type:"error",name:data.error.name,message:data.error.message,traceback:data.error.stack});worker._cbs[data.id].onerr&&worker._cbs[data.id].onerr();return}if(message.name==="out"){worker._cbs[data.id].out({type:"output","text/plain":JSON.stringify(data.display,null,2)});return}if(message.name==="go"){worker._cbs[data.id].fns[data.fn].apply(null,data.args)}else if(message.name==="eval"){worker._cbs[data.id].done.call(null,data.result)}};return worker}function newFrame(){var frame=document.createElement("iframe");frame.className="m_IPython_js_frame";frame.session=uuid();document.body.appendChild(frame);var w=frame.contentWindow;w._ih=[];w._oh={};w.jsx=require("./jsx");w.esprima=require("jstransform/node_modules/esprima-fb");w._liveLocal={};w._sendLive=function(id,args){if(!w._liveLocal[id])return;w._liveLocal[id].forEach(function(fn){return fn.apply(null,args)})};w._liveCB={};w.sendLive=function(lid,value){if(!w._liveCB[lid])return;w._liveCB[lid].forEach(function(fn){return fn(value)})};w._loadCSS=function(window,output,filenames,done){if(!Array.isArray(filenames)){filenames=[filenames]}filenames.forEach(function(src){var node=window.document.createElement("link");node.href=src;node.rel="stylesheet";node.onload=function(){output({"text/plain":"loaded css! "+src})};window.document.head.appendChild(node)})};w._loadJS=function(window,output,filenames,done){if(!Array.isArray(filenames)){filenames=[filenames]}filenames.forEach(function(src){var node=window.document.createElement("script");node.src=src;node.onload=function(){output({"text/plain":"loaded js! "+src})};window.document.head.appendChild(node)})};w._inject_css="";w.addInjectCSS=function(text){w._inject_css+="\n"+text;w._inject_listeners.forEach(function(fn){return fn(w._inject_css)})};w.clearInjectCSS=function(){w._inject_css="";w._inject_listeners.forEach(function(fn){return fn(w._inject_css)})};w._inject_listeners=[];w.addInjectListener=function(fn){if(w._inject_listeners.indexOf(fn)!==-1)return;w._inject_listeners.push(fn)};w.removeInjectListener=function(fn){if(w._inject_listeners){var ix=w._inject_listeners.indexOf(fn);if(ix===-1)return false;w._inject_listeners.splice(ix,1)}};w.Isolate=require("./isolate");w.Stater=require("./stater");w.React=require("react");w.ajax=require("./ajax");w.showFrame=function(){frame.classList.add("show")};w.hideFrame=function(){frame.classList.remove("show")};if(window.Worker&&window.location.protocol!=="file:"){w.worker=initWorker(window);w.lworker=initWorker(w);w.restartLWorker=function(){if(w.lworker)w.lworker.terminate();w.lworker=initWorker(w)};w.restartWorker=function(){if(w.worker)w.worker.terminate();w.worker=initWorker(window)};w._work=function(worker,output,fn){if("function"!==typeof fn){var e=new Error("work takes a function");return output({type:"error",name:"ValueError",message:e.message,traceback:e.stack})}return function(){var args=[].slice.call(arguments);var fns={};for(var i=0;i<args.length;i++){if("function"===typeof args[i]){fns[i]=args[i];args[i]=null}}var id=worker._i++;worker._cbs[id]={fns:fns,out:output};worker.postMessage({name:"go",data:{id:id,fns:Object.keys(fns),args:args,what:fn+""}})}};w._wwEval=function(worker,output,what,done,onerr){var id=worker._i++;worker._cbs[id]={done:done,onerr:onerr,out:output};worker.postMessage({name:"eval",data:{id:id,text:what+""}})}}else{w._work=function(){throw new Error("Webworkers not supported in this browser")};w._wwEval=function(){throw new Error("Webworkers not supported in this browser")}}return frame}},{"../../uuid":130,"./ajax":103,"./isolate":108,"./jsx":109,"./stater":112,"jstransform/node_modules/esprima-fb":149,react:"react"}],107:[function(require,module,exports){var getFrame=require("./get-frame"),exec=require("./exec"),extend=require("../../extend"),EventEmitter=require("eventemitter3"),CodeMirror=require("codemirror");module.exports=JsKernel;function JsKernel(docid){this.frame=getFrame(docid);this.frame.style.display="block";this.w=this.frame.contentWindow;this.session=this.frame.session;this.status="done";this.type="ijs"}JsKernel.prototype=extend(Object.create(EventEmitter.prototype),{init:function(host,done){done()},asyncComplete:false,cmComplete:function(cm){return CodeMirror.hint.javascript(cm,{globalScope:this.w,additionalContext:this.w})},teardown:function(){this.frame.style.display="none"},onLive:function(lid,handler){if(!this.w._liveCB[lid]){this.w._liveCB[lid]=[handler]}else if(this.w._liveCB[lid].indexOf(handler)===-1){this.w._liveCB[lid].push(handler)}},sendLive:function(lid){this.w._sendLive(lid,[].slice.call(arguments,1))},sendShell:function(content,callbacks){exec(content,this.w,callbacks)}});JsKernel.prototype.constructor=JsKernel},{"../../extend":99,"./exec":105,"./get-frame":106,codemirror:"codemirror",eventemitter3:"eventemitter3"}],108:[function(require,module,exports){var React=require("react"),PT=React.PropTypes;var Isolate=React.createClass({displayName:"Isolate",propTypes:{children:PT.any.isRequired,autoSize:PT.bool,stylesheets:PT.oneOfType([PT.string,PT.array]),className:PT.string,style:PT.object},getDefaultProps:function(){return{className:"Isolate"}},componentDidMount:function(){this.loadChild()},componentDidUpdate:function(){this.loadChild()},shouldComponentUpdate:function(nextProps){return nextProps.children!==this.props.children},loadChild:function(){var frame=this.getDOMNode();var doc=frame.contentDocument.body;if(this.props.stylesheets){loadCSS(this.props.stylesheets,frame.contentDocument)}React.renderComponent(React.createElement("div",{children:this.props.children}),doc,function(){if(this.props.autoSize){frame.style.height="auto";frame.style.width="auto";frame.style.height=doc.scrollHeight+"px";frame.style.width=doc.scrollWidth+"px"}}.bind(this))},render:function(){return React.createElement("iframe",{className:this.props.className,style:this.props.style})}});function loadCSS(sheets,doc){if("string"===typeof sheets){sheets=[sheets]}sheets.forEach(function(sheet){var node=doc.createElement("link");node.rel="stylesheet";node.href=sheet;doc.head.appendChild(node)})}module.exports=Isolate},{react:"react"}],109:[function(require,module,exports){var transform=require("jstransform").transform;var reactTransform=require("reactify/node_modules/react-tools").transform;var visitors=require("reactify/node_modules/react-tools/vendor/fbtransform/visitors");var PRAGMA="/** @jsx React.DOM **/";module.exports=function(code){var transformers=visitors.getAllVisitors();transformers=require("jstransform/visitors/es6-destructuring-visitors").visitorList.concat(transformers);return transform(transformers,PRAGMA+code).code}},{jstransform:161,"jstransform/visitors/es6-destructuring-visitors":163,"reactify/node_modules/react-tools":207,"reactify/node_modules/react-tools/vendor/fbtransform/visitors":211}],110:[function(require,module,exports){var safeString=require("./safe-string"),React=require("react"),format=require("../../plugin/format");
module.exports=function(value,window,mime){var out=format.format(value,window);if(mime){out[mime]=value}out.type="output";out.suppressable=false;if(!out["text/plain"]){out["text/plain"]=safeString(value)}return out}},{"../../plugin/format":118,"./safe-string":111,react:"react"}],111:[function(require,module,exports){module.exports=function(res){if("undefined"===typeof res)return"undefined";if("number"===typeof res&&isNaN(res))return"NaN";try{return JSON.stringify(res,null,2)||res+""}catch(e){}try{return res+""}catch(e){}return"<cannot display object>"}},{}],112:[function(require,module,exports){var React=require("react"),PT=React.PropTypes;function stringify(value){try{return JSON.stringify(value)}catch(e){}try{return value+""}catch(e){}return"Could not display value due to a security error"}var Stater=React.createClass({displayName:"Stater",propTypes:{attr:PT.string,cb:PT.string,initial:PT.any,extra:PT.object,comp:PT.component,show:PT.bool},getDefaultProps:function(){return{attr:"value",cb:"onChange",initial:"",extra:{},show:false}},getInitialState:function(){return{value:this.props.initial}},render:function(){var C=this.props.comp,props=this.props.extra;props[this.props.attr]=this.state.value;props[this.props.cb]=function(value){return this.setState({value:value})}.bind(this);var el=React.createElement(C,props,this.props.children);if(this.props.show){return React.createElement("div",null,el,React.createElement("pre",null,stringify(this.state.value)))}return el}});module.exports=Stater},{react:"react"}],113:[function(require,module,exports){var escoped=require("./escoped");module.exports=function(tree,map){var scope=escoped(tree);return Object.keys(changeCheck(scope,map,tree))};function changeCheck(scope,map,root){var using={};var mymap={};for(var name in map){if(scope.declared.indexOf(name)!==-1)continue;mymap[name]=map[name];scope.used.forEach(function(used){var alt=mymap[used.name];if(!alt)return;using[used.name]=true;used.path.reduce(function(obj,attr){return obj[attr]},root).name=alt})}scope.children.forEach(function(child){var chusing=changeCheck(child,mymap,root);for(var name in chusing){using[name]=true}});return using}},{"./escoped":104}],114:[function(require,module,exports){var extend=require("../../extend"),request=require("majax"),EventEmitter=require("eventemitter3"),CodeMirror=require("codemirror");module.exports=Rust;function Rust(){this.session="not-session-based";this.status="disconnected";this.type="rust-play"}Rust.prototype=extend(Object.create(EventEmitter.prototype),{init:function(host,done){this.host=host;request({url:"http://"+this.host},function(response){if(response.status==="running"&&response.lang==="rust"){this.status="done";this.emit("status");done()}else{done("Invalid server response")}}.bind(this),function(xhr){done("Failed to connect")})},disconnect:function(){},sendShell:function(content,callbacks){callbacks.start();request({data:JSON.stringify({optimize:0,version:"master",code:content}),method:"POST",url:"http://"+this.host,type:"json"},function(response){if(response.stdout){callbacks.output({type:"stream",stream:"stdout",text:response.stdout})}if(response.stderr){callbacks.output({type:"stream",stream:"stderr",text:response.stderr})}callbacks.end()},function(_,xhr){try{var response=JSON.parse(xhr.responseText);callbacks.output({type:"error",name:"CompilerError",message:response.error,traceback:response.error})}catch(e){callbacks.output({type:"error",name:"ConnectionError",message:"Failed to connect",traceback:"Failed to connect"})}callbacks.end()})}});Rust.prototype.constructor=Rust},{"../../extend":99,codemirror:"codemirror",eventemitter3:"eventemitter3",majax:"majax"}],115:[function(require,module,exports){var html5notify=false;if(window.Notification&&window.Notification.requestPermission){if(window.Notification.permission==="granted"){html5notify=true}}function showDoneNotification(text,time){var secs=time/1e3;var stime=parseInt(secs/60)+":"+secs%60;var n=new window.Notification("Code finished after "+stime+"s",{body:text.slice(0,100)});setTimeout(function(){return n.close()},1e4)}module.exports=function(type,language){return{toggleDisplayCollapse:function(id){if(!arguments.length)id=this.view.active;this.set(id,"display_collapsed",!this.db.nodes[id].display_collapsed)},toggleEditorCollapse:function(id){if(!arguments.length)id=this.view.active;this.set(id,"editor_collapsed",!this.db.nodes[id].editor_collapsed)},executeDeep:function(id){if(!arguments.length&&this.view.mode==="visual"){return this.executeManyDeep()}if(!arguments.length)id=this.view.active;var node=this.db.nodes[id];node.children.forEach(function(id){this.execute(id);this.executeDeep(id)}.bind(this))},executeMany:function(){if(this.view.mode!=="visual")return;this.startTransaction();this.view.selection.forEach(function(id){return this.execute(id)}.bind(this));this.stopTransaction();this.setMode("normal")},executeManyDeep:function(){if(this.view.mode!=="visual")return;this.startTransaction();this.view.selection.forEach(this.executeDeep.bind(this));this.stopTransaction();this.setMode("normal")},clearKernelError:function(){this.globals.kernelError=false;this.changed(this.events.kernelError())},executeAndAdd:function(id){this.execute(id);this.createAfter(id);this.edit()},execute:function(id,histIx){if(!arguments.length&&this.view.mode==="visual"){return this.executeMany()}if(!arguments.length)id=this.view.active;var node=this.db.nodes[id];if(node.type!=="ipython")return;if(!this.globals.kernel){this.globals.kernelError="kernel not configured";this.changed(this.events.kernelError());return console.warn("kernel not set")}if(!this.globals.kernel.session){this.globals.kernelError="kernel disconnected";this.changed("kernel-error");return console.warn("kernel not connected")}var refocus;if(this.view.mode==="insert"){refocus=document.activeElement;document.activeElement.blur()}if("number"==typeof histIx){this.update(id,{waiting:true},histIx)}else{histIx=this.update(id,{waiting:true})}var content=node.content;this.globals.kernel.sendShell(content,{start:function(){this.update(id,{started:Date.now(),session:this.globals.kernel.session,executed:content,finished:null,waiting:false,display_collapsed:false,outputs:[]},histIx)}.bind(this),output:function(output){var outputs=this.db.nodes[id].outputs.concat([output]);this.set(id,"outputs",outputs,histIx);if(output["json/live"]){var lid=output["json/live"].id;this.globals.kernel.onLive(lid,function(value){var outputs=this.db.nodes[id].outputs;for(var i=0;i<outputs.length;i++){if(outputs[i]["json/live"]&&outputs[i]["json/live"].id===lid){outputs[i]["json/live"].value=value}}this.set(id,"outputs",outputs,histIx)}.bind(this))}}.bind(this),end:function(){var finished=Date.now(),time=finished-this.db.nodes[id].started;if(html5notify&&document.hidden){showDoneNotification(content,time)}this.update(id,{finished:finished,waiting:false},histIx)}.bind(this)});if(refocus){refocus.focus();this.setMode("insert")}return histIx}}}.bind(this)},{}],116:[function(require,module,exports){var React=require("react/addons"),CodeMirror=require("codemirror"),cx=React.addons.classSet,PT=React.PropTypes;require("codemirror/mode/javascript/javascript");require("codemirror/mode/clojure/clojure");require("codemirror/mode/python/python");require("codemirror/mode/julia/julia");require("codemirror/mode/rust/rust");require("codemirror/mode/css/css");require("codemirror/addon/fold/foldcode");require("codemirror/addon/fold/foldgutter");require("codemirror/addon/fold/brace-fold");require("codemirror/addon/fold/xml-fold");require("codemirror/addon/fold/comment-fold");require("codemirror/addon/edit/closebrackets");require("codemirror/addon/edit/matchbrackets");require("codemirror/addon/hint/javascript-hint");require("codemirror/addon/hint/show-hint");var CodeEditor=React.createClass({displayName:"CodeEditor",propTypes:{node:PT.object,value:PT.string,blurred:PT.bool,onBlur:PT.func,onFocus:PT.func,onChange:PT.func,onFOcus:PT.func,onComplete:PT.func,goDown:PT.func,goUp:PT.func},isFocused:function(){return this._cm.hasFocus()},focus:function(at){if(!this._cm.hasFocus()){this._cm.focus();if(at==="end"||!at){this._cm.setCursor(this._cm.lineCount(),0)}else if(at!=="start"){console.warn("Selecting in the middle not supported");this._cm.setCursor(this._cm.lineCount(),0)}else{this._cm.setCursor(0,0)}}},_onKeyDown:function(editor,e){if(!this.isMounted())return;if(this.props.blurred&&this.props.onFocus){this.props.onFocus()}if(editor.state.completionActive&&e.keyCode!==27){e.stopPropagation();return}if(e.keyCode===9)return e.stopPropagation();if(e.keyCode===13&&e.ctrlKey){var curs=editor.getCursor(),text=editor.getValue(),pos=text.split("\n").slice(0,curs.line).join("\n").length+curs.ch+1;if(pos<text.length){var pre=text.slice(0,pos),post=text.slice(pos);this.props.onChange(pre);editor.setValue(pre);this.props.createAfter(null,pre,post)}else{this.props.createAfter()}e.preventDefault();e.stopPropagation();return}if(e.shiftKey||e.ctrlKey||e.altKey||e.metaKey){return}if(e.keyCode===38){var curs=editor.getCursor();if(curs.line===0&&curs.ch===0){return this.props.goUp()}}else if(e.keyCode===37){var curs=editor.getCursor();if(curs.line===0&&curs.ch===0){return this.props.goUp()}}else if(e.keyCode===40){var curs=editor.getCursor();if(curs.line===editor.lineCount()-1&&curs.ch===editor.getLine(curs.line).length){return this.props.goDown()}}else if(e.keyCode===39){var curs=editor.getCursor();if(curs.line===editor.lineCount()-1&&curs.ch===editor.getLine(curs.line).length){return this.props.goDown(true)}}},componentDidMount:function(){var betterTab=function(cm){if(cm.somethingSelected()){return cm.indentSelection("add")}var cursor=cm.getCursor(),line=cm.getLine(cursor.line),pos={line:cursor.line,ch:cursor.ch};if(cursor.ch>0&&line[cursor.ch-1]!==" "){return cm.showHint({hint:this.props.onComplete})}cm.replaceSelection(Array(cm.getOption("indentUnit")+1).join(" "),"end","+input")}.bind(this);function betterShiftTab(cm){cm.execCommand("indentLess")}var minLengthForLinos=10;var lang=this.props.language||this.props.node.language;this._cm=CodeMirror(this.getDOMNode(),{value:this.props.value,lineNumbers:this.props.value.split("\n").length>minLengthForLinos,matchBrackets:true,autoCloseBrackets:'()[]{}""',indentUnit:2,indentWithTabs:false,smartIndent:lang!=="javascript",tabSize:2,lineWrapping:true,mode:lang,viewportMargin:Infinity,extraKeys:{Tab:betterTab,"Shift-Tab":betterShiftTab}});this._cm.on("keydown",this._onKeyDown);this._cm.on("change",function(editor){if(!this.isMounted())return;var value=editor.getValue();if(this.props.onChange)this.props.onChange(value);if(value.split("\n").length>minLengthForLinos){this._cm.setOption("lineNumbers",true)}else{this._cm.setOption("lineNumbers",false)}}.bind(this));this._cm.on("focus",function(){if(!this.isMounted())return;if(this.props.onFocus&&this.props.blurred)this.props.onFocus()}.bind(this));this._cm.on("blur",function(){if(!this.isMounted())return;if(this.props.onBlur&&!this.props.blurred){var value=this._cm.getValue();if(this.props.value!==value){this.props.onChange(value)}this.props.onBlur()}}.bind(this));if(!this.props.blurred){this._cm.focus()}},componentWillReceiveProps:function(nextProps){if(this._cm.getValue()!==nextProps.value&&this.props.blurred){this._cm.setValue(nextProps.value)}},render:function(){return React.createElement("div",{className:"ITreedCodeEditor"},React.createElement("div",{onClick:this.props.onExecute,className:"ITreedRunButton"}))}});module.exports=CodeEditor},{codemirror:"codemirror","codemirror/addon/edit/closebrackets":"codemirror/addon/edit/closebrackets","codemirror/addon/edit/matchbrackets":"codemirror/addon/edit/matchbrackets","codemirror/addon/fold/brace-fold":"codemirror/addon/fold/brace-fold","codemirror/addon/fold/comment-fold":"codemirror/addon/fold/comment-fold","codemirror/addon/fold/foldcode":"codemirror/addon/fold/foldcode","codemirror/addon/fold/foldgutter":"codemirror/addon/fold/foldgutter","codemirror/addon/fold/xml-fold":"codemirror/addon/fold/xml-fold","codemirror/addon/hint/javascript-hint":"codemirror/addon/hint/javascript-hint","codemirror/addon/hint/show-hint":"codemirror/addon/hint/show-hint","codemirror/mode/clojure/clojure":"codemirror/mode/clojure/clojure","codemirror/mode/css/css":"codemirror/mode/css/css","codemirror/mode/javascript/javascript":"codemirror/mode/javascript/javascript","codemirror/mode/julia/julia":"codemirror/mode/julia/julia","codemirror/mode/python/python":"codemirror/mode/python/python","codemirror/mode/rust/rust":"codemirror/mode/rust/rust","react/addons":"react/addons"}],117:[function(require,module,exports){var React=require("react"),PT=React.PropTypes,CodeMirror=require("codemirror");function px(val){if("number"===typeof val)return val+"px";return val}function reactStyle(node,style){var nopx="opacity,z-index,zIndex".split(",");for(var name in style){if(nopx.indexOf(name)!==-1){node.style[name]=style[name]}else{node.style[name]=px(style[name])}}}var CodeMirrorRx=React.createClass({displayName:"CodeMirrorRx",propTypes:{onChange:PT.func,onFocus:PT.func},getDefaultProps:function(){return{mode:"javascript"}},componentDidMount:function(){this._cm=new CodeMirror(this.getDOMNode(),this.props);this._cm.on("keydown",this.onKeyDown);this._cm.on("change",function(doc){return this.isMounted()&&this.props.onChange&&this.props.onChange(doc.getValue())}.bind(this));this._cm.on("focus",function(){if(!this.isMounted())return;if(this.props.onFocus&&this.props.blurred)this.props.onFocus()}.bind(this));this._cm.on("blur",function(){this.isMounted()&&this.props.onBlur&&this.props.onBlur()}.bind(this));var node=this._cm.getWrapperElement();if(this.props.style){reactStyle(node,this.props.style);this._cm.refresh()}setTimeout(function(){return this._cm.refresh()}.bind(this),1e3)},componentDidUpdate:function(prevProps){var same=true;for(var name in this.props){if(this.props[name]!==prevProps[name]){if(name==="value"&&this._cm.getValue()===this.props[name])continue;this._cm.setOption(name,this.props[name]||"")}}var node=this._cm.getWrapperElement();if(this.props.style){reactStyle(node,this.props.style);this._cm.refresh()}},onFocus:function(){if(this.props.blurred&&this.props.onFocus){this.props.onFocus()}},onKeyDown:function(editor,e){if(!this.isMounted())return;if(this.props.blurred&&this.props.onFocus){this.props.onFocus()}if(editor.state.completionActive&&e.keyCode!==27){e.stopPropagation();return}if(e.keyCode===9)return e.stopPropagation();if(e.shiftKey||e.ctrlKey||e.altKey||e.metaKey){return}if(e.keyCode===38){var curs=editor.getCursor();if(curs.line===0&&curs.ch===0){return this.props.goUp&&this.props.goUp()}}else if(e.keyCode===37){var curs=editor.getCursor();if(curs.line===0&&curs.ch===0){return this.props.goUp&&this.props.goUp()}}else if(e.keyCode===40){var curs=editor.getCursor();if(curs.line===editor.lineCount()-1&&curs.ch===editor.getLine(curs.line).length){return this.props.goDown&&this.props.goDown()}}else if(e.keyCode===39){var curs=editor.getCursor();if(curs.line===editor.lineCount()-1&&curs.ch===editor.getLine(curs.line).length){return this.props.goDown&&this.props.goDown(true)}}},focus:function(){this._cm.focus()},isFocused:function(){return this._cm.hasFocus()},render:function(){return React.createElement("div",{className:"CodeMirrorRx"})}});module.exports=CodeMirrorRx},{codemirror:"codemirror",react:"react"}],118:[function(require,module,exports){var React=require("react"),safeString=require("../../kernels/js/safe-string"),Convert=require("ansi-to-html"),convert=new Convert;var handlers={default_mime:{"json/link":function(value){return React.createElement("a",{href:value.href||value,title:value.title,target:"_blank"},value.text||value)},"text/html":function(value){return React.createElement("div",{className:"m_IPython_output_html",dangerouslySetInnerHTML:{__html:value}})},"json/log":function(value,store){return React.createElement("ul",{className:"m_IPython_output_log",style:{padding:0,margin:0,"list-style":"none"}},value.map(function(item,i){return React.createElement("li",{style:{display:"inline-block",padding:"0 5px"}},display(i,item,store))}))},"json/figure":function(value){return React.createElement("div",{style:{textAlign:"center",display:"inline-block"}},React.createElement("img",{src:value.src}),React.createElement("div",{style:{textAlign:"center"}},value.title))},"image/png":function(value){return React.createElement("img",{className:"m_IPython_output_png",src:"data:image/png;base64,"+value})},"text/ansi":function(value){return React.createElement("div",{className:"m_IPython_output_ansi",dangerouslySetInnerHTML:{__html:convert.toHtml(escape(value))}})},"text/plain":function(value){return React.createElement("div",{className:"m_IPython_output_plain"},value)}},formatters:[],mime:{}};function escape(text){return text?text.replace("&","&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"):"null"}module.exports={display:display,format:format,handlers:handlers,displayer:displayer,formatter:formatter};function display(key,value,store,meta){for(var name in handlers.mime){if(value[name]){var res=handlers.mime[name](value[name],store,meta);return React.createElement("div",{className:"m_IPython_output m_IPython_output-"+name.replace("/","-"),key:key},res)}}for(var name in handlers.default_mime){if(value[name]){var res=handlers.default_mime[name](value[name],store,meta);return React.createElement("div",{className:"m_IPython_output m_IPython_output-"+name.replace("/","-"),key:key},res)}}return React.createElement("div",{className:"m_IPython_output",key:key},React.createElement("em",null,"Unknown mime type"))}function format(value,window){var result={"text/plain":safeString(value)};handlers.formatters.some(function(fm){var res=fm[0](value,window);if(res===undefined)return false;result[fm[1]]=res;return true});return result}function displayer(handler,mime){handlers.mime[mime]=handler}function formatter(handler,mime){handlers.formatters.push([handler,mime])}},{"../../kernels/js/safe-string":111,"ansi-to-html":"ansi-to-html",react:"react"}],119:[function(require,module,exports){var React=require("react"),Listener=require("treed/listener"),KernelController=require("./kernel-controller");module.exports=function(kernelConfig){return{title:"Code REPL",types:{"code-playground":{title:"Code Playground",shortcut:"p"},ipython:{title:"Code Block",shortcut:"c",update:{language:kernelConfig.language}}},keys:{execute:{type:"ipython",normal:"shift+enter",insert:"shift+enter",visual:"shift+enter"},"execute deep":{normal:"ctrl+shift+enter",insert:"ctrl+shift+enter",visual:"ctrl+shift+enter"},"toggle display collapse":{title:"(un) collapse code output",type:"ipython",normal:"space"},"execute and add":{type:"ipython",title:"execute and add a node after",normal:"alt+enter",insert:"alt+enter"},"toggle editor collapse":{title:"(un) collapse playground editor",type:"code-playground",normal:"space"}},app:{blocks:{icon:function(actions,state,store){},bar:function(actions,state,store){return KernelController({store:store,type:kernelConfig.type})}}},view:{global:function(store){return KernelController({store:store,type:kernelConfig.type,remote:kernelConfig.remote})}},db:{addNewNodeAttrs:function(node){if(node.type==="ipython"){node.language=kernelConfig.language}}},store:{init:function(store){var host="";var K=kernelConfig.kernel;var kernel=store._globals.kernel=new K(store.db.root);store._globals.kernelError=false;kernel.on("session",function(){store.changed(store.events.kernelSession())});kernel.on("status",function(){store.changed(store.events.kernelStatus())});if(host||!kernelConfig.remote){if(host.indexOf(":")===-1){host="localhost:"+host}setTimeout(function(){kernel.init(host,function(){})},0)}},teardown:function(store){store._globals.kernel.teardown&&store._globals.kernel.teardown()},actions:require("./actions")(kernelConfig.type,kernelConfig.language),getters:{kernelStatus:function(){return this.globals.kernel&&this.globals.kernel.status},kernelHost:function(){return this.globals.kernel&&this.globals.kernel.host},kernelSession:function(){return this.globals.kernel&&this.globals.kernel.session},kernelError:function(){return this.globals.kernelError},kernelsAvailable:function(){return this.globals.kernel&&this.globals.kernel.available_kernels}},events:{kernelSession:function(){return"kernel-session"},kernelStatus:function(){return"kernel-status"},kernelError:function(){return"kernel-error"}}},node:require("./node")}}.bind(this)},{"./actions":115,"./kernel-controller":121,"./node":124,react:"react","treed/listener":212}],120:[function(require,module,exports){var React=require("react");var KernelChanger=React.createClass({displayName:"KernelChanger",getInitialState:function(){return{host:this.props.initialValue||"localhost:8888",type:this.props.initialType}},_onChange:function(e){this.setState({host:e.target.value})},_setType:function(type){this.setState({type:type})},_onDone:function(){this.props.onDone(this.state.host)},_onKeyDown:function(e){if(e.key==="Enter"){this._onDone()}},render:function(){return React.createElement("div",{className:"m_IPythonKernel_changer"},React.createElement("input",{placeholder:(this.props.type==="ipython"?"iPython":"Gorilla-repl")+" host",value:this.state.host,onChange:this._onChange,onKeyDown:this._onKeyDown}),React.createElement("span",{className:"m_IPythonKernel_changer_btn",onClick:this._onDone,style:{color:"green"}},""),React.createElement("span",{className:"m_IPythonKernel_changer_btn",onClick:this.props.onCancel,style:{color:"red"}},""))}});module.exports=KernelChanger},{react:"react"}],121:[function(require,module,exports){var React=require("react"),Listener=require("treed/listener"),KernelIndicator=require("./kernel-indicator"),KernelChanger=require("./kernel-changer");var KernelController=React.createClass({displayName:"KernelController",propTypes:{remote:React.PropTypes.bool},mixins:[Listener({storeAttrs:function(getters,props){return{kernelHost:getters.kernelHost(),kernelStatus:getters.kernelStatus(),kernelSession:getters.kernelSession(),kernelError:getters.kernelError(),kernelsAvailable:getters.kernelsAvailable()}},getListeners:function(props,events){return[events.kernelStatus(),events.kernelSession(),events.kernelError()]}})],getInitialState:function(){return{changing:false}},componentDidUpdate:function(prevProps,prevState){if(!prevState.kernelError&&this.state.kernelError){if(this._tout){clearTimeout(this._tout)}this._tout=setTimeout(function(){this.props.store.actions.clearKernelError();this._tout=null}.bind(this),2e3)}},_onConnect:function(host){this.setState({changing:false});var k=this.props.store.globals.kernel;k.disconnect();k.init(host,function(err){})},_onInterrupt:function(e){if(e){e.stopPropagation();e.preventDefault()}var k=this.props.store.globals.kernel;k.interrupt()},_onReconnect:function(e){if(e){e.stopPropagation();e.preventDefault()}this._onConnect(this.state.kernelHost)},_onChange:function(e){if(e){e.stopPropagation();e.preventDefault()}this.setState({changing:true})},_onCancel:function(e){if(e){e.stopPropagation();e.preventDefault()}this.setState({changing:false})},_onChooseKernel:function(kernel){var k=this.props.store.globals.kernel;if(!kernel){k.newKernel()}else{k.useKernel(kernel)}},render:function(){return React.createElement("div",{className:"m_IPythonKernel m_IPythonKernel-"+this.state.kernelStatus},this.state.kernelError&&React.createElement("div",{className:"m_IPythonKernel_error"},this.state.kernelError),this.state.changing?React.createElement(KernelChanger,{initialValue:this.state.kernelHost,type:this.props.type,onCancel:this._onCancel,onDone:this._onConnect}):React.createElement(KernelIndicator,{remote:this.props.remote,onReconnect:this._onReconnect,onInterrupt:this._onInterrupt,onChange:this._onChange,type:this.props.type,host:this.state.kernelHost,status:this.state.kernelStatus,kernels:this.state.kernelsAvailable,onChooseKernel:this._onChooseKernel,session:this.state.kernelSession}))}});module.exports=KernelController},{"./kernel-changer":120,"./kernel-indicator":122,react:"react","treed/listener":212}],122:[function(require,module,exports){var React=require("react"),PT=React.PropTypes;var KernelPicker=require("./kernel-picker");var KernelIndicator=React.createClass({displayName:"KernelIndicator",propTypes:{type:PT.string,onChange:PT.func,onReconnect:PT.func,onChooseKernel:PT.func,host:PT.string,status:PT.string,kernels:PT.array,session:PT.string},render:function(){if(this.props.status==="error"){return React.createElement("div",{className:"m_IPythonKernel_indicator m_IPythonKernel_indicator-error"},"Error connecting to ",this.props.host,"!",React.createElement("button",{onClick:this.props.onReconnect},"Reconnect"),React.createElement("button",{onClick:this.props.onChange},"Change Host"))}if(this.props.status==="available-kernels"){return React.createElement(KernelPicker,{onPick:this.props.onChooseKernel,onCancel:this.props.onChange,kernels:this.props.kernels})}if(!this.props.host&&this.props.remote){return React.createElement("div",{onClick:this.props.onChange,className:"m_IPythonKernel_indicator m_IPythonKernel_indicator-disconnected"},"Set the repl host")}return React.createElement("div",{onClick:this.props.host&&this.props.onChange,className:"m_IPythonKernel_indicator m_IPythonKernel_indicator-"+this.props.status},this.props.host||"Local",this.props.status==="running"&&React.createElement("span",{onClick:this.props.onInterrupt,title:"interrupt",className:"m_IPythonKernel_indicator_interrupt"},""),React.createElement("span",{className:"m_IPythonKernel_indicator_icon m_IPythonKernel_indicator_icon-"+this.props.status}),this.props.status==="disconnected"&&React.createElement("button",{onClick:this.props.onReconnect},"Reconnect"),this.props.status==="disconnected"&&React.createElement("button",{onClick:this.props.onChange},"Change Host"))}});module.exports=KernelIndicator},{"./kernel-picker":123,react:"react"}],123:[function(require,module,exports){var React=require("react"),PT=React.PropTypes;var KernelPicker=React.createClass({displayName:"KernelPicker",propTypes:{onCancel:PT.func,onPick:PT.func,kernels:PT.array},getInitialState:function(){return{open:false}},_toggleOpen:function(){this.setState({open:!this.state.open})},render:function(){return React.createElement("div",{className:"KernelPicker"},React.createElement("span",{onClick:this._toggleOpen,className:"KernelPicker_label"},"Choose kernel",React.createElement("span",{className:"KernelPicker_close",onClick:this.props.onCancel},"")),this.state.open&&React.createElement("ul",{className:"KernelPicker_list"},this.props.kernels.map(function(kernel){return React.createElement("li",{onClick:this.props.onPick.bind(null,kernel.kernel),className:"KernelPicker_item"},kernel.kernel.id)}.bind(this)),React.createElement("li",{onClick:this.props.onPick.bind(null,false),className:"KernelPicker_item"},"New Kernel")))}});module.exports=KernelPicker},{react:"react"}],124:[function(require,module,exports){var React=require("react/addons"),cx=React.addons.classSet,Convert=require("ansi-to-html"),convert=new Convert,moment=require("moment"),hljs=require("highlight.js"),Playground=require("./playground"),CodeEditor=require("./code-editor"),Output=require("./output");function codeOutput(node,actions,state,store){if(node.type!=="ipython")return;var kernelW=store.globals.kernel&&store.globals.kernel.w,style=kernelW&&kernelW._inject_css,addListener=kernelW&&kernelW.addInjectListener,removeListener=kernelW&&kernelW.removeInjectListener;return React.createElement(Output,{node:node,ref:"ipython_view",styles:style,addInjectListener:addListener,removeInjectListener:removeListener,setActive:actions.setActive.bind(actions,node.id),kernelSession:state.kernelSession,store:store})}module.exports={classes:function(node,state){if(node.type!=="ipython")return;return cx({"TreeItem-ipython-disabled":!state.kernelSession,"TreeItem-ipython-collapsed":node.display_collapsed,"TreeItem-ipython-stale":state.kernelSession!==node.session,"TreeItem-ipython-running":node.started&&!node.finished,"TreeItem-ipython-waiting":node.waiting,"TreeItem-ipython-dirty":node.executed!==node.content})},blocks:{belowbody:codeOutput,"focus-pane":codeOutput},bodies:{ipython:{renderer:function(){return React.createElement(CodeEditor,{ref:"text",blurred:true,node:this.props.node,value:this.props.node.content,onExecute:function(){return this.props.actions.execute(this.props.node.id)}.bind(this),onFocus:this._onClick})},editor:function(props){var kernel=props.store.globals.kernel;if(kernel&&(kernel.complete||kernel.cmComplete)){props.onComplete=kernelComplete(kernel)}props.onExecute=function(){return props.actions.execute(props.node.id)};return React.createElement(CodeEditor,React.__spread({},props))}},"code-playground":{renderer:function(){return React.createElement(Playground,{ref:"text",blurred:true,value:this.props.node.content,onFocus:this._onClick,onChange:this._onChange,store:this.props.store,node:this.props.node})},editor:function(props){return React.createElement(Playground,React.__spread({ref:"text"},props))}}},listener:{changes:["kernel-session"],updateStoreState:function(state,getters){return{kernelSession:getters.kernelSession()}}}};function kernelComplete(kernel){var func;if(kernel.cmComplete){func=function(cm,done){return kernel.cmComplete(cm)}}else if(kernel.complete){func=function(cm,done){var cursor=cm.getCursor(),line=cm.getLine(cursor.line),pos={line:cursor.line,ch:cursor.ch};return kernel.complete(line,pos,done)}}else{return function(cm){return CodeMirror.hint.auto(cm)}}if(kernel.asyncComplete){func.async=true}return func}},{"./code-editor":116,"./output":125,"./playground":127,"ansi-to-html":"ansi-to-html","highlight.js":"highlight.js",moment:"moment","react/addons":"react/addons"}],125:[function(require,module,exports){var showTimes=require("./timer"),make_outputs=require("./view"),React=require("react"),cx=React.addons.classSet;var Output=React.createClass({displayName:"Output",getInitialState:function(){return{popout:false}},_onPopout:function(){var box=this.refs.outputs.getDOMNode().getBoundingClientRect(),w=window.open("party.html","Popped out output","location=no,menubar=no,height="+(box.height+20)+",width="+(box.width+20));w.onbeforeunload=this._onClose;w.onload=function(){w.document.body.className="m_IPython_popout-body";var style=w.document.createElement("style");style.innerHTML=this.props.styles;w.style=style;w.document.head.appendChild(style);this.setState({popout:w})}.bind(this);if(this.props.addInjectListener){this.props.addInjectListener(this._updateStyle)}},_updateStyle:function(style){if(!this.state.popout)return;this.state.popout.style.innerHTML=style},_onClose:function(){if(!this.isMounted())return;this.setState({popout:false})},componentDidUpdate:function(prevProps,prevState){if(!this.state.popout){if(prevState.popout&&!prevState.popout.closed){prevState.popout.onbeforeunload=null;prevState.popout.close()}return}this.state.popout.style.innerHTML=this.props.styles;var outputs=make_outputs(this.props.node.outputs,this.props.store),container=React.createElement("div",{className:"m_IPython m_IPython_popout-wrapper"},outputs);React.render(container,this.state.popout.document.body)},componentWillUnmount:function(){if(this.state.popout&&!this.state.popout.closed){this.state.popout.onbeforeunload=null;this.state.popout.close()}if(this.props.removeInjectListener){this.props.removeInjectListener(this._updateStyle)}},render:function(){var node=this.props.node,store=this.props.store;var className=cx({m_IPython:true,"m_IPython-hiding":node.display_collapsed,"m_IPython-empty":!(node.output&&node.output.length)});return React.createElement("div",{className:className,ref:"ipython_view",onClick:this.props.setActive},React.createElement("div",{ref:"outputs",className:"m_IPython_outputs"},!this.state.popout&&React.createElement("span",{onClick:this._onPopout,className:"m_IPython_popout-button"},React.createElement("i",{className:"fa fa-external-link-square"})),this.state.popout?React.createElement("div",{onClick:this._onClose,className:"m_IPython_popped-message"},"Output has been popped out into a separate window. Click to get it back"):make_outputs(node.outputs,store)),showTimes(node,this.props.kernelSession))
}});module.exports=Output},{"./timer":128,"./view":129,react:"react"}],126:[function(require,module,exports){var React=require("react/addons"),cx=React.addons.classSet;var DEFAULT_STYLE='\nhtml {\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  justify-content: center;\n  align-content: center;\n  flex: 1;\n  min-height: 100%;\n  background-color: white;\n}\nhtml.focused {\n  box-shadow: 0 0 10px blue inset;\n}\nhtml.focused:before {\n  color: #ddd;\n  content: "this frame has focus!";\n  font-family: sans-serif;\n  font-size: 30px;\n  font-weight: bold;\n  padding: 5px;\n  position: absolute;\n  right: 10px;\n  top: 0;\n  z-index: -10;\n}\nbody {\n  margin: 0;\n  padding: 10px;\n  display: flex;\n  flex-direction: column;\n  justify-content: center;\n  align-items: center;\n}\n';module.exports=function(frame,onFocus){var doc=frame.contentDocument,style=doc.createElement("style"),custom=doc.createElement("style"),win=frame.contentWindow;style.innerHTML=DEFAULT_STYLE;doc.head.appendChild(style);doc.head.appendChild(custom);win.React=React;win.cx=cx;win.addEventListener("focus",function(){doc.body.parentNode.classList.add("focused");onFocus()});win.addEventListener("blur",function(){return doc.body.parentNode.classList.remove("focused")});return custom}},{"react/addons":"react/addons"}],127:[function(require,module,exports){var React=require("react/addons"),cx=React.addons.classSet,less=require("less"),jsx=require("../kernels/js/jsx"),CodeMirrorRx=require("./codemirror-rx"),initFrame=require("./play-frame");var cache={jsx:{},less:{}};var SEP="\n// @playground-split\n";var Playground=React.createClass({displayName:"Playground",getInitialState:function(){return{jserror:null,csserror:null}},componentDidMount:function(){var frame=this.refs.out.getDOMNode();this._styler=initFrame(frame,this.onSelect);var parts=this.props.value.split(SEP);this.updateJSX(parts[0]||"");this.updateCSS(parts[1]||"");this._resize();if(!this.props.blurred){var parts=this.props.value.split(SEP);this.refs.jsx.focus()}},componentDidUpdate:function(prevProps,prevState){var prev=prevProps.value.split(SEP),now=this.props.value.split(SEP);if(prev[0]!==now[0]){this.updateJSX(now[0]||"")}if(prev[1]!==now[1]){this.updateCSS(now[1]||"")}var frame=this.refs.out.getDOMNode();this._resize()},_resize:function(){var frame=this.refs.out.getDOMNode();var el=frame.contentDocument.body.firstElementChild;if(!el)return;var st=window.getComputedStyle(el),margin=parseInt(st.marginTop)+parseInt(st.marginBottom);frame.style.height=el.offsetHeight+20+margin+"px"},onSelect:function(){this.props.store.actions.setMode("normal");this.props.store.actions.setActive(this.props.node.id)},updateJSX:function(val){var frame=this.refs.out.getDOMNode();try{var js=cache[val]||jsx(val);cache[val]=js}catch(e){return this.setState({jserror:e})}try{var jsel=frame.contentWindow.eval(js);if(jsel)React.render(jsel,frame.contentDocument.body);if(this.state.jserror)this.setState({jserror:null})}catch(e){this.setState({jserror:e})}},updateCSS:function(val){var frame=this.refs.out.getDOMNode();if(cache[val]){return this._styler.innerHTML=cache[val]}less.render(val,{},function(error,css){if(error)return this.setState({csserror:error});cache[val]=css.css;this._styler.innerHTML=css.css;if(this.state.csserror)this.setState({csserror:null});this._resize()}.bind(this))},setJSX:function(val){var parts=this.props.value.split(SEP);parts[0]=val;this.props.onChange(parts.join(SEP))},setLess:function(val){var parts=this.props.value.split(SEP);parts[1]=val;this.props.onChange(parts.join(SEP))},focus:function(){this.refs.jsx.focus()},isFocused:function(){return this.refs.jsx&&(this.refs.jsx.isFocused()||this.refs.less.isFocused())},_toggleCollapse:function(){this.props.store.actions.toggleEditorCollapse(this.props.node.id)},render:function(){if(this.props.node.editor_collapsed&&this.props.blurred){return React.createElement("div",{className:"Playground Playground-collapsed"},React.createElement("div",{key:"collapse",className:"Playground_collapse",onClick:this._toggleCollapse}),React.createElement("div",{key:"out",className:"Playground_out"},React.createElement("iframe",{ref:"out"})))}var parts=this.props.value.split(SEP),cmProps={style:{},indentWidth:2,indentWithTabs:false,matchBrackets:true,lineNumbers:true,tabSize:2,foldGutter:true,lineWrapping:true,viewportMargin:Infinity,blurred:this.props.blurred,gutters:["CodeMirror-linenumbers","CodeMirror-foldgutter"],onFocus:function(){return this.props.onFocus()}.bind(this)};return React.createElement("div",{className:"Playground"},React.createElement("div",{key:"collapse",className:"Playground_collapse",onClick:this._toggleCollapse}),React.createElement("div",{className:"Playground_code"},React.createElement(CodeMirrorRx,React.__spread({ref:"jsx",mode:"javascript",smartIndent:false,value:parts[0]||"",onBlur:this.props.onBlur,goDown:function(){return this.refs.less.focus()}.bind(this),onChange:this.setJSX},cmProps)),React.createElement(CodeMirrorRx,React.__spread({ref:"less",mode:"css",smartIndent:true,value:parts[1]||"",onBlur:this.props.onBlur,goUp:function(){return this.refs.jsx.focus()}.bind(this),onFocus:function(){return this.props.onFocus()}.bind(this),onChange:this.setLess},cmProps)),React.createElement("div",{className:"Playground_error"},this.state.jserror,this.state.csserror)),React.createElement("div",{key:"out",className:"Playground_out"},React.createElement("iframe",{ref:"out"})))}});module.exports=Playground},{"../kernels/js/jsx":109,"./codemirror-rx":117,"./play-frame":126,less:"less","react/addons":"react/addons"}],128:[function(require,module,exports){var React=require("react/addons"),moment=require("moment");module.exports=showTimes;function showTimes(node,kernelSession){var thisSession=kernelSession===node.session;if(!node.started||!node.finished&&!thisSession)return;if(!node.finished){return React.createElement(CountingTimer,{time:node.started,className:"m_IPython_time m_IPython_time-loading"})}var duration=node.finished-node.started;var className="m_IPython_time"+(thisSession?"":" m_IPython_time-stale");return React.createElement("div",{className:className},!thisSession&&React.createElement("em",null,"stale "),moment(node.finished).format("h:mm:ss\\\\a"),React.createElement("br",null),moment(duration).format("mm:ss.SSS\\s"))}var CountingTimer=React.createClass({displayName:"CountingTimer",getInitialState:function(){return{duration:Date.now()-this.props.time}},componentDidMount:function(){this._interval=setInterval(function(){this.setState({duration:Date.now()-this.props.time})}.bind(this),200)},componentWillUnmount:function(){clearInterval(this._interval)},render:function(){return this.transferPropsTo(React.createElement("div",null,moment(this.state.duration).format("mm:ss\\s")))}})},{moment:"moment","react/addons":"react/addons"}],129:[function(require,module,exports){var Convert=require("ansi-to-html"),convert=new Convert,format=require("./format"),React=require("react");module.exports=make_outputs;function make_outputs(outputs,store){if(!outputs||!outputs.length)return;var org=organizeOutputs(outputs);var items=[];if(org.streams.stdout){items.push(React.createElement("div",{key:"stdout",className:"m_IPython_output m_IPython_output-stdout"},ansiHtml(org.streams.stdout)))}if(org.streams.stderr){items.push(React.createElement("div",{key:"stderr",className:"m_IPython_output m_IPython_output-stderr"},ansiHtml(org.streams.stderr)))}return items.concat(org.normal.map(showOutput.bind(null,store)))}function organizeOutputs(outputs){var streams={stdout:null,stderr:null};var normal=[];outputs.forEach(function(output,i){if(output.type!=="stream"){if(output.suppressable&&i!==outputs.length-1){return}return normal.push(output)}if(streams[output.stream]){streams[output.stream]+=output.text}else{streams[output.stream]=output.text}});return{streams:streams,normal:normal}}function formatTraceback(traceback,ansi){if(!traceback)return;if(ansi)return ansiHtml(traceback.join(""));return traceback}function escape(text){return text?text.replace("&","&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"):"null"}function ansiHtml(text){return React.createElement("pre",{dangerouslySetInnerHTML:{__html:convert.toHtml(escape(text))}})}function showOutput(store,output,i){if(output.type==="error"){return React.createElement("div",{className:"m_IPython_output m_IPython_output-error",key:i},React.createElement("div",{className:"m_IPython_error_trace"},formatTraceback(output.traceback,output.format==="ansi")))}return format.display(i,output,store)}},{"./format":118,"ansi-to-html":"ansi-to-html",react:"react"}],130:[function(require,module,exports){arguments[4][84][0].apply(exports,arguments)},{dup:84}],131:[function(require,module,exports){(function(global){(function(){"use strict";var Syntax,Precedence,BinaryPrecedence,SourceNode,estraverse,esutils,isArray,base,indent,json,renumber,hexadecimal,quotes,escapeless,newline,space,parentheses,semicolons,safeConcatenation,directive,extra,parse,sourceMap,FORMAT_MINIFY,FORMAT_DEFAULTS;estraverse=require("estraverse");esutils=require("esutils");Syntax={AssignmentExpression:"AssignmentExpression",ArrayExpression:"ArrayExpression",ArrayPattern:"ArrayPattern",ArrowFunctionExpression:"ArrowFunctionExpression",BlockStatement:"BlockStatement",BinaryExpression:"BinaryExpression",BreakStatement:"BreakStatement",CallExpression:"CallExpression",CatchClause:"CatchClause",ClassBody:"ClassBody",ClassDeclaration:"ClassDeclaration",ClassExpression:"ClassExpression",ComprehensionBlock:"ComprehensionBlock",ComprehensionExpression:"ComprehensionExpression",ConditionalExpression:"ConditionalExpression",ContinueStatement:"ContinueStatement",DirectiveStatement:"DirectiveStatement",DoWhileStatement:"DoWhileStatement",DebuggerStatement:"DebuggerStatement",EmptyStatement:"EmptyStatement",ExportBatchSpecifier:"ExportBatchSpecifier",ExportDeclaration:"ExportDeclaration",ExportSpecifier:"ExportSpecifier",ExpressionStatement:"ExpressionStatement",ForStatement:"ForStatement",ForInStatement:"ForInStatement",ForOfStatement:"ForOfStatement",FunctionDeclaration:"FunctionDeclaration",FunctionExpression:"FunctionExpression",GeneratorExpression:"GeneratorExpression",Identifier:"Identifier",IfStatement:"IfStatement",ImportSpecifier:"ImportSpecifier",ImportDeclaration:"ImportDeclaration",Literal:"Literal",LabeledStatement:"LabeledStatement",LogicalExpression:"LogicalExpression",MemberExpression:"MemberExpression",MethodDefinition:"MethodDefinition",ModuleDeclaration:"ModuleDeclaration",NewExpression:"NewExpression",ObjectExpression:"ObjectExpression",ObjectPattern:"ObjectPattern",Program:"Program",Property:"Property",ReturnStatement:"ReturnStatement",SequenceExpression:"SequenceExpression",SpreadElement:"SpreadElement",SwitchStatement:"SwitchStatement",SwitchCase:"SwitchCase",TaggedTemplateExpression:"TaggedTemplateExpression",TemplateElement:"TemplateElement",TemplateLiteral:"TemplateLiteral",ThisExpression:"ThisExpression",ThrowStatement:"ThrowStatement",TryStatement:"TryStatement",UnaryExpression:"UnaryExpression",UpdateExpression:"UpdateExpression",VariableDeclaration:"VariableDeclaration",VariableDeclarator:"VariableDeclarator",WhileStatement:"WhileStatement",WithStatement:"WithStatement",YieldExpression:"YieldExpression"};function isExpression(node){switch(node.type){case Syntax.AssignmentExpression:case Syntax.ArrayExpression:case Syntax.ArrayPattern:case Syntax.BinaryExpression:case Syntax.CallExpression:case Syntax.ConditionalExpression:case Syntax.ClassExpression:case Syntax.ExportBatchSpecifier:case Syntax.ExportSpecifier:case Syntax.FunctionExpression:case Syntax.Identifier:case Syntax.ImportSpecifier:case Syntax.Literal:case Syntax.LogicalExpression:case Syntax.MemberExpression:case Syntax.MethodDefinition:case Syntax.NewExpression:case Syntax.ObjectExpression:case Syntax.ObjectPattern:case Syntax.Property:case Syntax.SequenceExpression:case Syntax.ThisExpression:case Syntax.UnaryExpression:case Syntax.UpdateExpression:case Syntax.YieldExpression:return true}return false}function isStatement(node){switch(node.type){case Syntax.BlockStatement:case Syntax.BreakStatement:case Syntax.CatchClause:case Syntax.ContinueStatement:case Syntax.ClassDeclaration:case Syntax.ClassBody:case Syntax.DirectiveStatement:case Syntax.DoWhileStatement:case Syntax.DebuggerStatement:case Syntax.EmptyStatement:case Syntax.ExpressionStatement:case Syntax.ForStatement:case Syntax.ForInStatement:case Syntax.ForOfStatement:case Syntax.FunctionDeclaration:case Syntax.IfStatement:case Syntax.LabeledStatement:case Syntax.ModuleDeclaration:case Syntax.Program:case Syntax.ReturnStatement:case Syntax.SwitchStatement:case Syntax.SwitchCase:case Syntax.ThrowStatement:case Syntax.TryStatement:case Syntax.VariableDeclaration:case Syntax.VariableDeclarator:case Syntax.WhileStatement:case Syntax.WithStatement:return true}return false}Precedence={Sequence:0,Yield:1,Assignment:1,Conditional:2,ArrowFunction:2,LogicalOR:3,LogicalAND:4,BitwiseOR:5,BitwiseXOR:6,BitwiseAND:7,Equality:8,Relational:9,BitwiseSHIFT:10,Additive:11,Multiplicative:12,Unary:13,Postfix:14,Call:15,New:16,TaggedTemplate:17,Member:18,Primary:19};BinaryPrecedence={"||":Precedence.LogicalOR,"&&":Precedence.LogicalAND,"|":Precedence.BitwiseOR,"^":Precedence.BitwiseXOR,"&":Precedence.BitwiseAND,"==":Precedence.Equality,"!=":Precedence.Equality,"===":Precedence.Equality,"!==":Precedence.Equality,is:Precedence.Equality,isnt:Precedence.Equality,"<":Precedence.Relational,">":Precedence.Relational,"<=":Precedence.Relational,">=":Precedence.Relational,in:Precedence.Relational,instanceof:Precedence.Relational,"<<":Precedence.BitwiseSHIFT,">>":Precedence.BitwiseSHIFT,">>>":Precedence.BitwiseSHIFT,"+":Precedence.Additive,"-":Precedence.Additive,"*":Precedence.Multiplicative,"%":Precedence.Multiplicative,"/":Precedence.Multiplicative};function getDefaultOptions(){return{indent:null,base:null,parse:null,comment:false,format:{indent:{style:"    ",base:0,adjustMultilineComment:false},newline:"\n",space:" ",json:false,renumber:false,hexadecimal:false,quotes:"single",escapeless:false,compact:false,parentheses:true,semicolons:true,safeConcatenation:false},moz:{comprehensionExpressionStartsWithAssignment:false,starlessGenerator:false},sourceMap:null,sourceMapRoot:null,sourceMapWithCode:false,directive:false,raw:true,verbatim:null}}function stringRepeat(str,num){var result="";for(num|=0;num>0;num>>>=1,str+=str){if(num&1){result+=str}}return result}isArray=Array.isArray;if(!isArray){isArray=function isArray(array){return Object.prototype.toString.call(array)==="[object Array]"}}function hasLineTerminator(str){return/[\r\n]/g.test(str)}function endsWithLineTerminator(str){var len=str.length;return len&&esutils.code.isLineTerminator(str.charCodeAt(len-1))}function updateDeeply(target,override){var key,val;function isHashObject(target){return typeof target==="object"&&target instanceof Object&&!(target instanceof RegExp)}for(key in override){if(override.hasOwnProperty(key)){val=override[key];if(isHashObject(val)){if(isHashObject(target[key])){updateDeeply(target[key],val)}else{target[key]=updateDeeply({},val)}}else{target[key]=val}}}return target}function generateNumber(value){var result,point,temp,exponent,pos;if(value!==value){throw new Error("Numeric literal whose value is NaN")}if(value<0||value===0&&1/value<0){throw new Error("Numeric literal whose value is negative")}if(value===1/0){return json?"null":renumber?"1e400":"1e+400"}result=""+value;if(!renumber||result.length<3){return result}point=result.indexOf(".");if(!json&&result.charCodeAt(0)===48&&point===1){point=0;result=result.slice(1)}temp=result;result=result.replace("e+","e");exponent=0;if((pos=temp.indexOf("e"))>0){exponent=+temp.slice(pos+1);temp=temp.slice(0,pos)}if(point>=0){exponent-=temp.length-point-1;temp=+(temp.slice(0,point)+temp.slice(point+1))+""}pos=0;while(temp.charCodeAt(temp.length+pos-1)===48){--pos}if(pos!==0){exponent-=pos;temp=temp.slice(0,pos)}if(exponent!==0){temp+="e"+exponent}if((temp.length<result.length||hexadecimal&&value>1e12&&Math.floor(value)===value&&(temp="0x"+value.toString(16)).length<result.length)&&+temp===value){result=temp}return result}function escapeRegExpCharacter(ch,previousIsBackslash){if((ch&~1)===8232){return(previousIsBackslash?"u":"\\u")+(ch===8232?"2028":"2029")}else if(ch===10||ch===13){return(previousIsBackslash?"":"\\")+(ch===10?"n":"r")}return String.fromCharCode(ch)}function generateRegExp(reg){var match,result,flags,i,iz,ch,characterInBrack,previousIsBackslash;result=reg.toString();if(reg.source){match=result.match(/\/([^/]*)$/);if(!match){return result}flags=match[1];result="";characterInBrack=false;previousIsBackslash=false;for(i=0,iz=reg.source.length;i<iz;++i){ch=reg.source.charCodeAt(i);if(!previousIsBackslash){if(characterInBrack){if(ch===93){characterInBrack=false}}else{if(ch===47){result+="\\"}else if(ch===91){characterInBrack=true}}result+=escapeRegExpCharacter(ch,previousIsBackslash);previousIsBackslash=ch===92}else{result+=escapeRegExpCharacter(ch,previousIsBackslash);previousIsBackslash=false}}return"/"+result+"/"+flags}return result}function escapeAllowedCharacter(code,next){var hex,result="\\";switch(code){case 8:result+="b";break;case 12:result+="f";break;case 9:result+="t";break;default:hex=code.toString(16).toUpperCase();if(json||code>255){result+="u"+"0000".slice(hex.length)+hex}else if(code===0&&!esutils.code.isDecimalDigit(next)){result+="0"}else if(code===11){result+="x0B"}else{result+="x"+"00".slice(hex.length)+hex}break}return result}function escapeDisallowedCharacter(code){var result="\\";switch(code){case 92:result+="\\";break;case 10:result+="n";break;case 13:result+="r";break;case 8232:result+="u2028";break;case 8233:result+="u2029";break;default:throw new Error("Incorrectly classified character")}return result}function escapeDirective(str){var i,iz,code,quote;quote=quotes==="double"?'"':"'";for(i=0,iz=str.length;i<iz;++i){code=str.charCodeAt(i);if(code===39){quote='"';break}else if(code===34){quote="'";break}else if(code===92){++i}}return quote+str+quote}function escapeString(str){var result="",i,len,code,singleQuotes=0,doubleQuotes=0,single,quote;for(i=0,len=str.length;i<len;++i){code=str.charCodeAt(i);if(code===39){++singleQuotes}else if(code===34){++doubleQuotes}else if(code===47&&json){result+="\\"}else if(esutils.code.isLineTerminator(code)||code===92){result+=escapeDisallowedCharacter(code);continue}else if(json&&code<32||!(json||escapeless||code>=32&&code<=126)){result+=escapeAllowedCharacter(code,str.charCodeAt(i+1));continue}result+=String.fromCharCode(code)}single=!(quotes==="double"||quotes==="auto"&&doubleQuotes<singleQuotes);quote=single?"'":'"';if(!(single?singleQuotes:doubleQuotes)){return quote+result+quote}str=result;result=quote;for(i=0,len=str.length;i<len;++i){code=str.charCodeAt(i);if(code===39&&single||code===34&&!single){result+="\\"}result+=String.fromCharCode(code)}return result+quote}function flattenToString(arr){var i,iz,elem,result="";for(i=0,iz=arr.length;i<iz;++i){elem=arr[i];result+=isArray(elem)?flattenToString(elem):elem}return result}function toSourceNodeWhenNeeded(generated,node){if(!sourceMap){if(isArray(generated)){return flattenToString(generated)}else{return generated}}if(node==null){if(generated instanceof SourceNode){return generated}else{node={}}}if(node.loc==null){return new SourceNode(null,null,sourceMap,generated,node.name||null)}return new SourceNode(node.loc.start.line,node.loc.start.column,sourceMap===true?node.loc.source||null:sourceMap,generated,node.name||null)}function noEmptySpace(){return space?space:" "}function join(left,right){var leftSource,rightSource,leftCharCode,rightCharCode;leftSource=toSourceNodeWhenNeeded(left).toString();if(leftSource.length===0){return[right]}rightSource=toSourceNodeWhenNeeded(right).toString();if(rightSource.length===0){return[left]}leftCharCode=leftSource.charCodeAt(leftSource.length-1);rightCharCode=rightSource.charCodeAt(0);if((leftCharCode===43||leftCharCode===45)&&leftCharCode===rightCharCode||esutils.code.isIdentifierPart(leftCharCode)&&esutils.code.isIdentifierPart(rightCharCode)||leftCharCode===47&&rightCharCode===105){return[left,noEmptySpace(),right]}else if(esutils.code.isWhiteSpace(leftCharCode)||esutils.code.isLineTerminator(leftCharCode)||esutils.code.isWhiteSpace(rightCharCode)||esutils.code.isLineTerminator(rightCharCode)){return[left,right]}return[left,space,right]}function addIndent(stmt){return[base,stmt]}function withIndent(fn){var previousBase,result;previousBase=base;base+=indent;result=fn.call(this,base);base=previousBase;return result}function calculateSpaces(str){var i;for(i=str.length-1;i>=0;--i){if(esutils.code.isLineTerminator(str.charCodeAt(i))){break}}return str.length-1-i}function adjustMultilineComment(value,specialBase){var array,i,len,line,j,spaces,previousBase,sn;array=value.split(/\r\n|[\r\n]/);spaces=Number.MAX_VALUE;for(i=1,len=array.length;i<len;++i){line=array[i];j=0;while(j<line.length&&esutils.code.isWhiteSpace(line.charCodeAt(j))){++j}if(spaces>j){spaces=j}}if(typeof specialBase!=="undefined"){previousBase=base;if(array[1][spaces]==="*"){specialBase+=" "}base=specialBase}else{if(spaces&1){--spaces}previousBase=base}for(i=1,len=array.length;i<len;++i){sn=toSourceNodeWhenNeeded(addIndent(array[i].slice(spaces)));array[i]=sourceMap?sn.join(""):sn}base=previousBase;return array.join("\n")}function generateComment(comment,specialBase){if(comment.type==="Line"){if(endsWithLineTerminator(comment.value)){return"//"+comment.value}else{return"//"+comment.value+"\n"}}if(extra.format.indent.adjustMultilineComment&&/[\n\r]/.test(comment.value)){return adjustMultilineComment("/*"+comment.value+"*/",specialBase)}return"/*"+comment.value+"*/"}function addComments(stmt,result){var i,len,comment,save,tailingToStatement,specialBase,fragment;if(stmt.leadingComments&&stmt.leadingComments.length>0){save=result;comment=stmt.leadingComments[0];result=[];if(safeConcatenation&&stmt.type===Syntax.Program&&stmt.body.length===0){result.push("\n")}result.push(generateComment(comment));if(!endsWithLineTerminator(toSourceNodeWhenNeeded(result).toString())){result.push("\n")}for(i=1,len=stmt.leadingComments.length;i<len;++i){comment=stmt.leadingComments[i];fragment=[generateComment(comment)];if(!endsWithLineTerminator(toSourceNodeWhenNeeded(fragment).toString())){fragment.push("\n")}result.push(addIndent(fragment))}result.push(addIndent(save))}if(stmt.trailingComments){tailingToStatement=!endsWithLineTerminator(toSourceNodeWhenNeeded(result).toString());specialBase=stringRepeat(" ",calculateSpaces(toSourceNodeWhenNeeded([base,result,indent]).toString()));for(i=0,len=stmt.trailingComments.length;i<len;++i){comment=stmt.trailingComments[i];if(tailingToStatement){if(i===0){result=[result,indent]}else{result=[result,specialBase]}result.push(generateComment(comment,specialBase))}else{result=[result,addIndent(generateComment(comment))]}if(i!==len-1&&!endsWithLineTerminator(toSourceNodeWhenNeeded(result).toString())){result=[result,"\n"]}}}return result}function parenthesize(text,current,should){if(current<should){return["(",text,")"]}return text}function maybeBlock(stmt,semicolonOptional,functionBody){var result,noLeadingComment;noLeadingComment=!extra.comment||!stmt.leadingComments;if(stmt.type===Syntax.BlockStatement&&noLeadingComment){return[space,generateStatement(stmt,{functionBody:functionBody})]}if(stmt.type===Syntax.EmptyStatement&&noLeadingComment){return";"}withIndent(function(){result=[newline,addIndent(generateStatement(stmt,{semicolonOptional:semicolonOptional,functionBody:functionBody}))]});return result}function maybeBlockSuffix(stmt,result){var ends=endsWithLineTerminator(toSourceNodeWhenNeeded(result).toString());if(stmt.type===Syntax.BlockStatement&&(!extra.comment||!stmt.leadingComments)&&!ends){return[result,space]}if(ends){return[result,base]}return[result,newline,base]}function generateVerbatimString(string){var i,iz,result;result=string.split(/\r\n|\n/);for(i=1,iz=result.length;i<iz;i++){result[i]=newline+base+result[i]}return result}function generateVerbatim(expr,option){var verbatim,result,prec;verbatim=expr[extra.verbatim];if(typeof verbatim==="string"){result=parenthesize(generateVerbatimString(verbatim),Precedence.Sequence,option.precedence)}else{result=generateVerbatimString(verbatim.content);prec=verbatim.precedence!=null?verbatim.precedence:Precedence.Sequence;result=parenthesize(result,prec,option.precedence)}return toSourceNodeWhenNeeded(result,expr)}function generateIdentifier(node){return toSourceNodeWhenNeeded(node.name,node)}function generatePattern(node,options){var result;if(node.type===Syntax.Identifier){result=generateIdentifier(node)}else{result=generateExpression(node,{precedence:options.precedence,allowIn:options.allowIn,allowCall:true})}return result}function generateFunctionParams(node){var i,iz,result,hasDefault;hasDefault=false;if(node.type===Syntax.ArrowFunctionExpression&&!node.rest&&(!node.defaults||node.defaults.length===0)&&node.params.length===1&&node.params[0].type===Syntax.Identifier){result=[generateIdentifier(node.params[0])]}else{result=["("];if(node.defaults){hasDefault=true}for(i=0,iz=node.params.length;i<iz;++i){if(hasDefault&&node.defaults[i]){result.push(generateAssignment(node.params[i],node.defaults[i],"=",{precedence:Precedence.Assignment,allowIn:true,allowCall:true}))}else{result.push(generatePattern(node.params[i],{precedence:Precedence.Assignment,allowIn:true,allowCall:true}))}if(i+1<iz){result.push(","+space)}}if(node.rest){if(node.params.length){result.push(","+space)}result.push("...");result.push(generateIdentifier(node.rest,{precedence:Precedence.Assignment,allowIn:true,allowCall:true}))}result.push(")")}return result}function generateFunctionBody(node){var result,expr;result=generateFunctionParams(node);if(node.type===Syntax.ArrowFunctionExpression){result.push(space);result.push("=>")}if(node.expression){result.push(space);expr=generateExpression(node.body,{precedence:Precedence.Assignment,allowIn:true,allowCall:true});if(expr.toString().charAt(0)==="{"){expr=["(",expr,")"]}result.push(expr)}else{result.push(maybeBlock(node.body,false,true))}return result}function generateIterationForStatement(operator,stmt,semicolonIsNotNeeded){var result=["for"+space+"("];withIndent(function(){if(stmt.left.type===Syntax.VariableDeclaration){withIndent(function(){result.push(stmt.left.kind+noEmptySpace());result.push(generateStatement(stmt.left.declarations[0],{allowIn:false}))})}else{result.push(generateExpression(stmt.left,{precedence:Precedence.Call,allowIn:true,allowCall:true}))}result=join(result,operator);result=[join(result,generateExpression(stmt.right,{precedence:Precedence.Sequence,allowIn:true,allowCall:true})),")"]});result.push(maybeBlock(stmt.body,semicolonIsNotNeeded));return result}function generateVariableDeclaration(stmt,semicolon,allowIn){var result,i,iz,node;result=[stmt.kind];function block(){node=stmt.declarations[0];if(extra.comment&&node.leadingComments){result.push("\n");result.push(addIndent(generateStatement(node,{allowIn:allowIn})))}else{result.push(noEmptySpace());result.push(generateStatement(node,{allowIn:allowIn}))}for(i=1,iz=stmt.declarations.length;i<iz;++i){node=stmt.declarations[i];if(extra.comment&&node.leadingComments){result.push(","+newline);result.push(addIndent(generateStatement(node,{allowIn:allowIn})))}else{result.push(","+space);result.push(generateStatement(node,{allowIn:allowIn}))}}}if(stmt.declarations.length>1){withIndent(block)}else{block()}result.push(semicolon);return result}function generateClassBody(classBody){var result=["{",newline];withIndent(function(indent){var i,iz;for(i=0,iz=classBody.body.length;i<iz;++i){result.push(indent);result.push(generateExpression(classBody.body[i],{precedence:Precedence.Sequence,allowIn:true,allowCall:true,type:Syntax.Property}));if(i+1<iz){result.push(newline)}}});if(!endsWithLineTerminator(toSourceNodeWhenNeeded(result).toString())){result.push(newline)}result.push(base);result.push("}");return result}function generateLiteral(expr){var raw;if(expr.hasOwnProperty("raw")&&parse&&extra.raw){try{raw=parse(expr.raw).body[0].expression;if(raw.type===Syntax.Literal){if(raw.value===expr.value){return expr.raw}}}catch(e){}}if(expr.value===null){return"null"}if(typeof expr.value==="string"){return escapeString(expr.value)}if(typeof expr.value==="number"){return generateNumber(expr.value)}if(typeof expr.value==="boolean"){return expr.value?"true":"false"}return generateRegExp(expr.value)}function generatePropertyKey(expr,computed,option){var result=[];if(computed){result.push("[")}result.push(generateExpression(expr,option));if(computed){result.push("]")}return result}function generateAssignment(left,right,operator,option){var allowIn,precedence;precedence=option.precedence;allowIn=option.allowIn||Precedence.Assignment<precedence;return parenthesize([generateExpression(left,{precedence:Precedence.Call,allowIn:allowIn,allowCall:true}),space+operator+space,generateExpression(right,{precedence:Precedence.Assignment,allowIn:allowIn,allowCall:true})],Precedence.Assignment,precedence)}function generateExpression(expr,option){var result,precedence,type,currentPrecedence,i,len,fragment,multiline,leftCharCode,leftSource,rightCharCode,allowIn,allowCall,allowUnparenthesizedNew,property,isGenerator;precedence=option.precedence;allowIn=option.allowIn;allowCall=option.allowCall;type=expr.type||option.type;if(extra.verbatim&&expr.hasOwnProperty(extra.verbatim)){return generateVerbatim(expr,option)}switch(type){case Syntax.SequenceExpression:result=[];allowIn|=Precedence.Sequence<precedence;for(i=0,len=expr.expressions.length;i<len;++i){result.push(generateExpression(expr.expressions[i],{precedence:Precedence.Assignment,allowIn:allowIn,allowCall:true}));if(i+1<len){result.push(","+space)}}result=parenthesize(result,Precedence.Sequence,precedence);break;case Syntax.AssignmentExpression:result=generateAssignment(expr.left,expr.right,expr.operator,option);break;case Syntax.ArrowFunctionExpression:allowIn|=Precedence.ArrowFunction<precedence;result=parenthesize(generateFunctionBody(expr),Precedence.ArrowFunction,precedence);break;case Syntax.ConditionalExpression:allowIn|=Precedence.Conditional<precedence;result=parenthesize([generateExpression(expr.test,{precedence:Precedence.LogicalOR,allowIn:allowIn,allowCall:true}),space+"?"+space,generateExpression(expr.consequent,{precedence:Precedence.Assignment,allowIn:allowIn,allowCall:true}),space+":"+space,generateExpression(expr.alternate,{precedence:Precedence.Assignment,allowIn:allowIn,allowCall:true})],Precedence.Conditional,precedence);break;case Syntax.LogicalExpression:case Syntax.BinaryExpression:currentPrecedence=BinaryPrecedence[expr.operator];allowIn|=currentPrecedence<precedence;fragment=generateExpression(expr.left,{precedence:currentPrecedence,allowIn:allowIn,allowCall:true});leftSource=fragment.toString();if(leftSource.charCodeAt(leftSource.length-1)===47&&esutils.code.isIdentifierPart(expr.operator.charCodeAt(0))){result=[fragment,noEmptySpace(),expr.operator]}else{result=join(fragment,expr.operator)}fragment=generateExpression(expr.right,{precedence:currentPrecedence+1,allowIn:allowIn,allowCall:true});if(expr.operator==="/"&&fragment.toString().charAt(0)==="/"||expr.operator.slice(-1)==="<"&&fragment.toString().slice(0,3)==="!--"){result.push(noEmptySpace());result.push(fragment)}else{result=join(result,fragment)}if(expr.operator==="in"&&!allowIn){result=["(",result,")"]}else{result=parenthesize(result,currentPrecedence,precedence)}break;case Syntax.CallExpression:result=[generateExpression(expr.callee,{precedence:Precedence.Call,allowIn:true,allowCall:true,allowUnparenthesizedNew:false})];result.push("(");for(i=0,len=expr["arguments"].length;i<len;++i){result.push(generateExpression(expr["arguments"][i],{precedence:Precedence.Assignment,allowIn:true,allowCall:true}));if(i+1<len){result.push(","+space)
}}result.push(")");if(!allowCall){result=["(",result,")"]}else{result=parenthesize(result,Precedence.Call,precedence)}break;case Syntax.NewExpression:len=expr["arguments"].length;allowUnparenthesizedNew=option.allowUnparenthesizedNew===undefined||option.allowUnparenthesizedNew;result=join("new",generateExpression(expr.callee,{precedence:Precedence.New,allowIn:true,allowCall:false,allowUnparenthesizedNew:allowUnparenthesizedNew&&!parentheses&&len===0}));if(!allowUnparenthesizedNew||parentheses||len>0){result.push("(");for(i=0;i<len;++i){result.push(generateExpression(expr["arguments"][i],{precedence:Precedence.Assignment,allowIn:true,allowCall:true}));if(i+1<len){result.push(","+space)}}result.push(")")}result=parenthesize(result,Precedence.New,precedence);break;case Syntax.MemberExpression:result=[generateExpression(expr.object,{precedence:Precedence.Call,allowIn:true,allowCall:allowCall,allowUnparenthesizedNew:false})];if(expr.computed){result.push("[");result.push(generateExpression(expr.property,{precedence:Precedence.Sequence,allowIn:true,allowCall:allowCall}));result.push("]")}else{if(expr.object.type===Syntax.Literal&&typeof expr.object.value==="number"){fragment=toSourceNodeWhenNeeded(result).toString();if(fragment.indexOf(".")<0&&!/[eExX]/.test(fragment)&&esutils.code.isDecimalDigit(fragment.charCodeAt(fragment.length-1))&&!(fragment.length>=2&&fragment.charCodeAt(0)===48)){result.push(".")}}result.push(".");result.push(generateIdentifier(expr.property))}result=parenthesize(result,Precedence.Member,precedence);break;case Syntax.UnaryExpression:fragment=generateExpression(expr.argument,{precedence:Precedence.Unary,allowIn:true,allowCall:true});if(space===""){result=join(expr.operator,fragment)}else{result=[expr.operator];if(expr.operator.length>2){result=join(result,fragment)}else{leftSource=toSourceNodeWhenNeeded(result).toString();leftCharCode=leftSource.charCodeAt(leftSource.length-1);rightCharCode=fragment.toString().charCodeAt(0);if((leftCharCode===43||leftCharCode===45)&&leftCharCode===rightCharCode||esutils.code.isIdentifierPart(leftCharCode)&&esutils.code.isIdentifierPart(rightCharCode)){result.push(noEmptySpace());result.push(fragment)}else{result.push(fragment)}}}result=parenthesize(result,Precedence.Unary,precedence);break;case Syntax.YieldExpression:if(expr.delegate){result="yield*"}else{result="yield"}if(expr.argument){result=join(result,generateExpression(expr.argument,{precedence:Precedence.Yield,allowIn:true,allowCall:true}))}result=parenthesize(result,Precedence.Yield,precedence);break;case Syntax.UpdateExpression:if(expr.prefix){result=parenthesize([expr.operator,generateExpression(expr.argument,{precedence:Precedence.Unary,allowIn:true,allowCall:true})],Precedence.Unary,precedence)}else{result=parenthesize([generateExpression(expr.argument,{precedence:Precedence.Postfix,allowIn:true,allowCall:true}),expr.operator],Precedence.Postfix,precedence)}break;case Syntax.FunctionExpression:isGenerator=expr.generator&&!extra.moz.starlessGenerator;result=isGenerator?"function*":"function";if(expr.id){result=[result,isGenerator?space:noEmptySpace(),generateIdentifier(expr.id),generateFunctionBody(expr)]}else{result=[result+space,generateFunctionBody(expr)]}break;case Syntax.ExportBatchSpecifier:result="*";break;case Syntax.ArrayPattern:case Syntax.ArrayExpression:if(!expr.elements.length){result="[]";break}multiline=expr.elements.length>1;result=["[",multiline?newline:""];withIndent(function(indent){for(i=0,len=expr.elements.length;i<len;++i){if(!expr.elements[i]){if(multiline){result.push(indent)}if(i+1===len){result.push(",")}}else{result.push(multiline?indent:"");result.push(generateExpression(expr.elements[i],{precedence:Precedence.Assignment,allowIn:true,allowCall:true}))}if(i+1<len){result.push(","+(multiline?newline:space))}}});if(multiline&&!endsWithLineTerminator(toSourceNodeWhenNeeded(result).toString())){result.push(newline)}result.push(multiline?base:"");result.push("]");break;case Syntax.ClassExpression:result=["class"];if(expr.id){result=join(result,generateExpression(expr.id,{allowIn:true,allowCall:true}))}if(expr.superClass){fragment=join("extends",generateExpression(expr.superClass,{precedence:Precedence.Assignment,allowIn:true,allowCall:true}));result=join(result,fragment)}result.push(space);result.push(generateStatement(expr.body,{semicolonOptional:true,directiveContext:false}));break;case Syntax.MethodDefinition:if(expr["static"]){result=["static"+space]}else{result=[]}if(expr.kind==="get"||expr.kind==="set"){result=join(result,[join(expr.kind,generatePropertyKey(expr.key,expr.computed,{precedence:Precedence.Sequence,allowIn:true,allowCall:true})),generateFunctionBody(expr.value)])}else{fragment=[generatePropertyKey(expr.key,expr.computed,{precedence:Precedence.Sequence,allowIn:true,allowCall:true}),generateFunctionBody(expr.value)];if(expr.value.generator){result.push("*");result.push(fragment)}else{result=join(result,fragment)}}break;case Syntax.Property:if(expr.kind==="get"||expr.kind==="set"){result=[expr.kind,noEmptySpace(),generatePropertyKey(expr.key,expr.computed,{precedence:Precedence.Sequence,allowIn:true,allowCall:true}),generateFunctionBody(expr.value)]}else{if(expr.shorthand){result=generatePropertyKey(expr.key,expr.computed,{precedence:Precedence.Sequence,allowIn:true,allowCall:true})}else if(expr.method){result=[];if(expr.value.generator){result.push("*")}result.push(generatePropertyKey(expr.key,expr.computed,{precedence:Precedence.Sequence,allowIn:true,allowCall:true}));result.push(generateFunctionBody(expr.value))}else{result=[generatePropertyKey(expr.key,expr.computed,{precedence:Precedence.Sequence,allowIn:true,allowCall:true}),":"+space,generateExpression(expr.value,{precedence:Precedence.Assignment,allowIn:true,allowCall:true})]}}break;case Syntax.ObjectExpression:if(!expr.properties.length){result="{}";break}multiline=expr.properties.length>1;withIndent(function(){fragment=generateExpression(expr.properties[0],{precedence:Precedence.Sequence,allowIn:true,allowCall:true,type:Syntax.Property})});if(!multiline){if(!hasLineTerminator(toSourceNodeWhenNeeded(fragment).toString())){result=["{",space,fragment,space,"}"];break}}withIndent(function(indent){result=["{",newline,indent,fragment];if(multiline){result.push(","+newline);for(i=1,len=expr.properties.length;i<len;++i){result.push(indent);result.push(generateExpression(expr.properties[i],{precedence:Precedence.Sequence,allowIn:true,allowCall:true,type:Syntax.Property}));if(i+1<len){result.push(","+newline)}}}});if(!endsWithLineTerminator(toSourceNodeWhenNeeded(result).toString())){result.push(newline)}result.push(base);result.push("}");break;case Syntax.ObjectPattern:if(!expr.properties.length){result="{}";break}multiline=false;if(expr.properties.length===1){property=expr.properties[0];if(property.value.type!==Syntax.Identifier){multiline=true}}else{for(i=0,len=expr.properties.length;i<len;++i){property=expr.properties[i];if(!property.shorthand){multiline=true;break}}}result=["{",multiline?newline:""];withIndent(function(indent){for(i=0,len=expr.properties.length;i<len;++i){result.push(multiline?indent:"");result.push(generateExpression(expr.properties[i],{precedence:Precedence.Sequence,allowIn:true,allowCall:true}));if(i+1<len){result.push(","+(multiline?newline:space))}}});if(multiline&&!endsWithLineTerminator(toSourceNodeWhenNeeded(result).toString())){result.push(newline)}result.push(multiline?base:"");result.push("}");break;case Syntax.ThisExpression:result="this";break;case Syntax.Identifier:result=generateIdentifier(expr);break;case Syntax.ImportSpecifier:case Syntax.ExportSpecifier:result=[expr.id.name];if(expr.name){result.push(noEmptySpace()+"as"+noEmptySpace()+expr.name.name)}break;case Syntax.Literal:result=generateLiteral(expr);break;case Syntax.GeneratorExpression:case Syntax.ComprehensionExpression:result=type===Syntax.GeneratorExpression?["("]:["["];if(extra.moz.comprehensionExpressionStartsWithAssignment){fragment=generateExpression(expr.body,{precedence:Precedence.Assignment,allowIn:true,allowCall:true});result.push(fragment)}if(expr.blocks){withIndent(function(){for(i=0,len=expr.blocks.length;i<len;++i){fragment=generateExpression(expr.blocks[i],{precedence:Precedence.Sequence,allowIn:true,allowCall:true});if(i>0||extra.moz.comprehensionExpressionStartsWithAssignment){result=join(result,fragment)}else{result.push(fragment)}}})}if(expr.filter){result=join(result,"if"+space);fragment=generateExpression(expr.filter,{precedence:Precedence.Sequence,allowIn:true,allowCall:true});result=join(result,["(",fragment,")"])}if(!extra.moz.comprehensionExpressionStartsWithAssignment){fragment=generateExpression(expr.body,{precedence:Precedence.Assignment,allowIn:true,allowCall:true});result=join(result,fragment)}result.push(type===Syntax.GeneratorExpression?")":"]");break;case Syntax.ComprehensionBlock:if(expr.left.type===Syntax.VariableDeclaration){fragment=[expr.left.kind,noEmptySpace(),generateStatement(expr.left.declarations[0],{allowIn:false})]}else{fragment=generateExpression(expr.left,{precedence:Precedence.Call,allowIn:true,allowCall:true})}fragment=join(fragment,expr.of?"of":"in");fragment=join(fragment,generateExpression(expr.right,{precedence:Precedence.Sequence,allowIn:true,allowCall:true}));result=["for"+space+"(",fragment,")"];break;case Syntax.SpreadElement:result=["...",generateExpression(expr.argument,{precedence:Precedence.Assignment,allowIn:true,allowCall:true})];break;case Syntax.TaggedTemplateExpression:result=[generateExpression(expr.tag,{precedence:Precedence.Call,allowIn:true,allowCall:allowCall,allowUnparenthesizedNew:false}),generateExpression(expr.quasi,{precedence:Precedence.Primary})];result=parenthesize(result,Precedence.TaggedTemplate,precedence);break;case Syntax.TemplateElement:result=expr.value.raw;break;case Syntax.TemplateLiteral:result=["`"];for(i=0,len=expr.quasis.length;i<len;++i){result.push(generateExpression(expr.quasis[i],{precedence:Precedence.Primary,allowIn:true,allowCall:true}));if(i+1<len){result.push("${"+space);result.push(generateExpression(expr.expressions[i],{precedence:Precedence.Sequence,allowIn:true,allowCall:true}));result.push(space+"}")}}result.push("`");break;default:throw new Error("Unknown expression type: "+expr.type)}if(extra.comment){result=addComments(expr,result)}return toSourceNodeWhenNeeded(result,expr)}function generateImportDeclaration(stmt,semicolon){var result,namedStart;if(stmt.specifiers.length===0){return["import",space,generateLiteral(stmt.source),semicolon]}result=["import"];namedStart=0;if(stmt.specifiers[0]["default"]){result=join(result,[stmt.specifiers[0].id.name]);++namedStart}if(stmt.specifiers[namedStart]){if(namedStart!==0){result.push(",")}result.push(space+"{");if(stmt.specifiers.length-namedStart===1){result.push(space);result.push(generateExpression(stmt.specifiers[namedStart],{precedence:Precedence.Sequence,allowIn:true,allowCall:true}));result.push(space+"}"+space)}else{withIndent(function(indent){var i,iz;result.push(newline);for(i=namedStart,iz=stmt.specifiers.length;i<iz;++i){result.push(indent);result.push(generateExpression(stmt.specifiers[i],{precedence:Precedence.Sequence,allowIn:true,allowCall:true}));if(i+1<iz){result.push(","+newline)}}});if(!endsWithLineTerminator(toSourceNodeWhenNeeded(result).toString())){result.push(newline)}result.push(base+"}"+space)}}result=join(result,["from"+space,generateLiteral(stmt.source),semicolon]);return result}function generateStatement(stmt,option){var i,len,result,allowIn,functionBody,directiveContext,fragment,semicolon,isGenerator,guardedHandlers;allowIn=true;semicolon=";";functionBody=false;directiveContext=false;if(option){allowIn=option.allowIn===undefined||option.allowIn;if(!semicolons&&option.semicolonOptional===true){semicolon=""}functionBody=option.functionBody;directiveContext=option.directiveContext}switch(stmt.type){case Syntax.BlockStatement:result=["{",newline];withIndent(function(){for(i=0,len=stmt.body.length;i<len;++i){fragment=addIndent(generateStatement(stmt.body[i],{semicolonOptional:i===len-1,directiveContext:functionBody}));result.push(fragment);if(!endsWithLineTerminator(toSourceNodeWhenNeeded(fragment).toString())){result.push(newline)}}});result.push(addIndent("}"));break;case Syntax.BreakStatement:if(stmt.label){result="break "+stmt.label.name+semicolon}else{result="break"+semicolon}break;case Syntax.ContinueStatement:if(stmt.label){result="continue "+stmt.label.name+semicolon}else{result="continue"+semicolon}break;case Syntax.ClassBody:result=generateClassBody(stmt);break;case Syntax.ClassDeclaration:result=["class "+stmt.id.name];if(stmt.superClass){fragment=join("extends",generateExpression(stmt.superClass,{precedence:Precedence.Assignment,allowIn:true,allowCall:true}));result=join(result,fragment)}result.push(space);result.push(generateStatement(stmt.body,{semicolonOptional:true,directiveContext:false}));break;case Syntax.DirectiveStatement:if(extra.raw&&stmt.raw){result=stmt.raw+semicolon}else{result=escapeDirective(stmt.directive)+semicolon}break;case Syntax.DoWhileStatement:result=join("do",maybeBlock(stmt.body));result=maybeBlockSuffix(stmt.body,result);result=join(result,["while"+space+"(",generateExpression(stmt.test,{precedence:Precedence.Sequence,allowIn:true,allowCall:true}),")"+semicolon]);break;case Syntax.CatchClause:withIndent(function(){var guard;result=["catch"+space+"(",generateExpression(stmt.param,{precedence:Precedence.Sequence,allowIn:true,allowCall:true}),")"];if(stmt.guard){guard=generateExpression(stmt.guard,{precedence:Precedence.Sequence,allowIn:true,allowCall:true});result.splice(2,0," if ",guard)}});result.push(maybeBlock(stmt.body));break;case Syntax.DebuggerStatement:result="debugger"+semicolon;break;case Syntax.EmptyStatement:result=";";break;case Syntax.ExportDeclaration:result=["export"];if(stmt["default"]){result=join(result,"default");result=join(result,generateExpression(stmt.declaration,{precedence:Precedence.Assignment,allowIn:true,allowCall:true})+semicolon);break}if(stmt.specifiers){if(stmt.specifiers.length===0){result=join(result,"{"+space+"}")}else if(stmt.specifiers[0].type===Syntax.ExportBatchSpecifier){result=join(result,generateExpression(stmt.specifiers[0],{precedence:Precedence.Sequence,allowIn:true,allowCall:true}))}else{result=join(result,"{");withIndent(function(indent){var i,iz;result.push(newline);for(i=0,iz=stmt.specifiers.length;i<iz;++i){result.push(indent);result.push(generateExpression(stmt.specifiers[i],{precedence:Precedence.Sequence,allowIn:true,allowCall:true}));if(i+1<iz){result.push(","+newline)}}});if(!endsWithLineTerminator(toSourceNodeWhenNeeded(result).toString())){result.push(newline)}result.push(base+"}")}if(stmt.source){result=join(result,["from"+space,generateLiteral(stmt.source),semicolon])}else{result.push(semicolon)}break}if(stmt.declaration){result=join(result,generateStatement(stmt.declaration,{semicolonOptional:semicolon===""}))}break;case Syntax.ExpressionStatement:result=[generateExpression(stmt.expression,{precedence:Precedence.Sequence,allowIn:true,allowCall:true})];fragment=toSourceNodeWhenNeeded(result).toString();if(fragment.charAt(0)==="{"||fragment.slice(0,5)==="class"&&" {".indexOf(fragment.charAt(5))>=0||fragment.slice(0,8)==="function"&&"* (".indexOf(fragment.charAt(8))>=0||directive&&directiveContext&&stmt.expression.type===Syntax.Literal&&typeof stmt.expression.value==="string"){result=["(",result,")"+semicolon]}else{result.push(semicolon)}break;case Syntax.ImportDeclaration:result=generateImportDeclaration(stmt,semicolon);break;case Syntax.VariableDeclarator:if(stmt.init){result=[generateExpression(stmt.id,{precedence:Precedence.Assignment,allowIn:allowIn,allowCall:true}),space,"=",space,generateExpression(stmt.init,{precedence:Precedence.Assignment,allowIn:allowIn,allowCall:true})]}else{result=generatePattern(stmt.id,{precedence:Precedence.Assignment,allowIn:allowIn})}break;case Syntax.VariableDeclaration:result=generateVariableDeclaration(stmt,semicolon,allowIn);break;case Syntax.ThrowStatement:result=[join("throw",generateExpression(stmt.argument,{precedence:Precedence.Sequence,allowIn:true,allowCall:true})),semicolon];break;case Syntax.TryStatement:result=["try",maybeBlock(stmt.block)];result=maybeBlockSuffix(stmt.block,result);if(stmt.handlers){for(i=0,len=stmt.handlers.length;i<len;++i){result=join(result,generateStatement(stmt.handlers[i]));if(stmt.finalizer||i+1!==len){result=maybeBlockSuffix(stmt.handlers[i].body,result)}}}else{guardedHandlers=stmt.guardedHandlers||[];for(i=0,len=guardedHandlers.length;i<len;++i){result=join(result,generateStatement(guardedHandlers[i]));if(stmt.finalizer||i+1!==len){result=maybeBlockSuffix(guardedHandlers[i].body,result)}}if(stmt.handler){if(isArray(stmt.handler)){for(i=0,len=stmt.handler.length;i<len;++i){result=join(result,generateStatement(stmt.handler[i]));if(stmt.finalizer||i+1!==len){result=maybeBlockSuffix(stmt.handler[i].body,result)}}}else{result=join(result,generateStatement(stmt.handler));if(stmt.finalizer){result=maybeBlockSuffix(stmt.handler.body,result)}}}}if(stmt.finalizer){result=join(result,["finally",maybeBlock(stmt.finalizer)])}break;case Syntax.SwitchStatement:withIndent(function(){result=["switch"+space+"(",generateExpression(stmt.discriminant,{precedence:Precedence.Sequence,allowIn:true,allowCall:true}),")"+space+"{"+newline]});if(stmt.cases){for(i=0,len=stmt.cases.length;i<len;++i){fragment=addIndent(generateStatement(stmt.cases[i],{semicolonOptional:i===len-1}));result.push(fragment);if(!endsWithLineTerminator(toSourceNodeWhenNeeded(fragment).toString())){result.push(newline)}}}result.push(addIndent("}"));break;case Syntax.SwitchCase:withIndent(function(){if(stmt.test){result=[join("case",generateExpression(stmt.test,{precedence:Precedence.Sequence,allowIn:true,allowCall:true})),":"]}else{result=["default:"]}i=0;len=stmt.consequent.length;if(len&&stmt.consequent[0].type===Syntax.BlockStatement){fragment=maybeBlock(stmt.consequent[0]);result.push(fragment);i=1}if(i!==len&&!endsWithLineTerminator(toSourceNodeWhenNeeded(result).toString())){result.push(newline)}for(;i<len;++i){fragment=addIndent(generateStatement(stmt.consequent[i],{semicolonOptional:i===len-1&&semicolon===""}));result.push(fragment);if(i+1!==len&&!endsWithLineTerminator(toSourceNodeWhenNeeded(fragment).toString())){result.push(newline)}}});break;case Syntax.IfStatement:withIndent(function(){result=["if"+space+"(",generateExpression(stmt.test,{precedence:Precedence.Sequence,allowIn:true,allowCall:true}),")"]});if(stmt.alternate){result.push(maybeBlock(stmt.consequent));result=maybeBlockSuffix(stmt.consequent,result);if(stmt.alternate.type===Syntax.IfStatement){result=join(result,["else ",generateStatement(stmt.alternate,{semicolonOptional:semicolon===""})])}else{result=join(result,join("else",maybeBlock(stmt.alternate,semicolon==="")))}}else{result.push(maybeBlock(stmt.consequent,semicolon===""))}break;case Syntax.ForStatement:withIndent(function(){result=["for"+space+"("];if(stmt.init){if(stmt.init.type===Syntax.VariableDeclaration){result.push(generateStatement(stmt.init,{allowIn:false}))}else{result.push(generateExpression(stmt.init,{precedence:Precedence.Sequence,allowIn:false,allowCall:true}));result.push(";")}}else{result.push(";")}if(stmt.test){result.push(space);result.push(generateExpression(stmt.test,{precedence:Precedence.Sequence,allowIn:true,allowCall:true}));result.push(";")}else{result.push(";")}if(stmt.update){result.push(space);result.push(generateExpression(stmt.update,{precedence:Precedence.Sequence,allowIn:true,allowCall:true}));result.push(")")}else{result.push(")")}});result.push(maybeBlock(stmt.body,semicolon===""));break;case Syntax.ForInStatement:result=generateIterationForStatement("in",stmt,semicolon==="");break;case Syntax.ForOfStatement:result=generateIterationForStatement("of",stmt,semicolon==="");break;case Syntax.LabeledStatement:result=[stmt.label.name+":",maybeBlock(stmt.body,semicolon==="")];break;case Syntax.ModuleDeclaration:result=["module",noEmptySpace(),stmt.id.name,noEmptySpace(),"from",space,generateLiteral(stmt.source),semicolon];break;case Syntax.Program:len=stmt.body.length;result=[safeConcatenation&&len>0?"\n":""];for(i=0;i<len;++i){fragment=addIndent(generateStatement(stmt.body[i],{semicolonOptional:!safeConcatenation&&i===len-1,directiveContext:true}));result.push(fragment);if(i+1<len&&!endsWithLineTerminator(toSourceNodeWhenNeeded(fragment).toString())){result.push(newline)}}break;case Syntax.FunctionDeclaration:isGenerator=stmt.generator&&!extra.moz.starlessGenerator;result=[isGenerator?"function*":"function",isGenerator?space:noEmptySpace(),generateIdentifier(stmt.id),generateFunctionBody(stmt)];break;case Syntax.ReturnStatement:if(stmt.argument){result=[join("return",generateExpression(stmt.argument,{precedence:Precedence.Sequence,allowIn:true,allowCall:true})),semicolon]}else{result=["return"+semicolon]}break;case Syntax.WhileStatement:withIndent(function(){result=["while"+space+"(",generateExpression(stmt.test,{precedence:Precedence.Sequence,allowIn:true,allowCall:true}),")"]});result.push(maybeBlock(stmt.body,semicolon===""));break;case Syntax.WithStatement:withIndent(function(){result=["with"+space+"(",generateExpression(stmt.object,{precedence:Precedence.Sequence,allowIn:true,allowCall:true}),")"]});result.push(maybeBlock(stmt.body,semicolon===""));break;default:throw new Error("Unknown statement type: "+stmt.type)}if(extra.comment){result=addComments(stmt,result)}fragment=toSourceNodeWhenNeeded(result).toString();if(stmt.type===Syntax.Program&&!safeConcatenation&&newline===""&&fragment.charAt(fragment.length-1)==="\n"){result=sourceMap?toSourceNodeWhenNeeded(result).replaceRight(/\s+$/,""):fragment.replace(/\s+$/,"")}return toSourceNodeWhenNeeded(result,stmt)}function generateInternal(node){if(isStatement(node)){return generateStatement(node)}if(isExpression(node)){return generateExpression(node,{precedence:Precedence.Sequence,allowIn:true,allowCall:true})}throw new Error("Unknown node type: "+node.type)}function generate(node,options){var defaultOptions=getDefaultOptions(),result,pair;if(options!=null){if(typeof options.indent==="string"){defaultOptions.format.indent.style=options.indent}if(typeof options.base==="number"){defaultOptions.format.indent.base=options.base}options=updateDeeply(defaultOptions,options);indent=options.format.indent.style;if(typeof options.base==="string"){base=options.base}else{base=stringRepeat(indent,options.format.indent.base)}}else{options=defaultOptions;indent=options.format.indent.style;base=stringRepeat(indent,options.format.indent.base)}json=options.format.json;renumber=options.format.renumber;hexadecimal=json?false:options.format.hexadecimal;quotes=json?"double":options.format.quotes;escapeless=options.format.escapeless;newline=options.format.newline;space=options.format.space;if(options.format.compact){newline=space=indent=base=""}parentheses=options.format.parentheses;semicolons=options.format.semicolons;safeConcatenation=options.format.safeConcatenation;directive=options.directive;parse=json?null:options.parse;sourceMap=options.sourceMap;extra=options;if(sourceMap){if(!exports.browser){SourceNode=require("source-map").SourceNode}else{SourceNode=global.sourceMap.SourceNode}}result=generateInternal(node);if(!sourceMap){pair={code:result.toString(),map:null};return options.sourceMapWithCode?pair:pair.code}pair=result.toStringWithSourceMap({file:options.file,sourceRoot:options.sourceMapRoot});if(options.sourceContent){pair.map.setSourceContent(options.sourceMap,options.sourceContent)}if(options.sourceMapWithCode){return pair}return pair.map.toString()}FORMAT_MINIFY={indent:{style:"",base:0},renumber:true,hexadecimal:true,quotes:"auto",escapeless:true,compact:true,parentheses:false,semicolons:false};FORMAT_DEFAULTS=getDefaultOptions().format;exports.version=require("./package.json").version;exports.generate=generate;exports.attachComments=estraverse.attachComments;exports.Precedence=updateDeeply({},Precedence);exports.browser=false;exports.FORMAT_MINIFY=FORMAT_MINIFY;exports.FORMAT_DEFAULTS=FORMAT_DEFAULTS})()}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"./package.json":147,estraverse:132,esutils:136,"source-map":137}],132:[function(require,module,exports){(function(root,factory){"use strict";if(typeof define==="function"&&define.amd){define(["exports"],factory)}else if(typeof exports!=="undefined"){factory(exports)}else{factory(root.estraverse={})}})(this,function(exports){"use strict";var Syntax,isArray,VisitorOption,VisitorKeys,objectCreate,objectKeys,BREAK,SKIP,REMOVE;function ignoreJSHintError(){}isArray=Array.isArray;if(!isArray){isArray=function isArray(array){return Object.prototype.toString.call(array)==="[object Array]"}}function deepCopy(obj){var ret={},key,val;for(key in obj){if(obj.hasOwnProperty(key)){val=obj[key];if(typeof val==="object"&&val!==null){ret[key]=deepCopy(val)}else{ret[key]=val}}}return ret}function shallowCopy(obj){var ret={},key;for(key in obj){if(obj.hasOwnProperty(key)){ret[key]=obj[key]}}return ret}ignoreJSHintError(shallowCopy);function upperBound(array,func){var diff,len,i,current;len=array.length;i=0;while(len){diff=len>>>1;current=i+diff;if(func(array[current])){len=diff}else{i=current+1;len-=diff+1}}return i}function lowerBound(array,func){var diff,len,i,current;len=array.length;i=0;while(len){diff=len>>>1;current=i+diff;if(func(array[current])){i=current+1;len-=diff+1}else{len=diff}}return i}ignoreJSHintError(lowerBound);objectCreate=Object.create||function(){function F(){}return function(o){F.prototype=o;return new F}}();objectKeys=Object.keys||function(o){var keys=[],key;for(key in o){keys.push(key)}return keys};function extend(to,from){objectKeys(from).forEach(function(key){to[key]=from[key]});return to}Syntax={AssignmentExpression:"AssignmentExpression",ArrayExpression:"ArrayExpression",ArrayPattern:"ArrayPattern",ArrowFunctionExpression:"ArrowFunctionExpression",AwaitExpression:"AwaitExpression",BlockStatement:"BlockStatement",BinaryExpression:"BinaryExpression",BreakStatement:"BreakStatement",CallExpression:"CallExpression",CatchClause:"CatchClause",ClassBody:"ClassBody",ClassDeclaration:"ClassDeclaration",ClassExpression:"ClassExpression",ComprehensionBlock:"ComprehensionBlock",ComprehensionExpression:"ComprehensionExpression",ConditionalExpression:"ConditionalExpression",ContinueStatement:"ContinueStatement",DebuggerStatement:"DebuggerStatement",DirectiveStatement:"DirectiveStatement",DoWhileStatement:"DoWhileStatement",EmptyStatement:"EmptyStatement",ExportBatchSpecifier:"ExportBatchSpecifier",ExportDeclaration:"ExportDeclaration",ExportSpecifier:"ExportSpecifier",ExpressionStatement:"ExpressionStatement",ForStatement:"ForStatement",ForInStatement:"ForInStatement",ForOfStatement:"ForOfStatement",FunctionDeclaration:"FunctionDeclaration",FunctionExpression:"FunctionExpression",GeneratorExpression:"GeneratorExpression",Identifier:"Identifier",IfStatement:"IfStatement",ImportDeclaration:"ImportDeclaration",ImportDefaultSpecifier:"ImportDefaultSpecifier",ImportNamespaceSpecifier:"ImportNamespaceSpecifier",ImportSpecifier:"ImportSpecifier",Literal:"Literal",LabeledStatement:"LabeledStatement",LogicalExpression:"LogicalExpression",MemberExpression:"MemberExpression",MethodDefinition:"MethodDefinition",ModuleSpecifier:"ModuleSpecifier",NewExpression:"NewExpression",ObjectExpression:"ObjectExpression",ObjectPattern:"ObjectPattern",Program:"Program",Property:"Property",ReturnStatement:"ReturnStatement",SequenceExpression:"SequenceExpression",SpreadElement:"SpreadElement",SwitchStatement:"SwitchStatement",SwitchCase:"SwitchCase",TaggedTemplateExpression:"TaggedTemplateExpression",TemplateElement:"TemplateElement",TemplateLiteral:"TemplateLiteral",ThisExpression:"ThisExpression",ThrowStatement:"ThrowStatement",TryStatement:"TryStatement",UnaryExpression:"UnaryExpression",UpdateExpression:"UpdateExpression",VariableDeclaration:"VariableDeclaration",VariableDeclarator:"VariableDeclarator",WhileStatement:"WhileStatement",WithStatement:"WithStatement",YieldExpression:"YieldExpression"};VisitorKeys={AssignmentExpression:["left","right"],ArrayExpression:["elements"],ArrayPattern:["elements"],ArrowFunctionExpression:["params","defaults","rest","body"],AwaitExpression:["argument"],BlockStatement:["body"],BinaryExpression:["left","right"],BreakStatement:["label"],CallExpression:["callee","arguments"],CatchClause:["param","body"],ClassBody:["body"],ClassDeclaration:["id","body","superClass"],ClassExpression:["id","body","superClass"],ComprehensionBlock:["left","right"],ComprehensionExpression:["blocks","filter","body"],ConditionalExpression:["test","consequent","alternate"],ContinueStatement:["label"],DebuggerStatement:[],DirectiveStatement:[],DoWhileStatement:["body","test"],EmptyStatement:[],ExportBatchSpecifier:[],ExportDeclaration:["declaration","specifiers","source"],ExportSpecifier:["id","name"],ExpressionStatement:["expression"],ForStatement:["init","test","update","body"],ForInStatement:["left","right","body"],ForOfStatement:["left","right","body"],FunctionDeclaration:["id","params","defaults","rest","body"],FunctionExpression:["id","params","defaults","rest","body"],GeneratorExpression:["blocks","filter","body"],Identifier:[],IfStatement:["test","consequent","alternate"],ImportDeclaration:["specifiers","source"],ImportDefaultSpecifier:["id"],ImportNamespaceSpecifier:["id"],ImportSpecifier:["id","name"],Literal:[],LabeledStatement:["label","body"],LogicalExpression:["left","right"],MemberExpression:["object","property"],MethodDefinition:["key","value"],ModuleSpecifier:[],NewExpression:["callee","arguments"],ObjectExpression:["properties"],ObjectPattern:["properties"],Program:["body"],Property:["key","value"],ReturnStatement:["argument"],SequenceExpression:["expressions"],SpreadElement:["argument"],SwitchStatement:["discriminant","cases"],SwitchCase:["test","consequent"],TaggedTemplateExpression:["tag","quasi"],TemplateElement:[],TemplateLiteral:["quasis","expressions"],ThisExpression:[],ThrowStatement:["argument"],TryStatement:["block","handlers","handler","guardedHandlers","finalizer"],UnaryExpression:["argument"],UpdateExpression:["argument"],VariableDeclaration:["declarations"],VariableDeclarator:["id","init"],WhileStatement:["test","body"],WithStatement:["object","body"],YieldExpression:["argument"]};BREAK={};SKIP={};REMOVE={};VisitorOption={Break:BREAK,Skip:SKIP,Remove:REMOVE};function Reference(parent,key){this.parent=parent;this.key=key}Reference.prototype.replace=function replace(node){this.parent[this.key]=node};Reference.prototype.remove=function remove(){if(isArray(this.parent)){this.parent.splice(this.key,1);return true}else{this.replace(null);return false}};function Element(node,path,wrap,ref){this.node=node;this.path=path;this.wrap=wrap;this.ref=ref}function Controller(){}Controller.prototype.path=function path(){var i,iz,j,jz,result,element;function addToPath(result,path){if(isArray(path)){for(j=0,jz=path.length;j<jz;++j){result.push(path[j])}}else{result.push(path)}}if(!this.__current.path){return null}result=[];for(i=2,iz=this.__leavelist.length;i<iz;++i){element=this.__leavelist[i];addToPath(result,element.path)}addToPath(result,this.__current.path);return result};Controller.prototype.type=function(){var node=this.current();return node.type||this.__current.wrap};Controller.prototype.parents=function parents(){var i,iz,result;result=[];for(i=1,iz=this.__leavelist.length;i<iz;++i){result.push(this.__leavelist[i].node)}return result};Controller.prototype.current=function current(){return this.__current.node};Controller.prototype.__execute=function __execute(callback,element){var previous,result;result=undefined;previous=this.__current;this.__current=element;this.__state=null;if(callback){result=callback.call(this,element.node,this.__leavelist[this.__leavelist.length-1].node)}this.__current=previous;
return result};Controller.prototype.notify=function notify(flag){this.__state=flag};Controller.prototype.skip=function(){this.notify(SKIP)};Controller.prototype["break"]=function(){this.notify(BREAK)};Controller.prototype.remove=function(){this.notify(REMOVE)};Controller.prototype.__initialize=function(root,visitor){this.visitor=visitor;this.root=root;this.__worklist=[];this.__leavelist=[];this.__current=null;this.__state=null;this.__fallback=visitor.fallback==="iteration";this.__keys=VisitorKeys;if(visitor.keys){this.__keys=extend(objectCreate(this.__keys),visitor.keys)}};function isNode(node){if(node==null){return false}return typeof node==="object"&&typeof node.type==="string"}function isProperty(nodeType,key){return(nodeType===Syntax.ObjectExpression||nodeType===Syntax.ObjectPattern)&&"properties"===key}Controller.prototype.traverse=function traverse(root,visitor){var worklist,leavelist,element,node,nodeType,ret,key,current,current2,candidates,candidate,sentinel;this.__initialize(root,visitor);sentinel={};worklist=this.__worklist;leavelist=this.__leavelist;worklist.push(new Element(root,null,null,null));leavelist.push(new Element(null,null,null,null));while(worklist.length){element=worklist.pop();if(element===sentinel){element=leavelist.pop();ret=this.__execute(visitor.leave,element);if(this.__state===BREAK||ret===BREAK){return}continue}if(element.node){ret=this.__execute(visitor.enter,element);if(this.__state===BREAK||ret===BREAK){return}worklist.push(sentinel);leavelist.push(element);if(this.__state===SKIP||ret===SKIP){continue}node=element.node;nodeType=element.wrap||node.type;candidates=this.__keys[nodeType];if(!candidates){if(this.__fallback){candidates=objectKeys(node)}else{throw new Error("Unknown node type "+nodeType+".")}}current=candidates.length;while((current-=1)>=0){key=candidates[current];candidate=node[key];if(!candidate){continue}if(isArray(candidate)){current2=candidate.length;while((current2-=1)>=0){if(!candidate[current2]){continue}if(isProperty(nodeType,candidates[current])){element=new Element(candidate[current2],[key,current2],"Property",null)}else if(isNode(candidate[current2])){element=new Element(candidate[current2],[key,current2],null,null)}else{continue}worklist.push(element)}}else if(isNode(candidate)){worklist.push(new Element(candidate,key,null,null))}}}}};Controller.prototype.replace=function replace(root,visitor){function removeElem(element){var i,key,nextElem,parent;if(element.ref.remove()){key=element.ref.key;parent=element.ref.parent;i=worklist.length;while(i--){nextElem=worklist[i];if(nextElem.ref&&nextElem.ref.parent===parent){if(nextElem.ref.key<key){break}--nextElem.ref.key}}}}var worklist,leavelist,node,nodeType,target,element,current,current2,candidates,candidate,sentinel,outer,key;this.__initialize(root,visitor);sentinel={};worklist=this.__worklist;leavelist=this.__leavelist;outer={root:root};element=new Element(root,null,null,new Reference(outer,"root"));worklist.push(element);leavelist.push(element);while(worklist.length){element=worklist.pop();if(element===sentinel){element=leavelist.pop();target=this.__execute(visitor.leave,element);if(target!==undefined&&target!==BREAK&&target!==SKIP&&target!==REMOVE){element.ref.replace(target)}if(this.__state===REMOVE||target===REMOVE){removeElem(element)}if(this.__state===BREAK||target===BREAK){return outer.root}continue}target=this.__execute(visitor.enter,element);if(target!==undefined&&target!==BREAK&&target!==SKIP&&target!==REMOVE){element.ref.replace(target);element.node=target}if(this.__state===REMOVE||target===REMOVE){removeElem(element);element.node=null}if(this.__state===BREAK||target===BREAK){return outer.root}node=element.node;if(!node){continue}worklist.push(sentinel);leavelist.push(element);if(this.__state===SKIP||target===SKIP){continue}nodeType=element.wrap||node.type;candidates=this.__keys[nodeType];if(!candidates){if(this.__fallback){candidates=objectKeys(node)}else{throw new Error("Unknown node type "+nodeType+".")}}current=candidates.length;while((current-=1)>=0){key=candidates[current];candidate=node[key];if(!candidate){continue}if(isArray(candidate)){current2=candidate.length;while((current2-=1)>=0){if(!candidate[current2]){continue}if(isProperty(nodeType,candidates[current])){element=new Element(candidate[current2],[key,current2],"Property",new Reference(candidate,current2))}else if(isNode(candidate[current2])){element=new Element(candidate[current2],[key,current2],null,new Reference(candidate,current2))}else{continue}worklist.push(element)}}else if(isNode(candidate)){worklist.push(new Element(candidate,key,null,new Reference(node,key)))}}}return outer.root};function traverse(root,visitor){var controller=new Controller;return controller.traverse(root,visitor)}function replace(root,visitor){var controller=new Controller;return controller.replace(root,visitor)}function extendCommentRange(comment,tokens){var target;target=upperBound(tokens,function search(token){return token.range[0]>comment.range[0]});comment.extendedRange=[comment.range[0],comment.range[1]];if(target!==tokens.length){comment.extendedRange[1]=tokens[target].range[0]}target-=1;if(target>=0){comment.extendedRange[0]=tokens[target].range[1]}return comment}function attachComments(tree,providedComments,tokens){var comments=[],comment,len,i,cursor;if(!tree.range){throw new Error("attachComments needs range information")}if(!tokens.length){if(providedComments.length){for(i=0,len=providedComments.length;i<len;i+=1){comment=deepCopy(providedComments[i]);comment.extendedRange=[0,tree.range[0]];comments.push(comment)}tree.leadingComments=comments}return tree}for(i=0,len=providedComments.length;i<len;i+=1){comments.push(extendCommentRange(deepCopy(providedComments[i]),tokens))}cursor=0;traverse(tree,{enter:function(node){var comment;while(cursor<comments.length){comment=comments[cursor];if(comment.extendedRange[1]>node.range[0]){break}if(comment.extendedRange[1]===node.range[0]){if(!node.leadingComments){node.leadingComments=[]}node.leadingComments.push(comment);comments.splice(cursor,1)}else{cursor+=1}}if(cursor===comments.length){return VisitorOption.Break}if(comments[cursor].extendedRange[0]>node.range[1]){return VisitorOption.Skip}}});cursor=0;traverse(tree,{leave:function(node){var comment;while(cursor<comments.length){comment=comments[cursor];if(node.range[1]<comment.extendedRange[0]){break}if(node.range[1]===comment.extendedRange[0]){if(!node.trailingComments){node.trailingComments=[]}node.trailingComments.push(comment);comments.splice(cursor,1)}else{cursor+=1}}if(cursor===comments.length){return VisitorOption.Break}if(comments[cursor].extendedRange[0]>node.range[1]){return VisitorOption.Skip}}});return tree}exports.version="1.8.1-dev";exports.Syntax=Syntax;exports.traverse=traverse;exports.replace=replace;exports.attachComments=attachComments;exports.VisitorKeys=VisitorKeys;exports.VisitorOption=VisitorOption;exports.Controller=Controller})},{}],133:[function(require,module,exports){(function(){"use strict";function isExpression(node){if(node==null){return false}switch(node.type){case"ArrayExpression":case"AssignmentExpression":case"BinaryExpression":case"CallExpression":case"ConditionalExpression":case"FunctionExpression":case"Identifier":case"Literal":case"LogicalExpression":case"MemberExpression":case"NewExpression":case"ObjectExpression":case"SequenceExpression":case"ThisExpression":case"UnaryExpression":case"UpdateExpression":return true}return false}function isIterationStatement(node){if(node==null){return false}switch(node.type){case"DoWhileStatement":case"ForInStatement":case"ForStatement":case"WhileStatement":return true}return false}function isStatement(node){if(node==null){return false}switch(node.type){case"BlockStatement":case"BreakStatement":case"ContinueStatement":case"DebuggerStatement":case"DoWhileStatement":case"EmptyStatement":case"ExpressionStatement":case"ForInStatement":case"ForStatement":case"IfStatement":case"LabeledStatement":case"ReturnStatement":case"SwitchStatement":case"ThrowStatement":case"TryStatement":case"VariableDeclaration":case"WhileStatement":case"WithStatement":return true}return false}function isSourceElement(node){return isStatement(node)||node!=null&&node.type==="FunctionDeclaration"}function trailingStatement(node){switch(node.type){case"IfStatement":if(node.alternate!=null){return node.alternate}return node.consequent;case"LabeledStatement":case"ForStatement":case"ForInStatement":case"WhileStatement":case"WithStatement":return node.body}return null}function isProblematicIfStatement(node){var current;if(node.type!=="IfStatement"){return false}if(node.alternate==null){return false}current=node.consequent;do{if(current.type==="IfStatement"){if(current.alternate==null){return true}}current=trailingStatement(current)}while(current);return false}module.exports={isExpression:isExpression,isStatement:isStatement,isIterationStatement:isIterationStatement,isSourceElement:isSourceElement,isProblematicIfStatement:isProblematicIfStatement,trailingStatement:trailingStatement}})()},{}],134:[function(require,module,exports){(function(){"use strict";var Regex,NON_ASCII_WHITESPACES;Regex={NonAsciiIdentifierStart:new RegExp("[------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------]"),NonAsciiIdentifierPart:new RegExp("[------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------]")};function isDecimalDigit(ch){return ch>=48&&ch<=57}function isHexDigit(ch){return isDecimalDigit(ch)||97<=ch&&ch<=102||65<=ch&&ch<=70}function isOctalDigit(ch){return ch>=48&&ch<=55}NON_ASCII_WHITESPACES=[5760,6158,8192,8193,8194,8195,8196,8197,8198,8199,8200,8201,8202,8239,8287,12288,65279];function isWhiteSpace(ch){return ch===32||ch===9||ch===11||ch===12||ch===160||ch>=5760&&NON_ASCII_WHITESPACES.indexOf(ch)>=0}function isLineTerminator(ch){return ch===10||ch===13||ch===8232||ch===8233}function isIdentifierStart(ch){return ch>=97&&ch<=122||ch>=65&&ch<=90||ch===36||ch===95||ch===92||ch>=128&&Regex.NonAsciiIdentifierStart.test(String.fromCharCode(ch))}function isIdentifierPart(ch){return ch>=97&&ch<=122||ch>=65&&ch<=90||ch>=48&&ch<=57||ch===36||ch===95||ch===92||ch>=128&&Regex.NonAsciiIdentifierPart.test(String.fromCharCode(ch))}module.exports={isDecimalDigit:isDecimalDigit,isHexDigit:isHexDigit,isOctalDigit:isOctalDigit,isWhiteSpace:isWhiteSpace,isLineTerminator:isLineTerminator,isIdentifierStart:isIdentifierStart,isIdentifierPart:isIdentifierPart}})()},{}],135:[function(require,module,exports){(function(){"use strict";var code=require("./code");function isStrictModeReservedWordES6(id){switch(id){case"implements":case"interface":case"package":case"private":case"protected":case"public":case"static":case"let":return true;default:return false}}function isKeywordES5(id,strict){if(!strict&&id==="yield"){return false}return isKeywordES6(id,strict)}function isKeywordES6(id,strict){if(strict&&isStrictModeReservedWordES6(id)){return true}switch(id.length){case 2:return id==="if"||id==="in"||id==="do";case 3:return id==="var"||id==="for"||id==="new"||id==="try";case 4:return id==="this"||id==="else"||id==="case"||id==="void"||id==="with"||id==="enum";case 5:return id==="while"||id==="break"||id==="catch"||id==="throw"||id==="const"||id==="yield"||id==="class"||id==="super";case 6:return id==="return"||id==="typeof"||id==="delete"||id==="switch"||id==="export"||id==="import";case 7:return id==="default"||id==="finally"||id==="extends";case 8:return id==="function"||id==="continue"||id==="debugger";case 10:return id==="instanceof";default:return false}}function isReservedWordES5(id,strict){return id==="null"||id==="true"||id==="false"||isKeywordES5(id,strict)}function isReservedWordES6(id,strict){return id==="null"||id==="true"||id==="false"||isKeywordES6(id,strict)}function isRestrictedWord(id){return id==="eval"||id==="arguments"}function isIdentifierName(id){var i,iz,ch;if(id.length===0){return false}ch=id.charCodeAt(0);if(!code.isIdentifierStart(ch)||ch===92){return false}for(i=1,iz=id.length;i<iz;++i){ch=id.charCodeAt(i);if(!code.isIdentifierPart(ch)||ch===92){return false}}return true}function isIdentifierES5(id,strict){return isIdentifierName(id)&&!isReservedWordES5(id,strict)}function isIdentifierES6(id,strict){return isIdentifierName(id)&&!isReservedWordES6(id,strict)}module.exports={isKeywordES5:isKeywordES5,isKeywordES6:isKeywordES6,isReservedWordES5:isReservedWordES5,isReservedWordES6:isReservedWordES6,isRestrictedWord:isRestrictedWord,isIdentifierName:isIdentifierName,isIdentifierES5:isIdentifierES5,isIdentifierES6:isIdentifierES6}})()},{"./code":134}],136:[function(require,module,exports){(function(){"use strict";exports.ast=require("./ast");exports.code=require("./code");exports.keyword=require("./keyword")})()},{"./ast":133,"./code":134,"./keyword":135}],137:[function(require,module,exports){exports.SourceMapGenerator=require("./source-map/source-map-generator").SourceMapGenerator;exports.SourceMapConsumer=require("./source-map/source-map-consumer").SourceMapConsumer;exports.SourceNode=require("./source-map/source-node").SourceNode},{"./source-map/source-map-consumer":142,"./source-map/source-map-generator":143,"./source-map/source-node":144}],138:[function(require,module,exports){if(typeof define!=="function"){var define=require("amdefine")(module,require)}define(function(require,exports,module){var util=require("./util");function ArraySet(){this._array=[];this._set={}}ArraySet.fromArray=function ArraySet_fromArray(aArray,aAllowDuplicates){var set=new ArraySet;for(var i=0,len=aArray.length;i<len;i++){set.add(aArray[i],aAllowDuplicates)}return set};ArraySet.prototype.add=function ArraySet_add(aStr,aAllowDuplicates){var isDuplicate=this.has(aStr);var idx=this._array.length;if(!isDuplicate||aAllowDuplicates){this._array.push(aStr)}if(!isDuplicate){this._set[util.toSetString(aStr)]=idx}};ArraySet.prototype.has=function ArraySet_has(aStr){return Object.prototype.hasOwnProperty.call(this._set,util.toSetString(aStr))};ArraySet.prototype.indexOf=function ArraySet_indexOf(aStr){if(this.has(aStr)){return this._set[util.toSetString(aStr)]}throw new Error('"'+aStr+'" is not in the set.')};ArraySet.prototype.at=function ArraySet_at(aIdx){if(aIdx>=0&&aIdx<this._array.length){return this._array[aIdx]}throw new Error("No element indexed by "+aIdx)};ArraySet.prototype.toArray=function ArraySet_toArray(){return this._array.slice()};exports.ArraySet=ArraySet})},{"./util":145,amdefine:146}],139:[function(require,module,exports){if(typeof define!=="function"){var define=require("amdefine")(module,require)}define(function(require,exports,module){var base64=require("./base64");var VLQ_BASE_SHIFT=5;var VLQ_BASE=1<<VLQ_BASE_SHIFT;var VLQ_BASE_MASK=VLQ_BASE-1;var VLQ_CONTINUATION_BIT=VLQ_BASE;function toVLQSigned(aValue){return aValue<0?(-aValue<<1)+1:(aValue<<1)+0}function fromVLQSigned(aValue){var isNegative=(aValue&1)===1;var shifted=aValue>>1;return isNegative?-shifted:shifted}exports.encode=function base64VLQ_encode(aValue){var encoded="";var digit;var vlq=toVLQSigned(aValue);do{digit=vlq&VLQ_BASE_MASK;vlq>>>=VLQ_BASE_SHIFT;if(vlq>0){digit|=VLQ_CONTINUATION_BIT}encoded+=base64.encode(digit)}while(vlq>0);return encoded};exports.decode=function base64VLQ_decode(aStr,aOutParam){var i=0;var strLen=aStr.length;var result=0;var shift=0;var continuation,digit;do{if(i>=strLen){throw new Error("Expected more digits in base 64 VLQ value.")}digit=base64.decode(aStr.charAt(i++));continuation=!!(digit&VLQ_CONTINUATION_BIT);digit&=VLQ_BASE_MASK;result=result+(digit<<shift);shift+=VLQ_BASE_SHIFT}while(continuation);aOutParam.value=fromVLQSigned(result);aOutParam.rest=aStr.slice(i)}})},{"./base64":140,amdefine:146}],140:[function(require,module,exports){if(typeof define!=="function"){var define=require("amdefine")(module,require)}define(function(require,exports,module){var charToIntMap={};var intToCharMap={};"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split("").forEach(function(ch,index){charToIntMap[ch]=index;intToCharMap[index]=ch});exports.encode=function base64_encode(aNumber){if(aNumber in intToCharMap){return intToCharMap[aNumber]}throw new TypeError("Must be between 0 and 63: "+aNumber)};exports.decode=function base64_decode(aChar){if(aChar in charToIntMap){return charToIntMap[aChar]}throw new TypeError("Not a valid base 64 digit: "+aChar)}})},{amdefine:146}],141:[function(require,module,exports){if(typeof define!=="function"){var define=require("amdefine")(module,require)}define(function(require,exports,module){function recursiveSearch(aLow,aHigh,aNeedle,aHaystack,aCompare){var mid=Math.floor((aHigh-aLow)/2)+aLow;var cmp=aCompare(aNeedle,aHaystack[mid],true);if(cmp===0){return aHaystack[mid]}else if(cmp>0){if(aHigh-mid>1){return recursiveSearch(mid,aHigh,aNeedle,aHaystack,aCompare)}return aHaystack[mid]}else{if(mid-aLow>1){return recursiveSearch(aLow,mid,aNeedle,aHaystack,aCompare)}return aLow<0?null:aHaystack[aLow]}}exports.search=function search(aNeedle,aHaystack,aCompare){return aHaystack.length>0?recursiveSearch(-1,aHaystack.length,aNeedle,aHaystack,aCompare):null}})},{amdefine:146}],142:[function(require,module,exports){if(typeof define!=="function"){var define=require("amdefine")(module,require)}define(function(require,exports,module){var util=require("./util");var binarySearch=require("./binary-search");var ArraySet=require("./array-set").ArraySet;var base64VLQ=require("./base64-vlq");function SourceMapConsumer(aSourceMap){var sourceMap=aSourceMap;if(typeof aSourceMap==="string"){sourceMap=JSON.parse(aSourceMap.replace(/^\)\]\}'/,""))}var version=util.getArg(sourceMap,"version");var sources=util.getArg(sourceMap,"sources");var names=util.getArg(sourceMap,"names",[]);var sourceRoot=util.getArg(sourceMap,"sourceRoot",null);var sourcesContent=util.getArg(sourceMap,"sourcesContent",null);var mappings=util.getArg(sourceMap,"mappings");var file=util.getArg(sourceMap,"file",null);if(version!=this._version){throw new Error("Unsupported version: "+version)}this._names=ArraySet.fromArray(names,true);this._sources=ArraySet.fromArray(sources,true);this.sourceRoot=sourceRoot;this.sourcesContent=sourcesContent;this._mappings=mappings;this.file=file}SourceMapConsumer.fromSourceMap=function SourceMapConsumer_fromSourceMap(aSourceMap){var smc=Object.create(SourceMapConsumer.prototype);smc._names=ArraySet.fromArray(aSourceMap._names.toArray(),true);smc._sources=ArraySet.fromArray(aSourceMap._sources.toArray(),true);smc.sourceRoot=aSourceMap._sourceRoot;smc.sourcesContent=aSourceMap._generateSourcesContent(smc._sources.toArray(),smc.sourceRoot);smc.file=aSourceMap._file;smc.__generatedMappings=aSourceMap._mappings.slice().sort(util.compareByGeneratedPositions);smc.__originalMappings=aSourceMap._mappings.slice().sort(util.compareByOriginalPositions);return smc};SourceMapConsumer.prototype._version=3;Object.defineProperty(SourceMapConsumer.prototype,"sources",{get:function(){return this._sources.toArray().map(function(s){return this.sourceRoot!=null?util.join(this.sourceRoot,s):s},this)}});SourceMapConsumer.prototype.__generatedMappings=null;Object.defineProperty(SourceMapConsumer.prototype,"_generatedMappings",{get:function(){if(!this.__generatedMappings){this.__generatedMappings=[];this.__originalMappings=[];this._parseMappings(this._mappings,this.sourceRoot)}return this.__generatedMappings}});SourceMapConsumer.prototype.__originalMappings=null;Object.defineProperty(SourceMapConsumer.prototype,"_originalMappings",{get:function(){if(!this.__originalMappings){this.__generatedMappings=[];this.__originalMappings=[];this._parseMappings(this._mappings,this.sourceRoot)}return this.__originalMappings}});SourceMapConsumer.prototype._nextCharIsMappingSeparator=function SourceMapConsumer_nextCharIsMappingSeparator(aStr){var c=aStr.charAt(0);return c===";"||c===","};SourceMapConsumer.prototype._parseMappings=function SourceMapConsumer_parseMappings(aStr,aSourceRoot){var generatedLine=1;var previousGeneratedColumn=0;var previousOriginalLine=0;var previousOriginalColumn=0;var previousSource=0;var previousName=0;var str=aStr;var temp={};var mapping;while(str.length>0){if(str.charAt(0)===";"){generatedLine++;str=str.slice(1);previousGeneratedColumn=0}else if(str.charAt(0)===","){str=str.slice(1)}else{mapping={};mapping.generatedLine=generatedLine;base64VLQ.decode(str,temp);mapping.generatedColumn=previousGeneratedColumn+temp.value;previousGeneratedColumn=mapping.generatedColumn;str=temp.rest;if(str.length>0&&!this._nextCharIsMappingSeparator(str)){base64VLQ.decode(str,temp);mapping.source=this._sources.at(previousSource+temp.value);previousSource+=temp.value;str=temp.rest;if(str.length===0||this._nextCharIsMappingSeparator(str)){throw new Error("Found a source, but no line and column")}base64VLQ.decode(str,temp);mapping.originalLine=previousOriginalLine+temp.value;previousOriginalLine=mapping.originalLine;mapping.originalLine+=1;str=temp.rest;if(str.length===0||this._nextCharIsMappingSeparator(str)){throw new Error("Found a source and line, but no column")}base64VLQ.decode(str,temp);mapping.originalColumn=previousOriginalColumn+temp.value;previousOriginalColumn=mapping.originalColumn;str=temp.rest;if(str.length>0&&!this._nextCharIsMappingSeparator(str)){base64VLQ.decode(str,temp);mapping.name=this._names.at(previousName+temp.value);previousName+=temp.value;str=temp.rest}}this.__generatedMappings.push(mapping);if(typeof mapping.originalLine==="number"){this.__originalMappings.push(mapping)}}}this.__generatedMappings.sort(util.compareByGeneratedPositions);this.__originalMappings.sort(util.compareByOriginalPositions)};SourceMapConsumer.prototype._findMapping=function SourceMapConsumer_findMapping(aNeedle,aMappings,aLineName,aColumnName,aComparator){if(aNeedle[aLineName]<=0){throw new TypeError("Line must be greater than or equal to 1, got "+aNeedle[aLineName])}if(aNeedle[aColumnName]<0){throw new TypeError("Column must be greater than or equal to 0, got "+aNeedle[aColumnName])}return binarySearch.search(aNeedle,aMappings,aComparator)};SourceMapConsumer.prototype.originalPositionFor=function SourceMapConsumer_originalPositionFor(aArgs){var needle={generatedLine:util.getArg(aArgs,"line"),generatedColumn:util.getArg(aArgs,"column")};var mapping=this._findMapping(needle,this._generatedMappings,"generatedLine","generatedColumn",util.compareByGeneratedPositions);if(mapping&&mapping.generatedLine===needle.generatedLine){var source=util.getArg(mapping,"source",null);if(source!=null&&this.sourceRoot!=null){source=util.join(this.sourceRoot,source)}return{source:source,line:util.getArg(mapping,"originalLine",null),column:util.getArg(mapping,"originalColumn",null),name:util.getArg(mapping,"name",null)}}return{source:null,line:null,column:null,name:null}};SourceMapConsumer.prototype.sourceContentFor=function SourceMapConsumer_sourceContentFor(aSource){if(!this.sourcesContent){return null}if(this.sourceRoot!=null){aSource=util.relative(this.sourceRoot,aSource)}if(this._sources.has(aSource)){return this.sourcesContent[this._sources.indexOf(aSource)]}var url;if(this.sourceRoot!=null&&(url=util.urlParse(this.sourceRoot))){var fileUriAbsPath=aSource.replace(/^file:\/\//,"");if(url.scheme=="file"&&this._sources.has(fileUriAbsPath)){return this.sourcesContent[this._sources.indexOf(fileUriAbsPath)]}if((!url.path||url.path=="/")&&this._sources.has("/"+aSource)){return this.sourcesContent[this._sources.indexOf("/"+aSource)]}}throw new Error('"'+aSource+'" is not in the SourceMap.')};SourceMapConsumer.prototype.generatedPositionFor=function SourceMapConsumer_generatedPositionFor(aArgs){var needle={source:util.getArg(aArgs,"source"),originalLine:util.getArg(aArgs,"line"),originalColumn:util.getArg(aArgs,"column")};if(this.sourceRoot!=null){needle.source=util.relative(this.sourceRoot,needle.source)}var mapping=this._findMapping(needle,this._originalMappings,"originalLine","originalColumn",util.compareByOriginalPositions);if(mapping){return{line:util.getArg(mapping,"generatedLine",null),column:util.getArg(mapping,"generatedColumn",null)}}return{line:null,column:null}};SourceMapConsumer.GENERATED_ORDER=1;SourceMapConsumer.ORIGINAL_ORDER=2;SourceMapConsumer.prototype.eachMapping=function SourceMapConsumer_eachMapping(aCallback,aContext,aOrder){var context=aContext||null;var order=aOrder||SourceMapConsumer.GENERATED_ORDER;var mappings;switch(order){case SourceMapConsumer.GENERATED_ORDER:mappings=this._generatedMappings;break;case SourceMapConsumer.ORIGINAL_ORDER:mappings=this._originalMappings;break;default:throw new Error("Unknown order of iteration.")}var sourceRoot=this.sourceRoot;mappings.map(function(mapping){var source=mapping.source;if(source!=null&&sourceRoot!=null){source=util.join(sourceRoot,source)}return{source:source,generatedLine:mapping.generatedLine,generatedColumn:mapping.generatedColumn,originalLine:mapping.originalLine,originalColumn:mapping.originalColumn,name:mapping.name}}).forEach(aCallback,context)};exports.SourceMapConsumer=SourceMapConsumer})},{"./array-set":138,"./base64-vlq":139,"./binary-search":141,"./util":145,amdefine:146}],143:[function(require,module,exports){if(typeof define!=="function"){var define=require("amdefine")(module,require)}define(function(require,exports,module){var base64VLQ=require("./base64-vlq");var util=require("./util");var ArraySet=require("./array-set").ArraySet;function SourceMapGenerator(aArgs){if(!aArgs){aArgs={}}this._file=util.getArg(aArgs,"file",null);this._sourceRoot=util.getArg(aArgs,"sourceRoot",null);this._sources=new ArraySet;this._names=new ArraySet;this._mappings=[];this._sourcesContents=null}SourceMapGenerator.prototype._version=3;SourceMapGenerator.fromSourceMap=function SourceMapGenerator_fromSourceMap(aSourceMapConsumer){var sourceRoot=aSourceMapConsumer.sourceRoot;var generator=new SourceMapGenerator({file:aSourceMapConsumer.file,sourceRoot:sourceRoot});aSourceMapConsumer.eachMapping(function(mapping){var newMapping={generated:{line:mapping.generatedLine,column:mapping.generatedColumn}};if(mapping.source!=null){newMapping.source=mapping.source;if(sourceRoot!=null){newMapping.source=util.relative(sourceRoot,newMapping.source)}newMapping.original={line:mapping.originalLine,column:mapping.originalColumn};if(mapping.name!=null){newMapping.name=mapping.name}}generator.addMapping(newMapping)});aSourceMapConsumer.sources.forEach(function(sourceFile){var content=aSourceMapConsumer.sourceContentFor(sourceFile);if(content!=null){generator.setSourceContent(sourceFile,content)}});return generator};SourceMapGenerator.prototype.addMapping=function SourceMapGenerator_addMapping(aArgs){var generated=util.getArg(aArgs,"generated");var original=util.getArg(aArgs,"original",null);var source=util.getArg(aArgs,"source",null);var name=util.getArg(aArgs,"name",null);this._validateMapping(generated,original,source,name);if(source!=null&&!this._sources.has(source)){this._sources.add(source)}if(name!=null&&!this._names.has(name)){this._names.add(name)}this._mappings.push({generatedLine:generated.line,generatedColumn:generated.column,originalLine:original!=null&&original.line,originalColumn:original!=null&&original.column,source:source,name:name})};SourceMapGenerator.prototype.setSourceContent=function SourceMapGenerator_setSourceContent(aSourceFile,aSourceContent){var source=aSourceFile;if(this._sourceRoot!=null){source=util.relative(this._sourceRoot,source)}if(aSourceContent!=null){if(!this._sourcesContents){this._sourcesContents={}}this._sourcesContents[util.toSetString(source)]=aSourceContent}else if(this._sourcesContents){delete this._sourcesContents[util.toSetString(source)];if(Object.keys(this._sourcesContents).length===0){this._sourcesContents=null}}};SourceMapGenerator.prototype.applySourceMap=function SourceMapGenerator_applySourceMap(aSourceMapConsumer,aSourceFile,aSourceMapPath){var sourceFile=aSourceFile;if(aSourceFile==null){if(aSourceMapConsumer.file==null){throw new Error("SourceMapGenerator.prototype.applySourceMap requires either an explicit source file, "+'or the source map\'s "file" property. Both were omitted.')}sourceFile=aSourceMapConsumer.file}var sourceRoot=this._sourceRoot;if(sourceRoot!=null){sourceFile=util.relative(sourceRoot,sourceFile)}var newSources=new ArraySet;var newNames=new ArraySet;this._mappings.forEach(function(mapping){if(mapping.source===sourceFile&&mapping.originalLine!=null){var original=aSourceMapConsumer.originalPositionFor({line:mapping.originalLine,column:mapping.originalColumn});if(original.source!=null){mapping.source=original.source;if(aSourceMapPath!=null){mapping.source=util.join(aSourceMapPath,mapping.source)}if(sourceRoot!=null){mapping.source=util.relative(sourceRoot,mapping.source)}mapping.originalLine=original.line;mapping.originalColumn=original.column;if(original.name!=null){mapping.name=original.name}}}var source=mapping.source;if(source!=null&&!newSources.has(source)){newSources.add(source)}var name=mapping.name;if(name!=null&&!newNames.has(name)){newNames.add(name)}},this);this._sources=newSources;this._names=newNames;aSourceMapConsumer.sources.forEach(function(sourceFile){var content=aSourceMapConsumer.sourceContentFor(sourceFile);if(content!=null){if(aSourceMapPath!=null){sourceFile=util.join(aSourceMapPath,sourceFile)}if(sourceRoot!=null){sourceFile=util.relative(sourceRoot,sourceFile)}this.setSourceContent(sourceFile,content)}},this)};SourceMapGenerator.prototype._validateMapping=function SourceMapGenerator_validateMapping(aGenerated,aOriginal,aSource,aName){if(aGenerated&&"line"in aGenerated&&"column"in aGenerated&&aGenerated.line>0&&aGenerated.column>=0&&!aOriginal&&!aSource&&!aName){return}else if(aGenerated&&"line"in aGenerated&&"column"in aGenerated&&aOriginal&&"line"in aOriginal&&"column"in aOriginal&&aGenerated.line>0&&aGenerated.column>=0&&aOriginal.line>0&&aOriginal.column>=0&&aSource){return}else{throw new Error("Invalid mapping: "+JSON.stringify({generated:aGenerated,source:aSource,original:aOriginal,name:aName}))}};SourceMapGenerator.prototype._serializeMappings=function SourceMapGenerator_serializeMappings(){var previousGeneratedColumn=0;var previousGeneratedLine=1;var previousOriginalColumn=0;
var previousOriginalLine=0;var previousName=0;var previousSource=0;var result="";var mapping;this._mappings.sort(util.compareByGeneratedPositions);for(var i=0,len=this._mappings.length;i<len;i++){mapping=this._mappings[i];if(mapping.generatedLine!==previousGeneratedLine){previousGeneratedColumn=0;while(mapping.generatedLine!==previousGeneratedLine){result+=";";previousGeneratedLine++}}else{if(i>0){if(!util.compareByGeneratedPositions(mapping,this._mappings[i-1])){continue}result+=","}}result+=base64VLQ.encode(mapping.generatedColumn-previousGeneratedColumn);previousGeneratedColumn=mapping.generatedColumn;if(mapping.source!=null){result+=base64VLQ.encode(this._sources.indexOf(mapping.source)-previousSource);previousSource=this._sources.indexOf(mapping.source);result+=base64VLQ.encode(mapping.originalLine-1-previousOriginalLine);previousOriginalLine=mapping.originalLine-1;result+=base64VLQ.encode(mapping.originalColumn-previousOriginalColumn);previousOriginalColumn=mapping.originalColumn;if(mapping.name!=null){result+=base64VLQ.encode(this._names.indexOf(mapping.name)-previousName);previousName=this._names.indexOf(mapping.name)}}}return result};SourceMapGenerator.prototype._generateSourcesContent=function SourceMapGenerator_generateSourcesContent(aSources,aSourceRoot){return aSources.map(function(source){if(!this._sourcesContents){return null}if(aSourceRoot!=null){source=util.relative(aSourceRoot,source)}var key=util.toSetString(source);return Object.prototype.hasOwnProperty.call(this._sourcesContents,key)?this._sourcesContents[key]:null},this)};SourceMapGenerator.prototype.toJSON=function SourceMapGenerator_toJSON(){var map={version:this._version,sources:this._sources.toArray(),names:this._names.toArray(),mappings:this._serializeMappings()};if(this._file!=null){map.file=this._file}if(this._sourceRoot!=null){map.sourceRoot=this._sourceRoot}if(this._sourcesContents){map.sourcesContent=this._generateSourcesContent(map.sources,map.sourceRoot)}return map};SourceMapGenerator.prototype.toString=function SourceMapGenerator_toString(){return JSON.stringify(this)};exports.SourceMapGenerator=SourceMapGenerator})},{"./array-set":138,"./base64-vlq":139,"./util":145,amdefine:146}],144:[function(require,module,exports){if(typeof define!=="function"){var define=require("amdefine")(module,require)}define(function(require,exports,module){var SourceMapGenerator=require("./source-map-generator").SourceMapGenerator;var util=require("./util");var REGEX_NEWLINE=/(\r?\n)/;var REGEX_CHARACTER=/\r\n|[\s\S]/g;function SourceNode(aLine,aColumn,aSource,aChunks,aName){this.children=[];this.sourceContents={};this.line=aLine==null?null:aLine;this.column=aColumn==null?null:aColumn;this.source=aSource==null?null:aSource;this.name=aName==null?null:aName;if(aChunks!=null)this.add(aChunks)}SourceNode.fromStringWithSourceMap=function SourceNode_fromStringWithSourceMap(aGeneratedCode,aSourceMapConsumer,aRelativePath){var node=new SourceNode;var remainingLines=aGeneratedCode.split(REGEX_NEWLINE);var shiftNextLine=function(){var lineContents=remainingLines.shift();var newLine=remainingLines.shift()||"";return lineContents+newLine};var lastGeneratedLine=1,lastGeneratedColumn=0;var lastMapping=null;aSourceMapConsumer.eachMapping(function(mapping){if(lastMapping!==null){if(lastGeneratedLine<mapping.generatedLine){var code="";addMappingWithCode(lastMapping,shiftNextLine());lastGeneratedLine++;lastGeneratedColumn=0}else{var nextLine=remainingLines[0];var code=nextLine.substr(0,mapping.generatedColumn-lastGeneratedColumn);remainingLines[0]=nextLine.substr(mapping.generatedColumn-lastGeneratedColumn);lastGeneratedColumn=mapping.generatedColumn;addMappingWithCode(lastMapping,code);lastMapping=mapping;return}}while(lastGeneratedLine<mapping.generatedLine){node.add(shiftNextLine());lastGeneratedLine++}if(lastGeneratedColumn<mapping.generatedColumn){var nextLine=remainingLines[0];node.add(nextLine.substr(0,mapping.generatedColumn));remainingLines[0]=nextLine.substr(mapping.generatedColumn);lastGeneratedColumn=mapping.generatedColumn}lastMapping=mapping},this);if(remainingLines.length>0){if(lastMapping){addMappingWithCode(lastMapping,shiftNextLine())}node.add(remainingLines.join(""))}aSourceMapConsumer.sources.forEach(function(sourceFile){var content=aSourceMapConsumer.sourceContentFor(sourceFile);if(content!=null){if(aRelativePath!=null){sourceFile=util.join(aRelativePath,sourceFile)}node.setSourceContent(sourceFile,content)}});return node;function addMappingWithCode(mapping,code){if(mapping===null||mapping.source===undefined){node.add(code)}else{var source=aRelativePath?util.join(aRelativePath,mapping.source):mapping.source;node.add(new SourceNode(mapping.originalLine,mapping.originalColumn,source,code,mapping.name))}}};SourceNode.prototype.add=function SourceNode_add(aChunk){if(Array.isArray(aChunk)){aChunk.forEach(function(chunk){this.add(chunk)},this)}else if(aChunk instanceof SourceNode||typeof aChunk==="string"){if(aChunk){this.children.push(aChunk)}}else{throw new TypeError("Expected a SourceNode, string, or an array of SourceNodes and strings. Got "+aChunk)}return this};SourceNode.prototype.prepend=function SourceNode_prepend(aChunk){if(Array.isArray(aChunk)){for(var i=aChunk.length-1;i>=0;i--){this.prepend(aChunk[i])}}else if(aChunk instanceof SourceNode||typeof aChunk==="string"){this.children.unshift(aChunk)}else{throw new TypeError("Expected a SourceNode, string, or an array of SourceNodes and strings. Got "+aChunk)}return this};SourceNode.prototype.walk=function SourceNode_walk(aFn){var chunk;for(var i=0,len=this.children.length;i<len;i++){chunk=this.children[i];if(chunk instanceof SourceNode){chunk.walk(aFn)}else{if(chunk!==""){aFn(chunk,{source:this.source,line:this.line,column:this.column,name:this.name})}}}};SourceNode.prototype.join=function SourceNode_join(aSep){var newChildren;var i;var len=this.children.length;if(len>0){newChildren=[];for(i=0;i<len-1;i++){newChildren.push(this.children[i]);newChildren.push(aSep)}newChildren.push(this.children[i]);this.children=newChildren}return this};SourceNode.prototype.replaceRight=function SourceNode_replaceRight(aPattern,aReplacement){var lastChild=this.children[this.children.length-1];if(lastChild instanceof SourceNode){lastChild.replaceRight(aPattern,aReplacement)}else if(typeof lastChild==="string"){this.children[this.children.length-1]=lastChild.replace(aPattern,aReplacement)}else{this.children.push("".replace(aPattern,aReplacement))}return this};SourceNode.prototype.setSourceContent=function SourceNode_setSourceContent(aSourceFile,aSourceContent){this.sourceContents[util.toSetString(aSourceFile)]=aSourceContent};SourceNode.prototype.walkSourceContents=function SourceNode_walkSourceContents(aFn){for(var i=0,len=this.children.length;i<len;i++){if(this.children[i]instanceof SourceNode){this.children[i].walkSourceContents(aFn)}}var sources=Object.keys(this.sourceContents);for(var i=0,len=sources.length;i<len;i++){aFn(util.fromSetString(sources[i]),this.sourceContents[sources[i]])}};SourceNode.prototype.toString=function SourceNode_toString(){var str="";this.walk(function(chunk){str+=chunk});return str};SourceNode.prototype.toStringWithSourceMap=function SourceNode_toStringWithSourceMap(aArgs){var generated={code:"",line:1,column:0};var map=new SourceMapGenerator(aArgs);var sourceMappingActive=false;var lastOriginalSource=null;var lastOriginalLine=null;var lastOriginalColumn=null;var lastOriginalName=null;this.walk(function(chunk,original){generated.code+=chunk;if(original.source!==null&&original.line!==null&&original.column!==null){if(lastOriginalSource!==original.source||lastOriginalLine!==original.line||lastOriginalColumn!==original.column||lastOriginalName!==original.name){map.addMapping({source:original.source,original:{line:original.line,column:original.column},generated:{line:generated.line,column:generated.column},name:original.name})}lastOriginalSource=original.source;lastOriginalLine=original.line;lastOriginalColumn=original.column;lastOriginalName=original.name;sourceMappingActive=true}else if(sourceMappingActive){map.addMapping({generated:{line:generated.line,column:generated.column}});lastOriginalSource=null;sourceMappingActive=false}chunk.match(REGEX_CHARACTER).forEach(function(ch,idx,array){if(REGEX_NEWLINE.test(ch)){generated.line++;generated.column=0;if(idx+1===array.length){lastOriginalSource=null;sourceMappingActive=false}else if(sourceMappingActive){map.addMapping({source:original.source,original:{line:original.line,column:original.column},generated:{line:generated.line,column:generated.column},name:original.name})}}else{generated.column+=ch.length}})});this.walkSourceContents(function(sourceFile,sourceContent){map.setSourceContent(sourceFile,sourceContent)});return{code:generated.code,map:map}};exports.SourceNode=SourceNode})},{"./source-map-generator":143,"./util":145,amdefine:146}],145:[function(require,module,exports){if(typeof define!=="function"){var define=require("amdefine")(module,require)}define(function(require,exports,module){function getArg(aArgs,aName,aDefaultValue){if(aName in aArgs){return aArgs[aName]}else if(arguments.length===3){return aDefaultValue}else{throw new Error('"'+aName+'" is a required argument.')}}exports.getArg=getArg;var urlRegexp=/^(?:([\w+\-.]+):)?\/\/(?:(\w+:\w+)@)?([\w.]*)(?::(\d+))?(\S*)$/;var dataUrlRegexp=/^data:.+\,.+$/;function urlParse(aUrl){var match=aUrl.match(urlRegexp);if(!match){return null}return{scheme:match[1],auth:match[2],host:match[3],port:match[4],path:match[5]}}exports.urlParse=urlParse;function urlGenerate(aParsedUrl){var url="";if(aParsedUrl.scheme){url+=aParsedUrl.scheme+":"}url+="//";if(aParsedUrl.auth){url+=aParsedUrl.auth+"@"}if(aParsedUrl.host){url+=aParsedUrl.host}if(aParsedUrl.port){url+=":"+aParsedUrl.port}if(aParsedUrl.path){url+=aParsedUrl.path}return url}exports.urlGenerate=urlGenerate;function normalize(aPath){var path=aPath;var url=urlParse(aPath);if(url){if(!url.path){return aPath}path=url.path}var isAbsolute=path.charAt(0)==="/";var parts=path.split(/\/+/);for(var part,up=0,i=parts.length-1;i>=0;i--){part=parts[i];if(part==="."){parts.splice(i,1)}else if(part===".."){up++}else if(up>0){if(part===""){parts.splice(i+1,up);up=0}else{parts.splice(i,2);up--}}}path=parts.join("/");if(path===""){path=isAbsolute?"/":"."}if(url){url.path=path;return urlGenerate(url)}return path}exports.normalize=normalize;function join(aRoot,aPath){if(aRoot===""){aRoot="."}if(aPath===""){aPath="."}var aPathUrl=urlParse(aPath);var aRootUrl=urlParse(aRoot);if(aRootUrl){aRoot=aRootUrl.path||"/"}if(aPathUrl&&!aPathUrl.scheme){if(aRootUrl){aPathUrl.scheme=aRootUrl.scheme}return urlGenerate(aPathUrl)}if(aPathUrl||aPath.match(dataUrlRegexp)){return aPath}if(aRootUrl&&!aRootUrl.host&&!aRootUrl.path){aRootUrl.host=aPath;return urlGenerate(aRootUrl)}var joined=aPath.charAt(0)==="/"?aPath:normalize(aRoot.replace(/\/+$/,"")+"/"+aPath);if(aRootUrl){aRootUrl.path=joined;return urlGenerate(aRootUrl)}return joined}exports.join=join;function relative(aRoot,aPath){if(aRoot===""){aRoot="."}aRoot=aRoot.replace(/\/$/,"");var url=urlParse(aRoot);if(aPath.charAt(0)=="/"&&url&&url.path=="/"){return aPath.slice(1)}return aPath.indexOf(aRoot+"/")===0?aPath.substr(aRoot.length+1):aPath}exports.relative=relative;function toSetString(aStr){return"$"+aStr}exports.toSetString=toSetString;function fromSetString(aStr){return aStr.substr(1)}exports.fromSetString=fromSetString;function strcmp(aStr1,aStr2){var s1=aStr1||"";var s2=aStr2||"";return(s1>s2)-(s1<s2)}function compareByOriginalPositions(mappingA,mappingB,onlyCompareOriginal){var cmp;cmp=strcmp(mappingA.source,mappingB.source);if(cmp){return cmp}cmp=mappingA.originalLine-mappingB.originalLine;if(cmp){return cmp}cmp=mappingA.originalColumn-mappingB.originalColumn;if(cmp||onlyCompareOriginal){return cmp}cmp=strcmp(mappingA.name,mappingB.name);if(cmp){return cmp}cmp=mappingA.generatedLine-mappingB.generatedLine;if(cmp){return cmp}return mappingA.generatedColumn-mappingB.generatedColumn}exports.compareByOriginalPositions=compareByOriginalPositions;function compareByGeneratedPositions(mappingA,mappingB,onlyCompareGenerated){var cmp;cmp=mappingA.generatedLine-mappingB.generatedLine;if(cmp){return cmp}cmp=mappingA.generatedColumn-mappingB.generatedColumn;if(cmp||onlyCompareGenerated){return cmp}cmp=strcmp(mappingA.source,mappingB.source);if(cmp){return cmp}cmp=mappingA.originalLine-mappingB.originalLine;if(cmp){return cmp}cmp=mappingA.originalColumn-mappingB.originalColumn;if(cmp){return cmp}return strcmp(mappingA.name,mappingB.name)}exports.compareByGeneratedPositions=compareByGeneratedPositions})},{amdefine:146}],146:[function(require,module,exports){(function(process,__filename){"use strict";function amdefine(module,requireFn){"use strict";var defineCache={},loaderCache={},alreadyCalled=false,path=require("path"),makeRequire,stringRequire;function trimDots(ary){var i,part;for(i=0;ary[i];i+=1){part=ary[i];if(part==="."){ary.splice(i,1);i-=1}else if(part===".."){if(i===1&&(ary[2]===".."||ary[0]==="..")){break}else if(i>0){ary.splice(i-1,2);i-=2}}}}function normalize(name,baseName){var baseParts;if(name&&name.charAt(0)==="."){if(baseName){baseParts=baseName.split("/");baseParts=baseParts.slice(0,baseParts.length-1);baseParts=baseParts.concat(name.split("/"));trimDots(baseParts);name=baseParts.join("/")}}return name}function makeNormalize(relName){return function(name){return normalize(name,relName)}}function makeLoad(id){function load(value){loaderCache[id]=value}load.fromText=function(id,text){throw new Error("amdefine does not implement load.fromText")};return load}makeRequire=function(systemRequire,exports,module,relId){function amdRequire(deps,callback){if(typeof deps==="string"){return stringRequire(systemRequire,exports,module,deps,relId)}else{deps=deps.map(function(depName){return stringRequire(systemRequire,exports,module,depName,relId)});process.nextTick(function(){callback.apply(null,deps)})}}amdRequire.toUrl=function(filePath){if(filePath.indexOf(".")===0){return normalize(filePath,path.dirname(module.filename))}else{return filePath}};return amdRequire};requireFn=requireFn||function req(){return module.require.apply(module,arguments)};function runFactory(id,deps,factory){var r,e,m,result;if(id){e=loaderCache[id]={};m={id:id,uri:__filename,exports:e};r=makeRequire(requireFn,e,m,id)}else{if(alreadyCalled){throw new Error("amdefine with no module ID cannot be called more than once per file.")}alreadyCalled=true;e=module.exports;m=module;r=makeRequire(requireFn,e,m,module.id)}if(deps){deps=deps.map(function(depName){return r(depName)})}if(typeof factory==="function"){result=factory.apply(m.exports,deps)}else{result=factory}if(result!==undefined){m.exports=result;if(id){loaderCache[id]=m.exports}}}stringRequire=function(systemRequire,exports,module,id,relId){var index=id.indexOf("!"),originalId=id,prefix,plugin;if(index===-1){id=normalize(id,relId);if(id==="require"){return makeRequire(systemRequire,exports,module,relId)}else if(id==="exports"){return exports}else if(id==="module"){return module}else if(loaderCache.hasOwnProperty(id)){return loaderCache[id]}else if(defineCache[id]){runFactory.apply(null,defineCache[id]);return loaderCache[id]}else{if(systemRequire){return systemRequire(originalId)}else{throw new Error("No module with ID: "+id)}}}else{prefix=id.substring(0,index);id=id.substring(index+1,id.length);plugin=stringRequire(systemRequire,exports,module,prefix,relId);if(plugin.normalize){id=plugin.normalize(id,makeNormalize(relId))}else{id=normalize(id,relId)}if(loaderCache[id]){return loaderCache[id]}else{plugin.load(id,makeRequire(systemRequire,exports,module,relId),makeLoad(id),{});return loaderCache[id]}}};function define(id,deps,factory){if(Array.isArray(id)){factory=deps;deps=id;id=undefined}else if(typeof id!=="string"){factory=id;id=deps=undefined}if(deps&&!Array.isArray(deps)){factory=deps;deps=undefined}if(!deps){deps=["require","exports","module"]}if(id){defineCache[id]=[id,deps,factory]}else{runFactory(id,deps,factory)}}define.require=function(id){if(loaderCache[id]){return loaderCache[id]}if(defineCache[id]){runFactory.apply(null,defineCache[id]);return loaderCache[id]}};define.amd={};return define}module.exports=amdefine}).call(this,require("_process"),"/node_modules/itreed/node_modules/escodegen/node_modules/source-map/node_modules/amdefine/amdefine.js")},{_process:10,path:9}],147:[function(require,module,exports){module.exports={name:"escodegen",description:"ECMAScript code generator",homepage:"http://github.com/Constellation/escodegen",main:"escodegen.js",bin:{esgenerate:"./bin/esgenerate.js",escodegen:"./bin/escodegen.js"},version:"1.4.1",engines:{node:">=0.10.0"},maintainers:[{name:"constellation",email:"utatane.tea@gmail.com"}],repository:{type:"git",url:"http://github.com/Constellation/escodegen.git"},dependencies:{estraverse:"^1.5.1",esutils:"^1.1.4",esprima:"^1.2.2","source-map":"~0.1.37"},optionalDependencies:{"source-map":"~0.1.37"},devDependencies:{"esprima-moz":"*",semver:"^3.0.1",bluebird:"^2.2.2","jshint-stylish":"^0.4.0",chai:"^1.9.1","gulp-mocha":"^1.0.0","gulp-eslint":"^0.1.8",gulp:"^3.8.6","bower-registry-client":"^0.2.1","gulp-jshint":"^1.8.0","commonjs-everywhere":"^0.9.7"},licenses:[{type:"BSD",url:"http://github.com/Constellation/escodegen/raw/master/LICENSE.BSD"}],scripts:{test:"gulp travis","unit-test":"gulp test",lint:"gulp lint",release:"node tools/release.js","build-min":"cjsify -ma path: tools/entry-point.js > escodegen.browser.min.js",build:"cjsify -a path: tools/entry-point.js > escodegen.browser.js"},gitHead:"87296a9ac34dcaf6567bd7e3d351e4a227b434dc",bugs:{url:"https://github.com/Constellation/escodegen/issues"},_id:"escodegen@1.4.1",_shasum:"8c2562ff45da348975953e8c0a57f40848962ec7",_from:"escodegen@~1.4.1",_npmVersion:"2.0.0-alpha-5",_npmUser:{name:"constellation",email:"utatane.tea@gmail.com"},dist:{shasum:"8c2562ff45da348975953e8c0a57f40848962ec7",tarball:"http://registry.npmjs.org/escodegen/-/escodegen-1.4.1.tgz"},directories:{},_resolved:"https://registry.npmjs.org/escodegen/-/escodegen-1.4.1.tgz",readme:"ERROR: No README data found!"}},{}],148:[function(require,module,exports){(function(root,factory){"use strict";if(typeof define==="function"&&define.amd){define(["exports"],factory)}else if(typeof exports!=="undefined"){factory(exports)}else{factory(root.esprima={})}})(this,function(exports){"use strict";var Token,TokenName,FnExprTokens,Syntax,PropertyKind,Messages,Regex,SyntaxTreeDelegate,source,strict,index,lineNumber,lineStart,length,delegate,lookahead,state,extra;Token={BooleanLiteral:1,EOF:2,Identifier:3,Keyword:4,NullLiteral:5,NumericLiteral:6,Punctuator:7,StringLiteral:8,RegularExpression:9};TokenName={};TokenName[Token.BooleanLiteral]="Boolean";TokenName[Token.EOF]="<end>";TokenName[Token.Identifier]="Identifier";TokenName[Token.Keyword]="Keyword";TokenName[Token.NullLiteral]="Null";TokenName[Token.NumericLiteral]="Numeric";TokenName[Token.Punctuator]="Punctuator";TokenName[Token.StringLiteral]="String";TokenName[Token.RegularExpression]="RegularExpression";FnExprTokens=["(","{","[","in","typeof","instanceof","new","return","case","delete","throw","void","=","+=","-=","*=","/=","%=","<<=",">>=",">>>=","&=","|=","^=",",","+","-","*","/","%","++","--","<<",">>",">>>","&","|","^","!","~","&&","||","?",":","===","==",">=","<=","<",">","!=","!=="];Syntax={AssignmentExpression:"AssignmentExpression",ArrayExpression:"ArrayExpression",BlockStatement:"BlockStatement",BinaryExpression:"BinaryExpression",BreakStatement:"BreakStatement",CallExpression:"CallExpression",CatchClause:"CatchClause",ConditionalExpression:"ConditionalExpression",ContinueStatement:"ContinueStatement",DoWhileStatement:"DoWhileStatement",DebuggerStatement:"DebuggerStatement",EmptyStatement:"EmptyStatement",ExpressionStatement:"ExpressionStatement",ForStatement:"ForStatement",ForInStatement:"ForInStatement",FunctionDeclaration:"FunctionDeclaration",FunctionExpression:"FunctionExpression",Identifier:"Identifier",IfStatement:"IfStatement",Literal:"Literal",LabeledStatement:"LabeledStatement",LogicalExpression:"LogicalExpression",MemberExpression:"MemberExpression",NewExpression:"NewExpression",ObjectExpression:"ObjectExpression",Program:"Program",Property:"Property",ReturnStatement:"ReturnStatement",SequenceExpression:"SequenceExpression",SwitchStatement:"SwitchStatement",SwitchCase:"SwitchCase",ThisExpression:"ThisExpression",ThrowStatement:"ThrowStatement",TryStatement:"TryStatement",UnaryExpression:"UnaryExpression",UpdateExpression:"UpdateExpression",VariableDeclaration:"VariableDeclaration",VariableDeclarator:"VariableDeclarator",WhileStatement:"WhileStatement",WithStatement:"WithStatement"};PropertyKind={Data:1,Get:2,Set:4};Messages={UnexpectedToken:"Unexpected token %0",UnexpectedNumber:"Unexpected number",UnexpectedString:"Unexpected string",UnexpectedIdentifier:"Unexpected identifier",UnexpectedReserved:"Unexpected reserved word",UnexpectedEOS:"Unexpected end of input",NewlineAfterThrow:"Illegal newline after throw",InvalidRegExp:"Invalid regular expression",UnterminatedRegExp:"Invalid regular expression: missing /",InvalidLHSInAssignment:"Invalid left-hand side in assignment",InvalidLHSInForIn:"Invalid left-hand side in for-in",MultipleDefaultsInSwitch:"More than one default clause in switch statement",NoCatchOrFinally:"Missing catch or finally after try",UnknownLabel:"Undefined label '%0'",Redeclaration:"%0 '%1' has already been declared",IllegalContinue:"Illegal continue statement",IllegalBreak:"Illegal break statement",IllegalReturn:"Illegal return statement",StrictModeWith:"Strict mode code may not include a with statement",StrictCatchVariable:"Catch variable may not be eval or arguments in strict mode",StrictVarName:"Variable name may not be eval or arguments in strict mode",StrictParamName:"Parameter name eval or arguments is not allowed in strict mode",StrictParamDupe:"Strict mode function may not have duplicate parameter names",StrictFunctionName:"Function name may not be eval or arguments in strict mode",StrictOctalLiteral:"Octal literals are not allowed in strict mode.",StrictDelete:"Delete of an unqualified identifier in strict mode.",StrictDuplicateProperty:"Duplicate data property in object literal not allowed in strict mode",AccessorDataProperty:"Object literal may not have data and accessor property with the same name",AccessorGetSet:"Object literal may not have multiple get/set accessors with the same name",StrictLHSAssignment:"Assignment to eval or arguments is not allowed in strict mode",StrictLHSPostfix:"Postfix increment/decrement may not have eval or arguments operand in strict mode",StrictLHSPrefix:"Prefix increment/decrement may not have eval or arguments operand in strict mode",StrictReservedWord:"Use of future reserved word in strict mode"};Regex={NonAsciiIdentifierStart:new RegExp("[------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------]"),NonAsciiIdentifierPart:new RegExp("[------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------]")};function assert(condition,message){if(!condition){throw new Error("ASSERT: "+message)}}function isDecimalDigit(ch){return ch>=48&&ch<=57}function isHexDigit(ch){return"0123456789abcdefABCDEF".indexOf(ch)>=0}function isOctalDigit(ch){return"01234567".indexOf(ch)>=0}function isWhiteSpace(ch){return ch===32||ch===9||ch===11||ch===12||ch===160||ch>=5760&&[5760,6158,8192,8193,8194,8195,8196,8197,8198,8199,8200,8201,8202,8239,8287,12288,65279].indexOf(ch)>=0}function isLineTerminator(ch){return ch===10||ch===13||ch===8232||ch===8233}function isIdentifierStart(ch){return ch===36||ch===95||ch>=65&&ch<=90||ch>=97&&ch<=122||ch===92||ch>=128&&Regex.NonAsciiIdentifierStart.test(String.fromCharCode(ch))}function isIdentifierPart(ch){return ch===36||ch===95||ch>=65&&ch<=90||ch>=97&&ch<=122||ch>=48&&ch<=57||ch===92||ch>=128&&Regex.NonAsciiIdentifierPart.test(String.fromCharCode(ch))}function isFutureReservedWord(id){switch(id){case"class":case"enum":case"export":case"extends":case"import":case"super":return true;default:return false}}function isStrictModeReservedWord(id){switch(id){case"implements":case"interface":case"package":case"private":case"protected":case"public":case"static":case"yield":case"let":return true;default:return false}}function isRestrictedWord(id){return id==="eval"||id==="arguments"}function isKeyword(id){if(strict&&isStrictModeReservedWord(id)){return true}switch(id.length){case 2:return id==="if"||id==="in"||id==="do";case 3:return id==="var"||id==="for"||id==="new"||id==="try"||id==="let";case 4:return id==="this"||id==="else"||id==="case"||id==="void"||id==="with"||id==="enum";case 5:return id==="while"||id==="break"||id==="catch"||id==="throw"||id==="const"||id==="yield"||id==="class"||id==="super";case 6:return id==="return"||id==="typeof"||id==="delete"||id==="switch"||id==="export"||id==="import";case 7:return id==="default"||id==="finally"||id==="extends";case 8:return id==="function"||id==="continue"||id==="debugger";case 10:return id==="instanceof";default:return false}}function addComment(type,value,start,end,loc){var comment,attacher;assert(typeof start==="number","Comment must have valid position");if(state.lastCommentStart>=start){return}state.lastCommentStart=start;comment={type:type,value:value};if(extra.range){comment.range=[start,end]}if(extra.loc){comment.loc=loc}extra.comments.push(comment);if(extra.attachComment){extra.leadingComments.push(comment);extra.trailingComments.push(comment)}}function skipSingleLineComment(offset){var start,loc,ch,comment;start=index-offset;loc={start:{line:lineNumber,column:index-lineStart-offset}};while(index<length){ch=source.charCodeAt(index);++index;if(isLineTerminator(ch)){if(extra.comments){comment=source.slice(start+offset,index-1);loc.end={line:lineNumber,column:index-lineStart-1};addComment("Line",comment,start,index-1,loc)}if(ch===13&&source.charCodeAt(index)===10){++index}++lineNumber;lineStart=index;return}}if(extra.comments){comment=source.slice(start+offset,index);loc.end={line:lineNumber,column:index-lineStart};addComment("Line",comment,start,index,loc)}}function skipMultiLineComment(){var start,loc,ch,comment;if(extra.comments){start=index-2;loc={start:{line:lineNumber,column:index-lineStart-2}}}while(index<length){ch=source.charCodeAt(index);if(isLineTerminator(ch)){if(ch===13&&source.charCodeAt(index+1)===10){++index}++lineNumber;++index;lineStart=index;if(index>=length){throwError({},Messages.UnexpectedToken,"ILLEGAL")}}else if(ch===42){if(source.charCodeAt(index+1)===47){++index;++index;if(extra.comments){comment=source.slice(start+2,index-2);loc.end={line:lineNumber,column:index-lineStart};addComment("Block",comment,start,index,loc)}return}++index}else{++index}}throwError({},Messages.UnexpectedToken,"ILLEGAL")}function skipComment(){var ch,start;start=index===0;while(index<length){ch=source.charCodeAt(index);if(isWhiteSpace(ch)){++index}else if(isLineTerminator(ch)){++index;if(ch===13&&source.charCodeAt(index)===10){++index}++lineNumber;lineStart=index;start=true}else if(ch===47){ch=source.charCodeAt(index+1);if(ch===47){++index;++index;skipSingleLineComment(2);start=true}else if(ch===42){++index;++index;skipMultiLineComment()}else{break}}else if(start&&ch===45){if(source.charCodeAt(index+1)===45&&source.charCodeAt(index+2)===62){index+=3;skipSingleLineComment(3)}else{break}}else if(ch===60){if(source.slice(index+1,index+4)==="!--"){++index;++index;++index;++index;skipSingleLineComment(4)}else{break}}else{break}}}function scanHexEscape(prefix){var i,len,ch,code=0;len=prefix==="u"?4:2;for(i=0;i<len;++i){if(index<length&&isHexDigit(source[index])){ch=source[index++];code=code*16+"0123456789abcdef".indexOf(ch.toLowerCase())}else{return""}}return String.fromCharCode(code)}function getEscapedIdentifier(){var ch,id;ch=source.charCodeAt(index++);id=String.fromCharCode(ch);if(ch===92){if(source.charCodeAt(index)!==117){throwError({},Messages.UnexpectedToken,"ILLEGAL")}++index;ch=scanHexEscape("u");if(!ch||ch==="\\"||!isIdentifierStart(ch.charCodeAt(0))){throwError({},Messages.UnexpectedToken,"ILLEGAL")}id=ch}while(index<length){ch=source.charCodeAt(index);if(!isIdentifierPart(ch)){break}++index;id+=String.fromCharCode(ch);if(ch===92){id=id.substr(0,id.length-1);if(source.charCodeAt(index)!==117){throwError({},Messages.UnexpectedToken,"ILLEGAL")}++index;ch=scanHexEscape("u");if(!ch||ch==="\\"||!isIdentifierPart(ch.charCodeAt(0))){throwError({},Messages.UnexpectedToken,"ILLEGAL")}id+=ch}}return id}function getIdentifier(){var start,ch;start=index++;while(index<length){ch=source.charCodeAt(index);if(ch===92){index=start;return getEscapedIdentifier()}if(isIdentifierPart(ch)){++index}else{break}}return source.slice(start,index)}function scanIdentifier(){var start,id,type;start=index;id=source.charCodeAt(index)===92?getEscapedIdentifier():getIdentifier();if(id.length===1){type=Token.Identifier}else if(isKeyword(id)){type=Token.Keyword}else if(id==="null"){type=Token.NullLiteral}else if(id==="true"||id==="false"){type=Token.BooleanLiteral}else{type=Token.Identifier}return{type:type,value:id,lineNumber:lineNumber,lineStart:lineStart,start:start,end:index}}function scanPunctuator(){var start=index,code=source.charCodeAt(index),code2,ch1=source[index],ch2,ch3,ch4;switch(code){case 46:case 40:case 41:case 59:case 44:case 123:case 125:case 91:case 93:case 58:case 63:case 126:++index;if(extra.tokenize){if(code===40){extra.openParenToken=extra.tokens.length}else if(code===123){extra.openCurlyToken=extra.tokens.length}}return{type:Token.Punctuator,value:String.fromCharCode(code),lineNumber:lineNumber,lineStart:lineStart,start:start,end:index};default:code2=source.charCodeAt(index+1);if(code2===61){switch(code){case 43:case 45:case 47:case 60:case 62:case 94:case 124:case 37:case 38:case 42:index+=2;return{type:Token.Punctuator,value:String.fromCharCode(code)+String.fromCharCode(code2),lineNumber:lineNumber,lineStart:lineStart,start:start,end:index};case 33:case 61:index+=2;if(source.charCodeAt(index)===61){++index}return{type:Token.Punctuator,value:source.slice(start,index),lineNumber:lineNumber,lineStart:lineStart,start:start,end:index}
}}}ch4=source.substr(index,4);if(ch4===">>>="){index+=4;return{type:Token.Punctuator,value:ch4,lineNumber:lineNumber,lineStart:lineStart,start:start,end:index}}ch3=ch4.substr(0,3);if(ch3===">>>"||ch3==="<<="||ch3===">>="){index+=3;return{type:Token.Punctuator,value:ch3,lineNumber:lineNumber,lineStart:lineStart,start:start,end:index}}ch2=ch3.substr(0,2);if(ch1===ch2[1]&&"+-<>&|".indexOf(ch1)>=0||ch2==="=>"){index+=2;return{type:Token.Punctuator,value:ch2,lineNumber:lineNumber,lineStart:lineStart,start:start,end:index}}if("<>=!+-*%&|^/".indexOf(ch1)>=0){++index;return{type:Token.Punctuator,value:ch1,lineNumber:lineNumber,lineStart:lineStart,start:start,end:index}}throwError({},Messages.UnexpectedToken,"ILLEGAL")}function scanHexLiteral(start){var number="";while(index<length){if(!isHexDigit(source[index])){break}number+=source[index++]}if(number.length===0){throwError({},Messages.UnexpectedToken,"ILLEGAL")}if(isIdentifierStart(source.charCodeAt(index))){throwError({},Messages.UnexpectedToken,"ILLEGAL")}return{type:Token.NumericLiteral,value:parseInt("0x"+number,16),lineNumber:lineNumber,lineStart:lineStart,start:start,end:index}}function scanOctalLiteral(start){var number="0"+source[index++];while(index<length){if(!isOctalDigit(source[index])){break}number+=source[index++]}if(isIdentifierStart(source.charCodeAt(index))||isDecimalDigit(source.charCodeAt(index))){throwError({},Messages.UnexpectedToken,"ILLEGAL")}return{type:Token.NumericLiteral,value:parseInt(number,8),octal:true,lineNumber:lineNumber,lineStart:lineStart,start:start,end:index}}function scanNumericLiteral(){var number,start,ch;ch=source[index];assert(isDecimalDigit(ch.charCodeAt(0))||ch===".","Numeric literal must start with a decimal digit or a decimal point");start=index;number="";if(ch!=="."){number=source[index++];ch=source[index];if(number==="0"){if(ch==="x"||ch==="X"){++index;return scanHexLiteral(start)}if(isOctalDigit(ch)){return scanOctalLiteral(start)}if(ch&&isDecimalDigit(ch.charCodeAt(0))){throwError({},Messages.UnexpectedToken,"ILLEGAL")}}while(isDecimalDigit(source.charCodeAt(index))){number+=source[index++]}ch=source[index]}if(ch==="."){number+=source[index++];while(isDecimalDigit(source.charCodeAt(index))){number+=source[index++]}ch=source[index]}if(ch==="e"||ch==="E"){number+=source[index++];ch=source[index];if(ch==="+"||ch==="-"){number+=source[index++]}if(isDecimalDigit(source.charCodeAt(index))){while(isDecimalDigit(source.charCodeAt(index))){number+=source[index++]}}else{throwError({},Messages.UnexpectedToken,"ILLEGAL")}}if(isIdentifierStart(source.charCodeAt(index))){throwError({},Messages.UnexpectedToken,"ILLEGAL")}return{type:Token.NumericLiteral,value:parseFloat(number),lineNumber:lineNumber,lineStart:lineStart,start:start,end:index}}function scanStringLiteral(){var str="",quote,start,ch,code,unescaped,restore,octal=false,startLineNumber,startLineStart;startLineNumber=lineNumber;startLineStart=lineStart;quote=source[index];assert(quote==="'"||quote==='"',"String literal must starts with a quote");start=index;++index;while(index<length){ch=source[index++];if(ch===quote){quote="";break}else if(ch==="\\"){ch=source[index++];if(!ch||!isLineTerminator(ch.charCodeAt(0))){switch(ch){case"u":case"x":restore=index;unescaped=scanHexEscape(ch);if(unescaped){str+=unescaped}else{index=restore;str+=ch}break;case"n":str+="\n";break;case"r":str+="\r";break;case"t":str+="	";break;case"b":str+="\b";break;case"f":str+="\f";break;case"v":str+="";break;default:if(isOctalDigit(ch)){code="01234567".indexOf(ch);if(code!==0){octal=true}if(index<length&&isOctalDigit(source[index])){octal=true;code=code*8+"01234567".indexOf(source[index++]);if("0123".indexOf(ch)>=0&&index<length&&isOctalDigit(source[index])){code=code*8+"01234567".indexOf(source[index++])}}str+=String.fromCharCode(code)}else{str+=ch}break}}else{++lineNumber;if(ch==="\r"&&source[index]==="\n"){++index}lineStart=index}}else if(isLineTerminator(ch.charCodeAt(0))){break}else{str+=ch}}if(quote!==""){throwError({},Messages.UnexpectedToken,"ILLEGAL")}return{type:Token.StringLiteral,value:str,octal:octal,startLineNumber:startLineNumber,startLineStart:startLineStart,lineNumber:lineNumber,lineStart:lineStart,start:start,end:index}}function testRegExp(pattern,flags){var value;try{value=new RegExp(pattern,flags)}catch(e){throwError({},Messages.InvalidRegExp)}return value}function scanRegExpBody(){var ch,str,classMarker,terminated,body;ch=source[index];assert(ch==="/","Regular expression literal must start with a slash");str=source[index++];classMarker=false;terminated=false;while(index<length){ch=source[index++];str+=ch;if(ch==="\\"){ch=source[index++];if(isLineTerminator(ch.charCodeAt(0))){throwError({},Messages.UnterminatedRegExp)}str+=ch}else if(isLineTerminator(ch.charCodeAt(0))){throwError({},Messages.UnterminatedRegExp)}else if(classMarker){if(ch==="]"){classMarker=false}}else{if(ch==="/"){terminated=true;break}else if(ch==="["){classMarker=true}}}if(!terminated){throwError({},Messages.UnterminatedRegExp)}body=str.substr(1,str.length-2);return{value:body,literal:str}}function scanRegExpFlags(){var ch,str,flags,restore;str="";flags="";while(index<length){ch=source[index];if(!isIdentifierPart(ch.charCodeAt(0))){break}++index;if(ch==="\\"&&index<length){ch=source[index];if(ch==="u"){++index;restore=index;ch=scanHexEscape("u");if(ch){flags+=ch;for(str+="\\u";restore<index;++restore){str+=source[restore]}}else{index=restore;flags+="u";str+="\\u"}throwErrorTolerant({},Messages.UnexpectedToken,"ILLEGAL")}else{str+="\\";throwErrorTolerant({},Messages.UnexpectedToken,"ILLEGAL")}}else{flags+=ch;str+=ch}}return{value:flags,literal:str}}function scanRegExp(){var start,body,flags,pattern,value;lookahead=null;skipComment();start=index;body=scanRegExpBody();flags=scanRegExpFlags();value=testRegExp(body.value,flags.value);if(extra.tokenize){return{type:Token.RegularExpression,value:value,lineNumber:lineNumber,lineStart:lineStart,start:start,end:index}}return{literal:body.literal+flags.literal,value:value,start:start,end:index}}function collectRegex(){var pos,loc,regex,token;skipComment();pos=index;loc={start:{line:lineNumber,column:index-lineStart}};regex=scanRegExp();loc.end={line:lineNumber,column:index-lineStart};if(!extra.tokenize){if(extra.tokens.length>0){token=extra.tokens[extra.tokens.length-1];if(token.range[0]===pos&&token.type==="Punctuator"){if(token.value==="/"||token.value==="/="){extra.tokens.pop()}}}extra.tokens.push({type:"RegularExpression",value:regex.literal,range:[pos,index],loc:loc})}return regex}function isIdentifierName(token){return token.type===Token.Identifier||token.type===Token.Keyword||token.type===Token.BooleanLiteral||token.type===Token.NullLiteral}function advanceSlash(){var prevToken,checkToken;prevToken=extra.tokens[extra.tokens.length-1];if(!prevToken){return collectRegex()}if(prevToken.type==="Punctuator"){if(prevToken.value==="]"){return scanPunctuator()}if(prevToken.value===")"){checkToken=extra.tokens[extra.openParenToken-1];if(checkToken&&checkToken.type==="Keyword"&&(checkToken.value==="if"||checkToken.value==="while"||checkToken.value==="for"||checkToken.value==="with")){return collectRegex()}return scanPunctuator()}if(prevToken.value==="}"){if(extra.tokens[extra.openCurlyToken-3]&&extra.tokens[extra.openCurlyToken-3].type==="Keyword"){checkToken=extra.tokens[extra.openCurlyToken-4];if(!checkToken){return scanPunctuator()}}else if(extra.tokens[extra.openCurlyToken-4]&&extra.tokens[extra.openCurlyToken-4].type==="Keyword"){checkToken=extra.tokens[extra.openCurlyToken-5];if(!checkToken){return collectRegex()}}else{return scanPunctuator()}if(FnExprTokens.indexOf(checkToken.value)>=0){return scanPunctuator()}return collectRegex()}return collectRegex()}if(prevToken.type==="Keyword"){return collectRegex()}return scanPunctuator()}function advance(){var ch;skipComment();if(index>=length){return{type:Token.EOF,lineNumber:lineNumber,lineStart:lineStart,start:index,end:index}}ch=source.charCodeAt(index);if(isIdentifierStart(ch)){return scanIdentifier()}if(ch===40||ch===41||ch===59){return scanPunctuator()}if(ch===39||ch===34){return scanStringLiteral()}if(ch===46){if(isDecimalDigit(source.charCodeAt(index+1))){return scanNumericLiteral()}return scanPunctuator()}if(isDecimalDigit(ch)){return scanNumericLiteral()}if(extra.tokenize&&ch===47){return advanceSlash()}return scanPunctuator()}function collectToken(){var loc,token,range,value;skipComment();loc={start:{line:lineNumber,column:index-lineStart}};token=advance();loc.end={line:lineNumber,column:index-lineStart};if(token.type!==Token.EOF){value=source.slice(token.start,token.end);extra.tokens.push({type:TokenName[token.type],value:value,range:[token.start,token.end],loc:loc})}return token}function lex(){var token;token=lookahead;index=token.end;lineNumber=token.lineNumber;lineStart=token.lineStart;lookahead=typeof extra.tokens!=="undefined"?collectToken():advance();index=token.end;lineNumber=token.lineNumber;lineStart=token.lineStart;return token}function peek(){var pos,line,start;pos=index;line=lineNumber;start=lineStart;lookahead=typeof extra.tokens!=="undefined"?collectToken():advance();index=pos;lineNumber=line;lineStart=start}function Position(line,column){this.line=line;this.column=column}function SourceLocation(startLine,startColumn,line,column){this.start=new Position(startLine,startColumn);this.end=new Position(line,column)}SyntaxTreeDelegate={name:"SyntaxTree",processComment:function(node){var lastChild,trailingComments;if(node.type===Syntax.Program){if(node.body.length>0){return}}if(extra.trailingComments.length>0){if(extra.trailingComments[0].range[0]>=node.range[1]){trailingComments=extra.trailingComments;extra.trailingComments=[]}else{extra.trailingComments.length=0}}else{if(extra.bottomRightStack.length>0&&extra.bottomRightStack[extra.bottomRightStack.length-1].trailingComments&&extra.bottomRightStack[extra.bottomRightStack.length-1].trailingComments[0].range[0]>=node.range[1]){trailingComments=extra.bottomRightStack[extra.bottomRightStack.length-1].trailingComments;delete extra.bottomRightStack[extra.bottomRightStack.length-1].trailingComments}}while(extra.bottomRightStack.length>0&&extra.bottomRightStack[extra.bottomRightStack.length-1].range[0]>=node.range[0]){lastChild=extra.bottomRightStack.pop()}if(lastChild){if(lastChild.leadingComments&&lastChild.leadingComments[lastChild.leadingComments.length-1].range[1]<=node.range[0]){node.leadingComments=lastChild.leadingComments;delete lastChild.leadingComments}}else if(extra.leadingComments.length>0&&extra.leadingComments[extra.leadingComments.length-1].range[1]<=node.range[0]){node.leadingComments=extra.leadingComments;extra.leadingComments=[]}if(trailingComments){node.trailingComments=trailingComments}extra.bottomRightStack.push(node)},markEnd:function(node,startToken){if(extra.range){node.range=[startToken.start,index]}if(extra.loc){node.loc=new SourceLocation(startToken.startLineNumber===undefined?startToken.lineNumber:startToken.startLineNumber,startToken.start-(startToken.startLineStart===undefined?startToken.lineStart:startToken.startLineStart),lineNumber,index-lineStart);this.postProcess(node)}if(extra.attachComment){this.processComment(node)}return node},postProcess:function(node){if(extra.source){node.loc.source=extra.source}return node},createArrayExpression:function(elements){return{type:Syntax.ArrayExpression,elements:elements}},createAssignmentExpression:function(operator,left,right){return{type:Syntax.AssignmentExpression,operator:operator,left:left,right:right}},createBinaryExpression:function(operator,left,right){var type=operator==="||"||operator==="&&"?Syntax.LogicalExpression:Syntax.BinaryExpression;return{type:type,operator:operator,left:left,right:right}},createBlockStatement:function(body){return{type:Syntax.BlockStatement,body:body}},createBreakStatement:function(label){return{type:Syntax.BreakStatement,label:label}},createCallExpression:function(callee,args){return{type:Syntax.CallExpression,callee:callee,arguments:args}},createCatchClause:function(param,body){return{type:Syntax.CatchClause,param:param,body:body}},createConditionalExpression:function(test,consequent,alternate){return{type:Syntax.ConditionalExpression,test:test,consequent:consequent,alternate:alternate}},createContinueStatement:function(label){return{type:Syntax.ContinueStatement,label:label}},createDebuggerStatement:function(){return{type:Syntax.DebuggerStatement}},createDoWhileStatement:function(body,test){return{type:Syntax.DoWhileStatement,body:body,test:test}},createEmptyStatement:function(){return{type:Syntax.EmptyStatement}},createExpressionStatement:function(expression){return{type:Syntax.ExpressionStatement,expression:expression}},createForStatement:function(init,test,update,body){return{type:Syntax.ForStatement,init:init,test:test,update:update,body:body}},createForInStatement:function(left,right,body){return{type:Syntax.ForInStatement,left:left,right:right,body:body,each:false}},createFunctionDeclaration:function(id,params,defaults,body){return{type:Syntax.FunctionDeclaration,id:id,params:params,defaults:defaults,body:body,rest:null,generator:false,expression:false}},createFunctionExpression:function(id,params,defaults,body){return{type:Syntax.FunctionExpression,id:id,params:params,defaults:defaults,body:body,rest:null,generator:false,expression:false}},createIdentifier:function(name){return{type:Syntax.Identifier,name:name}},createIfStatement:function(test,consequent,alternate){return{type:Syntax.IfStatement,test:test,consequent:consequent,alternate:alternate}},createLabeledStatement:function(label,body){return{type:Syntax.LabeledStatement,label:label,body:body}},createLiteral:function(token){return{type:Syntax.Literal,value:token.value,raw:source.slice(token.start,token.end)}},createMemberExpression:function(accessor,object,property){return{type:Syntax.MemberExpression,computed:accessor==="[",object:object,property:property}},createNewExpression:function(callee,args){return{type:Syntax.NewExpression,callee:callee,arguments:args}},createObjectExpression:function(properties){return{type:Syntax.ObjectExpression,properties:properties}},createPostfixExpression:function(operator,argument){return{type:Syntax.UpdateExpression,operator:operator,argument:argument,prefix:false}},createProgram:function(body){return{type:Syntax.Program,body:body}},createProperty:function(kind,key,value){return{type:Syntax.Property,key:key,value:value,kind:kind}},createReturnStatement:function(argument){return{type:Syntax.ReturnStatement,argument:argument}},createSequenceExpression:function(expressions){return{type:Syntax.SequenceExpression,expressions:expressions}},createSwitchCase:function(test,consequent){return{type:Syntax.SwitchCase,test:test,consequent:consequent}},createSwitchStatement:function(discriminant,cases){return{type:Syntax.SwitchStatement,discriminant:discriminant,cases:cases}},createThisExpression:function(){return{type:Syntax.ThisExpression}},createThrowStatement:function(argument){return{type:Syntax.ThrowStatement,argument:argument}},createTryStatement:function(block,guardedHandlers,handlers,finalizer){return{type:Syntax.TryStatement,block:block,guardedHandlers:guardedHandlers,handlers:handlers,finalizer:finalizer}},createUnaryExpression:function(operator,argument){if(operator==="++"||operator==="--"){return{type:Syntax.UpdateExpression,operator:operator,argument:argument,prefix:true}}return{type:Syntax.UnaryExpression,operator:operator,argument:argument,prefix:true}},createVariableDeclaration:function(declarations,kind){return{type:Syntax.VariableDeclaration,declarations:declarations,kind:kind}},createVariableDeclarator:function(id,init){return{type:Syntax.VariableDeclarator,id:id,init:init}},createWhileStatement:function(test,body){return{type:Syntax.WhileStatement,test:test,body:body}},createWithStatement:function(object,body){return{type:Syntax.WithStatement,object:object,body:body}}};function peekLineTerminator(){var pos,line,start,found;pos=index;line=lineNumber;start=lineStart;skipComment();found=lineNumber!==line;index=pos;lineNumber=line;lineStart=start;return found}function throwError(token,messageFormat){var error,args=Array.prototype.slice.call(arguments,2),msg=messageFormat.replace(/%(\d)/g,function(whole,index){assert(index<args.length,"Message reference must be in range");return args[index]});if(typeof token.lineNumber==="number"){error=new Error("Line "+token.lineNumber+": "+msg);error.index=token.start;error.lineNumber=token.lineNumber;error.column=token.start-lineStart+1}else{error=new Error("Line "+lineNumber+": "+msg);error.index=index;error.lineNumber=lineNumber;error.column=index-lineStart+1}error.description=msg;throw error}function throwErrorTolerant(){try{throwError.apply(null,arguments)}catch(e){if(extra.errors){extra.errors.push(e)}else{throw e}}}function throwUnexpected(token){if(token.type===Token.EOF){throwError(token,Messages.UnexpectedEOS)}if(token.type===Token.NumericLiteral){throwError(token,Messages.UnexpectedNumber)}if(token.type===Token.StringLiteral){throwError(token,Messages.UnexpectedString)}if(token.type===Token.Identifier){throwError(token,Messages.UnexpectedIdentifier)}if(token.type===Token.Keyword){if(isFutureReservedWord(token.value)){throwError(token,Messages.UnexpectedReserved)}else if(strict&&isStrictModeReservedWord(token.value)){throwErrorTolerant(token,Messages.StrictReservedWord);return}throwError(token,Messages.UnexpectedToken,token.value)}throwError(token,Messages.UnexpectedToken,token.value)}function expect(value){var token=lex();if(token.type!==Token.Punctuator||token.value!==value){throwUnexpected(token)}}function expectKeyword(keyword){var token=lex();if(token.type!==Token.Keyword||token.value!==keyword){throwUnexpected(token)}}function match(value){return lookahead.type===Token.Punctuator&&lookahead.value===value}function matchKeyword(keyword){return lookahead.type===Token.Keyword&&lookahead.value===keyword}function matchAssign(){var op;if(lookahead.type!==Token.Punctuator){return false}op=lookahead.value;return op==="="||op==="*="||op==="/="||op==="%="||op==="+="||op==="-="||op==="<<="||op===">>="||op===">>>="||op==="&="||op==="^="||op==="|="}function consumeSemicolon(){var line;if(source.charCodeAt(index)===59||match(";")){lex();return}line=lineNumber;skipComment();if(lineNumber!==line){return}if(lookahead.type!==Token.EOF&&!match("}")){throwUnexpected(lookahead)}}function isLeftHandSide(expr){return expr.type===Syntax.Identifier||expr.type===Syntax.MemberExpression}function parseArrayInitialiser(){var elements=[],startToken;startToken=lookahead;expect("[");while(!match("]")){if(match(",")){lex();elements.push(null)}else{elements.push(parseAssignmentExpression());if(!match("]")){expect(",")}}}lex();return delegate.markEnd(delegate.createArrayExpression(elements),startToken)}function parsePropertyFunction(param,first){var previousStrict,body,startToken;previousStrict=strict;startToken=lookahead;body=parseFunctionSourceElements();if(first&&strict&&isRestrictedWord(param[0].name)){throwErrorTolerant(first,Messages.StrictParamName)}strict=previousStrict;return delegate.markEnd(delegate.createFunctionExpression(null,param,[],body),startToken)}function parseObjectPropertyKey(){var token,startToken;startToken=lookahead;token=lex();if(token.type===Token.StringLiteral||token.type===Token.NumericLiteral){if(strict&&token.octal){throwErrorTolerant(token,Messages.StrictOctalLiteral)}return delegate.markEnd(delegate.createLiteral(token),startToken)}return delegate.markEnd(delegate.createIdentifier(token.value),startToken)}function parseObjectProperty(){var token,key,id,value,param,startToken;token=lookahead;startToken=lookahead;if(token.type===Token.Identifier){id=parseObjectPropertyKey();if(token.value==="get"&&!match(":")){key=parseObjectPropertyKey();expect("(");expect(")");value=parsePropertyFunction([]);return delegate.markEnd(delegate.createProperty("get",key,value),startToken)}if(token.value==="set"&&!match(":")){key=parseObjectPropertyKey();expect("(");token=lookahead;if(token.type!==Token.Identifier){expect(")");throwErrorTolerant(token,Messages.UnexpectedToken,token.value);value=parsePropertyFunction([])}else{param=[parseVariableIdentifier()];expect(")");value=parsePropertyFunction(param,token)}return delegate.markEnd(delegate.createProperty("set",key,value),startToken)}expect(":");value=parseAssignmentExpression();return delegate.markEnd(delegate.createProperty("init",id,value),startToken)}if(token.type===Token.EOF||token.type===Token.Punctuator){throwUnexpected(token)}else{key=parseObjectPropertyKey();expect(":");value=parseAssignmentExpression();return delegate.markEnd(delegate.createProperty("init",key,value),startToken)}}function parseObjectInitialiser(){var properties=[],property,name,key,kind,map={},toString=String,startToken;startToken=lookahead;expect("{");while(!match("}")){property=parseObjectProperty();if(property.key.type===Syntax.Identifier){name=property.key.name}else{name=toString(property.key.value)}kind=property.kind==="init"?PropertyKind.Data:property.kind==="get"?PropertyKind.Get:PropertyKind.Set;key="$"+name;if(Object.prototype.hasOwnProperty.call(map,key)){if(map[key]===PropertyKind.Data){if(strict&&kind===PropertyKind.Data){throwErrorTolerant({},Messages.StrictDuplicateProperty)}else if(kind!==PropertyKind.Data){throwErrorTolerant({},Messages.AccessorDataProperty)}}else{if(kind===PropertyKind.Data){throwErrorTolerant({},Messages.AccessorDataProperty)}else if(map[key]&kind){throwErrorTolerant({},Messages.AccessorGetSet)}}map[key]|=kind}else{map[key]=kind}properties.push(property);if(!match("}")){expect(",")}}expect("}");return delegate.markEnd(delegate.createObjectExpression(properties),startToken)}function parseGroupExpression(){var expr;expect("(");expr=parseExpression();expect(")");return expr}function parsePrimaryExpression(){var type,token,expr,startToken;if(match("(")){return parseGroupExpression()}if(match("[")){return parseArrayInitialiser()}if(match("{")){return parseObjectInitialiser()}type=lookahead.type;startToken=lookahead;if(type===Token.Identifier){expr=delegate.createIdentifier(lex().value)}else if(type===Token.StringLiteral||type===Token.NumericLiteral){if(strict&&lookahead.octal){throwErrorTolerant(lookahead,Messages.StrictOctalLiteral)}expr=delegate.createLiteral(lex())}else if(type===Token.Keyword){if(matchKeyword("function")){return parseFunctionExpression()}if(matchKeyword("this")){lex();expr=delegate.createThisExpression()}else{throwUnexpected(lex())}}else if(type===Token.BooleanLiteral){token=lex();token.value=token.value==="true";expr=delegate.createLiteral(token)}else if(type===Token.NullLiteral){token=lex();token.value=null;expr=delegate.createLiteral(token)}else if(match("/")||match("/=")){if(typeof extra.tokens!=="undefined"){expr=delegate.createLiteral(collectRegex())}else{expr=delegate.createLiteral(scanRegExp())}peek()}else{throwUnexpected(lex())}return delegate.markEnd(expr,startToken)}function parseArguments(){var args=[];expect("(");if(!match(")")){while(index<length){args.push(parseAssignmentExpression());if(match(")")){break}expect(",")}}expect(")");return args}function parseNonComputedProperty(){var token,startToken;startToken=lookahead;token=lex();if(!isIdentifierName(token)){throwUnexpected(token)}return delegate.markEnd(delegate.createIdentifier(token.value),startToken)}function parseNonComputedMember(){expect(".");return parseNonComputedProperty()}function parseComputedMember(){var expr;expect("[");expr=parseExpression();expect("]");return expr}function parseNewExpression(){var callee,args,startToken;startToken=lookahead;expectKeyword("new");callee=parseLeftHandSideExpression();args=match("(")?parseArguments():[];return delegate.markEnd(delegate.createNewExpression(callee,args),startToken)}function parseLeftHandSideExpressionAllowCall(){var previousAllowIn,expr,args,property,startToken;startToken=lookahead;previousAllowIn=state.allowIn;state.allowIn=true;expr=matchKeyword("new")?parseNewExpression():parsePrimaryExpression();state.allowIn=previousAllowIn;for(;;){if(match(".")){property=parseNonComputedMember();expr=delegate.createMemberExpression(".",expr,property)}else if(match("(")){args=parseArguments();expr=delegate.createCallExpression(expr,args)}else if(match("[")){property=parseComputedMember();expr=delegate.createMemberExpression("[",expr,property)}else{break}delegate.markEnd(expr,startToken)}return expr}function parseLeftHandSideExpression(){var previousAllowIn,expr,property,startToken;startToken=lookahead;previousAllowIn=state.allowIn;expr=matchKeyword("new")?parseNewExpression():parsePrimaryExpression();state.allowIn=previousAllowIn;while(match(".")||match("[")){if(match("[")){property=parseComputedMember();expr=delegate.createMemberExpression("[",expr,property)}else{property=parseNonComputedMember();expr=delegate.createMemberExpression(".",expr,property)}delegate.markEnd(expr,startToken)}return expr}function parsePostfixExpression(){var expr,token,startToken=lookahead;expr=parseLeftHandSideExpressionAllowCall();if(lookahead.type===Token.Punctuator){if((match("++")||match("--"))&&!peekLineTerminator()){if(strict&&expr.type===Syntax.Identifier&&isRestrictedWord(expr.name)){throwErrorTolerant({},Messages.StrictLHSPostfix)}if(!isLeftHandSide(expr)){throwErrorTolerant({},Messages.InvalidLHSInAssignment)}token=lex();expr=delegate.markEnd(delegate.createPostfixExpression(token.value,expr),startToken)}}return expr}function parseUnaryExpression(){var token,expr,startToken;if(lookahead.type!==Token.Punctuator&&lookahead.type!==Token.Keyword){expr=parsePostfixExpression()}else if(match("++")||match("--")){startToken=lookahead;token=lex();expr=parseUnaryExpression();if(strict&&expr.type===Syntax.Identifier&&isRestrictedWord(expr.name)){throwErrorTolerant({},Messages.StrictLHSPrefix)}if(!isLeftHandSide(expr)){throwErrorTolerant({},Messages.InvalidLHSInAssignment)}expr=delegate.createUnaryExpression(token.value,expr);expr=delegate.markEnd(expr,startToken)}else if(match("+")||match("-")||match("~")||match("!")){startToken=lookahead;token=lex();expr=parseUnaryExpression();expr=delegate.createUnaryExpression(token.value,expr);expr=delegate.markEnd(expr,startToken)}else if(matchKeyword("delete")||matchKeyword("void")||matchKeyword("typeof")){startToken=lookahead;token=lex();expr=parseUnaryExpression();expr=delegate.createUnaryExpression(token.value,expr);expr=delegate.markEnd(expr,startToken);if(strict&&expr.operator==="delete"&&expr.argument.type===Syntax.Identifier){throwErrorTolerant({},Messages.StrictDelete)}}else{expr=parsePostfixExpression()}return expr}function binaryPrecedence(token,allowIn){var prec=0;if(token.type!==Token.Punctuator&&token.type!==Token.Keyword){return 0}switch(token.value){case"||":prec=1;break;case"&&":prec=2;break;case"|":prec=3;break;case"^":prec=4;break;case"&":prec=5;break;case"==":case"!=":case"===":case"!==":prec=6;break;case"<":case">":case"<=":case">=":case"instanceof":prec=7;break;case"in":prec=allowIn?7:0;break;case"<<":case">>":case">>>":prec=8;break;case"+":case"-":prec=9;break;case"*":case"/":case"%":prec=11;break;default:break}return prec}function parseBinaryExpression(){var marker,markers,expr,token,prec,stack,right,operator,left,i;marker=lookahead;left=parseUnaryExpression();token=lookahead;prec=binaryPrecedence(token,state.allowIn);if(prec===0){return left}token.prec=prec;lex();markers=[marker,lookahead];right=parseUnaryExpression();stack=[left,token,right];while((prec=binaryPrecedence(lookahead,state.allowIn))>0){while(stack.length>2&&prec<=stack[stack.length-2].prec){right=stack.pop();operator=stack.pop().value;left=stack.pop();expr=delegate.createBinaryExpression(operator,left,right);markers.pop();marker=markers[markers.length-1];delegate.markEnd(expr,marker);stack.push(expr)}token=lex();token.prec=prec;stack.push(token);markers.push(lookahead);expr=parseUnaryExpression();stack.push(expr)}i=stack.length-1;expr=stack[i];markers.pop();while(i>1){expr=delegate.createBinaryExpression(stack[i-1].value,stack[i-2],expr);i-=2;marker=markers.pop();delegate.markEnd(expr,marker)}return expr}function parseConditionalExpression(){var expr,previousAllowIn,consequent,alternate,startToken;startToken=lookahead;expr=parseBinaryExpression();if(match("?")){lex();previousAllowIn=state.allowIn;state.allowIn=true;consequent=parseAssignmentExpression();state.allowIn=previousAllowIn;expect(":");alternate=parseAssignmentExpression();expr=delegate.createConditionalExpression(expr,consequent,alternate);delegate.markEnd(expr,startToken)}return expr}function parseAssignmentExpression(){var token,left,right,node,startToken;token=lookahead;startToken=lookahead;node=left=parseConditionalExpression();if(matchAssign()){if(!isLeftHandSide(left)){throwErrorTolerant({},Messages.InvalidLHSInAssignment)}if(strict&&left.type===Syntax.Identifier&&isRestrictedWord(left.name)){throwErrorTolerant(token,Messages.StrictLHSAssignment)}token=lex();right=parseAssignmentExpression();node=delegate.markEnd(delegate.createAssignmentExpression(token.value,left,right),startToken)}return node}function parseExpression(){var expr,startToken=lookahead;expr=parseAssignmentExpression();if(match(",")){expr=delegate.createSequenceExpression([expr]);while(index<length){if(!match(",")){break}lex();expr.expressions.push(parseAssignmentExpression())}delegate.markEnd(expr,startToken)}return expr}function parseStatementList(){var list=[],statement;while(index<length){if(match("}")){break}statement=parseSourceElement();if(typeof statement==="undefined"){break}list.push(statement)}return list}function parseBlock(){var block,startToken;startToken=lookahead;expect("{");block=parseStatementList();expect("}");return delegate.markEnd(delegate.createBlockStatement(block),startToken)}function parseVariableIdentifier(){var token,startToken;startToken=lookahead;token=lex();if(token.type!==Token.Identifier){throwUnexpected(token)}return delegate.markEnd(delegate.createIdentifier(token.value),startToken)}function parseVariableDeclaration(kind){var init=null,id,startToken;startToken=lookahead;id=parseVariableIdentifier();if(strict&&isRestrictedWord(id.name)){throwErrorTolerant({},Messages.StrictVarName)}if(kind==="const"){expect("=");init=parseAssignmentExpression()}else if(match("=")){lex();init=parseAssignmentExpression()}return delegate.markEnd(delegate.createVariableDeclarator(id,init),startToken)}function parseVariableDeclarationList(kind){var list=[];do{list.push(parseVariableDeclaration(kind));if(!match(",")){break}lex()}while(index<length);return list}function parseVariableStatement(){var declarations;expectKeyword("var");declarations=parseVariableDeclarationList();consumeSemicolon();return delegate.createVariableDeclaration(declarations,"var")}function parseConstLetDeclaration(kind){var declarations,startToken;startToken=lookahead;expectKeyword(kind);declarations=parseVariableDeclarationList(kind);consumeSemicolon();return delegate.markEnd(delegate.createVariableDeclaration(declarations,kind),startToken)}function parseEmptyStatement(){expect(";");return delegate.createEmptyStatement()}function parseExpressionStatement(){var expr=parseExpression();consumeSemicolon();return delegate.createExpressionStatement(expr)}function parseIfStatement(){var test,consequent,alternate;expectKeyword("if");expect("(");test=parseExpression();expect(")");consequent=parseStatement();if(matchKeyword("else")){lex();alternate=parseStatement()}else{alternate=null}return delegate.createIfStatement(test,consequent,alternate)}function parseDoWhileStatement(){var body,test,oldInIteration;expectKeyword("do");oldInIteration=state.inIteration;state.inIteration=true;body=parseStatement();state.inIteration=oldInIteration;expectKeyword("while");expect("(");test=parseExpression();expect(")");if(match(";")){lex()}return delegate.createDoWhileStatement(body,test)}function parseWhileStatement(){var test,body,oldInIteration;expectKeyword("while");expect("(");test=parseExpression();expect(")");
oldInIteration=state.inIteration;state.inIteration=true;body=parseStatement();state.inIteration=oldInIteration;return delegate.createWhileStatement(test,body)}function parseForVariableDeclaration(){var token,declarations,startToken;startToken=lookahead;token=lex();declarations=parseVariableDeclarationList();return delegate.markEnd(delegate.createVariableDeclaration(declarations,token.value),startToken)}function parseForStatement(){var init,test,update,left,right,body,oldInIteration;init=test=update=null;expectKeyword("for");expect("(");if(match(";")){lex()}else{if(matchKeyword("var")||matchKeyword("let")){state.allowIn=false;init=parseForVariableDeclaration();state.allowIn=true;if(init.declarations.length===1&&matchKeyword("in")){lex();left=init;right=parseExpression();init=null}}else{state.allowIn=false;init=parseExpression();state.allowIn=true;if(matchKeyword("in")){if(!isLeftHandSide(init)){throwErrorTolerant({},Messages.InvalidLHSInForIn)}lex();left=init;right=parseExpression();init=null}}if(typeof left==="undefined"){expect(";")}}if(typeof left==="undefined"){if(!match(";")){test=parseExpression()}expect(";");if(!match(")")){update=parseExpression()}}expect(")");oldInIteration=state.inIteration;state.inIteration=true;body=parseStatement();state.inIteration=oldInIteration;return typeof left==="undefined"?delegate.createForStatement(init,test,update,body):delegate.createForInStatement(left,right,body)}function parseContinueStatement(){var label=null,key;expectKeyword("continue");if(source.charCodeAt(index)===59){lex();if(!state.inIteration){throwError({},Messages.IllegalContinue)}return delegate.createContinueStatement(null)}if(peekLineTerminator()){if(!state.inIteration){throwError({},Messages.IllegalContinue)}return delegate.createContinueStatement(null)}if(lookahead.type===Token.Identifier){label=parseVariableIdentifier();key="$"+label.name;if(!Object.prototype.hasOwnProperty.call(state.labelSet,key)){throwError({},Messages.UnknownLabel,label.name)}}consumeSemicolon();if(label===null&&!state.inIteration){throwError({},Messages.IllegalContinue)}return delegate.createContinueStatement(label)}function parseBreakStatement(){var label=null,key;expectKeyword("break");if(source.charCodeAt(index)===59){lex();if(!(state.inIteration||state.inSwitch)){throwError({},Messages.IllegalBreak)}return delegate.createBreakStatement(null)}if(peekLineTerminator()){if(!(state.inIteration||state.inSwitch)){throwError({},Messages.IllegalBreak)}return delegate.createBreakStatement(null)}if(lookahead.type===Token.Identifier){label=parseVariableIdentifier();key="$"+label.name;if(!Object.prototype.hasOwnProperty.call(state.labelSet,key)){throwError({},Messages.UnknownLabel,label.name)}}consumeSemicolon();if(label===null&&!(state.inIteration||state.inSwitch)){throwError({},Messages.IllegalBreak)}return delegate.createBreakStatement(label)}function parseReturnStatement(){var argument=null;expectKeyword("return");if(!state.inFunctionBody){throwErrorTolerant({},Messages.IllegalReturn)}if(source.charCodeAt(index)===32){if(isIdentifierStart(source.charCodeAt(index+1))){argument=parseExpression();consumeSemicolon();return delegate.createReturnStatement(argument)}}if(peekLineTerminator()){return delegate.createReturnStatement(null)}if(!match(";")){if(!match("}")&&lookahead.type!==Token.EOF){argument=parseExpression()}}consumeSemicolon();return delegate.createReturnStatement(argument)}function parseWithStatement(){var object,body;if(strict){skipComment();throwErrorTolerant({},Messages.StrictModeWith)}expectKeyword("with");expect("(");object=parseExpression();expect(")");body=parseStatement();return delegate.createWithStatement(object,body)}function parseSwitchCase(){var test,consequent=[],statement,startToken;startToken=lookahead;if(matchKeyword("default")){lex();test=null}else{expectKeyword("case");test=parseExpression()}expect(":");while(index<length){if(match("}")||matchKeyword("default")||matchKeyword("case")){break}statement=parseStatement();consequent.push(statement)}return delegate.markEnd(delegate.createSwitchCase(test,consequent),startToken)}function parseSwitchStatement(){var discriminant,cases,clause,oldInSwitch,defaultFound;expectKeyword("switch");expect("(");discriminant=parseExpression();expect(")");expect("{");cases=[];if(match("}")){lex();return delegate.createSwitchStatement(discriminant,cases)}oldInSwitch=state.inSwitch;state.inSwitch=true;defaultFound=false;while(index<length){if(match("}")){break}clause=parseSwitchCase();if(clause.test===null){if(defaultFound){throwError({},Messages.MultipleDefaultsInSwitch)}defaultFound=true}cases.push(clause)}state.inSwitch=oldInSwitch;expect("}");return delegate.createSwitchStatement(discriminant,cases)}function parseThrowStatement(){var argument;expectKeyword("throw");if(peekLineTerminator()){throwError({},Messages.NewlineAfterThrow)}argument=parseExpression();consumeSemicolon();return delegate.createThrowStatement(argument)}function parseCatchClause(){var param,body,startToken;startToken=lookahead;expectKeyword("catch");expect("(");if(match(")")){throwUnexpected(lookahead)}param=parseVariableIdentifier();if(strict&&isRestrictedWord(param.name)){throwErrorTolerant({},Messages.StrictCatchVariable)}expect(")");body=parseBlock();return delegate.markEnd(delegate.createCatchClause(param,body),startToken)}function parseTryStatement(){var block,handlers=[],finalizer=null;expectKeyword("try");block=parseBlock();if(matchKeyword("catch")){handlers.push(parseCatchClause())}if(matchKeyword("finally")){lex();finalizer=parseBlock()}if(handlers.length===0&&!finalizer){throwError({},Messages.NoCatchOrFinally)}return delegate.createTryStatement(block,[],handlers,finalizer)}function parseDebuggerStatement(){expectKeyword("debugger");consumeSemicolon();return delegate.createDebuggerStatement()}function parseStatement(){var type=lookahead.type,expr,labeledBody,key,startToken;if(type===Token.EOF){throwUnexpected(lookahead)}if(type===Token.Punctuator&&lookahead.value==="{"){return parseBlock()}startToken=lookahead;if(type===Token.Punctuator){switch(lookahead.value){case";":return delegate.markEnd(parseEmptyStatement(),startToken);case"(":return delegate.markEnd(parseExpressionStatement(),startToken);default:break}}if(type===Token.Keyword){switch(lookahead.value){case"break":return delegate.markEnd(parseBreakStatement(),startToken);case"continue":return delegate.markEnd(parseContinueStatement(),startToken);case"debugger":return delegate.markEnd(parseDebuggerStatement(),startToken);case"do":return delegate.markEnd(parseDoWhileStatement(),startToken);case"for":return delegate.markEnd(parseForStatement(),startToken);case"function":return delegate.markEnd(parseFunctionDeclaration(),startToken);case"if":return delegate.markEnd(parseIfStatement(),startToken);case"return":return delegate.markEnd(parseReturnStatement(),startToken);case"switch":return delegate.markEnd(parseSwitchStatement(),startToken);case"throw":return delegate.markEnd(parseThrowStatement(),startToken);case"try":return delegate.markEnd(parseTryStatement(),startToken);case"var":return delegate.markEnd(parseVariableStatement(),startToken);case"while":return delegate.markEnd(parseWhileStatement(),startToken);case"with":return delegate.markEnd(parseWithStatement(),startToken);default:break}}expr=parseExpression();if(expr.type===Syntax.Identifier&&match(":")){lex();key="$"+expr.name;if(Object.prototype.hasOwnProperty.call(state.labelSet,key)){throwError({},Messages.Redeclaration,"Label",expr.name)}state.labelSet[key]=true;labeledBody=parseStatement();delete state.labelSet[key];return delegate.markEnd(delegate.createLabeledStatement(expr,labeledBody),startToken)}consumeSemicolon();return delegate.markEnd(delegate.createExpressionStatement(expr),startToken)}function parseFunctionSourceElements(){var sourceElement,sourceElements=[],token,directive,firstRestricted,oldLabelSet,oldInIteration,oldInSwitch,oldInFunctionBody,startToken;startToken=lookahead;expect("{");while(index<length){if(lookahead.type!==Token.StringLiteral){break}token=lookahead;sourceElement=parseSourceElement();sourceElements.push(sourceElement);if(sourceElement.expression.type!==Syntax.Literal){break}directive=source.slice(token.start+1,token.end-1);if(directive==="use strict"){strict=true;if(firstRestricted){throwErrorTolerant(firstRestricted,Messages.StrictOctalLiteral)}}else{if(!firstRestricted&&token.octal){firstRestricted=token}}}oldLabelSet=state.labelSet;oldInIteration=state.inIteration;oldInSwitch=state.inSwitch;oldInFunctionBody=state.inFunctionBody;state.labelSet={};state.inIteration=false;state.inSwitch=false;state.inFunctionBody=true;while(index<length){if(match("}")){break}sourceElement=parseSourceElement();if(typeof sourceElement==="undefined"){break}sourceElements.push(sourceElement)}expect("}");state.labelSet=oldLabelSet;state.inIteration=oldInIteration;state.inSwitch=oldInSwitch;state.inFunctionBody=oldInFunctionBody;return delegate.markEnd(delegate.createBlockStatement(sourceElements),startToken)}function parseParams(firstRestricted){var param,params=[],token,stricted,paramSet,key,message;expect("(");if(!match(")")){paramSet={};while(index<length){token=lookahead;param=parseVariableIdentifier();key="$"+token.value;if(strict){if(isRestrictedWord(token.value)){stricted=token;message=Messages.StrictParamName}if(Object.prototype.hasOwnProperty.call(paramSet,key)){stricted=token;message=Messages.StrictParamDupe}}else if(!firstRestricted){if(isRestrictedWord(token.value)){firstRestricted=token;message=Messages.StrictParamName}else if(isStrictModeReservedWord(token.value)){firstRestricted=token;message=Messages.StrictReservedWord}else if(Object.prototype.hasOwnProperty.call(paramSet,key)){firstRestricted=token;message=Messages.StrictParamDupe}}params.push(param);paramSet[key]=true;if(match(")")){break}expect(",")}}expect(")");return{params:params,stricted:stricted,firstRestricted:firstRestricted,message:message}}function parseFunctionDeclaration(){var id,params=[],body,token,stricted,tmp,firstRestricted,message,previousStrict,startToken;startToken=lookahead;expectKeyword("function");token=lookahead;id=parseVariableIdentifier();if(strict){if(isRestrictedWord(token.value)){throwErrorTolerant(token,Messages.StrictFunctionName)}}else{if(isRestrictedWord(token.value)){firstRestricted=token;message=Messages.StrictFunctionName}else if(isStrictModeReservedWord(token.value)){firstRestricted=token;message=Messages.StrictReservedWord}}tmp=parseParams(firstRestricted);params=tmp.params;stricted=tmp.stricted;firstRestricted=tmp.firstRestricted;if(tmp.message){message=tmp.message}previousStrict=strict;body=parseFunctionSourceElements();if(strict&&firstRestricted){throwError(firstRestricted,message)}if(strict&&stricted){throwErrorTolerant(stricted,message)}strict=previousStrict;return delegate.markEnd(delegate.createFunctionDeclaration(id,params,[],body),startToken)}function parseFunctionExpression(){var token,id=null,stricted,firstRestricted,message,tmp,params=[],body,previousStrict,startToken;startToken=lookahead;expectKeyword("function");if(!match("(")){token=lookahead;id=parseVariableIdentifier();if(strict){if(isRestrictedWord(token.value)){throwErrorTolerant(token,Messages.StrictFunctionName)}}else{if(isRestrictedWord(token.value)){firstRestricted=token;message=Messages.StrictFunctionName}else if(isStrictModeReservedWord(token.value)){firstRestricted=token;message=Messages.StrictReservedWord}}}tmp=parseParams(firstRestricted);params=tmp.params;stricted=tmp.stricted;firstRestricted=tmp.firstRestricted;if(tmp.message){message=tmp.message}previousStrict=strict;body=parseFunctionSourceElements();if(strict&&firstRestricted){throwError(firstRestricted,message)}if(strict&&stricted){throwErrorTolerant(stricted,message)}strict=previousStrict;return delegate.markEnd(delegate.createFunctionExpression(id,params,[],body),startToken)}function parseSourceElement(){if(lookahead.type===Token.Keyword){switch(lookahead.value){case"const":case"let":return parseConstLetDeclaration(lookahead.value);case"function":return parseFunctionDeclaration();default:return parseStatement()}}if(lookahead.type!==Token.EOF){return parseStatement()}}function parseSourceElements(){var sourceElement,sourceElements=[],token,directive,firstRestricted;while(index<length){token=lookahead;if(token.type!==Token.StringLiteral){break}sourceElement=parseSourceElement();sourceElements.push(sourceElement);if(sourceElement.expression.type!==Syntax.Literal){break}directive=source.slice(token.start+1,token.end-1);if(directive==="use strict"){strict=true;if(firstRestricted){throwErrorTolerant(firstRestricted,Messages.StrictOctalLiteral)}}else{if(!firstRestricted&&token.octal){firstRestricted=token}}}while(index<length){sourceElement=parseSourceElement();if(typeof sourceElement==="undefined"){break}sourceElements.push(sourceElement)}return sourceElements}function parseProgram(){var body,startToken;skipComment();peek();startToken=lookahead;strict=false;body=parseSourceElements();return delegate.markEnd(delegate.createProgram(body),startToken)}function filterTokenLocation(){var i,entry,token,tokens=[];for(i=0;i<extra.tokens.length;++i){entry=extra.tokens[i];token={type:entry.type,value:entry.value};if(extra.range){token.range=entry.range}if(extra.loc){token.loc=entry.loc}tokens.push(token)}extra.tokens=tokens}function tokenize(code,options){var toString,token,tokens;toString=String;if(typeof code!=="string"&&!(code instanceof String)){code=toString(code)}delegate=SyntaxTreeDelegate;source=code;index=0;lineNumber=source.length>0?1:0;lineStart=0;length=source.length;lookahead=null;state={allowIn:true,labelSet:{},inFunctionBody:false,inIteration:false,inSwitch:false,lastCommentStart:-1};extra={};options=options||{};options.tokens=true;extra.tokens=[];extra.tokenize=true;extra.openParenToken=-1;extra.openCurlyToken=-1;extra.range=typeof options.range==="boolean"&&options.range;extra.loc=typeof options.loc==="boolean"&&options.loc;if(typeof options.comment==="boolean"&&options.comment){extra.comments=[]}if(typeof options.tolerant==="boolean"&&options.tolerant){extra.errors=[]}try{peek();if(lookahead.type===Token.EOF){return extra.tokens}token=lex();while(lookahead.type!==Token.EOF){try{token=lex()}catch(lexError){token=lookahead;if(extra.errors){extra.errors.push(lexError);break}else{throw lexError}}}filterTokenLocation();tokens=extra.tokens;if(typeof extra.comments!=="undefined"){tokens.comments=extra.comments}if(typeof extra.errors!=="undefined"){tokens.errors=extra.errors}}catch(e){throw e}finally{extra={}}return tokens}function parse(code,options){var program,toString;toString=String;if(typeof code!=="string"&&!(code instanceof String)){code=toString(code)}delegate=SyntaxTreeDelegate;source=code;index=0;lineNumber=source.length>0?1:0;lineStart=0;length=source.length;lookahead=null;state={allowIn:true,labelSet:{},inFunctionBody:false,inIteration:false,inSwitch:false,lastCommentStart:-1};extra={};if(typeof options!=="undefined"){extra.range=typeof options.range==="boolean"&&options.range;extra.loc=typeof options.loc==="boolean"&&options.loc;extra.attachComment=typeof options.attachComment==="boolean"&&options.attachComment;if(extra.loc&&options.source!==null&&options.source!==undefined){extra.source=toString(options.source)}if(typeof options.tokens==="boolean"&&options.tokens){extra.tokens=[]}if(typeof options.comment==="boolean"&&options.comment){extra.comments=[]}if(typeof options.tolerant==="boolean"&&options.tolerant){extra.errors=[]}if(extra.attachComment){extra.range=true;extra.comments=[];extra.bottomRightStack=[];extra.trailingComments=[];extra.leadingComments=[]}}try{program=parseProgram();if(typeof extra.comments!=="undefined"){program.comments=extra.comments}if(typeof extra.tokens!=="undefined"){filterTokenLocation();program.tokens=extra.tokens}if(typeof extra.errors!=="undefined"){program.errors=extra.errors}}catch(e){throw e}finally{extra={}}return program}exports.version="1.2.2";exports.tokenize=tokenize;exports.parse=parse;exports.Syntax=function(){var name,types={};if(typeof Object.create==="function"){types=Object.create(null)}for(name in Syntax){if(Syntax.hasOwnProperty(name)){types[name]=Syntax[name]}}if(typeof Object.freeze==="function"){Object.freeze(types)}return types}()})},{}],149:[function(require,module,exports){(function(root,factory){"use strict";if(typeof define==="function"&&define.amd){define(["exports"],factory)}else if(typeof exports!=="undefined"){factory(exports)}else{factory(root.esprima={})}})(this,function(exports){"use strict";var Token,TokenName,FnExprTokens,Syntax,PropertyKind,Messages,Regex,SyntaxTreeDelegate,XHTMLEntities,ClassPropertyType,source,strict,index,lineNumber,lineStart,length,delegate,lookahead,state,extra;Token={BooleanLiteral:1,EOF:2,Identifier:3,Keyword:4,NullLiteral:5,NumericLiteral:6,Punctuator:7,StringLiteral:8,RegularExpression:9,Template:10,XJSIdentifier:11,XJSText:12};TokenName={};TokenName[Token.BooleanLiteral]="Boolean";TokenName[Token.EOF]="<end>";TokenName[Token.Identifier]="Identifier";TokenName[Token.Keyword]="Keyword";TokenName[Token.NullLiteral]="Null";TokenName[Token.NumericLiteral]="Numeric";TokenName[Token.Punctuator]="Punctuator";TokenName[Token.StringLiteral]="String";TokenName[Token.XJSIdentifier]="XJSIdentifier";TokenName[Token.XJSText]="XJSText";TokenName[Token.RegularExpression]="RegularExpression";FnExprTokens=["(","{","[","in","typeof","instanceof","new","return","case","delete","throw","void","=","+=","-=","*=","/=","%=","<<=",">>=",">>>=","&=","|=","^=",",","+","-","*","/","%","++","--","<<",">>",">>>","&","|","^","!","~","&&","||","?",":","===","==",">=","<=","<",">","!=","!=="];Syntax={ArrayExpression:"ArrayExpression",ArrayPattern:"ArrayPattern",ArrowFunctionExpression:"ArrowFunctionExpression",AssignmentExpression:"AssignmentExpression",BinaryExpression:"BinaryExpression",BlockStatement:"BlockStatement",BreakStatement:"BreakStatement",CallExpression:"CallExpression",CatchClause:"CatchClause",ClassBody:"ClassBody",ClassDeclaration:"ClassDeclaration",ClassExpression:"ClassExpression",ClassProperty:"ClassProperty",ComprehensionBlock:"ComprehensionBlock",ComprehensionExpression:"ComprehensionExpression",ConditionalExpression:"ConditionalExpression",ContinueStatement:"ContinueStatement",DebuggerStatement:"DebuggerStatement",DoWhileStatement:"DoWhileStatement",EmptyStatement:"EmptyStatement",ExportDeclaration:"ExportDeclaration",ExportBatchSpecifier:"ExportBatchSpecifier",ExportSpecifier:"ExportSpecifier",ExpressionStatement:"ExpressionStatement",ForInStatement:"ForInStatement",ForOfStatement:"ForOfStatement",ForStatement:"ForStatement",FunctionDeclaration:"FunctionDeclaration",FunctionExpression:"FunctionExpression",Identifier:"Identifier",IfStatement:"IfStatement",ImportDeclaration:"ImportDeclaration",ImportSpecifier:"ImportSpecifier",LabeledStatement:"LabeledStatement",Literal:"Literal",LogicalExpression:"LogicalExpression",MemberExpression:"MemberExpression",MethodDefinition:"MethodDefinition",ModuleDeclaration:"ModuleDeclaration",NewExpression:"NewExpression",ObjectExpression:"ObjectExpression",ObjectPattern:"ObjectPattern",ObjectTypeAnnotation:"ObjectTypeAnnotation",OptionalParameter:"OptionalParameter",ParametricTypeAnnotation:"ParametricTypeAnnotation",ParametricallyTypedIdentifier:"ParametricallyTypedIdentifier",Program:"Program",Property:"Property",ReturnStatement:"ReturnStatement",SequenceExpression:"SequenceExpression",SpreadElement:"SpreadElement",SpreadProperty:"SpreadProperty",SwitchCase:"SwitchCase",SwitchStatement:"SwitchStatement",TaggedTemplateExpression:"TaggedTemplateExpression",TemplateElement:"TemplateElement",TemplateLiteral:"TemplateLiteral",ThisExpression:"ThisExpression",ThrowStatement:"ThrowStatement",TryStatement:"TryStatement",TypeAnnotatedIdentifier:"TypeAnnotatedIdentifier",TypeAnnotation:"TypeAnnotation",UnaryExpression:"UnaryExpression",UpdateExpression:"UpdateExpression",VariableDeclaration:"VariableDeclaration",VariableDeclarator:"VariableDeclarator",VoidTypeAnnotation:"VoidTypeAnnotation",WhileStatement:"WhileStatement",WithStatement:"WithStatement",XJSIdentifier:"XJSIdentifier",XJSNamespacedName:"XJSNamespacedName",XJSMemberExpression:"XJSMemberExpression",XJSEmptyExpression:"XJSEmptyExpression",XJSExpressionContainer:"XJSExpressionContainer",XJSElement:"XJSElement",XJSClosingElement:"XJSClosingElement",XJSOpeningElement:"XJSOpeningElement",XJSAttribute:"XJSAttribute",XJSSpreadAttribute:"XJSSpreadAttribute",XJSText:"XJSText",YieldExpression:"YieldExpression"};PropertyKind={Data:1,Get:2,Set:4};ClassPropertyType={static:"static",prototype:"prototype"};Messages={UnexpectedToken:"Unexpected token %0",UnexpectedNumber:"Unexpected number",UnexpectedString:"Unexpected string",UnexpectedIdentifier:"Unexpected identifier",UnexpectedReserved:"Unexpected reserved word",UnexpectedTemplate:"Unexpected quasi %0",UnexpectedEOS:"Unexpected end of input",NewlineAfterThrow:"Illegal newline after throw",InvalidRegExp:"Invalid regular expression",UnterminatedRegExp:"Invalid regular expression: missing /",InvalidLHSInAssignment:"Invalid left-hand side in assignment",InvalidLHSInFormalsList:"Invalid left-hand side in formals list",InvalidLHSInForIn:"Invalid left-hand side in for-in",MultipleDefaultsInSwitch:"More than one default clause in switch statement",NoCatchOrFinally:"Missing catch or finally after try",UnknownLabel:"Undefined label '%0'",Redeclaration:"%0 '%1' has already been declared",IllegalContinue:"Illegal continue statement",IllegalBreak:"Illegal break statement",IllegalDuplicateClassProperty:"Illegal duplicate property in class definition",IllegalReturn:"Illegal return statement",IllegalYield:"Illegal yield expression",IllegalSpread:"Illegal spread element",StrictModeWith:"Strict mode code may not include a with statement",StrictCatchVariable:"Catch variable may not be eval or arguments in strict mode",StrictVarName:"Variable name may not be eval or arguments in strict mode",StrictParamName:"Parameter name eval or arguments is not allowed in strict mode",StrictParamDupe:"Strict mode function may not have duplicate parameter names",ParameterAfterRestParameter:"Rest parameter must be final parameter of an argument list",DefaultRestParameter:"Rest parameter can not have a default value",ElementAfterSpreadElement:"Spread must be the final element of an element list",PropertyAfterSpreadProperty:"A rest property must be the final property of an object literal",ObjectPatternAsRestParameter:"Invalid rest parameter",ObjectPatternAsSpread:"Invalid spread argument",StrictFunctionName:"Function name may not be eval or arguments in strict mode",StrictOctalLiteral:"Octal literals are not allowed in strict mode.",StrictDelete:"Delete of an unqualified identifier in strict mode.",StrictDuplicateProperty:"Duplicate data property in object literal not allowed in strict mode",AccessorDataProperty:"Object literal may not have data and accessor property with the same name",AccessorGetSet:"Object literal may not have multiple get/set accessors with the same name",StrictLHSAssignment:"Assignment to eval or arguments is not allowed in strict mode",StrictLHSPostfix:"Postfix increment/decrement may not have eval or arguments operand in strict mode",StrictLHSPrefix:"Prefix increment/decrement may not have eval or arguments operand in strict mode",StrictReservedWord:"Use of future reserved word in strict mode",NewlineAfterModule:"Illegal newline after module",NoFromAfterImport:"Missing from after import",InvalidModuleSpecifier:"Invalid module specifier",NestedModule:"Module declaration can not be nested",NoUnintializedConst:"Const must be initialized",ComprehensionRequiresBlock:"Comprehension must have at least one block",ComprehensionError:"Comprehension Error",EachNotAllowed:"Each is not supported",InvalidXJSAttributeValue:"XJS value should be either an expression or a quoted XJS text",ExpectedXJSClosingTag:"Expected corresponding XJS closing tag for %0",AdjacentXJSElements:"Adjacent XJS elements must be wrapped in an enclosing tag"};Regex={NonAsciiIdentifierStart:new RegExp("[------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------]"),NonAsciiIdentifierPart:new RegExp("[------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------]")};function assert(condition,message){if(!condition){throw new Error("ASSERT: "+message)}}function isDecimalDigit(ch){return ch>=48&&ch<=57}function isHexDigit(ch){return"0123456789abcdefABCDEF".indexOf(ch)>=0}function isOctalDigit(ch){return"01234567".indexOf(ch)>=0}function isWhiteSpace(ch){return ch===32||ch===9||ch===11||ch===12||ch===160||ch>=5760&&"".indexOf(String.fromCharCode(ch))>0}function isLineTerminator(ch){return ch===10||ch===13||ch===8232||ch===8233}function isIdentifierStart(ch){return ch===36||ch===95||ch>=65&&ch<=90||ch>=97&&ch<=122||ch===92||ch>=128&&Regex.NonAsciiIdentifierStart.test(String.fromCharCode(ch))}function isIdentifierPart(ch){return ch===36||ch===95||ch>=65&&ch<=90||ch>=97&&ch<=122||ch>=48&&ch<=57||ch===92||ch>=128&&Regex.NonAsciiIdentifierPart.test(String.fromCharCode(ch))}function isFutureReservedWord(id){switch(id){case"class":case"enum":case"export":case"extends":case"import":case"super":return true;default:return false}}function isStrictModeReservedWord(id){switch(id){case"implements":case"interface":case"package":case"private":case"protected":case"public":case"static":case"yield":case"let":return true;default:return false}}function isRestrictedWord(id){return id==="eval"||id==="arguments"}function isKeyword(id){if(strict&&isStrictModeReservedWord(id)){return true}switch(id.length){case 2:return id==="if"||id==="in"||id==="do";case 3:return id==="var"||id==="for"||id==="new"||id==="try"||id==="let";case 4:return id==="this"||id==="else"||id==="case"||id==="void"||id==="with"||id==="enum";case 5:return id==="while"||id==="break"||id==="catch"||id==="throw"||id==="const"||id==="class"||id==="super";case 6:return id==="return"||id==="typeof"||id==="delete"||id==="switch"||id==="export"||id==="import";case 7:return id==="default"||id==="finally"||id==="extends";case 8:return id==="function"||id==="continue"||id==="debugger";case 10:return id==="instanceof";default:return false}}function skipComment(){var ch,blockComment,lineComment;blockComment=false;lineComment=false;while(index<length){ch=source.charCodeAt(index);if(lineComment){++index;if(isLineTerminator(ch)){lineComment=false;if(ch===13&&source.charCodeAt(index)===10){++index}++lineNumber;lineStart=index}}else if(blockComment){if(isLineTerminator(ch)){if(ch===13){++index}if(ch!==13||source.charCodeAt(index)===10){++lineNumber;++index;lineStart=index;if(index>=length){throwError({},Messages.UnexpectedToken,"ILLEGAL")}}}else{ch=source.charCodeAt(index++);if(index>=length){throwError({},Messages.UnexpectedToken,"ILLEGAL")}if(ch===42){ch=source.charCodeAt(index);if(ch===47){++index;blockComment=false}}}}else if(ch===47){ch=source.charCodeAt(index+1);if(ch===47){index+=2;lineComment=true}else if(ch===42){index+=2;blockComment=true;if(index>=length){throwError({},Messages.UnexpectedToken,"ILLEGAL")}}else{break}}else if(isWhiteSpace(ch)){++index}else if(isLineTerminator(ch)){++index;if(ch===13&&source.charCodeAt(index)===10){++index}++lineNumber;lineStart=index}else{break}}}function scanHexEscape(prefix){var i,len,ch,code=0;len=prefix==="u"?4:2;for(i=0;i<len;++i){if(index<length&&isHexDigit(source[index])){ch=source[index++];code=code*16+"0123456789abcdef".indexOf(ch.toLowerCase())}else{return""}}return String.fromCharCode(code)}function scanUnicodeCodePointEscape(){var ch,code,cu1,cu2;ch=source[index];code=0;if(ch==="}"){throwError({},Messages.UnexpectedToken,"ILLEGAL")}while(index<length){ch=source[index++];if(!isHexDigit(ch)){break}code=code*16+"0123456789abcdef".indexOf(ch.toLowerCase())}if(code>1114111||ch!=="}"){throwError({},Messages.UnexpectedToken,"ILLEGAL")}if(code<=65535){return String.fromCharCode(code)}cu1=(code-65536>>10)+55296;cu2=(code-65536&1023)+56320;return String.fromCharCode(cu1,cu2)}function getEscapedIdentifier(){var ch,id;ch=source.charCodeAt(index++);id=String.fromCharCode(ch);if(ch===92){if(source.charCodeAt(index)!==117){throwError({},Messages.UnexpectedToken,"ILLEGAL")}++index;ch=scanHexEscape("u");if(!ch||ch==="\\"||!isIdentifierStart(ch.charCodeAt(0))){throwError({},Messages.UnexpectedToken,"ILLEGAL")}id=ch}while(index<length){ch=source.charCodeAt(index);if(!isIdentifierPart(ch)){break}++index;id+=String.fromCharCode(ch);if(ch===92){id=id.substr(0,id.length-1);if(source.charCodeAt(index)!==117){throwError({},Messages.UnexpectedToken,"ILLEGAL")}++index;ch=scanHexEscape("u");if(!ch||ch==="\\"||!isIdentifierPart(ch.charCodeAt(0))){throwError({},Messages.UnexpectedToken,"ILLEGAL")}id+=ch}}return id}function getIdentifier(){var start,ch;start=index++;while(index<length){ch=source.charCodeAt(index);if(ch===92){index=start;return getEscapedIdentifier()}if(isIdentifierPart(ch)){++index}else{break}}return source.slice(start,index)}function scanIdentifier(){var start,id,type;start=index;id=source.charCodeAt(index)===92?getEscapedIdentifier():getIdentifier();if(id.length===1){type=Token.Identifier}else if(isKeyword(id)){type=Token.Keyword}else if(id==="null"){type=Token.NullLiteral}else if(id==="true"||id==="false"){type=Token.BooleanLiteral}else{type=Token.Identifier}return{type:type,value:id,lineNumber:lineNumber,lineStart:lineStart,range:[start,index]}}function scanPunctuator(){var start=index,code=source.charCodeAt(index),code2,ch1=source[index],ch2,ch3,ch4;switch(code){case 40:case 41:case 59:case 44:case 123:case 125:case 91:case 93:case 58:case 63:case 126:++index;if(extra.tokenize){if(code===40){extra.openParenToken=extra.tokens.length}else if(code===123){extra.openCurlyToken=extra.tokens.length}}return{type:Token.Punctuator,value:String.fromCharCode(code),lineNumber:lineNumber,lineStart:lineStart,range:[start,index]};default:code2=source.charCodeAt(index+1);if(code2===61){switch(code){case 37:case 38:case 42:case 43:case 45:case 47:case 60:case 62:case 94:case 124:index+=2;return{type:Token.Punctuator,value:String.fromCharCode(code)+String.fromCharCode(code2),lineNumber:lineNumber,lineStart:lineStart,range:[start,index]};
case 33:case 61:index+=2;if(source.charCodeAt(index)===61){++index}return{type:Token.Punctuator,value:source.slice(start,index),lineNumber:lineNumber,lineStart:lineStart,range:[start,index]};default:break}}break}ch2=source[index+1];ch3=source[index+2];ch4=source[index+3];if(ch1===">"&&ch2===">"&&ch3===">"){if(ch4==="="){index+=4;return{type:Token.Punctuator,value:">>>=",lineNumber:lineNumber,lineStart:lineStart,range:[start,index]}}}if(ch1===">"&&ch2===">"&&ch3===">"){index+=3;return{type:Token.Punctuator,value:">>>",lineNumber:lineNumber,lineStart:lineStart,range:[start,index]}}if(ch1==="<"&&ch2==="<"&&ch3==="="){index+=3;return{type:Token.Punctuator,value:"<<=",lineNumber:lineNumber,lineStart:lineStart,range:[start,index]}}if(ch1===">"&&ch2===">"&&ch3==="="){index+=3;return{type:Token.Punctuator,value:">>=",lineNumber:lineNumber,lineStart:lineStart,range:[start,index]}}if(ch1==="."&&ch2==="."&&ch3==="."){index+=3;return{type:Token.Punctuator,value:"...",lineNumber:lineNumber,lineStart:lineStart,range:[start,index]}}if(ch1===ch2&&"+-<>&|".indexOf(ch1)>=0){index+=2;return{type:Token.Punctuator,value:ch1+ch2,lineNumber:lineNumber,lineStart:lineStart,range:[start,index]}}if(ch1==="="&&ch2===">"){index+=2;return{type:Token.Punctuator,value:"=>",lineNumber:lineNumber,lineStart:lineStart,range:[start,index]}}if("<>=!+-*%&|^/".indexOf(ch1)>=0){++index;return{type:Token.Punctuator,value:ch1,lineNumber:lineNumber,lineStart:lineStart,range:[start,index]}}if(ch1==="."){++index;return{type:Token.Punctuator,value:ch1,lineNumber:lineNumber,lineStart:lineStart,range:[start,index]}}throwError({},Messages.UnexpectedToken,"ILLEGAL")}function scanHexLiteral(start){var number="";while(index<length){if(!isHexDigit(source[index])){break}number+=source[index++]}if(number.length===0){throwError({},Messages.UnexpectedToken,"ILLEGAL")}if(isIdentifierStart(source.charCodeAt(index))){throwError({},Messages.UnexpectedToken,"ILLEGAL")}return{type:Token.NumericLiteral,value:parseInt("0x"+number,16),lineNumber:lineNumber,lineStart:lineStart,range:[start,index]}}function scanOctalLiteral(prefix,start){var number,octal;if(isOctalDigit(prefix)){octal=true;number="0"+source[index++]}else{octal=false;++index;number=""}while(index<length){if(!isOctalDigit(source[index])){break}number+=source[index++]}if(!octal&&number.length===0){throwError({},Messages.UnexpectedToken,"ILLEGAL")}if(isIdentifierStart(source.charCodeAt(index))||isDecimalDigit(source.charCodeAt(index))){throwError({},Messages.UnexpectedToken,"ILLEGAL")}return{type:Token.NumericLiteral,value:parseInt(number,8),octal:octal,lineNumber:lineNumber,lineStart:lineStart,range:[start,index]}}function scanNumericLiteral(){var number,start,ch,octal;ch=source[index];assert(isDecimalDigit(ch.charCodeAt(0))||ch===".","Numeric literal must start with a decimal digit or a decimal point");start=index;number="";if(ch!=="."){number=source[index++];ch=source[index];if(number==="0"){if(ch==="x"||ch==="X"){++index;return scanHexLiteral(start)}if(ch==="b"||ch==="B"){++index;number="";while(index<length){ch=source[index];if(ch!=="0"&&ch!=="1"){break}number+=source[index++]}if(number.length===0){throwError({},Messages.UnexpectedToken,"ILLEGAL")}if(index<length){ch=source.charCodeAt(index);if(isIdentifierStart(ch)||isDecimalDigit(ch)){throwError({},Messages.UnexpectedToken,"ILLEGAL")}}return{type:Token.NumericLiteral,value:parseInt(number,2),lineNumber:lineNumber,lineStart:lineStart,range:[start,index]}}if(ch==="o"||ch==="O"||isOctalDigit(ch)){return scanOctalLiteral(ch,start)}if(ch&&isDecimalDigit(ch.charCodeAt(0))){throwError({},Messages.UnexpectedToken,"ILLEGAL")}}while(isDecimalDigit(source.charCodeAt(index))){number+=source[index++]}ch=source[index]}if(ch==="."){number+=source[index++];while(isDecimalDigit(source.charCodeAt(index))){number+=source[index++]}ch=source[index]}if(ch==="e"||ch==="E"){number+=source[index++];ch=source[index];if(ch==="+"||ch==="-"){number+=source[index++]}if(isDecimalDigit(source.charCodeAt(index))){while(isDecimalDigit(source.charCodeAt(index))){number+=source[index++]}}else{throwError({},Messages.UnexpectedToken,"ILLEGAL")}}if(isIdentifierStart(source.charCodeAt(index))){throwError({},Messages.UnexpectedToken,"ILLEGAL")}return{type:Token.NumericLiteral,value:parseFloat(number),lineNumber:lineNumber,lineStart:lineStart,range:[start,index]}}function scanStringLiteral(){var str="",quote,start,ch,code,unescaped,restore,octal=false;quote=source[index];assert(quote==="'"||quote==='"',"String literal must starts with a quote");start=index;++index;while(index<length){ch=source[index++];if(ch===quote){quote="";break}else if(ch==="\\"){ch=source[index++];if(!ch||!isLineTerminator(ch.charCodeAt(0))){switch(ch){case"n":str+="\n";break;case"r":str+="\r";break;case"t":str+="	";break;case"u":case"x":if(source[index]==="{"){++index;str+=scanUnicodeCodePointEscape()}else{restore=index;unescaped=scanHexEscape(ch);if(unescaped){str+=unescaped}else{index=restore;str+=ch}}break;case"b":str+="\b";break;case"f":str+="\f";break;case"v":str+="";break;default:if(isOctalDigit(ch)){code="01234567".indexOf(ch);if(code!==0){octal=true}if(index<length&&isOctalDigit(source[index])){octal=true;code=code*8+"01234567".indexOf(source[index++]);if("0123".indexOf(ch)>=0&&index<length&&isOctalDigit(source[index])){code=code*8+"01234567".indexOf(source[index++])}}str+=String.fromCharCode(code)}else{str+=ch}break}}else{++lineNumber;if(ch==="\r"&&source[index]==="\n"){++index}lineStart=index}}else if(isLineTerminator(ch.charCodeAt(0))){break}else{str+=ch}}if(quote!==""){throwError({},Messages.UnexpectedToken,"ILLEGAL")}return{type:Token.StringLiteral,value:str,octal:octal,lineNumber:lineNumber,lineStart:lineStart,range:[start,index]}}function scanTemplate(){var cooked="",ch,start,terminated,tail,restore,unescaped,code,octal;terminated=false;tail=false;start=index;++index;while(index<length){ch=source[index++];if(ch==="`"){tail=true;terminated=true;break}else if(ch==="$"){if(source[index]==="{"){++index;terminated=true;break}cooked+=ch}else if(ch==="\\"){ch=source[index++];if(!isLineTerminator(ch.charCodeAt(0))){switch(ch){case"n":cooked+="\n";break;case"r":cooked+="\r";break;case"t":cooked+="	";break;case"u":case"x":if(source[index]==="{"){++index;cooked+=scanUnicodeCodePointEscape()}else{restore=index;unescaped=scanHexEscape(ch);if(unescaped){cooked+=unescaped}else{index=restore;cooked+=ch}}break;case"b":cooked+="\b";break;case"f":cooked+="\f";break;case"v":cooked+="";break;default:if(isOctalDigit(ch)){code="01234567".indexOf(ch);if(code!==0){octal=true}if(index<length&&isOctalDigit(source[index])){octal=true;code=code*8+"01234567".indexOf(source[index++]);if("0123".indexOf(ch)>=0&&index<length&&isOctalDigit(source[index])){code=code*8+"01234567".indexOf(source[index++])}}cooked+=String.fromCharCode(code)}else{cooked+=ch}break}}else{++lineNumber;if(ch==="\r"&&source[index]==="\n"){++index}lineStart=index}}else if(isLineTerminator(ch.charCodeAt(0))){++lineNumber;if(ch==="\r"&&source[index]==="\n"){++index}lineStart=index;cooked+="\n"}else{cooked+=ch}}if(!terminated){throwError({},Messages.UnexpectedToken,"ILLEGAL")}return{type:Token.Template,value:{cooked:cooked,raw:source.slice(start+1,index-(tail?1:2))},tail:tail,octal:octal,lineNumber:lineNumber,lineStart:lineStart,range:[start,index]}}function scanTemplateElement(option){var startsWith,template;lookahead=null;skipComment();startsWith=option.head?"`":"}";if(source[index]!==startsWith){throwError({},Messages.UnexpectedToken,"ILLEGAL")}template=scanTemplate();peek();return template}function scanRegExp(){var str,ch,start,pattern,flags,value,classMarker=false,restore,terminated=false;lookahead=null;skipComment();start=index;ch=source[index];assert(ch==="/","Regular expression literal must start with a slash");str=source[index++];while(index<length){ch=source[index++];str+=ch;if(classMarker){if(ch==="]"){classMarker=false}}else{if(ch==="\\"){ch=source[index++];if(isLineTerminator(ch.charCodeAt(0))){throwError({},Messages.UnterminatedRegExp)}str+=ch}else if(ch==="/"){terminated=true;break}else if(ch==="["){classMarker=true}else if(isLineTerminator(ch.charCodeAt(0))){throwError({},Messages.UnterminatedRegExp)}}}if(!terminated){throwError({},Messages.UnterminatedRegExp)}pattern=str.substr(1,str.length-2);flags="";while(index<length){ch=source[index];if(!isIdentifierPart(ch.charCodeAt(0))){break}++index;if(ch==="\\"&&index<length){ch=source[index];if(ch==="u"){++index;restore=index;ch=scanHexEscape("u");if(ch){flags+=ch;for(str+="\\u";restore<index;++restore){str+=source[restore]}}else{index=restore;flags+="u";str+="\\u"}}else{str+="\\"}}else{flags+=ch;str+=ch}}try{value=new RegExp(pattern,flags)}catch(e){throwError({},Messages.InvalidRegExp)}peek();if(extra.tokenize){return{type:Token.RegularExpression,value:value,lineNumber:lineNumber,lineStart:lineStart,range:[start,index]}}return{literal:str,value:value,range:[start,index]}}function isIdentifierName(token){return token.type===Token.Identifier||token.type===Token.Keyword||token.type===Token.BooleanLiteral||token.type===Token.NullLiteral}function advanceSlash(){var prevToken,checkToken;prevToken=extra.tokens[extra.tokens.length-1];if(!prevToken){return scanRegExp()}if(prevToken.type==="Punctuator"){if(prevToken.value===")"){checkToken=extra.tokens[extra.openParenToken-1];if(checkToken&&checkToken.type==="Keyword"&&(checkToken.value==="if"||checkToken.value==="while"||checkToken.value==="for"||checkToken.value==="with")){return scanRegExp()}return scanPunctuator()}if(prevToken.value==="}"){if(extra.tokens[extra.openCurlyToken-3]&&extra.tokens[extra.openCurlyToken-3].type==="Keyword"){checkToken=extra.tokens[extra.openCurlyToken-4];if(!checkToken){return scanPunctuator()}}else if(extra.tokens[extra.openCurlyToken-4]&&extra.tokens[extra.openCurlyToken-4].type==="Keyword"){checkToken=extra.tokens[extra.openCurlyToken-5];if(!checkToken){return scanRegExp()}}else{return scanPunctuator()}if(FnExprTokens.indexOf(checkToken.value)>=0){return scanPunctuator()}return scanRegExp()}return scanRegExp()}if(prevToken.type==="Keyword"){return scanRegExp()}return scanPunctuator()}function advance(){var ch;if(!state.inXJSChild){skipComment()}if(index>=length){return{type:Token.EOF,lineNumber:lineNumber,lineStart:lineStart,range:[index,index]}}if(state.inXJSChild){return advanceXJSChild()}ch=source.charCodeAt(index);if(ch===40||ch===41||ch===58){return scanPunctuator()}if(ch===39||ch===34){if(state.inXJSTag){return scanXJSStringLiteral()}return scanStringLiteral()}if(state.inXJSTag&&isXJSIdentifierStart(ch)){return scanXJSIdentifier()}if(ch===96){return scanTemplate()}if(isIdentifierStart(ch)){return scanIdentifier()}if(ch===46){if(isDecimalDigit(source.charCodeAt(index+1))){return scanNumericLiteral()}return scanPunctuator()}if(isDecimalDigit(ch)){return scanNumericLiteral()}if(extra.tokenize&&ch===47){return advanceSlash()}return scanPunctuator()}function lex(){var token;token=lookahead;index=token.range[1];lineNumber=token.lineNumber;lineStart=token.lineStart;lookahead=advance();index=token.range[1];lineNumber=token.lineNumber;lineStart=token.lineStart;return token}function peek(){var pos,line,start;pos=index;line=lineNumber;start=lineStart;lookahead=advance();index=pos;lineNumber=line;lineStart=start}function lookahead2(){var adv,pos,line,start,result;adv=typeof extra.advance==="function"?extra.advance:advance;pos=index;line=lineNumber;start=lineStart;if(lookahead===null){lookahead=adv()}index=lookahead.range[1];lineNumber=lookahead.lineNumber;lineStart=lookahead.lineStart;result=adv();index=pos;lineNumber=line;lineStart=start;return result}function markerCreate(){if(!extra.loc&&!extra.range){return undefined}skipComment();return{offset:index,line:lineNumber,col:index-lineStart}}function markerCreatePreserveWhitespace(){if(!extra.loc&&!extra.range){return undefined}return{offset:index,line:lineNumber,col:index-lineStart}}function processComment(node){var lastChild,trailingComments,bottomRight=extra.bottomRightStack,last=bottomRight[bottomRight.length-1];if(node.type===Syntax.Program){if(node.body.length>0){return}}if(extra.trailingComments.length>0){if(extra.trailingComments[0].range[0]>=node.range[1]){trailingComments=extra.trailingComments;extra.trailingComments=[]}else{extra.trailingComments.length=0}}else{if(last&&last.trailingComments&&last.trailingComments[0].range[0]>=node.range[1]){trailingComments=last.trailingComments;delete last.trailingComments}}if(last){while(last&&last.range[0]>=node.range[0]){lastChild=last;last=bottomRight.pop()}}if(lastChild){if(lastChild.leadingComments&&lastChild.leadingComments[lastChild.leadingComments.length-1].range[1]<=node.range[0]){node.leadingComments=lastChild.leadingComments;delete lastChild.leadingComments}}else if(extra.leadingComments.length>0&&extra.leadingComments[extra.leadingComments.length-1].range[1]<=node.range[0]){node.leadingComments=extra.leadingComments;extra.leadingComments=[]}if(trailingComments){node.trailingComments=trailingComments}bottomRight.push(node)}function markerApply(marker,node){if(extra.range){node.range=[marker.offset,index]}if(extra.loc){node.loc={start:{line:marker.line,column:marker.col},end:{line:lineNumber,column:index-lineStart}};node=delegate.postProcess(node)}if(extra.attachComment){processComment(node)}return node}SyntaxTreeDelegate={name:"SyntaxTree",postProcess:function(node){return node},createArrayExpression:function(elements){return{type:Syntax.ArrayExpression,elements:elements}},createAssignmentExpression:function(operator,left,right){return{type:Syntax.AssignmentExpression,operator:operator,left:left,right:right}},createBinaryExpression:function(operator,left,right){var type=operator==="||"||operator==="&&"?Syntax.LogicalExpression:Syntax.BinaryExpression;return{type:type,operator:operator,left:left,right:right}},createBlockStatement:function(body){return{type:Syntax.BlockStatement,body:body}},createBreakStatement:function(label){return{type:Syntax.BreakStatement,label:label}},createCallExpression:function(callee,args){return{type:Syntax.CallExpression,callee:callee,arguments:args}},createCatchClause:function(param,body){return{type:Syntax.CatchClause,param:param,body:body}},createConditionalExpression:function(test,consequent,alternate){return{type:Syntax.ConditionalExpression,test:test,consequent:consequent,alternate:alternate}},createContinueStatement:function(label){return{type:Syntax.ContinueStatement,label:label}},createDebuggerStatement:function(){return{type:Syntax.DebuggerStatement}},createDoWhileStatement:function(body,test){return{type:Syntax.DoWhileStatement,body:body,test:test}},createEmptyStatement:function(){return{type:Syntax.EmptyStatement}},createExpressionStatement:function(expression){return{type:Syntax.ExpressionStatement,expression:expression}},createForStatement:function(init,test,update,body){return{type:Syntax.ForStatement,init:init,test:test,update:update,body:body}},createForInStatement:function(left,right,body){return{type:Syntax.ForInStatement,left:left,right:right,body:body,each:false}},createForOfStatement:function(left,right,body){return{type:Syntax.ForOfStatement,left:left,right:right,body:body}},createFunctionDeclaration:function(id,params,defaults,body,rest,generator,expression,returnType,parametricType){return{type:Syntax.FunctionDeclaration,id:id,params:params,defaults:defaults,body:body,rest:rest,generator:generator,expression:expression,returnType:returnType,parametricType:parametricType}},createFunctionExpression:function(id,params,defaults,body,rest,generator,expression,returnType,parametricType){return{type:Syntax.FunctionExpression,id:id,params:params,defaults:defaults,body:body,rest:rest,generator:generator,expression:expression,returnType:returnType,parametricType:parametricType}},createIdentifier:function(name){return{type:Syntax.Identifier,name:name,typeAnnotation:undefined}},createTypeAnnotation:function(typeIdentifier,parametricType,params,returnType,nullable){return{type:Syntax.TypeAnnotation,id:typeIdentifier,parametricType:parametricType,params:params,returnType:returnType,nullable:nullable}},createParametricTypeAnnotation:function(parametricTypes){return{type:Syntax.ParametricTypeAnnotation,params:parametricTypes}},createVoidTypeAnnotation:function(){return{type:Syntax.VoidTypeAnnotation}},createObjectTypeAnnotation:function(properties,nullable){return{type:Syntax.ObjectTypeAnnotation,properties:properties,nullable:nullable}},createTypeAnnotatedIdentifier:function(identifier,annotation,isOptionalParam){return{type:Syntax.TypeAnnotatedIdentifier,id:identifier,annotation:annotation}},createOptionalParameter:function(identifier){return{type:Syntax.OptionalParameter,id:identifier}},createXJSAttribute:function(name,value){return{type:Syntax.XJSAttribute,name:name,value:value||null}},createXJSSpreadAttribute:function(argument){return{type:Syntax.XJSSpreadAttribute,argument:argument}},createXJSIdentifier:function(name){return{type:Syntax.XJSIdentifier,name:name}},createXJSNamespacedName:function(namespace,name){return{type:Syntax.XJSNamespacedName,namespace:namespace,name:name}},createXJSMemberExpression:function(object,property){return{type:Syntax.XJSMemberExpression,object:object,property:property}},createXJSElement:function(openingElement,closingElement,children){return{type:Syntax.XJSElement,openingElement:openingElement,closingElement:closingElement,children:children}},createXJSEmptyExpression:function(){return{type:Syntax.XJSEmptyExpression}},createXJSExpressionContainer:function(expression){return{type:Syntax.XJSExpressionContainer,expression:expression}},createXJSOpeningElement:function(name,attributes,selfClosing){return{type:Syntax.XJSOpeningElement,name:name,selfClosing:selfClosing,attributes:attributes}},createXJSClosingElement:function(name){return{type:Syntax.XJSClosingElement,name:name}},createIfStatement:function(test,consequent,alternate){return{type:Syntax.IfStatement,test:test,consequent:consequent,alternate:alternate}},createLabeledStatement:function(label,body){return{type:Syntax.LabeledStatement,label:label,body:body}},createLiteral:function(token){return{type:Syntax.Literal,value:token.value,raw:source.slice(token.range[0],token.range[1])}},createMemberExpression:function(accessor,object,property){return{type:Syntax.MemberExpression,computed:accessor==="[",object:object,property:property}},createNewExpression:function(callee,args){return{type:Syntax.NewExpression,callee:callee,arguments:args}},createObjectExpression:function(properties){return{type:Syntax.ObjectExpression,properties:properties}},createPostfixExpression:function(operator,argument){return{type:Syntax.UpdateExpression,operator:operator,argument:argument,prefix:false}},createProgram:function(body){return{type:Syntax.Program,body:body}},createProperty:function(kind,key,value,method,shorthand,computed){return{type:Syntax.Property,key:key,value:value,kind:kind,method:method,shorthand:shorthand,computed:computed}},createReturnStatement:function(argument){return{type:Syntax.ReturnStatement,argument:argument}},createSequenceExpression:function(expressions){return{type:Syntax.SequenceExpression,expressions:expressions}},createSwitchCase:function(test,consequent){return{type:Syntax.SwitchCase,test:test,consequent:consequent}},createSwitchStatement:function(discriminant,cases){return{type:Syntax.SwitchStatement,discriminant:discriminant,cases:cases}},createThisExpression:function(){return{type:Syntax.ThisExpression}},createThrowStatement:function(argument){return{type:Syntax.ThrowStatement,argument:argument}},createTryStatement:function(block,guardedHandlers,handlers,finalizer){return{type:Syntax.TryStatement,block:block,guardedHandlers:guardedHandlers,handlers:handlers,finalizer:finalizer}},createUnaryExpression:function(operator,argument){if(operator==="++"||operator==="--"){return{type:Syntax.UpdateExpression,operator:operator,argument:argument,prefix:true}}return{type:Syntax.UnaryExpression,operator:operator,argument:argument,prefix:true}},createVariableDeclaration:function(declarations,kind){return{type:Syntax.VariableDeclaration,declarations:declarations,kind:kind}},createVariableDeclarator:function(id,init){return{type:Syntax.VariableDeclarator,id:id,init:init}},createWhileStatement:function(test,body){return{type:Syntax.WhileStatement,test:test,body:body}},createWithStatement:function(object,body){return{type:Syntax.WithStatement,object:object,body:body}},createTemplateElement:function(value,tail){return{type:Syntax.TemplateElement,value:value,tail:tail}},createTemplateLiteral:function(quasis,expressions){return{type:Syntax.TemplateLiteral,quasis:quasis,expressions:expressions}},createSpreadElement:function(argument){return{type:Syntax.SpreadElement,argument:argument}},createSpreadProperty:function(argument){return{type:Syntax.SpreadProperty,argument:argument}},createTaggedTemplateExpression:function(tag,quasi){return{type:Syntax.TaggedTemplateExpression,tag:tag,quasi:quasi}},createArrowFunctionExpression:function(params,defaults,body,rest,expression){return{type:Syntax.ArrowFunctionExpression,id:null,params:params,defaults:defaults,body:body,rest:rest,generator:false,expression:expression}},createMethodDefinition:function(propertyType,kind,key,value){return{type:Syntax.MethodDefinition,key:key,value:value,kind:kind,static:propertyType===ClassPropertyType.static}},createClassProperty:function(propertyIdentifier){return{type:Syntax.ClassProperty,id:propertyIdentifier}},createClassBody:function(body){return{type:Syntax.ClassBody,body:body}},createClassExpression:function(id,superClass,body,parametricType){return{type:Syntax.ClassExpression,id:id,superClass:superClass,body:body,parametricType:parametricType}},createClassDeclaration:function(id,superClass,body,parametricType,superParametricType){return{type:Syntax.ClassDeclaration,id:id,superClass:superClass,body:body,parametricType:parametricType,superParametricType:superParametricType}},createExportSpecifier:function(id,name){return{type:Syntax.ExportSpecifier,id:id,name:name}},createExportBatchSpecifier:function(){return{type:Syntax.ExportBatchSpecifier}},createExportDeclaration:function(declaration,specifiers,source){return{type:Syntax.ExportDeclaration,declaration:declaration,specifiers:specifiers,source:source}},createImportSpecifier:function(id,name){return{type:Syntax.ImportSpecifier,id:id,name:name}},createImportDeclaration:function(specifiers,kind,source){return{type:Syntax.ImportDeclaration,specifiers:specifiers,kind:kind,source:source}},createYieldExpression:function(argument,delegate){return{type:Syntax.YieldExpression,argument:argument,delegate:delegate}},createModuleDeclaration:function(id,source,body){return{type:Syntax.ModuleDeclaration,id:id,source:source,body:body}},createComprehensionExpression:function(filter,blocks,body){return{type:Syntax.ComprehensionExpression,filter:filter,blocks:blocks,body:body}}};function peekLineTerminator(){var pos,line,start,found;pos=index;line=lineNumber;start=lineStart;skipComment();found=lineNumber!==line;index=pos;lineNumber=line;lineStart=start;return found}function throwError(token,messageFormat){var error,args=Array.prototype.slice.call(arguments,2),msg=messageFormat.replace(/%(\d)/g,function(whole,index){assert(index<args.length,"Message reference must be in range");return args[index]});if(typeof token.lineNumber==="number"){error=new Error("Line "+token.lineNumber+": "+msg);error.index=token.range[0];error.lineNumber=token.lineNumber;error.column=token.range[0]-lineStart+1}else{error=new Error("Line "+lineNumber+": "+msg);error.index=index;error.lineNumber=lineNumber;error.column=index-lineStart+1}error.description=msg;throw error}function throwErrorTolerant(){try{throwError.apply(null,arguments)}catch(e){if(extra.errors){extra.errors.push(e)}else{throw e}}}function throwUnexpected(token){if(token.type===Token.EOF){throwError(token,Messages.UnexpectedEOS)}if(token.type===Token.NumericLiteral){throwError(token,Messages.UnexpectedNumber)}if(token.type===Token.StringLiteral||token.type===Token.XJSText){throwError(token,Messages.UnexpectedString)}if(token.type===Token.Identifier){throwError(token,Messages.UnexpectedIdentifier)}if(token.type===Token.Keyword){if(isFutureReservedWord(token.value)){throwError(token,Messages.UnexpectedReserved)}else if(strict&&isStrictModeReservedWord(token.value)){throwErrorTolerant(token,Messages.StrictReservedWord);return}throwError(token,Messages.UnexpectedToken,token.value)}if(token.type===Token.Template){throwError(token,Messages.UnexpectedTemplate,token.value.raw)}throwError(token,Messages.UnexpectedToken,token.value)}function expect(value){var token=lex();if(token.type!==Token.Punctuator||token.value!==value){throwUnexpected(token)}}function expectKeyword(keyword){var token=lex();if(token.type!==Token.Keyword||token.value!==keyword){throwUnexpected(token)}}function match(value){return lookahead.type===Token.Punctuator&&lookahead.value===value}function matchKeyword(keyword){return lookahead.type===Token.Keyword&&lookahead.value===keyword}function matchContextualKeyword(keyword){return lookahead.type===Token.Identifier&&lookahead.value===keyword}function matchAssign(){var op;if(lookahead.type!==Token.Punctuator){return false}op=lookahead.value;return op==="="||op==="*="||op==="/="||op==="%="||op==="+="||op==="-="||op==="<<="||op===">>="||op===">>>="||op==="&="||op==="^="||op==="|="}function consumeSemicolon(){var line,oldIndex=index,oldLineNumber=lineNumber,oldLineStart=lineStart,oldLookahead=lookahead;if(source.charCodeAt(index)===59){lex();return}line=lineNumber;skipComment();if(lineNumber!==line){index=oldIndex;lineNumber=oldLineNumber;lineStart=oldLineStart;lookahead=oldLookahead;return}if(match(";")){lex();return}if(lookahead.type!==Token.EOF&&!match("}")){throwUnexpected(lookahead)}}function isLeftHandSide(expr){return expr.type===Syntax.Identifier||expr.type===Syntax.MemberExpression}function isAssignableLeftHandSide(expr){return isLeftHandSide(expr)||expr.type===Syntax.ObjectPattern||expr.type===Syntax.ArrayPattern}function parseArrayInitialiser(){var elements=[],blocks=[],filter=null,tmp,possiblecomprehension=true,body,marker=markerCreate();expect("[");while(!match("]")){if(lookahead.value==="for"&&lookahead.type===Token.Keyword){if(!possiblecomprehension){throwError({},Messages.ComprehensionError)}matchKeyword("for");tmp=parseForStatement({ignoreBody:true});tmp.of=tmp.type===Syntax.ForOfStatement;tmp.type=Syntax.ComprehensionBlock;if(tmp.left.kind){throwError({},Messages.ComprehensionError)}blocks.push(tmp)}else if(lookahead.value==="if"&&lookahead.type===Token.Keyword){if(!possiblecomprehension){throwError({},Messages.ComprehensionError)}expectKeyword("if");expect("(");filter=parseExpression();expect(")")}else if(lookahead.value===","&&lookahead.type===Token.Punctuator){possiblecomprehension=false;lex();elements.push(null)}else{tmp=parseSpreadOrAssignmentExpression();elements.push(tmp);if(tmp&&tmp.type===Syntax.SpreadElement){if(!match("]")){throwError({},Messages.ElementAfterSpreadElement)}}else if(!(match("]")||matchKeyword("for")||matchKeyword("if"))){expect(",");possiblecomprehension=false}}}expect("]");if(filter&&!blocks.length){throwError({},Messages.ComprehensionRequiresBlock)}if(blocks.length){if(elements.length!==1){throwError({},Messages.ComprehensionError)}return markerApply(marker,delegate.createComprehensionExpression(filter,blocks,elements[0]))}return markerApply(marker,delegate.createArrayExpression(elements))}function parsePropertyFunction(options){var previousStrict,previousYieldAllowed,params,defaults,body,marker=markerCreate();previousStrict=strict;previousYieldAllowed=state.yieldAllowed;state.yieldAllowed=options.generator;params=options.params||[];defaults=options.defaults||[];body=parseConciseBody();if(options.name&&strict&&isRestrictedWord(params[0].name)){throwErrorTolerant(options.name,Messages.StrictParamName)}strict=previousStrict;state.yieldAllowed=previousYieldAllowed;return markerApply(marker,delegate.createFunctionExpression(null,params,defaults,body,options.rest||null,options.generator,body.type!==Syntax.BlockStatement,options.returnType,options.parametricType))}function parsePropertyMethodFunction(options){var previousStrict,tmp,method;previousStrict=strict;strict=true;tmp=parseParams();if(tmp.stricted){throwErrorTolerant(tmp.stricted,tmp.message)}method=parsePropertyFunction({params:tmp.params,defaults:tmp.defaults,rest:tmp.rest,generator:options.generator,returnType:tmp.returnType,parametricType:options.parametricType});strict=previousStrict;return method}function parseObjectPropertyKey(){var marker=markerCreate(),token=lex(),propertyKey,result;if(token.type===Token.StringLiteral||token.type===Token.NumericLiteral){if(strict&&token.octal){throwErrorTolerant(token,Messages.StrictOctalLiteral)}return markerApply(marker,delegate.createLiteral(token))}if(token.type===Token.Punctuator&&token.value==="["){marker=markerCreate();propertyKey=parseAssignmentExpression();result=markerApply(marker,propertyKey);expect("]");return result}return markerApply(marker,delegate.createIdentifier(token.value))}function parseObjectProperty(){var token,key,id,value,param,expr,computed,marker=markerCreate();token=lookahead;computed=token.value==="[";if(token.type===Token.Identifier||computed){id=parseObjectPropertyKey();if(token.value==="get"&&!(match(":")||match("("))){computed=lookahead.value==="[";key=parseObjectPropertyKey();expect("(");expect(")");return markerApply(marker,delegate.createProperty("get",key,parsePropertyFunction({generator:false}),false,false,computed))}if(token.value==="set"&&!(match(":")||match("("))){computed=lookahead.value==="[";key=parseObjectPropertyKey();expect("(");token=lookahead;param=[parseTypeAnnotatableIdentifier()];expect(")");return markerApply(marker,delegate.createProperty("set",key,parsePropertyFunction({params:param,generator:false,name:token}),false,false,computed))}if(match(":")){lex();return markerApply(marker,delegate.createProperty("init",id,parseAssignmentExpression(),false,false,computed))}if(match("(")){return markerApply(marker,delegate.createProperty("init",id,parsePropertyMethodFunction({generator:false}),true,false,computed))}if(computed){throwUnexpected(lookahead)}return markerApply(marker,delegate.createProperty("init",id,id,false,true,false))}if(token.type===Token.EOF||token.type===Token.Punctuator){if(!match("*")){throwUnexpected(token)}lex();computed=lookahead.type===Token.Punctuator&&lookahead.value==="[";id=parseObjectPropertyKey();if(!match("(")){throwUnexpected(lex())}return markerApply(marker,delegate.createProperty("init",id,parsePropertyMethodFunction({generator:true}),true,false,computed))}key=parseObjectPropertyKey();if(match(":")){lex();return markerApply(marker,delegate.createProperty("init",key,parseAssignmentExpression(),false,false,false))}if(match("(")){return markerApply(marker,delegate.createProperty("init",key,parsePropertyMethodFunction({generator:false}),true,false,false))}throwUnexpected(lex())}function parseObjectSpreadProperty(){var marker=markerCreate();expect("...");return markerApply(marker,delegate.createSpreadProperty(parseAssignmentExpression()))}function parseObjectInitialiser(){var properties=[],property,name,key,kind,map={},toString=String,marker=markerCreate();expect("{");while(!match("}")){if(match("...")){property=parseObjectSpreadProperty()}else{property=parseObjectProperty();if(property.key.type===Syntax.Identifier){name=property.key.name}else{name=toString(property.key.value)}kind=property.kind==="init"?PropertyKind.Data:property.kind==="get"?PropertyKind.Get:PropertyKind.Set;key="$"+name;if(Object.prototype.hasOwnProperty.call(map,key)){if(map[key]===PropertyKind.Data){if(strict&&kind===PropertyKind.Data){throwErrorTolerant({},Messages.StrictDuplicateProperty)}else if(kind!==PropertyKind.Data){throwErrorTolerant({},Messages.AccessorDataProperty)}}else{if(kind===PropertyKind.Data){throwErrorTolerant({},Messages.AccessorDataProperty)}else if(map[key]&kind){throwErrorTolerant({},Messages.AccessorGetSet)
}}map[key]|=kind}else{map[key]=kind}}properties.push(property);if(!match("}")){expect(",")}}expect("}");return markerApply(marker,delegate.createObjectExpression(properties))}function parseTemplateElement(option){var marker=markerCreate(),token=scanTemplateElement(option);if(strict&&token.octal){throwError(token,Messages.StrictOctalLiteral)}return markerApply(marker,delegate.createTemplateElement({raw:token.value.raw,cooked:token.value.cooked},token.tail))}function parseTemplateLiteral(){var quasi,quasis,expressions,marker=markerCreate();quasi=parseTemplateElement({head:true});quasis=[quasi];expressions=[];while(!quasi.tail){expressions.push(parseExpression());quasi=parseTemplateElement({head:false});quasis.push(quasi)}return markerApply(marker,delegate.createTemplateLiteral(quasis,expressions))}function parseGroupExpression(){var expr;expect("(");++state.parenthesizedCount;expr=parseExpression();expect(")");return expr}function parsePrimaryExpression(){var marker,type,token,expr;type=lookahead.type;if(type===Token.Identifier){marker=markerCreate();return markerApply(marker,delegate.createIdentifier(lex().value))}if(type===Token.StringLiteral||type===Token.NumericLiteral){if(strict&&lookahead.octal){throwErrorTolerant(lookahead,Messages.StrictOctalLiteral)}marker=markerCreate();return markerApply(marker,delegate.createLiteral(lex()))}if(type===Token.Keyword){if(matchKeyword("this")){marker=markerCreate();lex();return markerApply(marker,delegate.createThisExpression())}if(matchKeyword("function")){return parseFunctionExpression()}if(matchKeyword("class")){return parseClassExpression()}if(matchKeyword("super")){marker=markerCreate();lex();return markerApply(marker,delegate.createIdentifier("super"))}}if(type===Token.BooleanLiteral){marker=markerCreate();token=lex();token.value=token.value==="true";return markerApply(marker,delegate.createLiteral(token))}if(type===Token.NullLiteral){marker=markerCreate();token=lex();token.value=null;return markerApply(marker,delegate.createLiteral(token))}if(match("[")){return parseArrayInitialiser()}if(match("{")){return parseObjectInitialiser()}if(match("(")){return parseGroupExpression()}if(match("/")||match("/=")){marker=markerCreate();return markerApply(marker,delegate.createLiteral(scanRegExp()))}if(type===Token.Template){return parseTemplateLiteral()}if(match("<")){return parseXJSElement()}throwUnexpected(lex())}function parseArguments(){var args=[],arg;expect("(");if(!match(")")){while(index<length){arg=parseSpreadOrAssignmentExpression();args.push(arg);if(match(")")){break}else if(arg.type===Syntax.SpreadElement){throwError({},Messages.ElementAfterSpreadElement)}expect(",")}}expect(")");return args}function parseSpreadOrAssignmentExpression(){if(match("...")){var marker=markerCreate();lex();return markerApply(marker,delegate.createSpreadElement(parseAssignmentExpression()))}return parseAssignmentExpression()}function parseNonComputedProperty(){var marker=markerCreate(),token=lex();if(!isIdentifierName(token)){throwUnexpected(token)}return markerApply(marker,delegate.createIdentifier(token.value))}function parseNonComputedMember(){expect(".");return parseNonComputedProperty()}function parseComputedMember(){var expr;expect("[");expr=parseExpression();expect("]");return expr}function parseNewExpression(){var callee,args,marker=markerCreate();expectKeyword("new");callee=parseLeftHandSideExpression();args=match("(")?parseArguments():[];return markerApply(marker,delegate.createNewExpression(callee,args))}function parseLeftHandSideExpressionAllowCall(){var expr,args,marker=markerCreate();expr=matchKeyword("new")?parseNewExpression():parsePrimaryExpression();while(match(".")||match("[")||match("(")||lookahead.type===Token.Template){if(match("(")){args=parseArguments();expr=markerApply(marker,delegate.createCallExpression(expr,args))}else if(match("[")){expr=markerApply(marker,delegate.createMemberExpression("[",expr,parseComputedMember()))}else if(match(".")){expr=markerApply(marker,delegate.createMemberExpression(".",expr,parseNonComputedMember()))}else{expr=markerApply(marker,delegate.createTaggedTemplateExpression(expr,parseTemplateLiteral()))}}return expr}function parseLeftHandSideExpression(){var expr,marker=markerCreate();expr=matchKeyword("new")?parseNewExpression():parsePrimaryExpression();while(match(".")||match("[")||lookahead.type===Token.Template){if(match("[")){expr=markerApply(marker,delegate.createMemberExpression("[",expr,parseComputedMember()))}else if(match(".")){expr=markerApply(marker,delegate.createMemberExpression(".",expr,parseNonComputedMember()))}else{expr=markerApply(marker,delegate.createTaggedTemplateExpression(expr,parseTemplateLiteral()))}}return expr}function parsePostfixExpression(){var marker=markerCreate(),expr=parseLeftHandSideExpressionAllowCall(),token;if(lookahead.type!==Token.Punctuator){return expr}if((match("++")||match("--"))&&!peekLineTerminator()){if(strict&&expr.type===Syntax.Identifier&&isRestrictedWord(expr.name)){throwErrorTolerant({},Messages.StrictLHSPostfix)}if(!isLeftHandSide(expr)){throwError({},Messages.InvalidLHSInAssignment)}token=lex();expr=markerApply(marker,delegate.createPostfixExpression(token.value,expr))}return expr}function parseUnaryExpression(){var marker,token,expr;if(lookahead.type!==Token.Punctuator&&lookahead.type!==Token.Keyword){return parsePostfixExpression()}if(match("++")||match("--")){marker=markerCreate();token=lex();expr=parseUnaryExpression();if(strict&&expr.type===Syntax.Identifier&&isRestrictedWord(expr.name)){throwErrorTolerant({},Messages.StrictLHSPrefix)}if(!isLeftHandSide(expr)){throwError({},Messages.InvalidLHSInAssignment)}return markerApply(marker,delegate.createUnaryExpression(token.value,expr))}if(match("+")||match("-")||match("~")||match("!")){marker=markerCreate();token=lex();expr=parseUnaryExpression();return markerApply(marker,delegate.createUnaryExpression(token.value,expr))}if(matchKeyword("delete")||matchKeyword("void")||matchKeyword("typeof")){marker=markerCreate();token=lex();expr=parseUnaryExpression();expr=markerApply(marker,delegate.createUnaryExpression(token.value,expr));if(strict&&expr.operator==="delete"&&expr.argument.type===Syntax.Identifier){throwErrorTolerant({},Messages.StrictDelete)}return expr}return parsePostfixExpression()}function binaryPrecedence(token,allowIn){var prec=0;if(token.type!==Token.Punctuator&&token.type!==Token.Keyword){return 0}switch(token.value){case"||":prec=1;break;case"&&":prec=2;break;case"|":prec=3;break;case"^":prec=4;break;case"&":prec=5;break;case"==":case"!=":case"===":case"!==":prec=6;break;case"<":case">":case"<=":case">=":case"instanceof":prec=7;break;case"in":prec=allowIn?7:0;break;case"<<":case">>":case">>>":prec=8;break;case"+":case"-":prec=9;break;case"*":case"/":case"%":prec=11;break;default:break}return prec}function parseBinaryExpression(){var expr,token,prec,previousAllowIn,stack,right,operator,left,i,marker,markers;previousAllowIn=state.allowIn;state.allowIn=true;marker=markerCreate();left=parseUnaryExpression();token=lookahead;prec=binaryPrecedence(token,previousAllowIn);if(prec===0){return left}token.prec=prec;lex();markers=[marker,markerCreate()];right=parseUnaryExpression();stack=[left,token,right];while((prec=binaryPrecedence(lookahead,previousAllowIn))>0){while(stack.length>2&&prec<=stack[stack.length-2].prec){right=stack.pop();operator=stack.pop().value;left=stack.pop();expr=delegate.createBinaryExpression(operator,left,right);markers.pop();marker=markers.pop();markerApply(marker,expr);stack.push(expr);markers.push(marker)}token=lex();token.prec=prec;stack.push(token);markers.push(markerCreate());expr=parseUnaryExpression();stack.push(expr)}state.allowIn=previousAllowIn;i=stack.length-1;expr=stack[i];markers.pop();while(i>1){expr=delegate.createBinaryExpression(stack[i-1].value,stack[i-2],expr);i-=2;marker=markers.pop();markerApply(marker,expr)}return expr}function parseConditionalExpression(){var expr,previousAllowIn,consequent,alternate,marker=markerCreate();expr=parseBinaryExpression();if(match("?")){lex();previousAllowIn=state.allowIn;state.allowIn=true;consequent=parseAssignmentExpression();state.allowIn=previousAllowIn;expect(":");alternate=parseAssignmentExpression();expr=markerApply(marker,delegate.createConditionalExpression(expr,consequent,alternate))}return expr}function reinterpretAsAssignmentBindingPattern(expr){var i,len,property,element;if(expr.type===Syntax.ObjectExpression){expr.type=Syntax.ObjectPattern;for(i=0,len=expr.properties.length;i<len;i+=1){property=expr.properties[i];if(property.type===Syntax.SpreadProperty){if(i<len-1){throwError({},Messages.PropertyAfterSpreadProperty)}reinterpretAsAssignmentBindingPattern(property.argument)}else{if(property.kind!=="init"){throwError({},Messages.InvalidLHSInAssignment)}reinterpretAsAssignmentBindingPattern(property.value)}}}else if(expr.type===Syntax.ArrayExpression){expr.type=Syntax.ArrayPattern;for(i=0,len=expr.elements.length;i<len;i+=1){element=expr.elements[i];if(element){reinterpretAsAssignmentBindingPattern(element)}}}else if(expr.type===Syntax.Identifier){if(isRestrictedWord(expr.name)){throwError({},Messages.InvalidLHSInAssignment)}}else if(expr.type===Syntax.SpreadElement){reinterpretAsAssignmentBindingPattern(expr.argument);if(expr.argument.type===Syntax.ObjectPattern){throwError({},Messages.ObjectPatternAsSpread)}}else{if(expr.type!==Syntax.MemberExpression&&expr.type!==Syntax.CallExpression&&expr.type!==Syntax.NewExpression){throwError({},Messages.InvalidLHSInAssignment)}}}function reinterpretAsDestructuredParameter(options,expr){var i,len,property,element;if(expr.type===Syntax.ObjectExpression){expr.type=Syntax.ObjectPattern;for(i=0,len=expr.properties.length;i<len;i+=1){property=expr.properties[i];if(property.type===Syntax.SpreadProperty){if(i<len-1){throwError({},Messages.PropertyAfterSpreadProperty)}reinterpretAsDestructuredParameter(options,property.argument)}else{if(property.kind!=="init"){throwError({},Messages.InvalidLHSInFormalsList)}reinterpretAsDestructuredParameter(options,property.value)}}}else if(expr.type===Syntax.ArrayExpression){expr.type=Syntax.ArrayPattern;for(i=0,len=expr.elements.length;i<len;i+=1){element=expr.elements[i];if(element){reinterpretAsDestructuredParameter(options,element)}}}else if(expr.type===Syntax.Identifier){validateParam(options,expr,expr.name)}else{if(expr.type!==Syntax.MemberExpression){throwError({},Messages.InvalidLHSInFormalsList)}}}function reinterpretAsCoverFormalsList(expressions){var i,len,param,params,defaults,defaultCount,options,rest;params=[];defaults=[];defaultCount=0;rest=null;options={paramSet:{}};for(i=0,len=expressions.length;i<len;i+=1){param=expressions[i];if(param.type===Syntax.Identifier){params.push(param);defaults.push(null);validateParam(options,param,param.name)}else if(param.type===Syntax.ObjectExpression||param.type===Syntax.ArrayExpression){reinterpretAsDestructuredParameter(options,param);params.push(param);defaults.push(null)}else if(param.type===Syntax.SpreadElement){assert(i===len-1,"It is guaranteed that SpreadElement is last element by parseExpression");reinterpretAsDestructuredParameter(options,param.argument);rest=param.argument}else if(param.type===Syntax.AssignmentExpression){params.push(param.left);defaults.push(param.right);++defaultCount;validateParam(options,param.left,param.left.name)}else{return null}}if(options.message===Messages.StrictParamDupe){throwError(strict?options.stricted:options.firstRestricted,options.message)}if(defaultCount===0){defaults=[]}return{params:params,defaults:defaults,rest:rest,stricted:options.stricted,firstRestricted:options.firstRestricted,message:options.message}}function parseArrowFunctionExpression(options,marker){var previousStrict,previousYieldAllowed,body;expect("=>");previousStrict=strict;previousYieldAllowed=state.yieldAllowed;state.yieldAllowed=false;body=parseConciseBody();if(strict&&options.firstRestricted){throwError(options.firstRestricted,options.message)}if(strict&&options.stricted){throwErrorTolerant(options.stricted,options.message)}strict=previousStrict;state.yieldAllowed=previousYieldAllowed;return markerApply(marker,delegate.createArrowFunctionExpression(options.params,options.defaults,body,options.rest,body.type!==Syntax.BlockStatement))}function parseAssignmentExpression(){var marker,expr,token,params,oldParenthesizedCount;if(state.yieldAllowed&&matchContextualKeyword("yield")||strict&&matchKeyword("yield")){return parseYieldExpression()}oldParenthesizedCount=state.parenthesizedCount;marker=markerCreate();if(match("(")){token=lookahead2();if(token.type===Token.Punctuator&&token.value===")"||token.value==="..."){params=parseParams();if(!match("=>")){throwUnexpected(lex())}return parseArrowFunctionExpression(params,marker)}}token=lookahead;expr=parseConditionalExpression();if(match("=>")&&(state.parenthesizedCount===oldParenthesizedCount||state.parenthesizedCount===oldParenthesizedCount+1)){if(expr.type===Syntax.Identifier){params=reinterpretAsCoverFormalsList([expr])}else if(expr.type===Syntax.SequenceExpression){params=reinterpretAsCoverFormalsList(expr.expressions)}if(params){return parseArrowFunctionExpression(params,marker)}}if(matchAssign()){if(strict&&expr.type===Syntax.Identifier&&isRestrictedWord(expr.name)){throwErrorTolerant(token,Messages.StrictLHSAssignment)}if(match("=")&&(expr.type===Syntax.ObjectExpression||expr.type===Syntax.ArrayExpression)){reinterpretAsAssignmentBindingPattern(expr)}else if(!isLeftHandSide(expr)){throwError({},Messages.InvalidLHSInAssignment)}expr=markerApply(marker,delegate.createAssignmentExpression(lex().value,expr,parseAssignmentExpression()))}return expr}function parseExpression(){var marker,expr,expressions,sequence,coverFormalsList,spreadFound,oldParenthesizedCount;oldParenthesizedCount=state.parenthesizedCount;marker=markerCreate();expr=parseAssignmentExpression();expressions=[expr];if(match(",")){while(index<length){if(!match(",")){break}lex();expr=parseSpreadOrAssignmentExpression();expressions.push(expr);if(expr.type===Syntax.SpreadElement){spreadFound=true;if(!match(")")){throwError({},Messages.ElementAfterSpreadElement)}break}}sequence=markerApply(marker,delegate.createSequenceExpression(expressions))}if(match("=>")){if(state.parenthesizedCount===oldParenthesizedCount||state.parenthesizedCount===oldParenthesizedCount+1){expr=expr.type===Syntax.SequenceExpression?expr.expressions:expressions;coverFormalsList=reinterpretAsCoverFormalsList(expr);if(coverFormalsList){return parseArrowFunctionExpression(coverFormalsList,marker)}}throwUnexpected(lex())}if(spreadFound&&lookahead2().value!=="=>"){throwError({},Messages.IllegalSpread)}return sequence||expr}function parseStatementList(){var list=[],statement;while(index<length){if(match("}")){break}statement=parseSourceElement();if(typeof statement==="undefined"){break}list.push(statement)}return list}function parseBlock(){var block,marker=markerCreate();expect("{");block=parseStatementList();expect("}");return markerApply(marker,delegate.createBlockStatement(block))}function parseObjectTypeAnnotation(nullable){var isMethod,marker,properties=[],property,propertyKey,propertyTypeAnnotation;expect("{");while(!match("}")){marker=markerCreate();propertyKey=parseObjectPropertyKey();isMethod=match("(");propertyTypeAnnotation=parseTypeAnnotation();properties.push(markerApply(marker,delegate.createProperty("init",propertyKey,propertyTypeAnnotation,isMethod,false)));if(!match("}")){if(match(",")||match(";")){lex()}else{throwUnexpected(lookahead)}}}expect("}");return delegate.createObjectTypeAnnotation(properties,nullable)}function parseVoidTypeAnnotation(){var marker=markerCreate();expectKeyword("void");return markerApply(marker,delegate.createVoidTypeAnnotation())}function parseParametricTypeAnnotation(){var marker=markerCreate(),typeIdentifier,paramTypes=[];expect("<");while(!match(">")){paramTypes.push(parseVariableIdentifier());if(!match(">")){expect(",")}}expect(">");return markerApply(marker,delegate.createParametricTypeAnnotation(paramTypes))}function parseTypeAnnotation(dontExpectColon){var typeIdentifier=null,params=null,returnType=null,nullable=false,marker=markerCreate(),returnTypeMarker=null,parametricType,annotation;if(!dontExpectColon){expect(":")}if(match("?")){lex();nullable=true}if(match("{")){return markerApply(marker,parseObjectTypeAnnotation(nullable))}if(lookahead.type===Token.Identifier){typeIdentifier=parseVariableIdentifier();if(match("<")){parametricType=parseParametricTypeAnnotation()}}else if(match("(")){lex();params=[];while(lookahead.type===Token.Identifier||match("?")){params.push(parseTypeAnnotatableIdentifier(true,true));if(!match(")")){expect(",")}}expect(")");returnTypeMarker=markerCreate();expect("=>");returnType=parseTypeAnnotation(true)}else{if(!matchKeyword("void")){throwUnexpected(lookahead)}else{return markerApply(marker,parseVoidTypeAnnotation())}}return markerApply(marker,delegate.createTypeAnnotation(typeIdentifier,parametricType,params,returnType,nullable))}function parseVariableIdentifier(){var marker=markerCreate(),token=lex();if(token.type!==Token.Identifier){throwUnexpected(token)}return markerApply(marker,delegate.createIdentifier(token.value))}function parseTypeAnnotatableIdentifier(requireTypeAnnotation,canBeOptionalParam){var marker=markerCreate(),ident=parseVariableIdentifier(),isOptionalParam=false;if(canBeOptionalParam&&match("?")){expect("?");isOptionalParam=true}if(requireTypeAnnotation||match(":")){ident=markerApply(marker,delegate.createTypeAnnotatedIdentifier(ident,parseTypeAnnotation()))}if(isOptionalParam){ident=markerApply(marker,delegate.createOptionalParameter(ident))}return ident}function parseVariableDeclaration(kind){var id,marker=markerCreate(),init=null;if(match("{")){id=parseObjectInitialiser();reinterpretAsAssignmentBindingPattern(id)}else if(match("[")){id=parseArrayInitialiser();reinterpretAsAssignmentBindingPattern(id)}else{id=state.allowKeyword?parseNonComputedProperty():parseTypeAnnotatableIdentifier();if(strict&&isRestrictedWord(id.name)){throwErrorTolerant({},Messages.StrictVarName)}}if(kind==="const"){if(!match("=")){throwError({},Messages.NoUnintializedConst)}expect("=");init=parseAssignmentExpression()}else if(match("=")){lex();init=parseAssignmentExpression()}return markerApply(marker,delegate.createVariableDeclarator(id,init))}function parseVariableDeclarationList(kind){var list=[];do{list.push(parseVariableDeclaration(kind));if(!match(",")){break}lex()}while(index<length);return list}function parseVariableStatement(){var declarations,marker=markerCreate();expectKeyword("var");declarations=parseVariableDeclarationList();consumeSemicolon();return markerApply(marker,delegate.createVariableDeclaration(declarations,"var"))}function parseConstLetDeclaration(kind){var declarations,marker=markerCreate();expectKeyword(kind);declarations=parseVariableDeclarationList(kind);consumeSemicolon();return markerApply(marker,delegate.createVariableDeclaration(declarations,kind))}function parseModuleDeclaration(){var id,src,body,marker=markerCreate();lex();if(peekLineTerminator()){throwError({},Messages.NewlineAfterModule)}switch(lookahead.type){case Token.StringLiteral:id=parsePrimaryExpression();body=parseModuleBlock();src=null;break;case Token.Identifier:id=parseVariableIdentifier();body=null;if(!matchContextualKeyword("from")){throwUnexpected(lex())}lex();src=parsePrimaryExpression();if(src.type!==Syntax.Literal){throwError({},Messages.InvalidModuleSpecifier)}break}consumeSemicolon();return markerApply(marker,delegate.createModuleDeclaration(id,src,body))}function parseExportBatchSpecifier(){var marker=markerCreate();expect("*");return markerApply(marker,delegate.createExportBatchSpecifier())}function parseExportSpecifier(){var id,name=null,marker=markerCreate();id=parseVariableIdentifier();if(matchContextualKeyword("as")){lex();name=parseNonComputedProperty()}return markerApply(marker,delegate.createExportSpecifier(id,name))}function parseExportDeclaration(){var previousAllowKeyword,decl,def,src,specifiers,marker=markerCreate();expectKeyword("export");if(lookahead.type===Token.Keyword){switch(lookahead.value){case"let":case"const":case"var":case"class":case"function":return markerApply(marker,delegate.createExportDeclaration(parseSourceElement(),null,null))}}if(isIdentifierName(lookahead)){previousAllowKeyword=state.allowKeyword;state.allowKeyword=true;decl=parseVariableDeclarationList("let");state.allowKeyword=previousAllowKeyword;return markerApply(marker,delegate.createExportDeclaration(decl,null,null))}specifiers=[];src=null;if(match("*")){specifiers.push(parseExportBatchSpecifier())}else{expect("{");do{specifiers.push(parseExportSpecifier())}while(match(",")&&lex());expect("}")}if(matchContextualKeyword("from")){lex();src=parsePrimaryExpression();if(src.type!==Syntax.Literal){throwError({},Messages.InvalidModuleSpecifier)}}consumeSemicolon();return markerApply(marker,delegate.createExportDeclaration(null,specifiers,src))}function parseImportDeclaration(){var specifiers,kind,src,marker=markerCreate();expectKeyword("import");specifiers=[];if(isIdentifierName(lookahead)){kind="default";specifiers.push(parseImportSpecifier());if(!matchContextualKeyword("from")){throwError({},Messages.NoFromAfterImport)}lex()}else if(match("{")){kind="named";lex();do{specifiers.push(parseImportSpecifier())}while(match(",")&&lex());expect("}");if(!matchContextualKeyword("from")){throwError({},Messages.NoFromAfterImport)}lex()}src=parsePrimaryExpression();if(src.type!==Syntax.Literal){throwError({},Messages.InvalidModuleSpecifier)}consumeSemicolon();return markerApply(marker,delegate.createImportDeclaration(specifiers,kind,src))}function parseImportSpecifier(){var id,name=null,marker=markerCreate();id=parseNonComputedProperty();if(matchContextualKeyword("as")){lex();name=parseVariableIdentifier()}return markerApply(marker,delegate.createImportSpecifier(id,name))}function parseEmptyStatement(){var marker=markerCreate();expect(";");return markerApply(marker,delegate.createEmptyStatement())}function parseExpressionStatement(){var marker=markerCreate(),expr=parseExpression();consumeSemicolon();return markerApply(marker,delegate.createExpressionStatement(expr))}function parseIfStatement(){var test,consequent,alternate,marker=markerCreate();expectKeyword("if");expect("(");test=parseExpression();expect(")");consequent=parseStatement();if(matchKeyword("else")){lex();alternate=parseStatement()}else{alternate=null}return markerApply(marker,delegate.createIfStatement(test,consequent,alternate))}function parseDoWhileStatement(){var body,test,oldInIteration,marker=markerCreate();expectKeyword("do");oldInIteration=state.inIteration;state.inIteration=true;body=parseStatement();state.inIteration=oldInIteration;expectKeyword("while");expect("(");test=parseExpression();expect(")");if(match(";")){lex()}return markerApply(marker,delegate.createDoWhileStatement(body,test))}function parseWhileStatement(){var test,body,oldInIteration,marker=markerCreate();expectKeyword("while");expect("(");test=parseExpression();expect(")");oldInIteration=state.inIteration;state.inIteration=true;body=parseStatement();state.inIteration=oldInIteration;return markerApply(marker,delegate.createWhileStatement(test,body))}function parseForVariableDeclaration(){var marker=markerCreate(),token=lex(),declarations=parseVariableDeclarationList();return markerApply(marker,delegate.createVariableDeclaration(declarations,token.value))}function parseForStatement(opts){var init,test,update,left,right,body,operator,oldInIteration,marker=markerCreate();init=test=update=null;expectKeyword("for");if(matchContextualKeyword("each")){throwError({},Messages.EachNotAllowed)}expect("(");if(match(";")){lex()}else{if(matchKeyword("var")||matchKeyword("let")||matchKeyword("const")){state.allowIn=false;init=parseForVariableDeclaration();state.allowIn=true;if(init.declarations.length===1){if(matchKeyword("in")||matchContextualKeyword("of")){operator=lookahead;if(!((operator.value==="in"||init.kind!=="var")&&init.declarations[0].init)){lex();left=init;right=parseExpression();init=null}}}}else{state.allowIn=false;init=parseExpression();state.allowIn=true;if(matchContextualKeyword("of")){operator=lex();left=init;right=parseExpression();init=null}else if(matchKeyword("in")){if(!isAssignableLeftHandSide(init)){throwError({},Messages.InvalidLHSInForIn)}operator=lex();left=init;right=parseExpression();init=null}}if(typeof left==="undefined"){expect(";")}}if(typeof left==="undefined"){if(!match(";")){test=parseExpression()}expect(";");if(!match(")")){update=parseExpression()}}expect(")");oldInIteration=state.inIteration;state.inIteration=true;if(!(opts!==undefined&&opts.ignoreBody)){body=parseStatement()}state.inIteration=oldInIteration;if(typeof left==="undefined"){return markerApply(marker,delegate.createForStatement(init,test,update,body))}if(operator.value==="in"){return markerApply(marker,delegate.createForInStatement(left,right,body))}return markerApply(marker,delegate.createForOfStatement(left,right,body))}function parseContinueStatement(){var label=null,key,marker=markerCreate();expectKeyword("continue");if(source.charCodeAt(index)===59){lex();if(!state.inIteration){throwError({},Messages.IllegalContinue)}return markerApply(marker,delegate.createContinueStatement(null))}if(peekLineTerminator()){if(!state.inIteration){throwError({},Messages.IllegalContinue)}return markerApply(marker,delegate.createContinueStatement(null))}if(lookahead.type===Token.Identifier){label=parseVariableIdentifier();key="$"+label.name;if(!Object.prototype.hasOwnProperty.call(state.labelSet,key)){throwError({},Messages.UnknownLabel,label.name)}}consumeSemicolon();if(label===null&&!state.inIteration){throwError({},Messages.IllegalContinue)}return markerApply(marker,delegate.createContinueStatement(label))}function parseBreakStatement(){var label=null,key,marker=markerCreate();expectKeyword("break");if(source.charCodeAt(index)===59){lex();if(!(state.inIteration||state.inSwitch)){throwError({},Messages.IllegalBreak)}return markerApply(marker,delegate.createBreakStatement(null))}if(peekLineTerminator()){if(!(state.inIteration||state.inSwitch)){throwError({},Messages.IllegalBreak)}return markerApply(marker,delegate.createBreakStatement(null))}if(lookahead.type===Token.Identifier){label=parseVariableIdentifier();key="$"+label.name;if(!Object.prototype.hasOwnProperty.call(state.labelSet,key)){throwError({},Messages.UnknownLabel,label.name)}}consumeSemicolon();if(label===null&&!(state.inIteration||state.inSwitch)){throwError({},Messages.IllegalBreak)}return markerApply(marker,delegate.createBreakStatement(label))}function parseReturnStatement(){var argument=null,marker=markerCreate();expectKeyword("return");if(!state.inFunctionBody){throwErrorTolerant({},Messages.IllegalReturn)}if(source.charCodeAt(index)===32){if(isIdentifierStart(source.charCodeAt(index+1))){argument=parseExpression();consumeSemicolon();return markerApply(marker,delegate.createReturnStatement(argument))}}if(peekLineTerminator()){return markerApply(marker,delegate.createReturnStatement(null))}if(!match(";")){if(!match("}")&&lookahead.type!==Token.EOF){argument=parseExpression()}}consumeSemicolon();return markerApply(marker,delegate.createReturnStatement(argument))}function parseWithStatement(){var object,body,marker=markerCreate();if(strict){throwErrorTolerant({},Messages.StrictModeWith)}expectKeyword("with");expect("(");object=parseExpression();expect(")");body=parseStatement();return markerApply(marker,delegate.createWithStatement(object,body))}function parseSwitchCase(){var test,consequent=[],sourceElement,marker=markerCreate();if(matchKeyword("default")){lex();test=null}else{expectKeyword("case");test=parseExpression()}expect(":");while(index<length){if(match("}")||matchKeyword("default")||matchKeyword("case")){break}sourceElement=parseSourceElement();if(typeof sourceElement==="undefined"){break}consequent.push(sourceElement)}return markerApply(marker,delegate.createSwitchCase(test,consequent))}function parseSwitchStatement(){var discriminant,cases,clause,oldInSwitch,defaultFound,marker=markerCreate();expectKeyword("switch");expect("(");discriminant=parseExpression();expect(")");expect("{");cases=[];if(match("}")){lex();return markerApply(marker,delegate.createSwitchStatement(discriminant,cases))}oldInSwitch=state.inSwitch;state.inSwitch=true;defaultFound=false;while(index<length){if(match("}")){break}clause=parseSwitchCase();if(clause.test===null){if(defaultFound){throwError({},Messages.MultipleDefaultsInSwitch)}defaultFound=true}cases.push(clause)}state.inSwitch=oldInSwitch;expect("}");return markerApply(marker,delegate.createSwitchStatement(discriminant,cases))}function parseThrowStatement(){var argument,marker=markerCreate();expectKeyword("throw");if(peekLineTerminator()){throwError({},Messages.NewlineAfterThrow)}argument=parseExpression();consumeSemicolon();return markerApply(marker,delegate.createThrowStatement(argument))}function parseCatchClause(){var param,body,marker=markerCreate();expectKeyword("catch");expect("(");if(match(")")){throwUnexpected(lookahead)}param=parseExpression();if(strict&&param.type===Syntax.Identifier&&isRestrictedWord(param.name)){throwErrorTolerant({},Messages.StrictCatchVariable)}expect(")");body=parseBlock();return markerApply(marker,delegate.createCatchClause(param,body))}function parseTryStatement(){var block,handlers=[],finalizer=null,marker=markerCreate();expectKeyword("try");block=parseBlock();if(matchKeyword("catch")){handlers.push(parseCatchClause())}if(matchKeyword("finally")){lex();finalizer=parseBlock()}if(handlers.length===0&&!finalizer){throwError({},Messages.NoCatchOrFinally)}return markerApply(marker,delegate.createTryStatement(block,[],handlers,finalizer))}function parseDebuggerStatement(){var marker=markerCreate();expectKeyword("debugger");consumeSemicolon();return markerApply(marker,delegate.createDebuggerStatement())}function parseStatement(){var type=lookahead.type,marker,expr,labeledBody,key;if(type===Token.EOF){throwUnexpected(lookahead)}if(type===Token.Punctuator){switch(lookahead.value){case";":return parseEmptyStatement();case"{":return parseBlock();case"(":return parseExpressionStatement();default:break}}if(type===Token.Keyword){switch(lookahead.value){case"break":return parseBreakStatement();case"continue":return parseContinueStatement();case"debugger":return parseDebuggerStatement();case"do":return parseDoWhileStatement();case"for":return parseForStatement();case"function":return parseFunctionDeclaration();case"class":return parseClassDeclaration();case"if":return parseIfStatement();case"return":return parseReturnStatement();case"switch":return parseSwitchStatement();case"throw":return parseThrowStatement();case"try":return parseTryStatement();case"var":return parseVariableStatement();case"while":return parseWhileStatement();case"with":return parseWithStatement();default:break}}marker=markerCreate();expr=parseExpression();if(expr.type===Syntax.Identifier&&match(":")){lex();key="$"+expr.name;if(Object.prototype.hasOwnProperty.call(state.labelSet,key)){throwError({},Messages.Redeclaration,"Label",expr.name)}state.labelSet[key]=true;labeledBody=parseStatement();delete state.labelSet[key];return markerApply(marker,delegate.createLabeledStatement(expr,labeledBody))}consumeSemicolon();return markerApply(marker,delegate.createExpressionStatement(expr))}function parseConciseBody(){if(match("{")){return parseFunctionSourceElements()}return parseAssignmentExpression()}function parseFunctionSourceElements(){var sourceElement,sourceElements=[],token,directive,firstRestricted,oldLabelSet,oldInIteration,oldInSwitch,oldInFunctionBody,oldParenthesizedCount,marker=markerCreate();expect("{");while(index<length){if(lookahead.type!==Token.StringLiteral){break}token=lookahead;sourceElement=parseSourceElement();sourceElements.push(sourceElement);if(sourceElement.expression.type!==Syntax.Literal){break}directive=source.slice(token.range[0]+1,token.range[1]-1);
if(directive==="use strict"){strict=true;if(firstRestricted){throwErrorTolerant(firstRestricted,Messages.StrictOctalLiteral)}}else{if(!firstRestricted&&token.octal){firstRestricted=token}}}oldLabelSet=state.labelSet;oldInIteration=state.inIteration;oldInSwitch=state.inSwitch;oldInFunctionBody=state.inFunctionBody;oldParenthesizedCount=state.parenthesizedCount;state.labelSet={};state.inIteration=false;state.inSwitch=false;state.inFunctionBody=true;state.parenthesizedCount=0;while(index<length){if(match("}")){break}sourceElement=parseSourceElement();if(typeof sourceElement==="undefined"){break}sourceElements.push(sourceElement)}expect("}");state.labelSet=oldLabelSet;state.inIteration=oldInIteration;state.inSwitch=oldInSwitch;state.inFunctionBody=oldInFunctionBody;state.parenthesizedCount=oldParenthesizedCount;return markerApply(marker,delegate.createBlockStatement(sourceElements))}function validateParam(options,param,name){var key="$"+name;if(strict){if(isRestrictedWord(name)){options.stricted=param;options.message=Messages.StrictParamName}if(Object.prototype.hasOwnProperty.call(options.paramSet,key)){options.stricted=param;options.message=Messages.StrictParamDupe}}else if(!options.firstRestricted){if(isRestrictedWord(name)){options.firstRestricted=param;options.message=Messages.StrictParamName}else if(isStrictModeReservedWord(name)){options.firstRestricted=param;options.message=Messages.StrictReservedWord}else if(Object.prototype.hasOwnProperty.call(options.paramSet,key)){options.firstRestricted=param;options.message=Messages.StrictParamDupe}}options.paramSet[key]=true}function parseParam(options){var token,rest,param,def;token=lookahead;if(token.value==="..."){token=lex();rest=true}if(match("[")){param=parseArrayInitialiser();reinterpretAsDestructuredParameter(options,param)}else if(match("{")){if(rest){throwError({},Messages.ObjectPatternAsRestParameter)}param=parseObjectInitialiser();reinterpretAsDestructuredParameter(options,param)}else{param=rest?parseVariableIdentifier():parseTypeAnnotatableIdentifier(false,true);validateParam(options,token,token.value)}if(match("=")){if(rest){throwErrorTolerant(lookahead,Messages.DefaultRestParameter)}lex();def=parseAssignmentExpression();++options.defaultCount}if(rest){if(!match(")")){throwError({},Messages.ParameterAfterRestParameter)}options.rest=param;return false}options.params.push(param);options.defaults.push(def);return!match(")")}function parseParams(firstRestricted){var options,marker=markerCreate();options={params:[],defaultCount:0,defaults:[],rest:null,firstRestricted:firstRestricted};expect("(");if(!match(")")){options.paramSet={};while(index<length){if(!parseParam(options)){break}expect(",")}}expect(")");if(options.defaultCount===0){options.defaults=[]}if(match(":")){options.returnType=parseTypeAnnotation()}return markerApply(marker,options)}function parseFunctionDeclaration(){var id,body,token,tmp,firstRestricted,message,previousStrict,previousYieldAllowed,generator,marker=markerCreate(),parametricType;expectKeyword("function");generator=false;if(match("*")){lex();generator=true}token=lookahead;id=parseVariableIdentifier();if(match("<")){parametricType=parseParametricTypeAnnotation()}if(strict){if(isRestrictedWord(token.value)){throwErrorTolerant(token,Messages.StrictFunctionName)}}else{if(isRestrictedWord(token.value)){firstRestricted=token;message=Messages.StrictFunctionName}else if(isStrictModeReservedWord(token.value)){firstRestricted=token;message=Messages.StrictReservedWord}}tmp=parseParams(firstRestricted);firstRestricted=tmp.firstRestricted;if(tmp.message){message=tmp.message}previousStrict=strict;previousYieldAllowed=state.yieldAllowed;state.yieldAllowed=generator;body=parseFunctionSourceElements();if(strict&&firstRestricted){throwError(firstRestricted,message)}if(strict&&tmp.stricted){throwErrorTolerant(tmp.stricted,message)}strict=previousStrict;state.yieldAllowed=previousYieldAllowed;return markerApply(marker,delegate.createFunctionDeclaration(id,tmp.params,tmp.defaults,body,tmp.rest,generator,false,tmp.returnType,parametricType))}function parseFunctionExpression(){var token,id=null,firstRestricted,message,tmp,body,previousStrict,previousYieldAllowed,generator,marker=markerCreate(),parametricType;expectKeyword("function");generator=false;if(match("*")){lex();generator=true}if(!match("(")){if(!match("<")){token=lookahead;id=parseVariableIdentifier();if(strict){if(isRestrictedWord(token.value)){throwErrorTolerant(token,Messages.StrictFunctionName)}}else{if(isRestrictedWord(token.value)){firstRestricted=token;message=Messages.StrictFunctionName}else if(isStrictModeReservedWord(token.value)){firstRestricted=token;message=Messages.StrictReservedWord}}}if(match("<")){parametricType=parseParametricTypeAnnotation()}}tmp=parseParams(firstRestricted);firstRestricted=tmp.firstRestricted;if(tmp.message){message=tmp.message}previousStrict=strict;previousYieldAllowed=state.yieldAllowed;state.yieldAllowed=generator;body=parseFunctionSourceElements();if(strict&&firstRestricted){throwError(firstRestricted,message)}if(strict&&tmp.stricted){throwErrorTolerant(tmp.stricted,message)}strict=previousStrict;state.yieldAllowed=previousYieldAllowed;return markerApply(marker,delegate.createFunctionExpression(id,tmp.params,tmp.defaults,body,tmp.rest,generator,false,tmp.returnType,parametricType))}function parseYieldExpression(){var yieldToken,delegateFlag,expr,marker=markerCreate();yieldToken=lex();assert(yieldToken.value==="yield","Called parseYieldExpression with non-yield lookahead.");if(!state.yieldAllowed){throwErrorTolerant({},Messages.IllegalYield)}delegateFlag=false;if(match("*")){lex();delegateFlag=true}expr=parseAssignmentExpression();return markerApply(marker,delegate.createYieldExpression(expr,delegateFlag))}function parseMethodDefinition(existingPropNames){var token,key,param,propType,isValidDuplicateProp=false,marker=markerCreate(),token2,parametricType,parametricTypeMarker,annotationMarker;if(lookahead.value==="static"){propType=ClassPropertyType.static;lex()}else{propType=ClassPropertyType.prototype}if(match("*")){lex();return markerApply(marker,delegate.createMethodDefinition(propType,"",parseObjectPropertyKey(),parsePropertyMethodFunction({generator:true})))}token=lookahead;key=parseObjectPropertyKey();if(token.value==="get"&&!match("(")){key=parseObjectPropertyKey();if(existingPropNames[propType].hasOwnProperty(key.name)){isValidDuplicateProp=existingPropNames[propType][key.name].get===undefined&&existingPropNames[propType][key.name].data===undefined&&existingPropNames[propType][key.name].set!==undefined;if(!isValidDuplicateProp){throwError(key,Messages.IllegalDuplicateClassProperty)}}else{existingPropNames[propType][key.name]={}}existingPropNames[propType][key.name].get=true;expect("(");expect(")");return markerApply(marker,delegate.createMethodDefinition(propType,"get",key,parsePropertyFunction({generator:false})))}if(token.value==="set"&&!match("(")){key=parseObjectPropertyKey();if(existingPropNames[propType].hasOwnProperty(key.name)){isValidDuplicateProp=existingPropNames[propType][key.name].set===undefined&&existingPropNames[propType][key.name].data===undefined&&existingPropNames[propType][key.name].get!==undefined;if(!isValidDuplicateProp){throwError(key,Messages.IllegalDuplicateClassProperty)}}else{existingPropNames[propType][key.name]={}}existingPropNames[propType][key.name].set=true;expect("(");token=lookahead;param=[parseTypeAnnotatableIdentifier()];expect(")");return markerApply(marker,delegate.createMethodDefinition(propType,"set",key,parsePropertyFunction({params:param,generator:false,name:token})))}if(match("<")){parametricType=parseParametricTypeAnnotation()}if(existingPropNames[propType].hasOwnProperty(key.name)){throwError(key,Messages.IllegalDuplicateClassProperty)}else{existingPropNames[propType][key.name]={}}existingPropNames[propType][key.name].data=true;return markerApply(marker,delegate.createMethodDefinition(propType,"",key,parsePropertyMethodFunction({generator:false,parametricType:parametricType})))}function parseClassProperty(existingPropNames){var marker=markerCreate(),propertyIdentifier;propertyIdentifier=parseTypeAnnotatableIdentifier();expect(";");return markerApply(marker,delegate.createClassProperty(propertyIdentifier))}function parseClassElement(existingProps){if(match(";")){lex();return}var doubleLookahead=lookahead2();if(doubleLookahead.type===Token.Punctuator){if(doubleLookahead.value===":"){return parseClassProperty(existingProps)}}return parseMethodDefinition(existingProps)}function parseClassBody(){var classElement,classElements=[],existingProps={},marker=markerCreate();existingProps[ClassPropertyType.static]={};existingProps[ClassPropertyType.prototype]={};expect("{");while(index<length){if(match("}")){break}classElement=parseClassElement(existingProps);if(typeof classElement!=="undefined"){classElements.push(classElement)}}expect("}");return markerApply(marker,delegate.createClassBody(classElements))}function parseClassExpression(){var id,previousYieldAllowed,superClass=null,marker=markerCreate(),parametricType;expectKeyword("class");if(!matchKeyword("extends")&&!match("{")){id=parseVariableIdentifier()}if(match("<")){parametricType=parseParametricTypeAnnotation()}if(matchKeyword("extends")){expectKeyword("extends");previousYieldAllowed=state.yieldAllowed;state.yieldAllowed=false;superClass=parseAssignmentExpression();state.yieldAllowed=previousYieldAllowed}return markerApply(marker,delegate.createClassExpression(id,superClass,parseClassBody(),parametricType))}function parseClassDeclaration(){var id,previousYieldAllowed,superClass=null,marker=markerCreate(),parametricType,superParametricType;expectKeyword("class");id=parseVariableIdentifier();if(match("<")){parametricType=parseParametricTypeAnnotation()}if(matchKeyword("extends")){expectKeyword("extends");previousYieldAllowed=state.yieldAllowed;state.yieldAllowed=false;superClass=parseAssignmentExpression();state.yieldAllowed=previousYieldAllowed}return markerApply(marker,delegate.createClassDeclaration(id,superClass,parseClassBody(),parametricType,superParametricType))}function matchModuleDeclaration(){var id;if(matchContextualKeyword("module")){id=lookahead2();return id.type===Token.StringLiteral||id.type===Token.Identifier}return false}function parseSourceElement(){if(lookahead.type===Token.Keyword){switch(lookahead.value){case"const":case"let":return parseConstLetDeclaration(lookahead.value);case"function":return parseFunctionDeclaration();case"export":return parseExportDeclaration();case"import":return parseImportDeclaration();default:return parseStatement()}}if(matchModuleDeclaration()){throwError({},Messages.NestedModule)}if(lookahead.type!==Token.EOF){return parseStatement()}}function parseProgramElement(){if(lookahead.type===Token.Keyword){switch(lookahead.value){case"export":return parseExportDeclaration();case"import":return parseImportDeclaration()}}if(matchModuleDeclaration()){return parseModuleDeclaration()}return parseSourceElement()}function parseProgramElements(){var sourceElement,sourceElements=[],token,directive,firstRestricted;while(index<length){token=lookahead;if(token.type!==Token.StringLiteral){break}sourceElement=parseProgramElement();sourceElements.push(sourceElement);if(sourceElement.expression.type!==Syntax.Literal){break}directive=source.slice(token.range[0]+1,token.range[1]-1);if(directive==="use strict"){strict=true;if(firstRestricted){throwErrorTolerant(firstRestricted,Messages.StrictOctalLiteral)}}else{if(!firstRestricted&&token.octal){firstRestricted=token}}}while(index<length){sourceElement=parseProgramElement();if(typeof sourceElement==="undefined"){break}sourceElements.push(sourceElement)}return sourceElements}function parseModuleElement(){return parseSourceElement()}function parseModuleElements(){var list=[],statement;while(index<length){if(match("}")){break}statement=parseModuleElement();if(typeof statement==="undefined"){break}list.push(statement)}return list}function parseModuleBlock(){var block,marker=markerCreate();expect("{");block=parseModuleElements();expect("}");return markerApply(marker,delegate.createBlockStatement(block))}function parseProgram(){var body,marker=markerCreate();strict=false;peek();body=parseProgramElements();return markerApply(marker,delegate.createProgram(body))}function addComment(type,value,start,end,loc){var comment;assert(typeof start==="number","Comment must have valid position");if(state.lastCommentStart>=start){return}state.lastCommentStart=start;comment={type:type,value:value};if(extra.range){comment.range=[start,end]}if(extra.loc){comment.loc=loc}extra.comments.push(comment);if(extra.attachComment){extra.leadingComments.push(comment);extra.trailingComments.push(comment)}}function scanComment(){var comment,ch,loc,start,blockComment,lineComment;comment="";blockComment=false;lineComment=false;while(index<length){ch=source[index];if(lineComment){ch=source[index++];if(isLineTerminator(ch.charCodeAt(0))){loc.end={line:lineNumber,column:index-lineStart-1};lineComment=false;addComment("Line",comment,start,index-1,loc);if(ch==="\r"&&source[index]==="\n"){++index}++lineNumber;lineStart=index;comment=""}else if(index>=length){lineComment=false;comment+=ch;loc.end={line:lineNumber,column:length-lineStart};addComment("Line",comment,start,length,loc)}else{comment+=ch}}else if(blockComment){if(isLineTerminator(ch.charCodeAt(0))){if(ch==="\r"){++index;comment+="\r"}if(ch!=="\r"||source[index]==="\n"){comment+=source[index];++lineNumber;++index;lineStart=index;if(index>=length){throwError({},Messages.UnexpectedToken,"ILLEGAL")}}}else{ch=source[index++];if(index>=length){throwError({},Messages.UnexpectedToken,"ILLEGAL")}comment+=ch;if(ch==="*"){ch=source[index];if(ch==="/"){comment=comment.substr(0,comment.length-1);blockComment=false;++index;loc.end={line:lineNumber,column:index-lineStart};addComment("Block",comment,start,index,loc);comment=""}}}}else if(ch==="/"){ch=source[index+1];if(ch==="/"){loc={start:{line:lineNumber,column:index-lineStart}};start=index;index+=2;lineComment=true;if(index>=length){loc.end={line:lineNumber,column:index-lineStart};lineComment=false;addComment("Line",comment,start,index,loc)}}else if(ch==="*"){start=index;index+=2;blockComment=true;loc={start:{line:lineNumber,column:index-lineStart-2}};if(index>=length){throwError({},Messages.UnexpectedToken,"ILLEGAL")}}else{break}}else if(isWhiteSpace(ch.charCodeAt(0))){++index}else if(isLineTerminator(ch.charCodeAt(0))){++index;if(ch==="\r"&&source[index]==="\n"){++index}++lineNumber;lineStart=index}else{break}}}XHTMLEntities={quot:'"',amp:"&",apos:"'",lt:"<",gt:">",nbsp:"",iexcl:"",cent:"",pound:"",curren:"",yen:"",brvbar:"",sect:"",uml:"",copy:"",ordf:"",laquo:"",not:"",shy:"",reg:"",macr:"",deg:"",plusmn:"",sup2:"",sup3:"",acute:"",micro:"",para:"",middot:"",cedil:"",sup1:"",ordm:"",raquo:"",frac14:"",frac12:"",frac34:"",iquest:"",Agrave:"",Aacute:"",Acirc:"",Atilde:"",Auml:"",Aring:"",AElig:"",Ccedil:"",Egrave:"",Eacute:"",Ecirc:"",Euml:"",Igrave:"",Iacute:"",Icirc:"",Iuml:"",ETH:"",Ntilde:"",Ograve:"",Oacute:"",Ocirc:"",Otilde:"",Ouml:"",times:"",Oslash:"",Ugrave:"",Uacute:"",Ucirc:"",Uuml:"",Yacute:"",THORN:"",szlig:"",agrave:"",aacute:"",acirc:"",atilde:"",auml:"",aring:"",aelig:"",ccedil:"",egrave:"",eacute:"",ecirc:"",euml:"",igrave:"",iacute:"",icirc:"",iuml:"",eth:"",ntilde:"",ograve:"",oacute:"",ocirc:"",otilde:"",ouml:"",divide:"",oslash:"",ugrave:"",uacute:"",ucirc:"",uuml:"",yacute:"",thorn:"",yuml:"",OElig:"",oelig:"",Scaron:"",scaron:"",Yuml:"",fnof:"",circ:"",tilde:"",Alpha:"",Beta:"",Gamma:"",Delta:"",Epsilon:"",Zeta:"",Eta:"",Theta:"",Iota:"",Kappa:"",Lambda:"",Mu:"",Nu:"",Xi:"",Omicron:"",Pi:"",Rho:"",Sigma:"",Tau:"",Upsilon:"",Phi:"",Chi:"",Psi:"",Omega:"",alpha:"",beta:"",gamma:"",delta:"",epsilon:"",zeta:"",eta:"",theta:"",iota:"",kappa:"",lambda:"",mu:"",nu:"",xi:"",omicron:"",pi:"",rho:"",sigmaf:"",sigma:"",tau:"",upsilon:"",phi:"",chi:"",psi:"",omega:"",thetasym:"",upsih:"",piv:"",ensp:"",emsp:"",thinsp:"",zwnj:"",zwj:"",lrm:"",rlm:"",ndash:"",mdash:"",lsquo:"",rsquo:"",sbquo:"",ldquo:"",rdquo:"",bdquo:"",dagger:"",Dagger:"",bull:"",hellip:"",permil:"",prime:"",Prime:"",lsaquo:"",rsaquo:"",oline:"",frasl:"",euro:"",image:"",weierp:"",real:"",trade:"",alefsym:"",larr:"",uarr:"",rarr:"",darr:"",harr:"",crarr:"",lArr:"",uArr:"",rArr:"",dArr:"",hArr:"",forall:"",part:"",exist:"",empty:"",nabla:"",isin:"",notin:"",ni:"",prod:"",sum:"",minus:"",lowast:"",radic:"",prop:"",infin:"",ang:"",and:"",or:"",cap:"",cup:"",int:"",there4:"",sim:"",cong:"",asymp:"",ne:"",equiv:"",le:"",ge:"",sub:"",sup:"",nsub:"",sube:"",supe:"",oplus:"",otimes:"",perp:"",sdot:"",lceil:"",rceil:"",lfloor:"",rfloor:"",lang:"",rang:"",loz:"",spades:"",clubs:"",hearts:"",diams:""};function getQualifiedXJSName(object){if(object.type===Syntax.XJSIdentifier){return object.name}if(object.type===Syntax.XJSNamespacedName){return object.namespace.name+":"+object.name.name}if(object.type===Syntax.XJSMemberExpression){return getQualifiedXJSName(object.object)+"."+getQualifiedXJSName(object.property)}}function isXJSIdentifierStart(ch){return ch!==92&&isIdentifierStart(ch)}function isXJSIdentifierPart(ch){return ch!==92&&(ch===45||isIdentifierPart(ch))}function scanXJSIdentifier(){var ch,start,value="";start=index;while(index<length){ch=source.charCodeAt(index);if(!isXJSIdentifierPart(ch)){break}value+=source[index++]}return{type:Token.XJSIdentifier,value:value,lineNumber:lineNumber,lineStart:lineStart,range:[start,index]}}function scanXJSEntity(){var ch,str="",count=0,entity;ch=source[index];assert(ch==="&","Entity must start with an ampersand");index++;while(index<length&&count++<10){ch=source[index++];if(ch===";"){break}str+=ch}if(str[0]==="#"&&str[1]==="x"){entity=String.fromCharCode(parseInt(str.substr(2),16))}else if(str[0]==="#"){entity=String.fromCharCode(parseInt(str.substr(1),10))}else{entity=XHTMLEntities[str]}return entity}function scanXJSText(stopChars){var ch,str="",start;start=index;while(index<length){ch=source[index];if(stopChars.indexOf(ch)!==-1){break}if(ch==="&"){str+=scanXJSEntity()}else{index++;if(ch==="\r"&&source[index]==="\n"){str+=ch;ch=source[index];index++}if(isLineTerminator(ch.charCodeAt(0))){++lineNumber;lineStart=index}str+=ch}}return{type:Token.XJSText,value:str,lineNumber:lineNumber,lineStart:lineStart,range:[start,index]}}function scanXJSStringLiteral(){var innerToken,quote,start;quote=source[index];assert(quote==="'"||quote==='"',"String literal must starts with a quote");start=index;++index;innerToken=scanXJSText([quote]);if(quote!==source[index]){throwError({},Messages.UnexpectedToken,"ILLEGAL")}++index;innerToken.range=[start,index];return innerToken}function advanceXJSChild(){var ch=source.charCodeAt(index);if(ch!==123&&ch!==60){return scanXJSText(["<","{"])}return scanPunctuator()}function parseXJSIdentifier(){var token,marker=markerCreate();if(lookahead.type!==Token.XJSIdentifier){throwUnexpected(lookahead)}token=lex();return markerApply(marker,delegate.createXJSIdentifier(token.value))}function parseXJSNamespacedName(){var namespace,name,marker=markerCreate();namespace=parseXJSIdentifier();expect(":");name=parseXJSIdentifier();return markerApply(marker,delegate.createXJSNamespacedName(namespace,name))}function parseXJSMemberExpression(){var marker=markerCreate(),expr=parseXJSIdentifier();while(match(".")){lex();expr=markerApply(marker,delegate.createXJSMemberExpression(expr,parseXJSIdentifier()))}return expr}function parseXJSElementName(){if(lookahead2().value===":"){return parseXJSNamespacedName()}if(lookahead2().value==="."){return parseXJSMemberExpression()}return parseXJSIdentifier()}function parseXJSAttributeName(){if(lookahead2().value===":"){return parseXJSNamespacedName()}return parseXJSIdentifier()}function parseXJSAttributeValue(){var value,marker;if(match("{")){value=parseXJSExpressionContainer();if(value.expression.type===Syntax.XJSEmptyExpression){throwError(value,"XJS attributes must only be assigned a non-empty "+"expression")}}else if(match("<")){value=parseXJSElement()}else if(lookahead.type===Token.XJSText){marker=markerCreate();value=markerApply(marker,delegate.createLiteral(lex()))}else{throwError({},Messages.InvalidXJSAttributeValue)}return value}function parseXJSEmptyExpression(){var marker=markerCreatePreserveWhitespace();while(source.charAt(index)!=="}"){index++}return markerApply(marker,delegate.createXJSEmptyExpression())}function parseXJSExpressionContainer(){var expression,origInXJSChild,origInXJSTag,marker=markerCreate();origInXJSChild=state.inXJSChild;origInXJSTag=state.inXJSTag;state.inXJSChild=false;state.inXJSTag=false;expect("{");if(match("}")){expression=parseXJSEmptyExpression()}else{expression=parseExpression()}state.inXJSChild=origInXJSChild;state.inXJSTag=origInXJSTag;expect("}");return markerApply(marker,delegate.createXJSExpressionContainer(expression))}function parseXJSSpreadAttribute(){var expression,origInXJSChild,origInXJSTag,marker=markerCreate();origInXJSChild=state.inXJSChild;origInXJSTag=state.inXJSTag;state.inXJSChild=false;state.inXJSTag=false;expect("{");expect("...");expression=parseAssignmentExpression();state.inXJSChild=origInXJSChild;state.inXJSTag=origInXJSTag;expect("}");return markerApply(marker,delegate.createXJSSpreadAttribute(expression))}function parseXJSAttribute(){var name,marker;if(match("{")){return parseXJSSpreadAttribute()}marker=markerCreate();name=parseXJSAttributeName();if(match("=")){lex();return markerApply(marker,delegate.createXJSAttribute(name,parseXJSAttributeValue()))}return markerApply(marker,delegate.createXJSAttribute(name))}function parseXJSChild(){var token,marker;if(match("{")){token=parseXJSExpressionContainer()}else if(lookahead.type===Token.XJSText){marker=markerCreatePreserveWhitespace();token=markerApply(marker,delegate.createLiteral(lex()))}else{token=parseXJSElement()}return token}function parseXJSClosingElement(){var name,origInXJSChild,origInXJSTag,marker=markerCreate();origInXJSChild=state.inXJSChild;origInXJSTag=state.inXJSTag;state.inXJSChild=false;state.inXJSTag=true;expect("<");expect("/");name=parseXJSElementName();state.inXJSChild=origInXJSChild;state.inXJSTag=origInXJSTag;expect(">");return markerApply(marker,delegate.createXJSClosingElement(name))}function parseXJSOpeningElement(){var name,attribute,attributes=[],selfClosing=false,origInXJSChild,origInXJSTag,marker=markerCreate();origInXJSChild=state.inXJSChild;origInXJSTag=state.inXJSTag;state.inXJSChild=false;state.inXJSTag=true;expect("<");name=parseXJSElementName();while(index<length&&lookahead.value!=="/"&&lookahead.value!==">"){attributes.push(parseXJSAttribute())}state.inXJSTag=origInXJSTag;if(lookahead.value==="/"){expect("/");state.inXJSChild=origInXJSChild;expect(">");selfClosing=true}else{state.inXJSChild=true;expect(">")}return markerApply(marker,delegate.createXJSOpeningElement(name,attributes,selfClosing))}function parseXJSElement(){var openingElement,closingElement=null,children=[],origInXJSChild,origInXJSTag,marker=markerCreate();origInXJSChild=state.inXJSChild;origInXJSTag=state.inXJSTag;openingElement=parseXJSOpeningElement();if(!openingElement.selfClosing){while(index<length){state.inXJSChild=false;if(lookahead.value==="<"&&lookahead2().value==="/"){break}state.inXJSChild=true;children.push(parseXJSChild())}state.inXJSChild=origInXJSChild;state.inXJSTag=origInXJSTag;closingElement=parseXJSClosingElement();if(getQualifiedXJSName(closingElement.name)!==getQualifiedXJSName(openingElement.name)){throwError({},Messages.ExpectedXJSClosingTag,getQualifiedXJSName(openingElement.name))}}if(!origInXJSChild&&match("<")){throwError(lookahead,Messages.AdjacentXJSElements)}return markerApply(marker,delegate.createXJSElement(openingElement,closingElement,children))}function collectToken(){var start,loc,token,range,value;if(!state.inXJSChild){skipComment()}start=index;loc={start:{line:lineNumber,column:index-lineStart}};token=extra.advance();loc.end={line:lineNumber,column:index-lineStart};if(token.type!==Token.EOF){range=[token.range[0],token.range[1]];value=source.slice(token.range[0],token.range[1]);extra.tokens.push({type:TokenName[token.type],value:value,range:range,loc:loc})}return token}function collectRegex(){var pos,loc,regex,token;skipComment();pos=index;loc={start:{line:lineNumber,column:index-lineStart}};regex=extra.scanRegExp();loc.end={line:lineNumber,column:index-lineStart};if(!extra.tokenize){if(extra.tokens.length>0){token=extra.tokens[extra.tokens.length-1];if(token.range[0]===pos&&token.type==="Punctuator"){if(token.value==="/"||token.value==="/="){extra.tokens.pop()}}}extra.tokens.push({type:"RegularExpression",value:regex.literal,range:[pos,index],loc:loc})}return regex}function filterTokenLocation(){var i,entry,token,tokens=[];for(i=0;i<extra.tokens.length;++i){entry=extra.tokens[i];token={type:entry.type,value:entry.value};if(extra.range){token.range=entry.range}if(extra.loc){token.loc=entry.loc}tokens.push(token)}extra.tokens=tokens}function patch(){if(extra.comments){extra.skipComment=skipComment;skipComment=scanComment}if(typeof extra.tokens!=="undefined"){extra.advance=advance;extra.scanRegExp=scanRegExp;advance=collectToken;scanRegExp=collectRegex}}function unpatch(){if(typeof extra.skipComment==="function"){skipComment=extra.skipComment}if(typeof extra.scanRegExp==="function"){advance=extra.advance;scanRegExp=extra.scanRegExp}}function extend(object,properties){var entry,result={};for(entry in object){if(object.hasOwnProperty(entry)){result[entry]=object[entry]}}for(entry in properties){if(properties.hasOwnProperty(entry)){result[entry]=properties[entry]}}return result}function tokenize(code,options){var toString,token,tokens;toString=String;if(typeof code!=="string"&&!(code instanceof String)){code=toString(code)}delegate=SyntaxTreeDelegate;source=code;index=0;lineNumber=source.length>0?1:0;lineStart=0;length=source.length;lookahead=null;state={allowKeyword:true,allowIn:true,labelSet:{},inFunctionBody:false,inIteration:false,inSwitch:false,lastCommentStart:-1};extra={};options=options||{};options.tokens=true;extra.tokens=[];extra.tokenize=true;extra.openParenToken=-1;extra.openCurlyToken=-1;extra.range=typeof options.range==="boolean"&&options.range;extra.loc=typeof options.loc==="boolean"&&options.loc;if(typeof options.comment==="boolean"&&options.comment){extra.comments=[]}if(typeof options.tolerant==="boolean"&&options.tolerant){extra.errors=[]}if(length>0){if(typeof source[0]==="undefined"){if(code instanceof String){source=code.valueOf()}}}patch();try{peek();if(lookahead.type===Token.EOF){return extra.tokens}token=lex();while(lookahead.type!==Token.EOF){try{token=lex()}catch(lexError){token=lookahead;if(extra.errors){extra.errors.push(lexError);break}else{throw lexError}}}filterTokenLocation();tokens=extra.tokens;if(typeof extra.comments!=="undefined"){tokens.comments=extra.comments}if(typeof extra.errors!=="undefined"){tokens.errors=extra.errors}}catch(e){throw e}finally{unpatch();extra={}}return tokens}function parse(code,options){var program,toString;toString=String;if(typeof code!=="string"&&!(code instanceof String)){code=toString(code)}delegate=SyntaxTreeDelegate;source=code;index=0;lineNumber=source.length>0?1:0;lineStart=0;length=source.length;lookahead=null;state={allowKeyword:false,allowIn:true,labelSet:{},parenthesizedCount:0,inFunctionBody:false,inIteration:false,inSwitch:false,inXJSChild:false,inXJSTag:false,lastCommentStart:-1,yieldAllowed:false};extra={};if(typeof options!=="undefined"){extra.range=typeof options.range==="boolean"&&options.range;extra.loc=typeof options.loc==="boolean"&&options.loc;extra.attachComment=typeof options.attachComment==="boolean"&&options.attachComment;if(extra.loc&&options.source!==null&&options.source!==undefined){delegate=extend(delegate,{postProcess:function(node){node.loc.source=toString(options.source);return node}})}if(typeof options.tokens==="boolean"&&options.tokens){extra.tokens=[]}if(typeof options.comment==="boolean"&&options.comment){extra.comments=[]}if(typeof options.tolerant==="boolean"&&options.tolerant){extra.errors=[]}if(extra.attachComment){extra.range=true;extra.comments=[];extra.bottomRightStack=[];extra.trailingComments=[];extra.leadingComments=[]}}if(length>0){if(typeof source[0]==="undefined"){if(code instanceof String){source=code.valueOf()}}}patch();try{program=parseProgram();if(typeof extra.comments!=="undefined"){program.comments=extra.comments}if(typeof extra.tokens!=="undefined"){filterTokenLocation();program.tokens=extra.tokens}if(typeof extra.errors!=="undefined"){program.errors=extra.errors}}catch(e){throw e}finally{unpatch();extra={}}return program}exports.version="6001.0001.0000-dev-harmony-fb";exports.tokenize=tokenize;exports.parse=parse;exports.Syntax=function(){var name,types={};if(typeof Object.create==="function"){types=Object.create(null)}for(name in Syntax){if(Syntax.hasOwnProperty(name)){types[name]=Syntax[name]}}if(typeof Object.freeze==="function"){Object.freeze(types)}return types}()})},{}],150:[function(require,module,exports){arguments[4][137][0].apply(exports,arguments)},{"./source-map/source-map-consumer":155,"./source-map/source-map-generator":156,"./source-map/source-node":157,dup:137}],151:[function(require,module,exports){arguments[4][138][0].apply(exports,arguments)},{"./util":158,amdefine:159,dup:138}],152:[function(require,module,exports){if(typeof define!=="function"){var define=require("amdefine")(module,require)}define(function(require,exports,module){var base64=require("./base64");var VLQ_BASE_SHIFT=5;var VLQ_BASE=1<<VLQ_BASE_SHIFT;var VLQ_BASE_MASK=VLQ_BASE-1;var VLQ_CONTINUATION_BIT=VLQ_BASE;function toVLQSigned(aValue){return aValue<0?(-aValue<<1)+1:(aValue<<1)+0}function fromVLQSigned(aValue){var isNegative=(aValue&1)===1;var shifted=aValue>>1;return isNegative?-shifted:shifted}exports.encode=function base64VLQ_encode(aValue){var encoded="";var digit;var vlq=toVLQSigned(aValue);do{digit=vlq&VLQ_BASE_MASK;vlq>>>=VLQ_BASE_SHIFT;if(vlq>0){digit|=VLQ_CONTINUATION_BIT}encoded+=base64.encode(digit)}while(vlq>0);return encoded};exports.decode=function base64VLQ_decode(aStr){var i=0;var strLen=aStr.length;var result=0;var shift=0;var continuation,digit;do{if(i>=strLen){throw new Error("Expected more digits in base 64 VLQ value.")}digit=base64.decode(aStr.charAt(i++));continuation=!!(digit&VLQ_CONTINUATION_BIT);digit&=VLQ_BASE_MASK;result=result+(digit<<shift);shift+=VLQ_BASE_SHIFT}while(continuation);return{value:fromVLQSigned(result),rest:aStr.slice(i)}}})},{"./base64":153,amdefine:159}],153:[function(require,module,exports){arguments[4][140][0].apply(exports,arguments)},{amdefine:159,dup:140}],154:[function(require,module,exports){arguments[4][141][0].apply(exports,arguments)},{amdefine:159,dup:141}],155:[function(require,module,exports){if(typeof define!=="function"){var define=require("amdefine")(module,require)}define(function(require,exports,module){var util=require("./util");var binarySearch=require("./binary-search");var ArraySet=require("./array-set").ArraySet;var base64VLQ=require("./base64-vlq");function SourceMapConsumer(aSourceMap){var sourceMap=aSourceMap;if(typeof aSourceMap==="string"){sourceMap=JSON.parse(aSourceMap.replace(/^\)\]\}'/,""))}var version=util.getArg(sourceMap,"version");var sources=util.getArg(sourceMap,"sources");var names=util.getArg(sourceMap,"names",[]);var sourceRoot=util.getArg(sourceMap,"sourceRoot",null);var sourcesContent=util.getArg(sourceMap,"sourcesContent",null);var mappings=util.getArg(sourceMap,"mappings");var file=util.getArg(sourceMap,"file",null);if(version!=this._version){throw new Error("Unsupported version: "+version)}this._names=ArraySet.fromArray(names,true);this._sources=ArraySet.fromArray(sources,true);
this.sourceRoot=sourceRoot;this.sourcesContent=sourcesContent;this._mappings=mappings;this.file=file}SourceMapConsumer.fromSourceMap=function SourceMapConsumer_fromSourceMap(aSourceMap){var smc=Object.create(SourceMapConsumer.prototype);smc._names=ArraySet.fromArray(aSourceMap._names.toArray(),true);smc._sources=ArraySet.fromArray(aSourceMap._sources.toArray(),true);smc.sourceRoot=aSourceMap._sourceRoot;smc.sourcesContent=aSourceMap._generateSourcesContent(smc._sources.toArray(),smc.sourceRoot);smc.file=aSourceMap._file;smc.__generatedMappings=aSourceMap._mappings.slice().sort(util.compareByGeneratedPositions);smc.__originalMappings=aSourceMap._mappings.slice().sort(util.compareByOriginalPositions);return smc};SourceMapConsumer.prototype._version=3;Object.defineProperty(SourceMapConsumer.prototype,"sources",{get:function(){return this._sources.toArray().map(function(s){return this.sourceRoot?util.join(this.sourceRoot,s):s},this)}});SourceMapConsumer.prototype.__generatedMappings=null;Object.defineProperty(SourceMapConsumer.prototype,"_generatedMappings",{get:function(){if(!this.__generatedMappings){this.__generatedMappings=[];this.__originalMappings=[];this._parseMappings(this._mappings,this.sourceRoot)}return this.__generatedMappings}});SourceMapConsumer.prototype.__originalMappings=null;Object.defineProperty(SourceMapConsumer.prototype,"_originalMappings",{get:function(){if(!this.__originalMappings){this.__generatedMappings=[];this.__originalMappings=[];this._parseMappings(this._mappings,this.sourceRoot)}return this.__originalMappings}});SourceMapConsumer.prototype._parseMappings=function SourceMapConsumer_parseMappings(aStr,aSourceRoot){var generatedLine=1;var previousGeneratedColumn=0;var previousOriginalLine=0;var previousOriginalColumn=0;var previousSource=0;var previousName=0;var mappingSeparator=/^[,;]/;var str=aStr;var mapping;var temp;while(str.length>0){if(str.charAt(0)===";"){generatedLine++;str=str.slice(1);previousGeneratedColumn=0}else if(str.charAt(0)===","){str=str.slice(1)}else{mapping={};mapping.generatedLine=generatedLine;temp=base64VLQ.decode(str);mapping.generatedColumn=previousGeneratedColumn+temp.value;previousGeneratedColumn=mapping.generatedColumn;str=temp.rest;if(str.length>0&&!mappingSeparator.test(str.charAt(0))){temp=base64VLQ.decode(str);mapping.source=this._sources.at(previousSource+temp.value);previousSource+=temp.value;str=temp.rest;if(str.length===0||mappingSeparator.test(str.charAt(0))){throw new Error("Found a source, but no line and column")}temp=base64VLQ.decode(str);mapping.originalLine=previousOriginalLine+temp.value;previousOriginalLine=mapping.originalLine;mapping.originalLine+=1;str=temp.rest;if(str.length===0||mappingSeparator.test(str.charAt(0))){throw new Error("Found a source and line, but no column")}temp=base64VLQ.decode(str);mapping.originalColumn=previousOriginalColumn+temp.value;previousOriginalColumn=mapping.originalColumn;str=temp.rest;if(str.length>0&&!mappingSeparator.test(str.charAt(0))){temp=base64VLQ.decode(str);mapping.name=this._names.at(previousName+temp.value);previousName+=temp.value;str=temp.rest}}this.__generatedMappings.push(mapping);if(typeof mapping.originalLine==="number"){this.__originalMappings.push(mapping)}}}this.__originalMappings.sort(util.compareByOriginalPositions)};SourceMapConsumer.prototype._findMapping=function SourceMapConsumer_findMapping(aNeedle,aMappings,aLineName,aColumnName,aComparator){if(aNeedle[aLineName]<=0){throw new TypeError("Line must be greater than or equal to 1, got "+aNeedle[aLineName])}if(aNeedle[aColumnName]<0){throw new TypeError("Column must be greater than or equal to 0, got "+aNeedle[aColumnName])}return binarySearch.search(aNeedle,aMappings,aComparator)};SourceMapConsumer.prototype.originalPositionFor=function SourceMapConsumer_originalPositionFor(aArgs){var needle={generatedLine:util.getArg(aArgs,"line"),generatedColumn:util.getArg(aArgs,"column")};var mapping=this._findMapping(needle,this._generatedMappings,"generatedLine","generatedColumn",util.compareByGeneratedPositions);if(mapping){var source=util.getArg(mapping,"source",null);if(source&&this.sourceRoot){source=util.join(this.sourceRoot,source)}return{source:source,line:util.getArg(mapping,"originalLine",null),column:util.getArg(mapping,"originalColumn",null),name:util.getArg(mapping,"name",null)}}return{source:null,line:null,column:null,name:null}};SourceMapConsumer.prototype.sourceContentFor=function SourceMapConsumer_sourceContentFor(aSource){if(!this.sourcesContent){return null}if(this.sourceRoot){aSource=util.relative(this.sourceRoot,aSource)}if(this._sources.has(aSource)){return this.sourcesContent[this._sources.indexOf(aSource)]}var url;if(this.sourceRoot&&(url=util.urlParse(this.sourceRoot))){var fileUriAbsPath=aSource.replace(/^file:\/\//,"");if(url.scheme=="file"&&this._sources.has(fileUriAbsPath)){return this.sourcesContent[this._sources.indexOf(fileUriAbsPath)]}if((!url.path||url.path=="/")&&this._sources.has("/"+aSource)){return this.sourcesContent[this._sources.indexOf("/"+aSource)]}}throw new Error('"'+aSource+'" is not in the SourceMap.')};SourceMapConsumer.prototype.generatedPositionFor=function SourceMapConsumer_generatedPositionFor(aArgs){var needle={source:util.getArg(aArgs,"source"),originalLine:util.getArg(aArgs,"line"),originalColumn:util.getArg(aArgs,"column")};if(this.sourceRoot){needle.source=util.relative(this.sourceRoot,needle.source)}var mapping=this._findMapping(needle,this._originalMappings,"originalLine","originalColumn",util.compareByOriginalPositions);if(mapping){return{line:util.getArg(mapping,"generatedLine",null),column:util.getArg(mapping,"generatedColumn",null)}}return{line:null,column:null}};SourceMapConsumer.GENERATED_ORDER=1;SourceMapConsumer.ORIGINAL_ORDER=2;SourceMapConsumer.prototype.eachMapping=function SourceMapConsumer_eachMapping(aCallback,aContext,aOrder){var context=aContext||null;var order=aOrder||SourceMapConsumer.GENERATED_ORDER;var mappings;switch(order){case SourceMapConsumer.GENERATED_ORDER:mappings=this._generatedMappings;break;case SourceMapConsumer.ORIGINAL_ORDER:mappings=this._originalMappings;break;default:throw new Error("Unknown order of iteration.")}var sourceRoot=this.sourceRoot;mappings.map(function(mapping){var source=mapping.source;if(source&&sourceRoot){source=util.join(sourceRoot,source)}return{source:source,generatedLine:mapping.generatedLine,generatedColumn:mapping.generatedColumn,originalLine:mapping.originalLine,originalColumn:mapping.originalColumn,name:mapping.name}}).forEach(aCallback,context)};exports.SourceMapConsumer=SourceMapConsumer})},{"./array-set":151,"./base64-vlq":152,"./binary-search":154,"./util":158,amdefine:159}],156:[function(require,module,exports){if(typeof define!=="function"){var define=require("amdefine")(module,require)}define(function(require,exports,module){var base64VLQ=require("./base64-vlq");var util=require("./util");var ArraySet=require("./array-set").ArraySet;function SourceMapGenerator(aArgs){this._file=util.getArg(aArgs,"file");this._sourceRoot=util.getArg(aArgs,"sourceRoot",null);this._sources=new ArraySet;this._names=new ArraySet;this._mappings=[];this._sourcesContents=null}SourceMapGenerator.prototype._version=3;SourceMapGenerator.fromSourceMap=function SourceMapGenerator_fromSourceMap(aSourceMapConsumer){var sourceRoot=aSourceMapConsumer.sourceRoot;var generator=new SourceMapGenerator({file:aSourceMapConsumer.file,sourceRoot:sourceRoot});aSourceMapConsumer.eachMapping(function(mapping){var newMapping={generated:{line:mapping.generatedLine,column:mapping.generatedColumn}};if(mapping.source){newMapping.source=mapping.source;if(sourceRoot){newMapping.source=util.relative(sourceRoot,newMapping.source)}newMapping.original={line:mapping.originalLine,column:mapping.originalColumn};if(mapping.name){newMapping.name=mapping.name}}generator.addMapping(newMapping)});aSourceMapConsumer.sources.forEach(function(sourceFile){var content=aSourceMapConsumer.sourceContentFor(sourceFile);if(content){generator.setSourceContent(sourceFile,content)}});return generator};SourceMapGenerator.prototype.addMapping=function SourceMapGenerator_addMapping(aArgs){var generated=util.getArg(aArgs,"generated");var original=util.getArg(aArgs,"original",null);var source=util.getArg(aArgs,"source",null);var name=util.getArg(aArgs,"name",null);this._validateMapping(generated,original,source,name);if(source&&!this._sources.has(source)){this._sources.add(source)}if(name&&!this._names.has(name)){this._names.add(name)}this._mappings.push({generatedLine:generated.line,generatedColumn:generated.column,originalLine:original!=null&&original.line,originalColumn:original!=null&&original.column,source:source,name:name})};SourceMapGenerator.prototype.setSourceContent=function SourceMapGenerator_setSourceContent(aSourceFile,aSourceContent){var source=aSourceFile;if(this._sourceRoot){source=util.relative(this._sourceRoot,source)}if(aSourceContent!==null){if(!this._sourcesContents){this._sourcesContents={}}this._sourcesContents[util.toSetString(source)]=aSourceContent}else{delete this._sourcesContents[util.toSetString(source)];if(Object.keys(this._sourcesContents).length===0){this._sourcesContents=null}}};SourceMapGenerator.prototype.applySourceMap=function SourceMapGenerator_applySourceMap(aSourceMapConsumer,aSourceFile){if(!aSourceFile){aSourceFile=aSourceMapConsumer.file}var sourceRoot=this._sourceRoot;if(sourceRoot){aSourceFile=util.relative(sourceRoot,aSourceFile)}var newSources=new ArraySet;var newNames=new ArraySet;this._mappings.forEach(function(mapping){if(mapping.source===aSourceFile&&mapping.originalLine){var original=aSourceMapConsumer.originalPositionFor({line:mapping.originalLine,column:mapping.originalColumn});if(original.source!==null){if(sourceRoot){mapping.source=util.relative(sourceRoot,original.source)}else{mapping.source=original.source}mapping.originalLine=original.line;mapping.originalColumn=original.column;if(original.name!==null&&mapping.name!==null){mapping.name=original.name}}}var source=mapping.source;if(source&&!newSources.has(source)){newSources.add(source)}var name=mapping.name;if(name&&!newNames.has(name)){newNames.add(name)}},this);this._sources=newSources;this._names=newNames;aSourceMapConsumer.sources.forEach(function(sourceFile){var content=aSourceMapConsumer.sourceContentFor(sourceFile);if(content){if(sourceRoot){sourceFile=util.relative(sourceRoot,sourceFile)}this.setSourceContent(sourceFile,content)}},this)};SourceMapGenerator.prototype._validateMapping=function SourceMapGenerator_validateMapping(aGenerated,aOriginal,aSource,aName){if(aGenerated&&"line"in aGenerated&&"column"in aGenerated&&aGenerated.line>0&&aGenerated.column>=0&&!aOriginal&&!aSource&&!aName){return}else if(aGenerated&&"line"in aGenerated&&"column"in aGenerated&&aOriginal&&"line"in aOriginal&&"column"in aOriginal&&aGenerated.line>0&&aGenerated.column>=0&&aOriginal.line>0&&aOriginal.column>=0&&aSource){return}else{throw new Error("Invalid mapping: "+JSON.stringify({generated:aGenerated,source:aSource,orginal:aOriginal,name:aName}))}};SourceMapGenerator.prototype._serializeMappings=function SourceMapGenerator_serializeMappings(){var previousGeneratedColumn=0;var previousGeneratedLine=1;var previousOriginalColumn=0;var previousOriginalLine=0;var previousName=0;var previousSource=0;var result="";var mapping;this._mappings.sort(util.compareByGeneratedPositions);for(var i=0,len=this._mappings.length;i<len;i++){mapping=this._mappings[i];if(mapping.generatedLine!==previousGeneratedLine){previousGeneratedColumn=0;while(mapping.generatedLine!==previousGeneratedLine){result+=";";previousGeneratedLine++}}else{if(i>0){if(!util.compareByGeneratedPositions(mapping,this._mappings[i-1])){continue}result+=","}}result+=base64VLQ.encode(mapping.generatedColumn-previousGeneratedColumn);previousGeneratedColumn=mapping.generatedColumn;if(mapping.source){result+=base64VLQ.encode(this._sources.indexOf(mapping.source)-previousSource);previousSource=this._sources.indexOf(mapping.source);result+=base64VLQ.encode(mapping.originalLine-1-previousOriginalLine);previousOriginalLine=mapping.originalLine-1;result+=base64VLQ.encode(mapping.originalColumn-previousOriginalColumn);previousOriginalColumn=mapping.originalColumn;if(mapping.name){result+=base64VLQ.encode(this._names.indexOf(mapping.name)-previousName);previousName=this._names.indexOf(mapping.name)}}}return result};SourceMapGenerator.prototype._generateSourcesContent=function SourceMapGenerator_generateSourcesContent(aSources,aSourceRoot){return aSources.map(function(source){if(!this._sourcesContents){return null}if(aSourceRoot){source=util.relative(aSourceRoot,source)}var key=util.toSetString(source);return Object.prototype.hasOwnProperty.call(this._sourcesContents,key)?this._sourcesContents[key]:null},this)};SourceMapGenerator.prototype.toJSON=function SourceMapGenerator_toJSON(){var map={version:this._version,file:this._file,sources:this._sources.toArray(),names:this._names.toArray(),mappings:this._serializeMappings()};if(this._sourceRoot){map.sourceRoot=this._sourceRoot}if(this._sourcesContents){map.sourcesContent=this._generateSourcesContent(map.sources,map.sourceRoot)}return map};SourceMapGenerator.prototype.toString=function SourceMapGenerator_toString(){return JSON.stringify(this)};exports.SourceMapGenerator=SourceMapGenerator})},{"./array-set":151,"./base64-vlq":152,"./util":158,amdefine:159}],157:[function(require,module,exports){if(typeof define!=="function"){var define=require("amdefine")(module,require)}define(function(require,exports,module){var SourceMapGenerator=require("./source-map-generator").SourceMapGenerator;var util=require("./util");function SourceNode(aLine,aColumn,aSource,aChunks,aName){this.children=[];this.sourceContents={};this.line=aLine===undefined?null:aLine;this.column=aColumn===undefined?null:aColumn;this.source=aSource===undefined?null:aSource;this.name=aName===undefined?null:aName;if(aChunks!=null)this.add(aChunks)}SourceNode.fromStringWithSourceMap=function SourceNode_fromStringWithSourceMap(aGeneratedCode,aSourceMapConsumer){var node=new SourceNode;var remainingLines=aGeneratedCode.split("\n");var lastGeneratedLine=1,lastGeneratedColumn=0;var lastMapping=null;aSourceMapConsumer.eachMapping(function(mapping){if(lastMapping===null){while(lastGeneratedLine<mapping.generatedLine){node.add(remainingLines.shift()+"\n");lastGeneratedLine++}if(lastGeneratedColumn<mapping.generatedColumn){var nextLine=remainingLines[0];node.add(nextLine.substr(0,mapping.generatedColumn));remainingLines[0]=nextLine.substr(mapping.generatedColumn);lastGeneratedColumn=mapping.generatedColumn}}else{if(lastGeneratedLine<mapping.generatedLine){var code="";do{code+=remainingLines.shift()+"\n";lastGeneratedLine++;lastGeneratedColumn=0}while(lastGeneratedLine<mapping.generatedLine);if(lastGeneratedColumn<mapping.generatedColumn){var nextLine=remainingLines[0];code+=nextLine.substr(0,mapping.generatedColumn);remainingLines[0]=nextLine.substr(mapping.generatedColumn);lastGeneratedColumn=mapping.generatedColumn}addMappingWithCode(lastMapping,code)}else{var nextLine=remainingLines[0];var code=nextLine.substr(0,mapping.generatedColumn-lastGeneratedColumn);remainingLines[0]=nextLine.substr(mapping.generatedColumn-lastGeneratedColumn);lastGeneratedColumn=mapping.generatedColumn;addMappingWithCode(lastMapping,code)}}lastMapping=mapping},this);addMappingWithCode(lastMapping,remainingLines.join("\n"));aSourceMapConsumer.sources.forEach(function(sourceFile){var content=aSourceMapConsumer.sourceContentFor(sourceFile);if(content){node.setSourceContent(sourceFile,content)}});return node;function addMappingWithCode(mapping,code){if(mapping===null||mapping.source===undefined){node.add(code)}else{node.add(new SourceNode(mapping.originalLine,mapping.originalColumn,mapping.source,code,mapping.name))}}};SourceNode.prototype.add=function SourceNode_add(aChunk){if(Array.isArray(aChunk)){aChunk.forEach(function(chunk){this.add(chunk)},this)}else if(aChunk instanceof SourceNode||typeof aChunk==="string"){if(aChunk){this.children.push(aChunk)}}else{throw new TypeError("Expected a SourceNode, string, or an array of SourceNodes and strings. Got "+aChunk)}return this};SourceNode.prototype.prepend=function SourceNode_prepend(aChunk){if(Array.isArray(aChunk)){for(var i=aChunk.length-1;i>=0;i--){this.prepend(aChunk[i])}}else if(aChunk instanceof SourceNode||typeof aChunk==="string"){this.children.unshift(aChunk)}else{throw new TypeError("Expected a SourceNode, string, or an array of SourceNodes and strings. Got "+aChunk)}return this};SourceNode.prototype.walk=function SourceNode_walk(aFn){var chunk;for(var i=0,len=this.children.length;i<len;i++){chunk=this.children[i];if(chunk instanceof SourceNode){chunk.walk(aFn)}else{if(chunk!==""){aFn(chunk,{source:this.source,line:this.line,column:this.column,name:this.name})}}}};SourceNode.prototype.join=function SourceNode_join(aSep){var newChildren;var i;var len=this.children.length;if(len>0){newChildren=[];for(i=0;i<len-1;i++){newChildren.push(this.children[i]);newChildren.push(aSep)}newChildren.push(this.children[i]);this.children=newChildren}return this};SourceNode.prototype.replaceRight=function SourceNode_replaceRight(aPattern,aReplacement){var lastChild=this.children[this.children.length-1];if(lastChild instanceof SourceNode){lastChild.replaceRight(aPattern,aReplacement)}else if(typeof lastChild==="string"){this.children[this.children.length-1]=lastChild.replace(aPattern,aReplacement)}else{this.children.push("".replace(aPattern,aReplacement))}return this};SourceNode.prototype.setSourceContent=function SourceNode_setSourceContent(aSourceFile,aSourceContent){this.sourceContents[util.toSetString(aSourceFile)]=aSourceContent};SourceNode.prototype.walkSourceContents=function SourceNode_walkSourceContents(aFn){for(var i=0,len=this.children.length;i<len;i++){if(this.children[i]instanceof SourceNode){this.children[i].walkSourceContents(aFn)}}var sources=Object.keys(this.sourceContents);for(var i=0,len=sources.length;i<len;i++){aFn(util.fromSetString(sources[i]),this.sourceContents[sources[i]])}};SourceNode.prototype.toString=function SourceNode_toString(){var str="";this.walk(function(chunk){str+=chunk});return str};SourceNode.prototype.toStringWithSourceMap=function SourceNode_toStringWithSourceMap(aArgs){var generated={code:"",line:1,column:0};var map=new SourceMapGenerator(aArgs);var sourceMappingActive=false;var lastOriginalSource=null;var lastOriginalLine=null;var lastOriginalColumn=null;var lastOriginalName=null;this.walk(function(chunk,original){generated.code+=chunk;if(original.source!==null&&original.line!==null&&original.column!==null){if(lastOriginalSource!==original.source||lastOriginalLine!==original.line||lastOriginalColumn!==original.column||lastOriginalName!==original.name){map.addMapping({source:original.source,original:{line:original.line,column:original.column},generated:{line:generated.line,column:generated.column},name:original.name})}lastOriginalSource=original.source;lastOriginalLine=original.line;lastOriginalColumn=original.column;lastOriginalName=original.name;sourceMappingActive=true}else if(sourceMappingActive){map.addMapping({generated:{line:generated.line,column:generated.column}});lastOriginalSource=null;sourceMappingActive=false}chunk.split("").forEach(function(ch){if(ch==="\n"){generated.line++;generated.column=0}else{generated.column++}})});this.walkSourceContents(function(sourceFile,sourceContent){map.setSourceContent(sourceFile,sourceContent)});return{code:generated.code,map:map}};exports.SourceNode=SourceNode})},{"./source-map-generator":156,"./util":158,amdefine:159}],158:[function(require,module,exports){if(typeof define!=="function"){var define=require("amdefine")(module,require)}define(function(require,exports,module){function getArg(aArgs,aName,aDefaultValue){if(aName in aArgs){return aArgs[aName]}else if(arguments.length===3){return aDefaultValue}else{throw new Error('"'+aName+'" is a required argument.')}}exports.getArg=getArg;var urlRegexp=/([\w+\-.]+):\/\/((\w+:\w+)@)?([\w.]+)?(:(\d+))?(\S+)?/;var dataUrlRegexp=/^data:.+\,.+/;function urlParse(aUrl){var match=aUrl.match(urlRegexp);if(!match){return null}return{scheme:match[1],auth:match[3],host:match[4],port:match[6],path:match[7]}}exports.urlParse=urlParse;function urlGenerate(aParsedUrl){var url=aParsedUrl.scheme+"://";if(aParsedUrl.auth){url+=aParsedUrl.auth+"@"}if(aParsedUrl.host){url+=aParsedUrl.host}if(aParsedUrl.port){url+=":"+aParsedUrl.port}if(aParsedUrl.path){url+=aParsedUrl.path}return url}exports.urlGenerate=urlGenerate;function join(aRoot,aPath){var url;if(aPath.match(urlRegexp)||aPath.match(dataUrlRegexp)){return aPath}if(aPath.charAt(0)==="/"&&(url=urlParse(aRoot))){url.path=aPath;return urlGenerate(url)}return aRoot.replace(/\/$/,"")+"/"+aPath}exports.join=join;function toSetString(aStr){return"$"+aStr}exports.toSetString=toSetString;function fromSetString(aStr){return aStr.substr(1)}exports.fromSetString=fromSetString;function relative(aRoot,aPath){aRoot=aRoot.replace(/\/$/,"");var url=urlParse(aRoot);if(aPath.charAt(0)=="/"&&url&&url.path=="/"){return aPath.slice(1)}return aPath.indexOf(aRoot+"/")===0?aPath.substr(aRoot.length+1):aPath}exports.relative=relative;function strcmp(aStr1,aStr2){var s1=aStr1||"";var s2=aStr2||"";return(s1>s2)-(s1<s2)}function compareByOriginalPositions(mappingA,mappingB,onlyCompareOriginal){var cmp;cmp=strcmp(mappingA.source,mappingB.source);if(cmp){return cmp}cmp=mappingA.originalLine-mappingB.originalLine;if(cmp){return cmp}cmp=mappingA.originalColumn-mappingB.originalColumn;if(cmp||onlyCompareOriginal){return cmp}cmp=strcmp(mappingA.name,mappingB.name);if(cmp){return cmp}cmp=mappingA.generatedLine-mappingB.generatedLine;if(cmp){return cmp}return mappingA.generatedColumn-mappingB.generatedColumn}exports.compareByOriginalPositions=compareByOriginalPositions;function compareByGeneratedPositions(mappingA,mappingB,onlyCompareGenerated){var cmp;cmp=mappingA.generatedLine-mappingB.generatedLine;if(cmp){return cmp}cmp=mappingA.generatedColumn-mappingB.generatedColumn;if(cmp||onlyCompareGenerated){return cmp}cmp=strcmp(mappingA.source,mappingB.source);if(cmp){return cmp}cmp=mappingA.originalLine-mappingB.originalLine;if(cmp){return cmp}cmp=mappingA.originalColumn-mappingB.originalColumn;if(cmp){return cmp}return strcmp(mappingA.name,mappingB.name)}exports.compareByGeneratedPositions=compareByGeneratedPositions})},{amdefine:159}],159:[function(require,module,exports){(function(process,__filename){"use strict";function amdefine(module,requireFn){"use strict";var defineCache={},loaderCache={},alreadyCalled=false,path=require("path"),makeRequire,stringRequire;function trimDots(ary){var i,part;for(i=0;ary[i];i+=1){part=ary[i];if(part==="."){ary.splice(i,1);i-=1}else if(part===".."){if(i===1&&(ary[2]===".."||ary[0]==="..")){break}else if(i>0){ary.splice(i-1,2);i-=2}}}}function normalize(name,baseName){var baseParts;if(name&&name.charAt(0)==="."){if(baseName){baseParts=baseName.split("/");baseParts=baseParts.slice(0,baseParts.length-1);baseParts=baseParts.concat(name.split("/"));trimDots(baseParts);name=baseParts.join("/")}}return name}function makeNormalize(relName){return function(name){return normalize(name,relName)}}function makeLoad(id){function load(value){loaderCache[id]=value}load.fromText=function(id,text){throw new Error("amdefine does not implement load.fromText")};return load}makeRequire=function(systemRequire,exports,module,relId){function amdRequire(deps,callback){if(typeof deps==="string"){return stringRequire(systemRequire,exports,module,deps,relId)}else{deps=deps.map(function(depName){return stringRequire(systemRequire,exports,module,depName,relId)});process.nextTick(function(){callback.apply(null,deps)})}}amdRequire.toUrl=function(filePath){if(filePath.indexOf(".")===0){return normalize(filePath,path.dirname(module.filename))}else{return filePath}};return amdRequire};requireFn=requireFn||function req(){return module.require.apply(module,arguments)};function runFactory(id,deps,factory){var r,e,m,result;if(id){e=loaderCache[id]={};m={id:id,uri:__filename,exports:e};r=makeRequire(requireFn,e,m,id)}else{if(alreadyCalled){throw new Error("amdefine with no module ID cannot be called more than once per file.")}alreadyCalled=true;e=module.exports;m=module;r=makeRequire(requireFn,e,m,module.id)}if(deps){deps=deps.map(function(depName){return r(depName)})}if(typeof factory==="function"){result=factory.apply(m.exports,deps)}else{result=factory}if(result!==undefined){m.exports=result;if(id){loaderCache[id]=m.exports}}}stringRequire=function(systemRequire,exports,module,id,relId){var index=id.indexOf("!"),originalId=id,prefix,plugin;if(index===-1){id=normalize(id,relId);if(id==="require"){return makeRequire(systemRequire,exports,module,relId)}else if(id==="exports"){return exports}else if(id==="module"){return module}else if(loaderCache.hasOwnProperty(id)){return loaderCache[id]}else if(defineCache[id]){runFactory.apply(null,defineCache[id]);return loaderCache[id]}else{if(systemRequire){return systemRequire(originalId)}else{throw new Error("No module with ID: "+id)}}}else{prefix=id.substring(0,index);id=id.substring(index+1,id.length);plugin=stringRequire(systemRequire,exports,module,prefix,relId);if(plugin.normalize){id=plugin.normalize(id,makeNormalize(relId))}else{id=normalize(id,relId)}if(loaderCache[id]){return loaderCache[id]}else{plugin.load(id,makeRequire(systemRequire,exports,module,relId),makeLoad(id),{});return loaderCache[id]}}};function define(id,deps,factory){if(Array.isArray(id)){factory=deps;deps=id;id=undefined}else if(typeof id!=="string"){factory=id;id=deps=undefined}if(deps&&!Array.isArray(deps)){factory=deps;deps=undefined}if(!deps){deps=["require","exports","module"]}if(id){defineCache[id]=[id,deps,factory]}else{runFactory(id,deps,factory)}}define.require=function(id){if(loaderCache[id]){return loaderCache[id]}if(defineCache[id]){runFactory.apply(null,defineCache[id]);return loaderCache[id]}};define.amd={};return define}module.exports=amdefine}).call(this,require("_process"),"/node_modules/itreed/node_modules/jstransform/node_modules/source-map/node_modules/amdefine/amdefine.js")},{_process:10,path:9}],160:[function(require,module,exports){var docblockRe=/^\s*(\/\*\*(.|\r?\n)*?\*\/)/;var ltrimRe=/^\s*/;function extract(contents){var match=contents.match(docblockRe);if(match){return match[0].replace(ltrimRe,"")||""}return""}var commentStartRe=/^\/\*\*?/;var commentEndRe=/\*+\/$/;var wsRe=/[\t ]+/g;var stringStartRe=/(\r?\n|^) *\*/g;var multilineRe=/(?:^|\r?\n) *(@[^\r\n]*?) *\r?\n *([^@\r\n\s][^@\r\n]+?) *\r?\n/g;var propertyRe=/(?:^|\r?\n) *@(\S+) *([^\r\n]*)/g;function parse(docblock){docblock=docblock.replace(commentStartRe,"").replace(commentEndRe,"").replace(wsRe," ").replace(stringStartRe,"$1");var prev="";while(prev!=docblock){prev=docblock;docblock=docblock.replace(multilineRe,"\n$1 $2\n")}docblock=docblock.trim();var result=[];var match;while(match=propertyRe.exec(docblock)){result.push([match[1],match[2]])}return result}function parseAsObject(docblock){var pairs=parse(docblock);var result={};for(var i=0;i<pairs.length;i++){result[pairs[i][0]]=pairs[i][1]}return result}exports.extract=extract;exports.parse=parse;exports.parseAsObject=parseAsObject},{}],161:[function(require,module,exports){"use strict";var esprima=require("esprima-fb");var utils=require("./utils");var getBoundaryNode=utils.getBoundaryNode;var declareIdentInScope=utils.declareIdentInLocalScope;var initScopeMetadata=utils.initScopeMetadata;var Syntax=esprima.Syntax;function _nodeIsClosureScopeBoundary(node,parentNode){if(node.type===Syntax.Program){return true}var parentIsFunction=parentNode.type===Syntax.FunctionDeclaration||parentNode.type===Syntax.FunctionExpression||parentNode.type===Syntax.ArrowFunctionExpression;return node.type===Syntax.BlockStatement&&parentIsFunction}function _nodeIsBlockScopeBoundary(node,parentNode){if(node.type===Syntax.Program){return false}return node.type===Syntax.BlockStatement&&parentNode.type===Syntax.CatchClause}function traverse(node,path,state){var parentNode=path[0];if(!Array.isArray(node)&&state.localScope.parentNode!==parentNode){if(_nodeIsClosureScopeBoundary(node,parentNode)){var scopeIsStrict=state.scopeIsStrict||node.body.length>0&&node.body[0].type===Syntax.ExpressionStatement&&node.body[0].expression.type===Syntax.Literal&&node.body[0].expression.value==="use strict";if(node.type===Syntax.Program){state=utils.updateState(state,{scopeIsStrict:scopeIsStrict})}else{state=utils.updateState(state,{localScope:{parentNode:parentNode,parentScope:state.localScope,identifiers:{},tempVarIndex:0},scopeIsStrict:scopeIsStrict});declareIdentInScope("arguments",initScopeMetadata(node),state);if(parentNode.params.length>0){var param;for(var i=0;i<parentNode.params.length;i++){param=parentNode.params[i];if(param.type===Syntax.Identifier){declareIdentInScope(param.name,initScopeMetadata(parentNode),state)}}}if(parentNode.type===Syntax.FunctionExpression&&parentNode.id){var metaData=initScopeMetadata(parentNode,path.parentNodeslice,parentNode);declareIdentInScope(parentNode.id.name,metaData,state)}}collectClosureIdentsAndTraverse(node,path,state)}if(_nodeIsBlockScopeBoundary(node,parentNode)){state=utils.updateState(state,{localScope:{parentNode:parentNode,parentScope:state.localScope,identifiers:{}}});if(parentNode.type===Syntax.CatchClause){declareIdentInScope(parentNode.param.name,initScopeMetadata(parentNode),state)}collectBlockIdentsAndTraverse(node,path,state)}}function traverser(node,path,state){node.range&&utils.catchup(node.range[0],state);traverse(node,path,state);node.range&&utils.catchup(node.range[1],state)}utils.analyzeAndTraverse(walker,traverser,node,path,state)}function collectClosureIdentsAndTraverse(node,path,state){utils.analyzeAndTraverse(visitLocalClosureIdentifiers,collectClosureIdentsAndTraverse,node,path,state)}function collectBlockIdentsAndTraverse(node,path,state){utils.analyzeAndTraverse(visitLocalBlockIdentifiers,collectBlockIdentsAndTraverse,node,path,state)}function visitLocalClosureIdentifiers(node,path,state){var metaData;switch(node.type){case Syntax.FunctionExpression:return false;case Syntax.ClassDeclaration:case Syntax.ClassExpression:case Syntax.FunctionDeclaration:if(node.id){metaData=initScopeMetadata(getBoundaryNode(path),path.slice(),node);declareIdentInScope(node.id.name,metaData,state)}return false;case Syntax.VariableDeclarator:if(path[0].kind==="var"){metaData=initScopeMetadata(getBoundaryNode(path),path.slice(),node);declareIdentInScope(node.id.name,metaData,state)}break}}function visitLocalBlockIdentifiers(node,path,state){if(node.type===Syntax.CatchClause){return false}}function walker(node,path,state){var visitors=state.g.visitors;for(var i=0;i<visitors.length;i++){if(visitors[i].test(node,path,state)){return visitors[i](traverse,node,path,state)}}}var _astCache={};function transform(visitors,source,options){options=options||{};var ast;try{var cachedAst=_astCache[source];ast=cachedAst||(_astCache[source]=esprima.parse(source,{comment:true,loc:true,range:true}))}catch(e){e.message="Parse Error: "+e.message;throw e}var state=utils.createState(source,ast,options);state.g.visitors=visitors;if(options.sourceMap){var SourceMapGenerator=require("source-map").SourceMapGenerator;state.g.sourceMap=new SourceMapGenerator({file:options.filename||"transformed.js"})}traverse(ast,[],state);utils.catchup(source.length,state);var ret={code:state.g.buffer,extra:state.g.extra};if(options.sourceMap){ret.sourceMap=state.g.sourceMap;ret.sourceMapFilename=options.filename||"source.js"}return ret}exports.transform=transform},{"./utils":162,"esprima-fb":149,"source-map":150}],162:[function(require,module,exports){var Syntax=require("esprima-fb").Syntax;var leadingIndentRegexp=/(^|\n)( {2}|\t)/g;var nonWhiteRegexp=/(\S)/g;function createState(source,rootNode,transformOptions){return{localScope:{parentNode:rootNode,parentScope:null,identifiers:{},tempVarIndex:0},superClass:null,mungeNamespace:"",methodNode:null,methodFuncNode:null,className:null,scopeIsStrict:null,indentBy:0,g:{opts:transformOptions,position:0,extra:{},buffer:"",source:source,docblock:null,tagNamespaceUsed:false,isBolt:undefined,sourceMap:null,sourceMapFilename:"source.js",sourceLine:1,bufferLine:1,originalProgramAST:null,sourceColumn:0,bufferColumn:0}}
}function updateState(state,update){var ret=Object.create(state);Object.keys(update).forEach(function(updatedKey){ret[updatedKey]=update[updatedKey]});return ret}function catchup(end,state,contentTransformer){if(end<state.g.position){return}var source=state.g.source.substring(state.g.position,end);var transformed=updateIndent(source,state);if(state.g.sourceMap&&transformed){state.g.sourceMap.addMapping({generated:{line:state.g.bufferLine,column:state.g.bufferColumn},original:{line:state.g.sourceLine,column:state.g.sourceColumn},source:state.g.sourceMapFilename});var sourceLines=source.split("\n");var transformedLines=transformed.split("\n");for(var i=1;i<sourceLines.length-1;i++){state.g.sourceMap.addMapping({generated:{line:state.g.bufferLine,column:0},original:{line:state.g.sourceLine,column:0},source:state.g.sourceMapFilename});state.g.sourceLine++;state.g.bufferLine++}if(sourceLines.length>1){state.g.sourceLine++;state.g.bufferLine++;state.g.sourceColumn=0;state.g.bufferColumn=0}state.g.sourceColumn+=sourceLines[sourceLines.length-1].length;state.g.bufferColumn+=transformedLines[transformedLines.length-1].length}state.g.buffer+=contentTransformer?contentTransformer(transformed):transformed;state.g.position=end}function getNodeSourceText(node,state){return state.g.source.substring(node.range[0],node.range[1])}function replaceNonWhite(value){return value.replace(nonWhiteRegexp," ")}function stripNonWhite(value){return value.replace(nonWhiteRegexp,"")}function catchupWhiteOut(end,state){catchup(end,state,replaceNonWhite)}function catchupWhiteSpace(end,state){catchup(end,state,stripNonWhite)}var reNonNewline=/[^\n]/g;function stripNonNewline(value){return value.replace(reNonNewline,function(){return""})}function catchupNewlines(end,state){catchup(end,state,stripNonNewline)}function move(end,state){if(state.g.sourceMap){if(end<state.g.position){state.g.position=0;state.g.sourceLine=1;state.g.sourceColumn=0}var source=state.g.source.substring(state.g.position,end);var sourceLines=source.split("\n");if(sourceLines.length>1){state.g.sourceLine+=sourceLines.length-1;state.g.sourceColumn=0}state.g.sourceColumn+=sourceLines[sourceLines.length-1].length}state.g.position=end}function append(str,state){if(state.g.sourceMap&&str){state.g.sourceMap.addMapping({generated:{line:state.g.bufferLine,column:state.g.bufferColumn},original:{line:state.g.sourceLine,column:state.g.sourceColumn},source:state.g.sourceMapFilename});var transformedLines=str.split("\n");if(transformedLines.length>1){state.g.bufferLine+=transformedLines.length-1;state.g.bufferColumn=0}state.g.bufferColumn+=transformedLines[transformedLines.length-1].length}state.g.buffer+=str}function updateIndent(str,state){var indentBy=state.indentBy;if(indentBy<0){for(var i=0;i<-indentBy;i++){str=str.replace(leadingIndentRegexp,"$1")}}else{for(var i=0;i<indentBy;i++){str=str.replace(leadingIndentRegexp,"$1$2$2")}}return str}function indentBefore(start,state){var end=start;start=start-1;while(start>0&&state.g.source[start]!="\n"){if(!state.g.source[start].match(/[ \t]/)){end=start}start--}return state.g.source.substring(start+1,end)}function getDocblock(state){if(!state.g.docblock){var docblock=require("./docblock");state.g.docblock=docblock.parseAsObject(docblock.extract(state.g.source))}return state.g.docblock}function identWithinLexicalScope(identName,state,stopBeforeNode){var currScope=state.localScope;while(currScope){if(currScope.identifiers[identName]!==undefined){return true}if(stopBeforeNode&&currScope.parentNode===stopBeforeNode){break}currScope=currScope.parentScope}return false}function identInLocalScope(identName,state){return state.localScope.identifiers[identName]!==undefined}function initScopeMetadata(boundaryNode,path,node){return{boundaryNode:boundaryNode,bindingPath:path,bindingNode:node}}function declareIdentInLocalScope(identName,metaData,state){state.localScope.identifiers[identName]={boundaryNode:metaData.boundaryNode,path:metaData.path,node:metaData.node,state:Object.create(state)}}function getLexicalBindingMetadata(identName,state){return state.localScope.identifiers[identName]}function analyzeAndTraverse(analyzer,traverser,node,path,state){if(node.type){if(analyzer(node,path,state)===false){return}path.unshift(node)}getOrderedChildren(node).forEach(function(child){traverser(child,path,state)});node.type&&path.shift()}function getOrderedChildren(node){var queue=[];for(var key in node){if(node.hasOwnProperty(key)){enqueueNodeWithStartIndex(queue,node[key])}}queue.sort(function(a,b){return a[1]-b[1]});return queue.map(function(pair){return pair[0]})}function enqueueNodeWithStartIndex(queue,node){if(typeof node!=="object"||node===null){return}if(node.range){queue.push([node,node.range[0]])}else if(Array.isArray(node)){for(var ii=0;ii<node.length;ii++){enqueueNodeWithStartIndex(queue,node[ii])}}}function containsChildOfType(node,type){var foundMatchingChild=false;function nodeTypeAnalyzer(node){if(node.type===type){foundMatchingChild=true;return false}}function nodeTypeTraverser(child,path,state){if(!foundMatchingChild){foundMatchingChild=containsChildOfType(child,type)}}analyzeAndTraverse(nodeTypeAnalyzer,nodeTypeTraverser,node,[]);return foundMatchingChild}var scopeTypes={};scopeTypes[Syntax.FunctionExpression]=true;scopeTypes[Syntax.FunctionDeclaration]=true;scopeTypes[Syntax.Program]=true;function getBoundaryNode(path){for(var ii=0;ii<path.length;++ii){if(scopeTypes[path[ii].type]){return path[ii]}}throw new Error("Expected to find a node with one of the following types in path:\n"+JSON.stringify(Object.keys(scopeTypes)))}exports.append=append;exports.catchup=catchup;exports.catchupWhiteOut=catchupWhiteOut;exports.catchupWhiteSpace=catchupWhiteSpace;exports.catchupNewlines=catchupNewlines;exports.containsChildOfType=containsChildOfType;exports.createState=createState;exports.declareIdentInLocalScope=declareIdentInLocalScope;exports.getBoundaryNode=getBoundaryNode;exports.getDocblock=getDocblock;exports.getLexicalBindingMetadata=getLexicalBindingMetadata;exports.initScopeMetadata=initScopeMetadata;exports.identWithinLexicalScope=identWithinLexicalScope;exports.identInLocalScope=identInLocalScope;exports.indentBefore=indentBefore;exports.move=move;exports.scopeTypes=scopeTypes;exports.updateIndent=updateIndent;exports.updateState=updateState;exports.analyzeAndTraverse=analyzeAndTraverse;exports.getOrderedChildren=getOrderedChildren;exports.getNodeSourceText=getNodeSourceText},{"./docblock":160,"esprima-fb":149}],163:[function(require,module,exports){var Syntax=require("esprima-fb").Syntax;var utils=require("../src/utils");var restParamVisitors=require("./es6-rest-param-visitors");var restPropertyHelpers=require("./es7-rest-property-helpers");function visitStructuredVariable(traverse,node,path,state){utils.append(getTmpVar(state.localScope.tempVarIndex)+"=",state);utils.catchupWhiteSpace(node.init.range[0],state);traverse(node.init,path,state);utils.catchup(node.init.range[1],state);utils.append(","+getDestructuredComponents(node.id,state),state);state.localScope.tempVarIndex++;return false}visitStructuredVariable.test=function(node,path,state){return node.type===Syntax.VariableDeclarator&&isStructuredPattern(node.id)};function isStructuredPattern(node){return node.type===Syntax.ObjectPattern||node.type===Syntax.ArrayPattern}function getDestructuredComponents(node,state){var tmpIndex=state.localScope.tempVarIndex;var components=[];var patternItems=getPatternItems(node);for(var idx=0;idx<patternItems.length;idx++){var item=patternItems[idx];if(!item){continue}if(item.type===Syntax.SpreadElement){components.push(item.argument.name+"=Array.prototype.slice.call("+getTmpVar(tmpIndex)+","+idx+")");continue}if(item.type===Syntax.SpreadProperty){var restExpression=restPropertyHelpers.renderRestExpression(getTmpVar(tmpIndex),patternItems);components.push(item.argument.name+"="+restExpression);continue}var accessor=getPatternItemAccessor(node,item,tmpIndex,idx);var value=getPatternItemValue(node,item);if(value.type===Syntax.Identifier){components.push(value.name+"="+accessor)}else{components.push(getInitialValue(++state.localScope.tempVarIndex,accessor)+","+getDestructuredComponents(value,state))}}return components.join(",")}function getPatternItems(node){return node.properties||node.elements}function getPatternItemAccessor(node,patternItem,tmpIndex,idx){var tmpName=getTmpVar(tmpIndex);return node.type===Syntax.ObjectPattern?tmpName+"."+patternItem.key.name:tmpName+"["+idx+"]"}function getPatternItemValue(node,patternItem){return node.type===Syntax.ObjectPattern?patternItem.value:patternItem}function getInitialValue(index,value){return getTmpVar(index)+"="+value}function getTmpVar(index){return"$__"+index}function visitStructuredAssignment(traverse,node,path,state){var exprNode=node.expression;utils.append("var "+getTmpVar(state.localScope.tempVarIndex)+"=",state);utils.catchupWhiteSpace(exprNode.right.range[0],state);traverse(exprNode.right,path,state);utils.catchup(exprNode.right.range[1],state);utils.append(","+getDestructuredComponents(exprNode.left,state)+";",state);utils.catchupWhiteSpace(node.range[1],state);state.localScope.tempVarIndex++;return false}visitStructuredAssignment.test=function(node,path,state){return node.type===Syntax.ExpressionStatement&&node.expression.type===Syntax.AssignmentExpression&&isStructuredPattern(node.expression.left)};function visitStructuredParameter(traverse,node,path,state){utils.append(getTmpVar(getParamIndex(node,path)),state);utils.catchupWhiteSpace(node.range[1],state);return true}function getParamIndex(paramNode,path){var funcNode=path[0];var tmpIndex=0;for(var k=0;k<funcNode.params.length;k++){var param=funcNode.params[k];if(param===paramNode){break}if(isStructuredPattern(param)){tmpIndex++}}return tmpIndex}visitStructuredParameter.test=function(node,path,state){return isStructuredPattern(node)&&isFunctionNode(path[0])};function isFunctionNode(node){return node.type==Syntax.FunctionDeclaration||node.type==Syntax.FunctionExpression||node.type==Syntax.MethodDefinition||node.type==Syntax.ArrowFunctionExpression}function visitFunctionBodyForStructuredParameter(traverse,node,path,state){var funcNode=path[0];utils.catchup(funcNode.body.range[0]+1,state);renderDestructuredComponents(funcNode,state);if(funcNode.rest){utils.append(restParamVisitors.renderRestParamSetup(funcNode),state)}return true}function renderDestructuredComponents(funcNode,state){var destructuredComponents=[];for(var k=0;k<funcNode.params.length;k++){var param=funcNode.params[k];if(isStructuredPattern(param)){destructuredComponents.push(getDestructuredComponents(param,state));state.localScope.tempVarIndex++}}if(destructuredComponents.length){utils.append("var "+destructuredComponents.join(",")+";",state)}}visitFunctionBodyForStructuredParameter.test=function(node,path,state){return node.type===Syntax.BlockStatement&&isFunctionNode(path[0])};exports.visitorList=[visitStructuredVariable,visitStructuredAssignment,visitStructuredParameter,visitFunctionBodyForStructuredParameter];exports.renderDestructuredComponents=renderDestructuredComponents},{"../src/utils":162,"./es6-rest-param-visitors":164,"./es7-rest-property-helpers":165,"esprima-fb":149}],164:[function(require,module,exports){var Syntax=require("esprima-fb").Syntax;var utils=require("../src/utils");function _nodeIsFunctionWithRestParam(node){return(node.type===Syntax.FunctionDeclaration||node.type===Syntax.FunctionExpression||node.type===Syntax.ArrowFunctionExpression)&&node.rest}function visitFunctionParamsWithRestParam(traverse,node,path,state){if(node.parametricType){utils.catchup(node.parametricType.range[0],state);path.unshift(node);traverse(node.parametricType,path,state);path.shift()}if(node.params.length){path.unshift(node);traverse(node.params,path,state);path.shift()}else{utils.catchup(node.rest.range[0]-3,state)}utils.catchupWhiteSpace(node.rest.range[1],state);path.unshift(node);traverse(node.body,path,state);path.shift();return false}visitFunctionParamsWithRestParam.test=function(node,path,state){return _nodeIsFunctionWithRestParam(node)};function renderRestParamSetup(functionNode){return"var "+functionNode.rest.name+"=Array.prototype.slice.call("+"arguments,"+functionNode.params.length+");"}function visitFunctionBodyWithRestParam(traverse,node,path,state){utils.catchup(node.range[0]+1,state);var parentNode=path[0];utils.append(renderRestParamSetup(parentNode),state);return true}visitFunctionBodyWithRestParam.test=function(node,path,state){return node.type===Syntax.BlockStatement&&_nodeIsFunctionWithRestParam(path[0])};exports.renderRestParamSetup=renderRestParamSetup;exports.visitorList=[visitFunctionParamsWithRestParam,visitFunctionBodyWithRestParam]},{"../src/utils":162,"esprima-fb":149}],165:[function(require,module,exports){var Syntax=require("esprima-fb").Syntax;var utils=require("../src/utils");var restFunction="(function(source, exclusion) {"+"var rest = {};"+"var hasOwn = Object.prototype.hasOwnProperty;"+"if (source == null) {"+"throw new TypeError();"+"}"+"for (var key in source) {"+"if (hasOwn.call(source, key) && !hasOwn.call(exclusion, key)) {"+"rest[key] = source[key];"+"}"+"}"+"return rest;"+"})";function getPropertyNames(properties){var names=[];for(var i=0;i<properties.length;i++){var property=properties[i];if(property.type===Syntax.SpreadProperty){continue}if(property.type===Syntax.Identifier){names.push(property.name)}else{names.push(property.key.name)}}return names}function getRestFunctionCall(source,exclusion){return restFunction+"("+source+","+exclusion+")"}function getSimpleShallowCopy(accessorExpression){return getRestFunctionCall(accessorExpression,"{}")}function renderRestExpression(accessorExpression,excludedProperties){var excludedNames=getPropertyNames(excludedProperties);if(!excludedNames.length){return getSimpleShallowCopy(accessorExpression)}return getRestFunctionCall(accessorExpression,"{"+excludedNames.join(":1,")+":1}")}exports.renderRestExpression=renderRestExpression},{"../src/utils":162,"esprima-fb":149}],166:[function(require,module,exports){var ParseError=require("./src/ParseError");var buildTree=require("./src/buildTree");var parseTree=require("./src/parseTree");var utils=require("./src/utils");var render=function(toParse,baseNode){utils.clearNode(baseNode);var tree=parseTree(toParse);var node=buildTree(tree).toNode();baseNode.appendChild(node)};if(typeof document!=="undefined"){if(document.compatMode!=="CSS1Compat"){typeof console!=="undefined"&&console.warn("Warning: KaTeX doesn't work in quirks mode. Make sure your "+"website has a suitable doctype.");render=function(){throw new ParseError("KaTeX doesn't work in quirks mode.")}}}var renderToString=function(toParse){var tree=parseTree(toParse);return buildTree(tree).toMarkup()};module.exports={render:render,renderToString:renderToString,ParseError:ParseError}},{"./src/ParseError":169,"./src/buildTree":173,"./src/parseTree":178,"./src/utils":180}],167:[function(require,module,exports){var ParseError=require("./ParseError");function Lexer(input){this._input=input}function Token(text,data,position){this.text=text;this.data=data;this.position=position}var mathNormals=[/^[/|@.""`0-9a-zA-Z]/,/^[*+-]/,/^[=<>:]/,/^[,;]/,/^['\^_{}]/,/^[(\[]/,/^[)\]?!]/,/^~/];var textNormals=[/^[a-zA-Z0-9`!@*()-=+\[\]'";:?\/.,]/,/^[{}]/,/^~/];var whitespaceRegex=/^\s*/;var whitespaceConcatRegex=/^( +|\\  +)/;var anyFunc=/^\\(?:[a-zA-Z]+|.)/;Lexer.prototype._innerLex=function(pos,normals,ignoreWhitespace){var input=this._input.slice(pos);var whitespace;if(ignoreWhitespace){whitespace=input.match(whitespaceRegex)[0];pos+=whitespace.length;input=input.slice(whitespace.length)}else{whitespace=input.match(whitespaceConcatRegex);if(whitespace!==null){return new Token(" ",null,pos+whitespace[0].length)}}if(input.length===0){return new Token("EOF",null,pos)}var match;if(match=input.match(anyFunc)){return new Token(match[0],null,pos+match[0].length)}else{for(var i=0;i<normals.length;i++){var normal=normals[i];if(match=input.match(normal)){return new Token(match[0],null,pos+match[0].length)}}}throw new ParseError("Unexpected character: '"+input[0]+"'",this,pos)};var cssColor=/^(#[a-z0-9]+|[a-z]+)/i;Lexer.prototype._innerLexColor=function(pos){var input=this._input.slice(pos);var whitespace=input.match(whitespaceRegex)[0];pos+=whitespace.length;input=input.slice(whitespace.length);var match;if(match=input.match(cssColor)){return new Token(match[0],null,pos+match[0].length)}else{throw new ParseError("Invalid color",this,pos)}};var sizeRegex=/^(-?)\s*(\d+(?:\.\d*)?|\.\d+)\s*([a-z]{2})/;Lexer.prototype._innerLexSize=function(pos){var input=this._input.slice(pos);var whitespace=input.match(whitespaceRegex)[0];pos+=whitespace.length;input=input.slice(whitespace.length);var match;if(match=input.match(sizeRegex)){var unit=match[3];if(unit!=="em"&&unit!=="ex"){throw new ParseError("Invalid unit: '"+unit+"'",this,pos)}return new Token(match[0],{number:+(match[1]+match[2]),unit:unit},pos+match[0].length)}throw new ParseError("Invalid size",this,pos)};Lexer.prototype._innerLexWhitespace=function(pos){var input=this._input.slice(pos);var whitespace=input.match(whitespaceRegex)[0];pos+=whitespace.length;return new Token(whitespace,null,pos)};Lexer.prototype.lex=function(pos,mode){if(mode==="math"){return this._innerLex(pos,mathNormals,true)}else if(mode==="text"){return this._innerLex(pos,textNormals,false)}else if(mode==="color"){return this._innerLexColor(pos)}else if(mode==="size"){return this._innerLexSize(pos)}else if(mode==="whitespace"){return this._innerLexWhitespace(pos)}};module.exports=Lexer},{"./ParseError":169}],168:[function(require,module,exports){function Options(style,size,color,parentStyle,parentSize){this.style=style;this.color=color;this.size=size;if(parentStyle===undefined){parentStyle=style}this.parentStyle=parentStyle;if(parentSize===undefined){parentSize=size}this.parentSize=parentSize}Options.prototype.withStyle=function(style){return new Options(style,this.size,this.color,this.style,this.size)};Options.prototype.withSize=function(size){return new Options(this.style,size,this.color,this.style,this.size)};Options.prototype.withColor=function(color){return new Options(this.style,this.size,color,this.style,this.size)};Options.prototype.reset=function(){return new Options(this.style,this.size,this.color,this.style,this.size)};var colorMap={"katex-blue":"#6495ed","katex-orange":"#ffa500","katex-pink":"#ff00af","katex-red":"#df0030","katex-green":"#28ae7b","katex-gray":"gray","katex-purple":"#9d38bd"};Options.prototype.getColor=function(){return colorMap[this.color]||this.color};module.exports=Options},{}],169:[function(require,module,exports){function ParseError(message,lexer,position){var error="KaTeX parse error: "+message;if(lexer!==undefined&&position!==undefined){error+=" at position "+position+": ";var input=lexer._input;input=input.slice(0,position)+""+input.slice(position);var begin=Math.max(0,position-15);var end=position+15;error+=input.slice(begin,end)}var self=new Error(error);self.name="ParseError";self.__proto__=ParseError.prototype;self.position=position;return self}ParseError.prototype.__proto__=Error.prototype;module.exports=ParseError},{}],170:[function(require,module,exports){var functions=require("./functions");var Lexer=require("./Lexer");var symbols=require("./symbols");var utils=require("./utils");var ParseError=require("./ParseError");function Parser(input){this.lexer=new Lexer(input)}function ParseNode(type,value,mode){this.type=type;this.value=value;this.mode=mode}function ParseResult(result,newPosition){this.result=result;this.position=newPosition}function ParseFuncOrArgument(result,isFunction,allowedInText,numArgs,numOptionalArgs,argTypes){this.result=result;this.isFunction=isFunction;this.allowedInText=allowedInText;this.numArgs=numArgs;this.numOptionalArgs=numOptionalArgs;this.argTypes=argTypes}Parser.prototype.expect=function(result,text){if(result.text!==text){throw new ParseError("Expected '"+text+"', got '"+result.text+"'",this.lexer,result.position)}};Parser.prototype.parse=function(input){var parse=this.parseInput(0,"math");return parse.result};Parser.prototype.parseInput=function(pos,mode){var expression=this.parseExpression(pos,mode,false,null);var EOF=this.lexer.lex(expression.position,mode);this.expect(EOF,"EOF");return expression};Parser.prototype.parseExpression=function(pos,mode,breakOnInfix,breakOnToken){var body=[];while(true){var lex=this.lexer.lex(pos,mode);if(breakOnToken!=null&&lex.text===breakOnToken){break}var atom=this.parseAtom(pos,mode);if(!atom){break}if(breakOnInfix&&atom.result.type==="infix"){break}body.push(atom.result);pos=atom.position}return new ParseResult(this.handleInfixNodes(body,mode),pos)};Parser.prototype.handleInfixNodes=function(body,mode){var overIndex=-1;var func;var funcName;for(var i=0;i<body.length;i++){var node=body[i];if(node.type==="infix"){if(overIndex!==-1){throw new ParseError("only one infix operator per group",this.lexer,-1)}overIndex=i;funcName=node.value.replaceWith;func=functions.funcs[funcName]}}if(overIndex!==-1){var numerNode,denomNode;var numerBody=body.slice(0,overIndex);var denomBody=body.slice(overIndex+1);if(numerBody.length===1&&numerBody[0].type==="ordgroup"){numerNode=numerBody[0]}else{numerNode=new ParseNode("ordgroup",numerBody,mode)}if(denomBody.length===1&&denomBody[0].type==="ordgroup"){denomNode=denomBody[0]}else{denomNode=new ParseNode("ordgroup",denomBody,mode)}var value=func.handler(funcName,numerNode,denomNode);return[new ParseNode(value.type,value,mode)]}else{return body}};var SUPSUB_GREEDINESS=1;Parser.prototype.handleSupSubscript=function(pos,mode,symbol,name){var group=this.parseGroup(pos,mode);if(!group){throw new ParseError("Expected group after '"+symbol+"'",this.lexer,pos)}else if(group.numArgs>0){var funcGreediness=functions.getGreediness(group.result.result);if(funcGreediness>SUPSUB_GREEDINESS){return this.parseFunction(pos,mode)}else{throw new ParseError("Got function '"+group.result.result+"' with no arguments "+"as "+name,this.lexer,pos)}}else{return group.result}};Parser.prototype.parseAtom=function(pos,mode){var base=this.parseImplicitGroup(pos,mode);if(mode==="text"){return base}var currPos;if(!base){currPos=pos;base=undefined}else{currPos=base.position}var superscript;var subscript;var result;while(true){var lex=this.lexer.lex(currPos,mode);if(lex.text==="^"){if(superscript){throw new ParseError("Double superscript",this.lexer,currPos)}result=this.handleSupSubscript(lex.position,mode,lex.text,"superscript");currPos=result.position;superscript=result.result}else if(lex.text==="_"){if(subscript){throw new ParseError("Double subscript",this.lexer,currPos)}result=this.handleSupSubscript(lex.position,mode,lex.text,"subscript");currPos=result.position;subscript=result.result}else if(lex.text==="'"){var prime=new ParseNode("textord","\\prime",mode);var primes=[prime];currPos=lex.position;while((lex=this.lexer.lex(currPos,mode)).text==="'"){primes.push(prime);currPos=lex.position}superscript=new ParseNode("ordgroup",primes,mode)}else{break}}if(superscript||subscript){return new ParseResult(new ParseNode("supsub",{base:base&&base.result,sup:superscript,sub:subscript},mode),currPos)}else{return base}};var sizeFuncs=["\\tiny","\\scriptsize","\\footnotesize","\\small","\\normalsize","\\large","\\Large","\\LARGE","\\huge","\\Huge"];var styleFuncs=["\\displaystyle","\\textstyle","\\scriptstyle","\\scriptscriptstyle"];Parser.prototype.parseImplicitGroup=function(pos,mode){var start=this.parseSymbol(pos,mode);if(!start||!start.result){return this.parseFunction(pos,mode)}var func=start.result.result;var body;if(func==="\\left"){var left=this.parseFunction(pos,mode);body=this.parseExpression(left.position,mode,false,"}");var rightLex=this.parseSymbol(body.position,mode);if(rightLex&&rightLex.result.result==="\\right"){var right=this.parseFunction(body.position,mode);return new ParseResult(new ParseNode("leftright",{body:body.result,left:left.result.value.value,right:right.result.value.value},mode),right.position)}else{throw new ParseError("Missing \\right",this.lexer,body.position)}}else if(func==="\\right"){return null}else if(utils.contains(sizeFuncs,func)){body=this.parseExpression(start.result.position,mode,false,"}");return new ParseResult(new ParseNode("sizing",{size:"size"+(utils.indexOf(sizeFuncs,func)+1),value:body.result},mode),body.position)}else if(utils.contains(styleFuncs,func)){body=this.parseExpression(start.result.position,mode,true,"}");return new ParseResult(new ParseNode("styling",{style:func.slice(1,func.length-5),value:body.result},mode),body.position)}else{return this.parseFunction(pos,mode)}};Parser.prototype.parseFunction=function(pos,mode){var baseGroup=this.parseGroup(pos,mode);if(baseGroup){if(baseGroup.isFunction){var func=baseGroup.result.result;if(mode==="text"&&!baseGroup.allowedInText){throw new ParseError("Can't use function '"+func+"' in text mode",this.lexer,baseGroup.position)}var newPos=baseGroup.result.position;var result;var totalArgs=baseGroup.numArgs+baseGroup.numOptionalArgs;if(totalArgs>0){var baseGreediness=functions.getGreediness(func);var args=[func];var positions=[newPos];for(var i=0;i<totalArgs;i++){var argType=baseGroup.argTypes&&baseGroup.argTypes[i];var arg;if(i<baseGroup.numOptionalArgs){if(argType){arg=this.parseSpecialGroup(newPos,argType,mode,true)}else{arg=this.parseOptionalGroup(newPos,mode)}if(!arg){args.push(null);positions.push(newPos);continue}}else{if(argType){arg=this.parseSpecialGroup(newPos,argType,mode)}else{arg=this.parseGroup(newPos,mode)}if(!arg){throw new ParseError("Expected group after '"+baseGroup.result.result+"'",this.lexer,newPos)}}var argNode;if(arg.numArgs>0){var argGreediness=functions.getGreediness(arg.result.result);if(argGreediness>baseGreediness){argNode=this.parseFunction(newPos,mode)}else{throw new ParseError("Got function '"+arg.result.result+"' as "+"argument to function '"+baseGroup.result.result+"'",this.lexer,arg.result.position-1)}}else{argNode=arg.result}args.push(argNode.result);positions.push(argNode.position);newPos=argNode.position}args.push(positions);result=functions.funcs[func].handler.apply(this,args)}else{result=functions.funcs[func].handler.apply(this,[func])}return new ParseResult(new ParseNode(result.type,result,mode),newPos)}else{return baseGroup.result}}else{return null}};Parser.prototype.parseSpecialGroup=function(pos,mode,outerMode,optional){if(mode==="color"||mode==="size"){var openBrace=this.lexer.lex(pos,outerMode);if(optional&&openBrace.text!=="["){return null}this.expect(openBrace,optional?"[":"{");var inner=this.lexer.lex(openBrace.position,mode);var data;if(mode==="color"){data=inner.text}else{data=inner.data}var closeBrace=this.lexer.lex(inner.position,outerMode);this.expect(closeBrace,optional?"]":"}");return new ParseFuncOrArgument(new ParseResult(new ParseNode(mode,data,outerMode),closeBrace.position),false)}else if(mode==="text"){var whitespace=this.lexer.lex(pos,"whitespace");pos=whitespace.position}if(optional){return this.parseOptionalGroup(pos,mode)}else{return this.parseGroup(pos,mode)}};Parser.prototype.parseGroup=function(pos,mode){var start=this.lexer.lex(pos,mode);if(start.text==="{"){var expression=this.parseExpression(start.position,mode,false,"}");var closeBrace=this.lexer.lex(expression.position,mode);this.expect(closeBrace,"}");return new ParseFuncOrArgument(new ParseResult(new ParseNode("ordgroup",expression.result,mode),closeBrace.position),false)}else{return this.parseSymbol(pos,mode)}};Parser.prototype.parseOptionalGroup=function(pos,mode){var start=this.lexer.lex(pos,mode);if(start.text==="["){var expression=this.parseExpression(start.position,mode,false,"]");var closeBracket=this.lexer.lex(expression.position,mode);this.expect(closeBracket,"]");return new ParseFuncOrArgument(new ParseResult(new ParseNode("ordgroup",expression.result,mode),closeBracket.position),false)}else{return null}};Parser.prototype.parseSymbol=function(pos,mode){var nucleus=this.lexer.lex(pos,mode);if(functions.funcs[nucleus.text]){var func=functions.funcs[nucleus.text];var argTypes=func.argTypes;if(argTypes){argTypes=argTypes.slice();for(var i=0;i<argTypes.length;i++){if(argTypes[i]==="original"){argTypes[i]=mode}}}return new ParseFuncOrArgument(new ParseResult(nucleus.text,nucleus.position),true,func.allowedInText,func.numArgs,func.numOptionalArgs,argTypes)}else if(symbols[mode][nucleus.text]){return new ParseFuncOrArgument(new ParseResult(new ParseNode(symbols[mode][nucleus.text].group,nucleus.text,mode),nucleus.position),false)}else{return null}};module.exports=Parser},{"./Lexer":167,"./ParseError":169,"./functions":177,"./symbols":179,"./utils":180}],171:[function(require,module,exports){function Style(id,size,multiplier,cramped){this.id=id;this.size=size;this.cramped=cramped;this.sizeMultiplier=multiplier}Style.prototype.sup=function(){return styles[sup[this.id]]};Style.prototype.sub=function(){return styles[sub[this.id]]};Style.prototype.fracNum=function(){return styles[fracNum[this.id]]};Style.prototype.fracDen=function(){return styles[fracDen[this.id]]};Style.prototype.cramp=function(){return styles[cramp[this.id]]};Style.prototype.cls=function(){return sizeNames[this.size]+(this.cramped?" cramped":" uncramped")};Style.prototype.reset=function(){return resetNames[this.size]};var D=0;var Dc=1;var T=2;var Tc=3;var S=4;var Sc=5;var SS=6;var SSc=7;var sizeNames=["displaystyle textstyle","textstyle","scriptstyle","scriptscriptstyle"];var resetNames=["reset-textstyle","reset-textstyle","reset-scriptstyle","reset-scriptscriptstyle"];var styles=[new Style(D,0,1,false),new Style(Dc,0,1,true),new Style(T,1,1,false),new Style(Tc,1,1,true),new Style(S,2,.7,false),new Style(Sc,2,.7,true),new Style(SS,3,.5,false),new Style(SSc,3,.5,true)];var sup=[S,Sc,S,Sc,SS,SSc,SS,SSc];var sub=[Sc,Sc,Sc,Sc,SSc,SSc,SSc,SSc];var fracNum=[T,Tc,S,Sc,SS,SSc,SS,SSc];var fracDen=[Tc,Tc,Sc,Sc,SSc,SSc,SSc,SSc];var cramp=[Dc,Dc,Tc,Tc,Sc,Sc,SSc,SSc];module.exports={DISPLAY:styles[D],TEXT:styles[T],SCRIPT:styles[S],SCRIPTSCRIPT:styles[SS]}},{}],172:[function(require,module,exports){var domTree=require("./domTree");var fontMetrics=require("./fontMetrics");var symbols=require("./symbols");var makeSymbol=function(value,style,mode,color,classes){if(symbols[mode][value]&&symbols[mode][value].replace){value=symbols[mode][value].replace}var metrics=fontMetrics.getCharacterMetrics(value,style);var symbolNode;if(metrics){symbolNode=new domTree.symbolNode(value,metrics.height,metrics.depth,metrics.italic,metrics.skew,classes)}else{typeof console!=="undefined"&&console.warn("No character metrics for '"+value+"' in style '"+style+"'");symbolNode=new domTree.symbolNode(value,0,0,0,0,classes)}if(color){symbolNode.style.color=color}return symbolNode};var mathit=function(value,mode,color,classes){return makeSymbol(value,"Math-Italic",mode,color,classes.concat(["mathit"]))};var mathrm=function(value,mode,color,classes){if(symbols[mode][value].font==="main"){return makeSymbol(value,"Main-Regular",mode,color,classes)}else{return makeSymbol(value,"AMS-Regular",mode,color,classes.concat(["amsrm"]))}};var sizeElementFromChildren=function(elem){var height=0;var depth=0;var maxFontSize=0;if(elem.children){for(var i=0;i<elem.children.length;i++){if(elem.children[i].height>height){height=elem.children[i].height}if(elem.children[i].depth>depth){depth=elem.children[i].depth}if(elem.children[i].maxFontSize>maxFontSize){maxFontSize=elem.children[i].maxFontSize}}}elem.height=height;elem.depth=depth;elem.maxFontSize=maxFontSize};var makeSpan=function(classes,children,color){var span=new domTree.span(classes,children);sizeElementFromChildren(span);if(color){span.style.color=color}return span};var makeFragment=function(children){var fragment=new domTree.documentFragment(children);sizeElementFromChildren(fragment);return fragment};var makeFontSizer=function(options,fontSize){var fontSizeInner=makeSpan([],[new domTree.symbolNode("")]);fontSizeInner.style.fontSize=fontSize/options.style.sizeMultiplier+"em";
var fontSizer=makeSpan(["fontsize-ensurer","reset-"+options.size,"size5"],[fontSizeInner]);return fontSizer};var makeVList=function(children,positionType,positionData,options){var depth;var currPos;var i;if(positionType==="individualShift"){var oldChildren=children;children=[oldChildren[0]];depth=-oldChildren[0].shift-oldChildren[0].elem.depth;currPos=depth;for(i=1;i<oldChildren.length;i++){var diff=-oldChildren[i].shift-currPos-oldChildren[i].elem.depth;var size=diff-(oldChildren[i-1].elem.height+oldChildren[i-1].elem.depth);currPos=currPos+diff;children.push({type:"kern",size:size});children.push(oldChildren[i])}}else if(positionType==="top"){var bottom=positionData;for(i=0;i<children.length;i++){if(children[i].type==="kern"){bottom-=children[i].size}else{bottom-=children[i].elem.height+children[i].elem.depth}}depth=bottom}else if(positionType==="bottom"){depth=-positionData}else if(positionType==="shift"){depth=-children[0].elem.depth-positionData}else if(positionType==="firstBaseline"){depth=-children[0].elem.depth}else{depth=0}var maxFontSize=0;for(i=0;i<children.length;i++){if(children[i].type==="elem"){maxFontSize=Math.max(maxFontSize,children[i].elem.maxFontSize)}}var fontSizer=makeFontSizer(options,maxFontSize);var realChildren=[];currPos=depth;for(i=0;i<children.length;i++){if(children[i].type==="kern"){currPos+=children[i].size}else{var child=children[i].elem;var shift=-child.depth-currPos;currPos+=child.height+child.depth;var childWrap=makeSpan([],[fontSizer,child]);childWrap.height-=shift;childWrap.depth+=shift;childWrap.style.top=shift+"em";realChildren.push(childWrap)}}var baselineFix=makeSpan(["baseline-fix"],[fontSizer,new domTree.symbolNode("")]);realChildren.push(baselineFix);var vlist=makeSpan(["vlist"],realChildren);vlist.height=Math.max(currPos,vlist.height);vlist.depth=Math.max(-depth,vlist.depth);return vlist};module.exports={makeSymbol:makeSymbol,mathit:mathit,mathrm:mathrm,makeSpan:makeSpan,makeFragment:makeFragment,makeVList:makeVList}},{"./domTree":175,"./fontMetrics":176,"./symbols":179}],173:[function(require,module,exports){var Options=require("./Options");var ParseError=require("./ParseError");var Style=require("./Style");var buildCommon=require("./buildCommon");var delimiter=require("./delimiter");var domTree=require("./domTree");var fontMetrics=require("./fontMetrics");var utils=require("./utils");var makeSpan=buildCommon.makeSpan;var buildExpression=function(expression,options,prev){var groups=[];for(var i=0;i<expression.length;i++){var group=expression[i];groups.push(buildGroup(group,options,prev));prev=group}return groups};var groupToType={mathord:"mord",textord:"mord",bin:"mbin",rel:"mrel",text:"mord",open:"mopen",close:"mclose",inner:"minner",frac:"minner",spacing:"mord",punct:"mpunct",ordgroup:"mord",op:"mop",katex:"mord",overline:"mord",rule:"mord",leftright:"minner",sqrt:"mord",accent:"mord"};var getTypeOfGroup=function(group){if(group==null){return groupToType.mathord}else if(group.type==="supsub"){return getTypeOfGroup(group.value.base)}else if(group.type==="llap"||group.type==="rlap"){return getTypeOfGroup(group.value)}else if(group.type==="color"){return getTypeOfGroup(group.value.value)}else if(group.type==="sizing"){return getTypeOfGroup(group.value.value)}else if(group.type==="styling"){return getTypeOfGroup(group.value.value)}else if(group.type==="delimsizing"){return groupToType[group.value.delimType]}else{return groupToType[group.type]}};var shouldHandleSupSub=function(group,options){if(!group){return false}else if(group.type==="op"){return group.value.limits&&options.style.size===Style.DISPLAY.size}else if(group.type==="accent"){return isCharacterBox(group.value.base)}else{return null}};var getBaseElem=function(group){if(!group){return false}else if(group.type==="ordgroup"){if(group.value.length===1){return getBaseElem(group.value[0])}else{return group}}else if(group.type==="color"){if(group.value.value.length===1){return getBaseElem(group.value.value[0])}else{return group}}else{return group}};var isCharacterBox=function(group){var baseElem=getBaseElem(group);return baseElem.type==="mathord"||baseElem.type==="textord"||baseElem.type==="bin"||baseElem.type==="rel"||baseElem.type==="inner"||baseElem.type==="open"||baseElem.type==="close"||baseElem.type==="punct"};var groupTypes={mathord:function(group,options,prev){return buildCommon.mathit(group.value,group.mode,options.getColor(),["mord"])},textord:function(group,options,prev){return buildCommon.mathrm(group.value,group.mode,options.getColor(),["mord"])},bin:function(group,options,prev){var className="mbin";var prevAtom=prev;while(prevAtom&&prevAtom.type=="color"){var atoms=prevAtom.value.value;prevAtom=atoms[atoms.length-1]}if(!prev||utils.contains(["mbin","mopen","mrel","mop","mpunct"],getTypeOfGroup(prevAtom))){group.type="textord";className="mord"}return buildCommon.mathrm(group.value,group.mode,options.getColor(),[className])},rel:function(group,options,prev){return buildCommon.mathrm(group.value,group.mode,options.getColor(),["mrel"])},open:function(group,options,prev){return buildCommon.mathrm(group.value,group.mode,options.getColor(),["mopen"])},close:function(group,options,prev){return buildCommon.mathrm(group.value,group.mode,options.getColor(),["mclose"])},inner:function(group,options,prev){return buildCommon.mathrm(group.value,group.mode,options.getColor(),["minner"])},punct:function(group,options,prev){return buildCommon.mathrm(group.value,group.mode,options.getColor(),["mpunct"])},ordgroup:function(group,options,prev){return makeSpan(["mord",options.style.cls()],buildExpression(group.value,options.reset()))},text:function(group,options,prev){return makeSpan(["text","mord",options.style.cls()],buildExpression(group.value.body,options.reset()))},color:function(group,options,prev){var elements=buildExpression(group.value.value,options.withColor(group.value.color),prev);return new buildCommon.makeFragment(elements)},supsub:function(group,options,prev){if(shouldHandleSupSub(group.value.base,options)){return groupTypes[group.value.base.type](group,options,prev)}var base=buildGroup(group.value.base,options.reset());var supmid,submid,sup,sub;if(group.value.sup){sup=buildGroup(group.value.sup,options.withStyle(options.style.sup()));supmid=makeSpan([options.style.reset(),options.style.sup().cls()],[sup])}if(group.value.sub){sub=buildGroup(group.value.sub,options.withStyle(options.style.sub()));submid=makeSpan([options.style.reset(),options.style.sub().cls()],[sub])}var supShift,subShift;if(isCharacterBox(group.value.base)){supShift=0;subShift=0}else{supShift=base.height-fontMetrics.metrics.supDrop;subShift=base.depth+fontMetrics.metrics.subDrop}var minSupShift;if(options.style===Style.DISPLAY){minSupShift=fontMetrics.metrics.sup1}else if(options.style.cramped){minSupShift=fontMetrics.metrics.sup3}else{minSupShift=fontMetrics.metrics.sup2}var multiplier=Style.TEXT.sizeMultiplier*options.style.sizeMultiplier;var scriptspace=.5/fontMetrics.metrics.ptPerEm/multiplier+"em";var supsub;if(!group.value.sup){subShift=Math.max(subShift,fontMetrics.metrics.sub1,sub.height-.8*fontMetrics.metrics.xHeight);supsub=buildCommon.makeVList([{type:"elem",elem:submid}],"shift",subShift,options);supsub.children[0].style.marginRight=scriptspace;if(base instanceof domTree.symbolNode){supsub.children[0].style.marginLeft=-base.italic+"em"}}else if(!group.value.sub){supShift=Math.max(supShift,minSupShift,sup.depth+.25*fontMetrics.metrics.xHeight);supsub=buildCommon.makeVList([{type:"elem",elem:supmid}],"shift",-supShift,options);supsub.children[0].style.marginRight=scriptspace}else{supShift=Math.max(supShift,minSupShift,sup.depth+.25*fontMetrics.metrics.xHeight);subShift=Math.max(subShift,fontMetrics.metrics.sub2);var ruleWidth=fontMetrics.metrics.defaultRuleThickness;if(supShift-sup.depth-(sub.height-subShift)<4*ruleWidth){subShift=4*ruleWidth-(supShift-sup.depth)+sub.height;var psi=.8*fontMetrics.metrics.xHeight-(supShift-sup.depth);if(psi>0){supShift+=psi;subShift-=psi}}supsub=buildCommon.makeVList([{type:"elem",elem:submid,shift:subShift},{type:"elem",elem:supmid,shift:-supShift}],"individualShift",null,options);if(base instanceof domTree.symbolNode){supsub.children[0].style.marginLeft=-base.italic+"em"}supsub.children[0].style.marginRight=scriptspace;supsub.children[1].style.marginRight=scriptspace}return makeSpan([getTypeOfGroup(group.value.base)],[base,supsub])},genfrac:function(group,options,prev){var fstyle=options.style;if(group.value.size==="display"){fstyle=Style.DISPLAY}else if(group.value.size==="text"){fstyle=Style.TEXT}var nstyle=fstyle.fracNum();var dstyle=fstyle.fracDen();var numer=buildGroup(group.value.numer,options.withStyle(nstyle));var numerreset=makeSpan([fstyle.reset(),nstyle.cls()],[numer]);var denom=buildGroup(group.value.denom,options.withStyle(dstyle));var denomreset=makeSpan([fstyle.reset(),dstyle.cls()],[denom]);var ruleWidth;if(group.value.hasBarLine){ruleWidth=fontMetrics.metrics.defaultRuleThickness/options.style.sizeMultiplier}else{ruleWidth=0}var numShift;var clearance;var denomShift;if(fstyle.size===Style.DISPLAY.size){numShift=fontMetrics.metrics.num1;if(ruleWidth>0){clearance=3*ruleWidth}else{clearance=7*fontMetrics.metrics.defaultRuleThickness}denomShift=fontMetrics.metrics.denom1}else{if(ruleWidth>0){numShift=fontMetrics.metrics.num2;clearance=ruleWidth}else{numShift=fontMetrics.metrics.num3;clearance=3*fontMetrics.metrics.defaultRuleThickness}denomShift=fontMetrics.metrics.denom2}var frac;if(ruleWidth===0){var candiateClearance=numShift-numer.depth-(denom.height-denomShift);if(candiateClearance<clearance){numShift+=.5*(clearance-candiateClearance);denomShift+=.5*(clearance-candiateClearance)}frac=buildCommon.makeVList([{type:"elem",elem:denomreset,shift:denomShift},{type:"elem",elem:numerreset,shift:-numShift}],"individualShift",null,options)}else{var axisHeight=fontMetrics.metrics.axisHeight;if(numShift-numer.depth-(axisHeight+.5*ruleWidth)<clearance){numShift+=clearance-(numShift-numer.depth-(axisHeight+.5*ruleWidth))}if(axisHeight-.5*ruleWidth-(denom.height-denomShift)<clearance){denomShift+=clearance-(axisHeight-.5*ruleWidth-(denom.height-denomShift))}var mid=makeSpan([options.style.reset(),Style.TEXT.cls(),"frac-line"]);mid.height=ruleWidth;var midShift=-(axisHeight-.5*ruleWidth);frac=buildCommon.makeVList([{type:"elem",elem:denomreset,shift:denomShift},{type:"elem",elem:mid,shift:midShift},{type:"elem",elem:numerreset,shift:-numShift}],"individualShift",null,options)}frac.height*=fstyle.sizeMultiplier/options.style.sizeMultiplier;frac.depth*=fstyle.sizeMultiplier/options.style.sizeMultiplier;var innerChildren=[makeSpan(["mfrac"],[frac])];var delimSize;if(fstyle.size===Style.DISPLAY.size){delimSize=fontMetrics.metrics.delim1}else{delimSize=fontMetrics.metrics.getDelim2(fstyle)}if(group.value.leftDelim!=null){innerChildren.unshift(delimiter.customSizedDelim(group.value.leftDelim,delimSize,true,options.withStyle(fstyle),group.mode))}if(group.value.rightDelim!=null){innerChildren.push(delimiter.customSizedDelim(group.value.rightDelim,delimSize,true,options.withStyle(fstyle),group.mode))}return makeSpan(["minner",options.style.reset(),fstyle.cls()],innerChildren,options.getColor())},spacing:function(group,options,prev){if(group.value==="\\ "||group.value==="\\space"||group.value===" "||group.value==="~"){return makeSpan(["mord","mspace"],[buildCommon.mathrm(group.value,group.mode)])}else{var spacingClassMap={"\\qquad":"qquad","\\quad":"quad","\\enspace":"enspace","\\;":"thickspace","\\:":"mediumspace","\\,":"thinspace","\\!":"negativethinspace"};return makeSpan(["mord","mspace",spacingClassMap[group.value]])}},llap:function(group,options,prev){var inner=makeSpan(["inner"],[buildGroup(group.value.body,options.reset())]);var fix=makeSpan(["fix"],[]);return makeSpan(["llap",options.style.cls()],[inner,fix])},rlap:function(group,options,prev){var inner=makeSpan(["inner"],[buildGroup(group.value.body,options.reset())]);var fix=makeSpan(["fix"],[]);return makeSpan(["rlap",options.style.cls()],[inner,fix])},op:function(group,options,prev){var supGroup;var subGroup;var hasLimits=false;if(group.type==="supsub"){supGroup=group.value.sup;subGroup=group.value.sub;group=group.value.base;hasLimits=true}var noSuccessor=["\\smallint"];var large=false;if(options.style.size===Style.DISPLAY.size&&group.value.symbol&&!utils.contains(noSuccessor,group.value.body)){large=true}var base;var baseShift=0;var slant=0;if(group.value.symbol){var style=large?"Size2-Regular":"Size1-Regular";base=buildCommon.makeSymbol(group.value.body,style,"math",options.getColor(),["op-symbol",large?"large-op":"small-op","mop"]);baseShift=(base.height-base.depth)/2-fontMetrics.metrics.axisHeight*options.style.sizeMultiplier;slant=base.italic}else{var output=[];for(var i=1;i<group.value.body.length;i++){output.push(buildCommon.mathrm(group.value.body[i],group.mode))}base=makeSpan(["mop"],output,options.getColor())}if(hasLimits){base=makeSpan([],[base]);var supmid,supKern,submid,subKern;if(supGroup){var sup=buildGroup(supGroup,options.withStyle(options.style.sup()));supmid=makeSpan([options.style.reset(),options.style.sup().cls()],[sup]);supKern=Math.max(fontMetrics.metrics.bigOpSpacing1,fontMetrics.metrics.bigOpSpacing3-sup.depth)}if(subGroup){var sub=buildGroup(subGroup,options.withStyle(options.style.sub()));submid=makeSpan([options.style.reset(),options.style.sub().cls()],[sub]);subKern=Math.max(fontMetrics.metrics.bigOpSpacing2,fontMetrics.metrics.bigOpSpacing4-sub.height)}var finalGroup,top,bottom;if(!supGroup){top=base.height-baseShift;finalGroup=buildCommon.makeVList([{type:"kern",size:fontMetrics.metrics.bigOpSpacing5},{type:"elem",elem:submid},{type:"kern",size:subKern},{type:"elem",elem:base}],"top",top,options);finalGroup.children[0].style.marginLeft=-slant+"em"}else if(!subGroup){bottom=base.depth+baseShift;finalGroup=buildCommon.makeVList([{type:"elem",elem:base},{type:"kern",size:supKern},{type:"elem",elem:supmid},{type:"kern",size:fontMetrics.metrics.bigOpSpacing5}],"bottom",bottom,options);finalGroup.children[1].style.marginLeft=slant+"em"}else if(!supGroup&&!subGroup){return base}else{bottom=fontMetrics.metrics.bigOpSpacing5+submid.height+submid.depth+subKern+base.depth+baseShift;finalGroup=buildCommon.makeVList([{type:"kern",size:fontMetrics.metrics.bigOpSpacing5},{type:"elem",elem:submid},{type:"kern",size:subKern},{type:"elem",elem:base},{type:"kern",size:supKern},{type:"elem",elem:supmid},{type:"kern",size:fontMetrics.metrics.bigOpSpacing5}],"bottom",bottom,options);finalGroup.children[0].style.marginLeft=-slant+"em";finalGroup.children[2].style.marginLeft=slant+"em"}return makeSpan(["mop","op-limits"],[finalGroup])}else{if(group.value.symbol){base.style.top=baseShift+"em"}return base}},katex:function(group,options,prev){var k=makeSpan(["k"],[buildCommon.mathrm("K",group.mode)]);var a=makeSpan(["a"],[buildCommon.mathrm("A",group.mode)]);a.height=(a.height+.2)*.75;a.depth=(a.height-.2)*.75;var t=makeSpan(["t"],[buildCommon.mathrm("T",group.mode)]);var e=makeSpan(["e"],[buildCommon.mathrm("E",group.mode)]);e.height=e.height-.2155;e.depth=e.depth+.2155;var x=makeSpan(["x"],[buildCommon.mathrm("X",group.mode)]);return makeSpan(["katex-logo"],[k,a,t,e,x],options.getColor())},overline:function(group,options,prev){var innerGroup=buildGroup(group.value.body,options.withStyle(options.style.cramp()));var ruleWidth=fontMetrics.metrics.defaultRuleThickness/options.style.sizeMultiplier;var line=makeSpan([options.style.reset(),Style.TEXT.cls(),"overline-line"]);line.height=ruleWidth;line.maxFontSize=1;var vlist=buildCommon.makeVList([{type:"elem",elem:innerGroup},{type:"kern",size:3*ruleWidth},{type:"elem",elem:line},{type:"kern",size:ruleWidth}],"firstBaseline",null,options);return makeSpan(["overline","mord"],[vlist],options.getColor())},sqrt:function(group,options,prev){var inner=buildGroup(group.value.body,options.withStyle(options.style.cramp()));var ruleWidth=fontMetrics.metrics.defaultRuleThickness/options.style.sizeMultiplier;var line=makeSpan([options.style.reset(),Style.TEXT.cls(),"sqrt-line"],[],options.getColor());line.height=ruleWidth;line.maxFontSize=1;var phi=ruleWidth;if(options.style.id<Style.TEXT.id){phi=fontMetrics.metrics.xHeight}var lineClearance=ruleWidth+phi/4;var innerHeight=(inner.height+inner.depth)*options.style.sizeMultiplier;var minDelimiterHeight=innerHeight+lineClearance+ruleWidth;var delim=makeSpan(["sqrt-sign"],[delimiter.customSizedDelim("\\surd",minDelimiterHeight,false,options,group.mode)],options.getColor());var delimDepth=delim.height+delim.depth-ruleWidth;if(delimDepth>inner.height+inner.depth+lineClearance){lineClearance=(lineClearance+delimDepth-inner.height-inner.depth)/2}var delimShift=-(inner.height+lineClearance+ruleWidth)+delim.height;delim.style.top=delimShift+"em";delim.height-=delimShift;delim.depth+=delimShift;var body;if(inner.height===0&&inner.depth===0){body=makeSpan()}else{body=buildCommon.makeVList([{type:"elem",elem:inner},{type:"kern",size:lineClearance},{type:"elem",elem:line},{type:"kern",size:ruleWidth}],"firstBaseline",null,options)}return makeSpan(["sqrt","mord"],[delim,body])},sizing:function(group,options,prev){var inner=buildExpression(group.value.value,options.withSize(group.value.size),prev);var span=makeSpan(["mord"],[makeSpan(["sizing","reset-"+options.size,group.value.size,options.style.cls()],inner)]);var fontSize=sizingMultiplier[group.value.size];span.maxFontSize=fontSize*options.style.sizeMultiplier;return span},styling:function(group,options,prev){var style={display:Style.DISPLAY,text:Style.TEXT,script:Style.SCRIPT,scriptscript:Style.SCRIPTSCRIPT};var newStyle=style[group.value.style];var inner=buildExpression(group.value.value,options.withStyle(newStyle),prev);return makeSpan([options.style.reset(),newStyle.cls()],inner)},delimsizing:function(group,options,prev){var delim=group.value.value;if(delim==="."){return makeSpan([groupToType[group.value.delimType]])}return makeSpan([groupToType[group.value.delimType]],[delimiter.sizedDelim(delim,group.value.size,options,group.mode)])},leftright:function(group,options,prev){var inner=buildExpression(group.value.body,options.reset());var innerHeight=0;var innerDepth=0;for(var i=0;i<inner.length;i++){innerHeight=Math.max(inner[i].height,innerHeight);innerDepth=Math.max(inner[i].depth,innerDepth)}innerHeight*=options.style.sizeMultiplier;innerDepth*=options.style.sizeMultiplier;var leftDelim;if(group.value.left==="."){leftDelim=makeSpan(["nulldelimiter"])}else{leftDelim=delimiter.leftRightDelim(group.value.left,innerHeight,innerDepth,options,group.mode)}inner.unshift(leftDelim);var rightDelim;if(group.value.right==="."){rightDelim=makeSpan(["nulldelimiter"])}else{rightDelim=delimiter.leftRightDelim(group.value.right,innerHeight,innerDepth,options,group.mode)}inner.push(rightDelim);return makeSpan(["minner",options.style.cls()],inner,options.getColor())},rule:function(group,options,prev){var rule=makeSpan(["mord","rule"],[],options.getColor());var shift=0;if(group.value.shift){shift=group.value.shift.number;if(group.value.shift.unit==="ex"){shift*=fontMetrics.metrics.xHeight}}var width=group.value.width.number;if(group.value.width.unit==="ex"){width*=fontMetrics.metrics.xHeight}var height=group.value.height.number;if(group.value.height.unit==="ex"){height*=fontMetrics.metrics.xHeight}shift/=options.style.sizeMultiplier;width/=options.style.sizeMultiplier;height/=options.style.sizeMultiplier;rule.style.borderRightWidth=width+"em";rule.style.borderTopWidth=height+"em";rule.style.bottom=shift+"em";rule.width=width;rule.height=height+shift;rule.depth=-shift;return rule},accent:function(group,options,prev){var base=group.value.base;var supsubGroup;if(group.type==="supsub"){var supsub=group;group=supsub.value.base;base=group.value.base;supsub.value.base=base;supsubGroup=buildGroup(supsub,options.reset(),prev)}var body=buildGroup(base,options.withStyle(options.style.cramp()));var skew;if(isCharacterBox(base)){var baseChar=getBaseElem(base);var baseGroup=buildGroup(baseChar,options.withStyle(options.style.cramp()));skew=baseGroup.skew}else{skew=0}var clearance=Math.min(body.height,fontMetrics.metrics.xHeight);var accent=buildCommon.makeSymbol(group.value.accent,"Main-Regular","math",options.getColor());accent.italic=0;var vecClass=group.value.accent==="\\vec"?"accent-vec":null;var accentBody=makeSpan(["accent-body",vecClass],[makeSpan([],[accent])]);accentBody=buildCommon.makeVList([{type:"elem",elem:body},{type:"kern",size:-clearance},{type:"elem",elem:accentBody}],"firstBaseline",null,options);accentBody.children[1].style.marginLeft=2*skew+"em";var accentWrap=makeSpan(["mord","accent"],[accentBody]);if(supsubGroup){supsubGroup.children[0]=accentWrap;supsubGroup.height=Math.max(accentWrap.height,supsubGroup.height);supsubGroup.classes[0]="mord";return supsubGroup}else{return accentWrap}}};var sizingMultiplier={size1:.5,size2:.7,size3:.8,size4:.9,size5:1,size6:1.2,size7:1.44,size8:1.73,size9:2.07,size10:2.49};var buildGroup=function(group,options,prev){if(!group){return makeSpan()}if(groupTypes[group.type]){var groupNode=groupTypes[group.type](group,options,prev);var multiplier;if(options.style!==options.parentStyle){multiplier=options.style.sizeMultiplier/options.parentStyle.sizeMultiplier;groupNode.height*=multiplier;groupNode.depth*=multiplier}if(options.size!==options.parentSize){multiplier=sizingMultiplier[options.size]/sizingMultiplier[options.parentSize];groupNode.height*=multiplier;groupNode.depth*=multiplier}return groupNode}else{throw new ParseError("Got group of unknown type: '"+group.type+"'")}};var buildTree=function(tree){var options=new Options(Style.TEXT,"size5","");var expression=buildExpression(tree,options);var body=makeSpan(["base",options.style.cls()],expression);var topStrut=makeSpan(["strut"]);var bottomStrut=makeSpan(["strut","bottom"]);topStrut.style.height=body.height+"em";bottomStrut.style.height=body.height+body.depth+"em";bottomStrut.style.verticalAlign=-body.depth+"em";var katexNode=makeSpan(["katex"],[makeSpan(["katex-inner"],[topStrut,bottomStrut,body])]);return katexNode};module.exports=buildTree},{"./Options":168,"./ParseError":169,"./Style":171,"./buildCommon":172,"./delimiter":174,"./domTree":175,"./fontMetrics":176,"./utils":180}],174:[function(require,module,exports){var ParseError=require("./ParseError");var Style=require("./Style");var buildCommon=require("./buildCommon");var fontMetrics=require("./fontMetrics");var symbols=require("./symbols");var utils=require("./utils");var makeSpan=buildCommon.makeSpan;var getMetrics=function(symbol,font){if(symbols.math[symbol]&&symbols.math[symbol].replace){return fontMetrics.getCharacterMetrics(symbols.math[symbol].replace,font)}else{return fontMetrics.getCharacterMetrics(symbol,font)}};var mathrmSize=function(value,size,mode){return buildCommon.makeSymbol(value,"Size"+size+"-Regular",mode)};var styleWrap=function(delim,toStyle,options){var span=makeSpan(["style-wrap",options.style.reset(),toStyle.cls()],[delim]);var multiplier=toStyle.sizeMultiplier/options.style.sizeMultiplier;span.height*=multiplier;span.depth*=multiplier;span.maxFontSize=toStyle.sizeMultiplier;return span};var makeSmallDelim=function(delim,style,center,options,mode){var text=buildCommon.makeSymbol(delim,"Main-Regular",mode);var span=styleWrap(text,style,options);if(center){var shift=(1-options.style.sizeMultiplier/style.sizeMultiplier)*fontMetrics.metrics.axisHeight;span.style.top=shift+"em";span.height-=shift;span.depth+=shift}return span};var makeLargeDelim=function(delim,size,center,options,mode){var inner=mathrmSize(delim,size,mode);var span=styleWrap(makeSpan(["delimsizing","size"+size],[inner],options.getColor()),Style.TEXT,options);if(center){var shift=(1-options.style.sizeMultiplier)*fontMetrics.metrics.axisHeight;span.style.top=shift+"em";span.height-=shift;span.depth+=shift}return span};var makeInner=function(symbol,font,mode){var sizeClass;if(font==="Size1-Regular"){sizeClass="delim-size1"}else if(font==="Size4-Regular"){sizeClass="delim-size4"}var inner=makeSpan(["delimsizinginner",sizeClass],[makeSpan([],[buildCommon.makeSymbol(symbol,font,mode)])]);return{type:"elem",elem:inner}};var makeStackedDelim=function(delim,heightTotal,center,options,mode){var top,middle,repeat,bottom;top=repeat=bottom=delim;middle=null;var font="Size1-Regular";if(delim==="\\uparrow"){repeat=bottom=""}else if(delim==="\\Uparrow"){repeat=bottom=""}else if(delim==="\\downarrow"){top=repeat=""}else if(delim==="\\Downarrow"){top=repeat=""}else if(delim==="\\updownarrow"){top="\\uparrow";repeat="";bottom="\\downarrow"}else if(delim==="\\Updownarrow"){top="\\Uparrow";repeat="";bottom="\\Downarrow"}else if(delim==="["||delim==="\\lbrack"){top="";repeat="";bottom="";font="Size4-Regular"}else if(delim==="]"||delim==="\\rbrack"){top="";repeat="";bottom="";font="Size4-Regular"}else if(delim==="\\lfloor"){repeat=top="";bottom="";font="Size4-Regular"}else if(delim==="\\lceil"){top="";repeat=bottom="";font="Size4-Regular"}else if(delim==="\\rfloor"){repeat=top="";bottom="";font="Size4-Regular"}else if(delim==="\\rceil"){top="";repeat=bottom="";font="Size4-Regular"}else if(delim==="("){top="";repeat="";bottom="";font="Size4-Regular"}else if(delim===")"){top="";repeat="";bottom="";font="Size4-Regular"}else if(delim==="\\{"||delim==="\\lbrace"){top="";middle="";bottom="";repeat="";font="Size4-Regular"}else if(delim==="\\}"||delim==="\\rbrace"){top="";middle="";bottom="";repeat="";font="Size4-Regular"}else if(delim==="\\surd"){top="";bottom="";repeat="";font="Size4-Regular"}var topMetrics=getMetrics(top,font);var topHeightTotal=topMetrics.height+topMetrics.depth;var repeatMetrics=getMetrics(repeat,font);var repeatHeightTotal=repeatMetrics.height+repeatMetrics.depth;var bottomMetrics=getMetrics(bottom,font);var bottomHeightTotal=bottomMetrics.height+bottomMetrics.depth;var middleMetrics,middleHeightTotal;if(middle!==null){middleMetrics=getMetrics(middle,font);middleHeightTotal=middleMetrics.height+middleMetrics.depth}var realHeightTotal=topHeightTotal+bottomHeightTotal;if(middle!==null){realHeightTotal+=middleHeightTotal}while(realHeightTotal<heightTotal){realHeightTotal+=repeatHeightTotal;if(middle!==null){realHeightTotal+=repeatHeightTotal}}var axisHeight=fontMetrics.metrics.axisHeight;if(center){axisHeight*=options.style.sizeMultiplier}var depth=realHeightTotal/2-axisHeight;var inners=[];inners.push(makeInner(bottom,font,mode));var i;if(middle===null){var repeatHeight=realHeightTotal-topHeightTotal-bottomHeightTotal;var symbolCount=Math.ceil(repeatHeight/repeatHeightTotal);for(i=0;i<symbolCount;i++){inners.push(makeInner(repeat,font,mode))}}else{var topRepeatHeight=realHeightTotal/2-topHeightTotal-middleHeightTotal/2;var topSymbolCount=Math.ceil(topRepeatHeight/repeatHeightTotal);var bottomRepeatHeight=realHeightTotal/2-topHeightTotal-middleHeightTotal/2;var bottomSymbolCount=Math.ceil(bottomRepeatHeight/repeatHeightTotal);for(i=0;i<topSymbolCount;i++){inners.push(makeInner(repeat,font,mode))}inners.push(makeInner(middle,font,mode));for(i=0;i<bottomSymbolCount;i++){inners.push(makeInner(repeat,font,mode))}}inners.push(makeInner(top,font,mode));var inner=buildCommon.makeVList(inners,"bottom",depth,options);return styleWrap(makeSpan(["delimsizing","mult"],[inner],options.getColor()),Style.TEXT,options)};var stackLargeDelimiters=["(",")","[","\\lbrack","]","\\rbrack","\\{","\\lbrace","\\}","\\rbrace","\\lfloor","\\rfloor","\\lceil","\\rceil","\\surd"];var stackAlwaysDelimiters=["\\uparrow","\\downarrow","\\updownarrow","\\Uparrow","\\Downarrow","\\Updownarrow","|","\\|","\\vert","\\Vert"];var stackNeverDelimiters=["<",">","\\langle","\\rangle","/","\\backslash"];var sizeToMaxHeight=[0,1.2,1.8,2.4,3];var makeSizedDelim=function(delim,size,options,mode){if(delim==="<"){delim="\\langle"}else if(delim===">"){delim="\\rangle"}if(utils.contains(stackLargeDelimiters,delim)||utils.contains(stackNeverDelimiters,delim)){return makeLargeDelim(delim,size,false,options,mode)}else if(utils.contains(stackAlwaysDelimiters,delim)){return makeStackedDelim(delim,sizeToMaxHeight[size],false,options,mode)}else{throw new ParseError("Illegal delimiter: '"+delim+"'")}};var stackNeverDelimiterSequence=[{type:"small",style:Style.SCRIPTSCRIPT},{type:"small",style:Style.SCRIPT},{type:"small",style:Style.TEXT},{type:"large",size:1},{type:"large",size:2},{type:"large",size:3},{type:"large",size:4}];var stackAlwaysDelimiterSequence=[{type:"small",style:Style.SCRIPTSCRIPT},{type:"small",style:Style.SCRIPT},{type:"small",style:Style.TEXT},{type:"stack"}];var stackLargeDelimiterSequence=[{type:"small",style:Style.SCRIPTSCRIPT},{type:"small",style:Style.SCRIPT},{type:"small",style:Style.TEXT},{type:"large",size:1},{type:"large",size:2},{type:"large",size:3},{type:"large",size:4},{type:"stack"}];var delimTypeToFont=function(type){if(type.type==="small"){return"Main-Regular"}else if(type.type==="large"){return"Size"+type.size+"-Regular"}else if(type.type==="stack"){return"Size4-Regular"}};var traverseSequence=function(delim,height,sequence,options){var start=Math.min(2,3-options.style.size);for(var i=start;i<sequence.length;i++){if(sequence[i].type==="stack"){break}var metrics=getMetrics(delim,delimTypeToFont(sequence[i]));var heightDepth=metrics.height+metrics.depth;if(sequence[i].type==="small"){heightDepth*=sequence[i].style.sizeMultiplier}if(heightDepth>height){return sequence[i]}}return sequence[sequence.length-1]};var makeCustomSizedDelim=function(delim,height,center,options,mode){if(delim==="<"){delim="\\langle"}else if(delim===">"){delim="\\rangle"}var sequence;if(utils.contains(stackNeverDelimiters,delim)){sequence=stackNeverDelimiterSequence}else if(utils.contains(stackLargeDelimiters,delim)){sequence=stackLargeDelimiterSequence}else{sequence=stackAlwaysDelimiterSequence}var delimType=traverseSequence(delim,height,sequence,options);if(delimType.type==="small"){return makeSmallDelim(delim,delimType.style,center,options,mode)}else if(delimType.type==="large"){return makeLargeDelim(delim,delimType.size,center,options,mode)}else if(delimType.type==="stack"){return makeStackedDelim(delim,height,center,options,mode)}};var makeLeftRightDelim=function(delim,height,depth,options,mode){var axisHeight=fontMetrics.metrics.axisHeight*options.style.sizeMultiplier;var delimiterFactor=901;var delimiterExtend=5/fontMetrics.metrics.ptPerEm;var maxDistFromAxis=Math.max(height-axisHeight,depth+axisHeight);var totalHeight=Math.max(maxDistFromAxis/500*delimiterFactor,2*maxDistFromAxis-delimiterExtend);return makeCustomSizedDelim(delim,totalHeight,true,options,mode)};module.exports={sizedDelim:makeSizedDelim,customSizedDelim:makeCustomSizedDelim,leftRightDelim:makeLeftRightDelim}},{"./ParseError":169,"./Style":171,"./buildCommon":172,"./fontMetrics":176,"./symbols":179,"./utils":180}],175:[function(require,module,exports){var utils=require("./utils");var createClass=function(classes){classes=classes.slice();for(var i=classes.length-1;i>=0;i--){if(!classes[i]){classes.splice(i,1)}}return classes.join(" ")};function span(classes,children,height,depth,maxFontSize,style){this.classes=classes||[];this.children=children||[];this.height=height||0;this.depth=depth||0;this.maxFontSize=maxFontSize||0;this.style=style||{}}span.prototype.toNode=function(){var span=document.createElement("span");span.className=createClass(this.classes);for(var style in this.style){if(this.style.hasOwnProperty(style)){span.style[style]=this.style[style]}}for(var i=0;i<this.children.length;i++){span.appendChild(this.children[i].toNode())}return span};span.prototype.toMarkup=function(){var markup="<span";if(this.classes.length){markup+=' class="';markup+=utils.escape(createClass(this.classes));markup+='"'}var styles="";for(var style in this.style){if(this.style.hasOwnProperty(style)){styles+=utils.hyphenate(style)+":"+this.style[style]+";"}}if(styles){markup+=' style="'+utils.escape(styles)+'"'}markup+=">";for(var i=0;i<this.children.length;i++){markup+=this.children[i].toMarkup()
}markup+="</span>";return markup};function documentFragment(children,height,depth,maxFontSize){this.children=children||[];this.height=height||0;this.depth=depth||0;this.maxFontSize=maxFontSize||0}documentFragment.prototype.toNode=function(){var frag=document.createDocumentFragment();for(var i=0;i<this.children.length;i++){frag.appendChild(this.children[i].toNode())}return frag};documentFragment.prototype.toMarkup=function(){var markup="";for(var i=0;i<this.children.length;i++){markup+=this.children[i].toMarkup()}return markup};function symbolNode(value,height,depth,italic,skew,classes,style){this.value=value||"";this.height=height||0;this.depth=depth||0;this.italic=italic||0;this.skew=skew||0;this.classes=classes||[];this.style=style||{};this.maxFontSize=0}symbolNode.prototype.toNode=function(){var node=document.createTextNode(this.value);var span=null;if(this.italic>0){span=document.createElement("span");span.style.marginRight=this.italic+"em"}if(this.classes.length>0){span=span||document.createElement("span");span.className=createClass(this.classes)}for(var style in this.style){if(this.style.hasOwnProperty(style)){span=span||document.createElement("span");span.style[style]=this.style[style]}}if(span){span.appendChild(node);return span}else{return node}};symbolNode.prototype.toMarkup=function(){var needsSpan=false;var markup="<span";if(this.classes.length){needsSpan=true;markup+=' class="';markup+=utils.escape(createClass(this.classes));markup+='"'}var styles="";if(this.italic>0){styles+="margin-right:"+this.italic+"em;"}for(var style in this.style){if(this.style.hasOwnProperty(style)){styles+=utils.hyphenate(style)+":"+this.style[style]+";"}}if(styles){needsSpan=true;markup+=' style="'+utils.escape(styles)+'"'}var escaped=utils.escape(this.value);if(needsSpan){markup+=">";markup+=escaped;markup+="</span>";return markup}else{return escaped}};module.exports={span:span,documentFragment:documentFragment,symbolNode:symbolNode}},{"./utils":180}],176:[function(require,module,exports){var Style=require("./Style");var sigma1=.025;var sigma2=0;var sigma3=0;var sigma4=0;var sigma5=.431;var sigma6=1;var sigma7=0;var sigma8=.677;var sigma9=.394;var sigma10=.444;var sigma11=.686;var sigma12=.345;var sigma13=.413;var sigma14=.363;var sigma15=.289;var sigma16=.15;var sigma17=.247;var sigma18=.386;var sigma19=.05;var sigma20=2.39;var sigma21=1.01;var sigma21Script=.81;var sigma21ScriptScript=.71;var sigma22=.25;var xi1=0;var xi2=0;var xi3=0;var xi4=0;var xi5=.431;var xi6=1;var xi7=0;var xi8=.04;var xi9=.111;var xi10=.166;var xi11=.2;var xi12=.6;var xi13=.1;var ptPerEm=10;var metrics={xHeight:sigma5,quad:sigma6,num1:sigma8,num2:sigma9,num3:sigma10,denom1:sigma11,denom2:sigma12,sup1:sigma13,sup2:sigma14,sup3:sigma15,sub1:sigma16,sub2:sigma17,supDrop:sigma18,subDrop:sigma19,axisHeight:sigma22,defaultRuleThickness:xi8,bigOpSpacing1:xi9,bigOpSpacing2:xi10,bigOpSpacing3:xi11,bigOpSpacing4:xi12,bigOpSpacing5:xi13,ptPerEm:ptPerEm,delim1:sigma20,getDelim2:function(style){if(style.size===Style.TEXT.size){return sigma21}else if(style.size===Style.SCRIPT.size){return sigma21Script}else if(style.size===Style.SCRIPTSCRIPT.size){return sigma21ScriptScript}throw new Error("Unexpected style size: "+style.size)}};var metricMap={"AMS-Regular":{10003:{depth:0,height:.69224,italic:0,skew:0},10016:{depth:0,height:.69224,italic:0,skew:0},1008:{depth:0,height:.43056,italic:.04028,skew:0},107:{depth:0,height:.68889,italic:0,skew:0},10731:{depth:.11111,height:.69224,italic:0,skew:0},10846:{depth:.19444,height:.75583,italic:0,skew:0},10877:{depth:.13667,height:.63667,italic:0,skew:0},10878:{depth:.13667,height:.63667,italic:0,skew:0},10885:{depth:.25583,height:.75583,italic:0,skew:0},10886:{depth:.25583,height:.75583,italic:0,skew:0},10887:{depth:.13597,height:.63597,italic:0,skew:0},10888:{depth:.13597,height:.63597,italic:0,skew:0},10889:{depth:.26167,height:.75726,italic:0,skew:0},10890:{depth:.26167,height:.75726,italic:0,skew:0},10891:{depth:.48256,height:.98256,italic:0,skew:0},10892:{depth:.48256,height:.98256,italic:0,skew:0},10901:{depth:.13667,height:.63667,italic:0,skew:0},10902:{depth:.13667,height:.63667,italic:0,skew:0},10933:{depth:.25142,height:.75726,italic:0,skew:0},10934:{depth:.25142,height:.75726,italic:0,skew:0},10935:{depth:.26167,height:.75726,italic:0,skew:0},10936:{depth:.26167,height:.75726,italic:0,skew:0},10937:{depth:.26167,height:.75726,italic:0,skew:0},10938:{depth:.26167,height:.75726,italic:0,skew:0},10949:{depth:.25583,height:.75583,italic:0,skew:0},10950:{depth:.25583,height:.75583,italic:0,skew:0},10955:{depth:.28481,height:.79383,italic:0,skew:0},10956:{depth:.28481,height:.79383,italic:0,skew:0},165:{depth:0,height:.675,italic:.025,skew:0},174:{depth:.15559,height:.69224,italic:0,skew:0},240:{depth:0,height:.68889,italic:0,skew:0},295:{depth:0,height:.68889,italic:0,skew:0},57350:{depth:.08167,height:.58167,italic:0,skew:0},57351:{depth:.08167,height:.58167,italic:0,skew:0},57352:{depth:.08167,height:.58167,italic:0,skew:0},57353:{depth:0,height:.43056,italic:.04028,skew:0},57356:{depth:.25142,height:.75726,italic:0,skew:0},57357:{depth:.25142,height:.75726,italic:0,skew:0},57358:{depth:.41951,height:.91951,italic:0,skew:0},57359:{depth:.30274,height:.79383,italic:0,skew:0},57360:{depth:.30274,height:.79383,italic:0,skew:0},57361:{depth:.41951,height:.91951,italic:0,skew:0},57366:{depth:.25142,height:.75726,italic:0,skew:0},57367:{depth:.25142,height:.75726,italic:0,skew:0},57368:{depth:.25142,height:.75726,italic:0,skew:0},57369:{depth:.25142,height:.75726,italic:0,skew:0},57370:{depth:.13597,height:.63597,italic:0,skew:0},57371:{depth:.13597,height:.63597,italic:0,skew:0},65:{depth:0,height:.68889,italic:0,skew:0},66:{depth:0,height:.68889,italic:0,skew:0},67:{depth:0,height:.68889,italic:0,skew:0},68:{depth:0,height:.68889,italic:0,skew:0},69:{depth:0,height:.68889,italic:0,skew:0},70:{depth:0,height:.68889,italic:0,skew:0},71:{depth:0,height:.68889,italic:0,skew:0},710:{depth:0,height:.825,italic:0,skew:0},72:{depth:0,height:.68889,italic:0,skew:0},73:{depth:0,height:.68889,italic:0,skew:0},732:{depth:0,height:.9,italic:0,skew:0},74:{depth:.16667,height:.68889,italic:0,skew:0},75:{depth:0,height:.68889,italic:0,skew:0},76:{depth:0,height:.68889,italic:0,skew:0},77:{depth:0,height:.68889,italic:0,skew:0},770:{depth:0,height:.825,italic:0,skew:0},771:{depth:0,height:.9,italic:0,skew:0},78:{depth:0,height:.68889,italic:0,skew:0},79:{depth:.16667,height:.68889,italic:0,skew:0},80:{depth:0,height:.68889,italic:0,skew:0},81:{depth:.16667,height:.68889,italic:0,skew:0},82:{depth:0,height:.68889,italic:0,skew:0},8245:{depth:0,height:.54986,italic:0,skew:0},83:{depth:0,height:.68889,italic:0,skew:0},84:{depth:0,height:.68889,italic:0,skew:0},8463:{depth:0,height:.68889,italic:0,skew:0},8487:{depth:0,height:.68889,italic:0,skew:0},8498:{depth:0,height:.68889,italic:0,skew:0},85:{depth:0,height:.68889,italic:0,skew:0},8502:{depth:0,height:.68889,italic:0,skew:0},8503:{depth:0,height:.68889,italic:0,skew:0},8504:{depth:0,height:.68889,italic:0,skew:0},8513:{depth:0,height:.68889,italic:0,skew:0},8592:{depth:-.03598,height:.46402,italic:0,skew:0},8594:{depth:-.03598,height:.46402,italic:0,skew:0},86:{depth:0,height:.68889,italic:0,skew:0},8602:{depth:-.13313,height:.36687,italic:0,skew:0},8603:{depth:-.13313,height:.36687,italic:0,skew:0},8606:{depth:.01354,height:.52239,italic:0,skew:0},8608:{depth:.01354,height:.52239,italic:0,skew:0},8610:{depth:.01354,height:.52239,italic:0,skew:0},8611:{depth:.01354,height:.52239,italic:0,skew:0},8619:{depth:0,height:.54986,italic:0,skew:0},8620:{depth:0,height:.54986,italic:0,skew:0},8621:{depth:-.13313,height:.37788,italic:0,skew:0},8622:{depth:-.13313,height:.36687,italic:0,skew:0},8624:{depth:0,height:.69224,italic:0,skew:0},8625:{depth:0,height:.69224,italic:0,skew:0},8630:{depth:0,height:.43056,italic:0,skew:0},8631:{depth:0,height:.43056,italic:0,skew:0},8634:{depth:.08198,height:.58198,italic:0,skew:0},8635:{depth:.08198,height:.58198,italic:0,skew:0},8638:{depth:.19444,height:.69224,italic:0,skew:0},8639:{depth:.19444,height:.69224,italic:0,skew:0},8642:{depth:.19444,height:.69224,italic:0,skew:0},8643:{depth:.19444,height:.69224,italic:0,skew:0},8644:{depth:.1808,height:.675,italic:0,skew:0},8646:{depth:.1808,height:.675,italic:0,skew:0},8647:{depth:.1808,height:.675,italic:0,skew:0},8648:{depth:.19444,height:.69224,italic:0,skew:0},8649:{depth:.1808,height:.675,italic:0,skew:0},8650:{depth:.19444,height:.69224,italic:0,skew:0},8651:{depth:.01354,height:.52239,italic:0,skew:0},8652:{depth:.01354,height:.52239,italic:0,skew:0},8653:{depth:-.13313,height:.36687,italic:0,skew:0},8654:{depth:-.13313,height:.36687,italic:0,skew:0},8655:{depth:-.13313,height:.36687,italic:0,skew:0},8666:{depth:.13667,height:.63667,italic:0,skew:0},8667:{depth:.13667,height:.63667,italic:0,skew:0},8669:{depth:-.13313,height:.37788,italic:0,skew:0},87:{depth:0,height:.68889,italic:0,skew:0},8705:{depth:0,height:.825,italic:0,skew:0},8708:{depth:0,height:.68889,italic:0,skew:0},8709:{depth:.08167,height:.58167,italic:0,skew:0},8717:{depth:0,height:.43056,italic:0,skew:0},8722:{depth:-.03598,height:.46402,italic:0,skew:0},8724:{depth:.08198,height:.69224,italic:0,skew:0},8726:{depth:.08167,height:.58167,italic:0,skew:0},8733:{depth:0,height:.69224,italic:0,skew:0},8736:{depth:0,height:.69224,italic:0,skew:0},8737:{depth:0,height:.69224,italic:0,skew:0},8738:{depth:.03517,height:.52239,italic:0,skew:0},8739:{depth:.08167,height:.58167,italic:0,skew:0},8740:{depth:.25142,height:.74111,italic:0,skew:0},8741:{depth:.08167,height:.58167,italic:0,skew:0},8742:{depth:.25142,height:.74111,italic:0,skew:0},8756:{depth:0,height:.69224,italic:0,skew:0},8757:{depth:0,height:.69224,italic:0,skew:0},8764:{depth:-.13313,height:.36687,italic:0,skew:0},8765:{depth:-.13313,height:.37788,italic:0,skew:0},8769:{depth:-.13313,height:.36687,italic:0,skew:0},8770:{depth:-.03625,height:.46375,italic:0,skew:0},8774:{depth:.30274,height:.79383,italic:0,skew:0},8776:{depth:-.01688,height:.48312,italic:0,skew:0},8778:{depth:.08167,height:.58167,italic:0,skew:0},8782:{depth:.06062,height:.54986,italic:0,skew:0},8783:{depth:.06062,height:.54986,italic:0,skew:0},8785:{depth:.08198,height:.58198,italic:0,skew:0},8786:{depth:.08198,height:.58198,italic:0,skew:0},8787:{depth:.08198,height:.58198,italic:0,skew:0},8790:{depth:0,height:.69224,italic:0,skew:0},8791:{depth:.22958,height:.72958,italic:0,skew:0},8796:{depth:.08198,height:.91667,italic:0,skew:0},88:{depth:0,height:.68889,italic:0,skew:0},8806:{depth:.25583,height:.75583,italic:0,skew:0},8807:{depth:.25583,height:.75583,italic:0,skew:0},8808:{depth:.25142,height:.75726,italic:0,skew:0},8809:{depth:.25142,height:.75726,italic:0,skew:0},8812:{depth:.25583,height:.75583,italic:0,skew:0},8814:{depth:.20576,height:.70576,italic:0,skew:0},8815:{depth:.20576,height:.70576,italic:0,skew:0},8816:{depth:.30274,height:.79383,italic:0,skew:0},8817:{depth:.30274,height:.79383,italic:0,skew:0},8818:{depth:.22958,height:.72958,italic:0,skew:0},8819:{depth:.22958,height:.72958,italic:0,skew:0},8822:{depth:.1808,height:.675,italic:0,skew:0},8823:{depth:.1808,height:.675,italic:0,skew:0},8828:{depth:.13667,height:.63667,italic:0,skew:0},8829:{depth:.13667,height:.63667,italic:0,skew:0},8830:{depth:.22958,height:.72958,italic:0,skew:0},8831:{depth:.22958,height:.72958,italic:0,skew:0},8832:{depth:.20576,height:.70576,italic:0,skew:0},8833:{depth:.20576,height:.70576,italic:0,skew:0},8840:{depth:.30274,height:.79383,italic:0,skew:0},8841:{depth:.30274,height:.79383,italic:0,skew:0},8842:{depth:.13597,height:.63597,italic:0,skew:0},8843:{depth:.13597,height:.63597,italic:0,skew:0},8847:{depth:.03517,height:.54986,italic:0,skew:0},8848:{depth:.03517,height:.54986,italic:0,skew:0},8858:{depth:.08198,height:.58198,italic:0,skew:0},8859:{depth:.08198,height:.58198,italic:0,skew:0},8861:{depth:.08198,height:.58198,italic:0,skew:0},8862:{depth:0,height:.675,italic:0,skew:0},8863:{depth:0,height:.675,italic:0,skew:0},8864:{depth:0,height:.675,italic:0,skew:0},8865:{depth:0,height:.675,italic:0,skew:0},8872:{depth:0,height:.69224,italic:0,skew:0},8873:{depth:0,height:.69224,italic:0,skew:0},8874:{depth:0,height:.69224,italic:0,skew:0},8876:{depth:0,height:.68889,italic:0,skew:0},8877:{depth:0,height:.68889,italic:0,skew:0},8878:{depth:0,height:.68889,italic:0,skew:0},8879:{depth:0,height:.68889,italic:0,skew:0},8882:{depth:.03517,height:.54986,italic:0,skew:0},8883:{depth:.03517,height:.54986,italic:0,skew:0},8884:{depth:.13667,height:.63667,italic:0,skew:0},8885:{depth:.13667,height:.63667,italic:0,skew:0},8888:{depth:0,height:.54986,italic:0,skew:0},8890:{depth:.19444,height:.43056,italic:0,skew:0},8891:{depth:.19444,height:.69224,italic:0,skew:0},8892:{depth:.19444,height:.69224,italic:0,skew:0},89:{depth:0,height:.68889,italic:0,skew:0},8901:{depth:0,height:.54986,italic:0,skew:0},8903:{depth:.08167,height:.58167,italic:0,skew:0},8905:{depth:.08167,height:.58167,italic:0,skew:0},8906:{depth:.08167,height:.58167,italic:0,skew:0},8907:{depth:0,height:.69224,italic:0,skew:0},8908:{depth:0,height:.69224,italic:0,skew:0},8909:{depth:-.03598,height:.46402,italic:0,skew:0},8910:{depth:0,height:.54986,italic:0,skew:0},8911:{depth:0,height:.54986,italic:0,skew:0},8912:{depth:.03517,height:.54986,italic:0,skew:0},8913:{depth:.03517,height:.54986,italic:0,skew:0},8914:{depth:0,height:.54986,italic:0,skew:0},8915:{depth:0,height:.54986,italic:0,skew:0},8916:{depth:0,height:.69224,italic:0,skew:0},8918:{depth:.0391,height:.5391,italic:0,skew:0},8919:{depth:.0391,height:.5391,italic:0,skew:0},8920:{depth:.03517,height:.54986,italic:0,skew:0},8921:{depth:.03517,height:.54986,italic:0,skew:0},8922:{depth:.38569,height:.88569,italic:0,skew:0},8923:{depth:.38569,height:.88569,italic:0,skew:0},8926:{depth:.13667,height:.63667,italic:0,skew:0},8927:{depth:.13667,height:.63667,italic:0,skew:0},8928:{depth:.30274,height:.79383,italic:0,skew:0},8929:{depth:.30274,height:.79383,italic:0,skew:0},8934:{depth:.23222,height:.74111,italic:0,skew:0},8935:{depth:.23222,height:.74111,italic:0,skew:0},8936:{depth:.23222,height:.74111,italic:0,skew:0},8937:{depth:.23222,height:.74111,italic:0,skew:0},8938:{depth:.20576,height:.70576,italic:0,skew:0},8939:{depth:.20576,height:.70576,italic:0,skew:0},8940:{depth:.30274,height:.79383,italic:0,skew:0},8941:{depth:.30274,height:.79383,italic:0,skew:0},8994:{depth:.19444,height:.69224,italic:0,skew:0},8995:{depth:.19444,height:.69224,italic:0,skew:0},90:{depth:0,height:.68889,italic:0,skew:0},9416:{depth:.15559,height:.69224,italic:0,skew:0},9484:{depth:0,height:.69224,italic:0,skew:0},9488:{depth:0,height:.69224,italic:0,skew:0},9492:{depth:0,height:.37788,italic:0,skew:0},9496:{depth:0,height:.37788,italic:0,skew:0},9585:{depth:.19444,height:.68889,italic:0,skew:0},9586:{depth:.19444,height:.74111,italic:0,skew:0},9632:{depth:0,height:.675,italic:0,skew:0},9633:{depth:0,height:.675,italic:0,skew:0},9650:{depth:0,height:.54986,italic:0,skew:0},9651:{depth:0,height:.54986,italic:0,skew:0},9654:{depth:.03517,height:.54986,italic:0,skew:0},9660:{depth:0,height:.54986,italic:0,skew:0},9661:{depth:0,height:.54986,italic:0,skew:0},9664:{depth:.03517,height:.54986,italic:0,skew:0},9674:{depth:.11111,height:.69224,italic:0,skew:0},9733:{depth:.19444,height:.69224,italic:0,skew:0},989:{depth:.08167,height:.58167,italic:0,skew:0}},"Main-Bold":{100:{depth:0,height:.69444,italic:0,skew:0},101:{depth:0,height:.44444,italic:0,skew:0},102:{depth:0,height:.69444,italic:.10903,skew:0},10216:{depth:.25,height:.75,italic:0,skew:0},10217:{depth:.25,height:.75,italic:0,skew:0},103:{depth:.19444,height:.44444,italic:.01597,skew:0},104:{depth:0,height:.69444,italic:0,skew:0},105:{depth:0,height:.69444,italic:0,skew:0},106:{depth:.19444,height:.69444,italic:0,skew:0},107:{depth:0,height:.69444,italic:0,skew:0},108:{depth:0,height:.69444,italic:0,skew:0},10815:{depth:0,height:.68611,italic:0,skew:0},109:{depth:0,height:.44444,italic:0,skew:0},10927:{depth:.19667,height:.69667,italic:0,skew:0},10928:{depth:.19667,height:.69667,italic:0,skew:0},110:{depth:0,height:.44444,italic:0,skew:0},111:{depth:0,height:.44444,italic:0,skew:0},112:{depth:.19444,height:.44444,italic:0,skew:0},113:{depth:.19444,height:.44444,italic:0,skew:0},114:{depth:0,height:.44444,italic:0,skew:0},115:{depth:0,height:.44444,italic:0,skew:0},116:{depth:0,height:.63492,italic:0,skew:0},117:{depth:0,height:.44444,italic:0,skew:0},118:{depth:0,height:.44444,italic:.01597,skew:0},119:{depth:0,height:.44444,italic:.01597,skew:0},120:{depth:0,height:.44444,italic:0,skew:0},121:{depth:.19444,height:.44444,italic:.01597,skew:0},122:{depth:0,height:.44444,italic:0,skew:0},123:{depth:.25,height:.75,italic:0,skew:0},124:{depth:.25,height:.75,italic:0,skew:0},125:{depth:.25,height:.75,italic:0,skew:0},126:{depth:.35,height:.34444,italic:0,skew:0},168:{depth:0,height:.69444,italic:0,skew:0},172:{depth:0,height:.44444,italic:0,skew:0},175:{depth:0,height:.59611,italic:0,skew:0},176:{depth:0,height:.69444,italic:0,skew:0},177:{depth:.13333,height:.63333,italic:0,skew:0},180:{depth:0,height:.69444,italic:0,skew:0},215:{depth:.13333,height:.63333,italic:0,skew:0},247:{depth:.13333,height:.63333,italic:0,skew:0},305:{depth:0,height:.44444,italic:0,skew:0},33:{depth:0,height:.69444,italic:0,skew:0},34:{depth:0,height:.69444,italic:0,skew:0},35:{depth:.19444,height:.69444,italic:0,skew:0},36:{depth:.05556,height:.75,italic:0,skew:0},37:{depth:.05556,height:.75,italic:0,skew:0},38:{depth:0,height:.69444,italic:0,skew:0},39:{depth:0,height:.69444,italic:0,skew:0},40:{depth:.25,height:.75,italic:0,skew:0},41:{depth:.25,height:.75,italic:0,skew:0},42:{depth:0,height:.75,italic:0,skew:0},43:{depth:.13333,height:.63333,italic:0,skew:0},44:{depth:.19444,height:.15556,italic:0,skew:0},45:{depth:0,height:.44444,italic:0,skew:0},46:{depth:0,height:.15556,italic:0,skew:0},47:{depth:.25,height:.75,italic:0,skew:0},48:{depth:0,height:.64444,italic:0,skew:0},49:{depth:0,height:.64444,italic:0,skew:0},50:{depth:0,height:.64444,italic:0,skew:0},51:{depth:0,height:.64444,italic:0,skew:0},52:{depth:0,height:.64444,italic:0,skew:0},53:{depth:0,height:.64444,italic:0,skew:0},54:{depth:0,height:.64444,italic:0,skew:0},55:{depth:0,height:.64444,italic:0,skew:0},56:{depth:0,height:.64444,italic:0,skew:0},567:{depth:.19444,height:.44444,italic:0,skew:0},57:{depth:0,height:.64444,italic:0,skew:0},58:{depth:0,height:.44444,italic:0,skew:0},59:{depth:.19444,height:.44444,italic:0,skew:0},60:{depth:.08556,height:.58556,italic:0,skew:0},61:{depth:-.10889,height:.39111,italic:0,skew:0},62:{depth:.08556,height:.58556,italic:0,skew:0},63:{depth:0,height:.69444,italic:0,skew:0},64:{depth:0,height:.69444,italic:0,skew:0},65:{depth:0,height:.68611,italic:0,skew:0},66:{depth:0,height:.68611,italic:0,skew:0},67:{depth:0,height:.68611,italic:0,skew:0},68:{depth:0,height:.68611,italic:0,skew:0},69:{depth:0,height:.68611,italic:0,skew:0},70:{depth:0,height:.68611,italic:0,skew:0},71:{depth:0,height:.68611,italic:0,skew:0},710:{depth:0,height:.69444,italic:0,skew:0},711:{depth:0,height:.63194,italic:0,skew:0},713:{depth:0,height:.59611,italic:0,skew:0},714:{depth:0,height:.69444,italic:0,skew:0},715:{depth:0,height:.69444,italic:0,skew:0},72:{depth:0,height:.68611,italic:0,skew:0},728:{depth:0,height:.69444,italic:0,skew:0},729:{depth:0,height:.69444,italic:0,skew:0},73:{depth:0,height:.68611,italic:0,skew:0},730:{depth:0,height:.69444,italic:0,skew:0},732:{depth:0,height:.69444,italic:0,skew:0},74:{depth:0,height:.68611,italic:0,skew:0},75:{depth:0,height:.68611,italic:0,skew:0},76:{depth:0,height:.68611,italic:0,skew:0},768:{depth:0,height:.69444,italic:0,skew:0},769:{depth:0,height:.69444,italic:0,skew:0},77:{depth:0,height:.68611,italic:0,skew:0},770:{depth:0,height:.69444,italic:0,skew:0},771:{depth:0,height:.69444,italic:0,skew:0},772:{depth:0,height:.59611,italic:0,skew:0},774:{depth:0,height:.69444,italic:0,skew:0},775:{depth:0,height:.69444,italic:0,skew:0},776:{depth:0,height:.69444,italic:0,skew:0},778:{depth:0,height:.69444,italic:0,skew:0},779:{depth:0,height:.69444,italic:0,skew:0},78:{depth:0,height:.68611,italic:0,skew:0},780:{depth:0,height:.63194,italic:0,skew:0},79:{depth:0,height:.68611,italic:0,skew:0},80:{depth:0,height:.68611,italic:0,skew:0},81:{depth:.19444,height:.68611,italic:0,skew:0},82:{depth:0,height:.68611,italic:0,skew:0},8211:{depth:0,height:.44444,italic:.03194,skew:0},8212:{depth:0,height:.44444,italic:.03194,skew:0},8216:{depth:0,height:.69444,italic:0,skew:0},8217:{depth:0,height:.69444,italic:0,skew:0},8220:{depth:0,height:.69444,italic:0,skew:0},8221:{depth:0,height:.69444,italic:0,skew:0},8224:{depth:.19444,height:.69444,italic:0,skew:0},8225:{depth:.19444,height:.69444,italic:0,skew:0},824:{depth:.19444,height:.69444,italic:0,skew:0},8242:{depth:0,height:.55556,italic:0,skew:0},83:{depth:0,height:.68611,italic:0,skew:0},84:{depth:0,height:.68611,italic:0,skew:0},8407:{depth:0,height:.72444,italic:.15486,skew:0},8463:{depth:0,height:.69444,italic:0,skew:0},8465:{depth:0,height:.69444,italic:0,skew:0},8467:{depth:0,height:.69444,italic:0,skew:0},8472:{depth:.19444,height:.44444,italic:0,skew:0},8476:{depth:0,height:.69444,italic:0,skew:0},85:{depth:0,height:.68611,italic:0,skew:0},8501:{depth:0,height:.69444,italic:0,skew:0},8592:{depth:-.10889,height:.39111,italic:0,skew:0},8593:{depth:.19444,height:.69444,italic:0,skew:0},8594:{depth:-.10889,height:.39111,italic:0,skew:0},8595:{depth:.19444,height:.69444,italic:0,skew:0},8596:{depth:-.10889,height:.39111,italic:0,skew:0},8597:{depth:.25,height:.75,italic:0,skew:0},8598:{depth:.19444,height:.69444,italic:0,skew:0},8599:{depth:.19444,height:.69444,italic:0,skew:0},86:{depth:0,height:.68611,italic:.01597,skew:0},8600:{depth:.19444,height:.69444,italic:0,skew:0},8601:{depth:.19444,height:.69444,italic:0,skew:0},8636:{depth:-.10889,height:.39111,italic:0,skew:0},8637:{depth:-.10889,height:.39111,italic:0,skew:0},8640:{depth:-.10889,height:.39111,italic:0,skew:0},8641:{depth:-.10889,height:.39111,italic:0,skew:0},8656:{depth:-.10889,height:.39111,italic:0,skew:0},8657:{depth:.19444,height:.69444,italic:0,skew:0},8658:{depth:-.10889,height:.39111,italic:0,skew:0},8659:{depth:.19444,height:.69444,italic:0,skew:0},8660:{depth:-.10889,height:.39111,italic:0,skew:0},8661:{depth:.25,height:.75,italic:0,skew:0},87:{depth:0,height:.68611,italic:.01597,skew:0},8704:{depth:0,height:.69444,italic:0,skew:0},8706:{depth:0,height:.69444,italic:.06389,skew:0},8707:{depth:0,height:.69444,italic:0,skew:0},8709:{depth:.05556,height:.75,italic:0,skew:0},8711:{depth:0,height:.68611,italic:0,skew:0},8712:{depth:.08556,height:.58556,italic:0,skew:0},8715:{depth:.08556,height:.58556,italic:0,skew:0},8722:{depth:.13333,height:.63333,italic:0,skew:0},8723:{depth:.13333,height:.63333,italic:0,skew:0},8725:{depth:.25,height:.75,italic:0,skew:0},8726:{depth:.25,height:.75,italic:0,skew:0},8727:{depth:-.02778,height:.47222,italic:0,skew:0},8728:{depth:-.02639,height:.47361,italic:0,skew:0},8729:{depth:-.02639,height:.47361,italic:0,skew:0},8730:{depth:.18,height:.82,italic:0,skew:0},8733:{depth:0,height:.44444,italic:0,skew:0},8734:{depth:0,height:.44444,italic:0,skew:0},8736:{depth:0,height:.69224,italic:0,skew:0},8739:{depth:.25,height:.75,italic:0,skew:0},8741:{depth:.25,height:.75,italic:0,skew:0},8743:{depth:0,height:.55556,italic:0,skew:0},8744:{depth:0,height:.55556,italic:0,skew:0},8745:{depth:0,height:.55556,italic:0,skew:0},8746:{depth:0,height:.55556,italic:0,skew:0},8747:{depth:.19444,height:.69444,italic:.12778,skew:0},8764:{depth:-.10889,height:.39111,italic:0,skew:0},8768:{depth:.19444,height:.69444,italic:0,skew:0},8771:{depth:.00222,height:.50222,italic:0,skew:0},8776:{depth:.02444,height:.52444,italic:0,skew:0},8781:{depth:.00222,height:.50222,italic:0,skew:0},88:{depth:0,height:.68611,italic:0,skew:0},8801:{depth:.00222,height:.50222,italic:0,skew:0},8804:{depth:.19667,height:.69667,italic:0,skew:0},8805:{depth:.19667,height:.69667,italic:0,skew:0},8810:{depth:.08556,height:.58556,italic:0,skew:0},8811:{depth:.08556,height:.58556,italic:0,skew:0},8826:{depth:.08556,height:.58556,italic:0,skew:0},8827:{depth:.08556,height:.58556,italic:0,skew:0},8834:{depth:.08556,height:.58556,italic:0,skew:0},8835:{depth:.08556,height:.58556,italic:0,skew:0},8838:{depth:.19667,height:.69667,italic:0,skew:0},8839:{depth:.19667,height:.69667,italic:0,skew:0},8846:{depth:0,height:.55556,italic:0,skew:0},8849:{depth:.19667,height:.69667,italic:0,skew:0},8850:{depth:.19667,height:.69667,italic:0,skew:0},8851:{depth:0,height:.55556,italic:0,skew:0},8852:{depth:0,height:.55556,italic:0,skew:0},8853:{depth:.13333,height:.63333,italic:0,skew:0},8854:{depth:.13333,height:.63333,italic:0,skew:0},8855:{depth:.13333,height:.63333,italic:0,skew:0},8856:{depth:.13333,height:.63333,italic:0,skew:0},8857:{depth:.13333,height:.63333,italic:0,skew:0},8866:{depth:0,height:.69444,italic:0,skew:0},8867:{depth:0,height:.69444,italic:0,skew:0},8868:{depth:0,height:.69444,italic:0,skew:0},8869:{depth:0,height:.69444,italic:0,skew:0},89:{depth:0,height:.68611,italic:.02875,skew:0},8900:{depth:-.02639,height:.47361,italic:0,skew:0},8901:{depth:-.02639,height:.47361,italic:0,skew:0},8902:{depth:-.02778,height:.47222,italic:0,skew:0},8968:{depth:.25,height:.75,italic:0,skew:0},8969:{depth:.25,height:.75,italic:0,skew:0},8970:{depth:.25,height:.75,italic:0,skew:0},8971:{depth:.25,height:.75,italic:0,skew:0},8994:{depth:-.13889,height:.36111,italic:0,skew:0},8995:{depth:-.13889,height:.36111,italic:0,skew:0},90:{depth:0,height:.68611,italic:0,skew:0},91:{depth:.25,height:.75,italic:0,skew:0},915:{depth:0,height:.68611,italic:0,skew:0},916:{depth:0,height:.68611,italic:0,skew:0},92:{depth:.25,height:.75,italic:0,skew:0},920:{depth:0,height:.68611,italic:0,skew:0},923:{depth:0,height:.68611,italic:0,skew:0},926:{depth:0,height:.68611,italic:0,skew:0},928:{depth:0,height:.68611,italic:0,skew:0},93:{depth:.25,height:.75,italic:0,skew:0},931:{depth:0,height:.68611,italic:0,skew:0},933:{depth:0,height:.68611,italic:0,skew:0},934:{depth:0,height:.68611,italic:0,skew:0},936:{depth:0,height:.68611,italic:0,skew:0},937:{depth:0,height:.68611,italic:0,skew:0},94:{depth:0,height:.69444,italic:0,skew:0},95:{depth:.31,height:.13444,italic:.03194,skew:0},96:{depth:0,height:.69444,italic:0,skew:0},9651:{depth:.19444,height:.69444,italic:0,skew:0},9657:{depth:-.02778,height:.47222,italic:0,skew:0},9661:{depth:.19444,height:.69444,italic:0,skew:0},9667:{depth:-.02778,height:.47222,italic:0,skew:0},97:{depth:0,height:.44444,italic:0,skew:0},9711:{depth:.19444,height:.69444,italic:0,skew:0},98:{depth:0,height:.69444,italic:0,skew:0},9824:{depth:.12963,height:.69444,italic:0,skew:0},9825:{depth:.12963,height:.69444,italic:0,skew:0},9826:{depth:.12963,height:.69444,italic:0,skew:0},9827:{depth:.12963,height:.69444,italic:0,skew:0},9837:{depth:0,height:.75,italic:0,skew:0},9838:{depth:.19444,height:.69444,italic:0,skew:0},9839:{depth:.19444,height:.69444,italic:0,skew:0},99:{depth:0,height:.44444,italic:0,skew:0}},"Main-Italic":{100:{depth:0,height:.69444,italic:.10333,skew:0},101:{depth:0,height:.43056,italic:.07514,skew:0},102:{depth:.19444,height:.69444,italic:.21194,skew:0},103:{depth:.19444,height:.43056,italic:.08847,skew:0},104:{depth:0,height:.69444,italic:.07671,skew:0},105:{depth:0,height:.65536,italic:.1019,skew:0},106:{depth:.19444,height:.65536,italic:.14467,skew:0},107:{depth:0,height:.69444,italic:.10764,skew:0},108:{depth:0,height:.69444,italic:.10333,skew:0},109:{depth:0,height:.43056,italic:.07671,skew:0},110:{depth:0,height:.43056,italic:.07671,skew:0},111:{depth:0,height:.43056,italic:.06312,skew:0},112:{depth:.19444,height:.43056,italic:.06312,skew:0},113:{depth:.19444,height:.43056,italic:.08847,skew:0},114:{depth:0,height:.43056,italic:.10764,skew:0},115:{depth:0,height:.43056,italic:.08208,skew:0},116:{depth:0,height:.61508,italic:.09486,skew:0},117:{depth:0,height:.43056,italic:.07671,skew:0},118:{depth:0,height:.43056,italic:.10764,skew:0},119:{depth:0,height:.43056,italic:.10764,skew:0},120:{depth:0,height:.43056,italic:.12042,skew:0},121:{depth:.19444,height:.43056,italic:.08847,skew:0},122:{depth:0,height:.43056,italic:.12292,skew:0},126:{depth:.35,height:.31786,italic:.11585,skew:0},163:{depth:0,height:.69444,italic:0,skew:0},305:{depth:0,height:.43056,italic:.07671,skew:0},33:{depth:0,height:.69444,italic:.12417,skew:0},34:{depth:0,height:.69444,italic:.06961,skew:0},35:{depth:.19444,height:.69444,italic:.06616,skew:0},37:{depth:.05556,height:.75,italic:.13639,skew:0},38:{depth:0,height:.69444,italic:.09694,skew:0},39:{depth:0,height:.69444,italic:.12417,skew:0},40:{depth:.25,height:.75,italic:.16194,skew:0},41:{depth:.25,height:.75,italic:.03694,skew:0},42:{depth:0,height:.75,italic:.14917,skew:0},43:{depth:.05667,height:.56167,italic:.03694,skew:0},44:{depth:.19444,height:.10556,italic:0,skew:0},45:{depth:0,height:.43056,italic:.02826,skew:0},46:{depth:0,height:.10556,italic:0,skew:0},47:{depth:.25,height:.75,italic:.16194,skew:0},48:{depth:0,height:.64444,italic:.13556,skew:0},49:{depth:0,height:.64444,italic:.13556,skew:0},50:{depth:0,height:.64444,italic:.13556,skew:0},51:{depth:0,height:.64444,italic:.13556,skew:0},52:{depth:.19444,height:.64444,italic:.13556,skew:0},53:{depth:0,height:.64444,italic:.13556,skew:0},54:{depth:0,height:.64444,italic:.13556,skew:0},55:{depth:.19444,height:.64444,italic:.13556,skew:0},56:{depth:0,height:.64444,italic:.13556,skew:0},567:{depth:.19444,height:.43056,italic:.03736,skew:0},57:{depth:0,height:.64444,italic:.13556,skew:0},58:{depth:0,height:.43056,italic:.0582,skew:0},59:{depth:.19444,height:.43056,italic:.0582,skew:0},61:{depth:-.13313,height:.36687,italic:.06616,skew:0},63:{depth:0,height:.69444,italic:.1225,skew:0},64:{depth:0,height:.69444,italic:.09597,skew:0},65:{depth:0,height:.68333,italic:0,skew:0},66:{depth:0,height:.68333,italic:.10257,skew:0},67:{depth:0,height:.68333,italic:.14528,skew:0},68:{depth:0,height:.68333,italic:.09403,skew:0},69:{depth:0,height:.68333,italic:.12028,skew:0},70:{depth:0,height:.68333,italic:.13305,skew:0},71:{depth:0,height:.68333,italic:.08722,skew:0},72:{depth:0,height:.68333,italic:.16389,skew:0},73:{depth:0,height:.68333,italic:.15806,skew:0},74:{depth:0,height:.68333,italic:.14028,skew:0},75:{depth:0,height:.68333,italic:.14528,skew:0},76:{depth:0,height:.68333,italic:0,skew:0},768:{depth:0,height:.69444,italic:0,skew:0},769:{depth:0,height:.69444,italic:.09694,skew:0},77:{depth:0,height:.68333,italic:.16389,skew:0},770:{depth:0,height:.69444,italic:.06646,skew:0},771:{depth:0,height:.66786,italic:.11585,skew:0},772:{depth:0,height:.56167,italic:.10333,skew:0},774:{depth:0,height:.69444,italic:.10806,skew:0},775:{depth:0,height:.66786,italic:.11752,skew:0},776:{depth:0,height:.66786,italic:.10474,skew:0},778:{depth:0,height:.69444,italic:0,skew:0},779:{depth:0,height:.69444,italic:.1225,skew:0},78:{depth:0,height:.68333,italic:.16389,skew:0},780:{depth:0,height:.62847,italic:.08295,skew:0},79:{depth:0,height:.68333,italic:.09403,skew:0},80:{depth:0,height:.68333,italic:.10257,skew:0},81:{depth:.19444,height:.68333,italic:.09403,skew:0},82:{depth:0,height:.68333,italic:.03868,skew:0},8211:{depth:0,height:.43056,italic:.09208,skew:0},8212:{depth:0,height:.43056,italic:.09208,skew:0},8216:{depth:0,height:.69444,italic:.12417,skew:0},8217:{depth:0,height:.69444,italic:.12417,skew:0},8220:{depth:0,height:.69444,italic:.1685,skew:0},8221:{depth:0,height:.69444,italic:.06961,skew:0},83:{depth:0,height:.68333,italic:.11972,skew:0},84:{depth:0,height:.68333,italic:.13305,skew:0},8463:{depth:0,height:.68889,italic:0,skew:0},85:{depth:0,height:.68333,italic:.16389,skew:0},86:{depth:0,height:.68333,italic:.18361,skew:0},87:{depth:0,height:.68333,italic:.18361,skew:0},88:{depth:0,height:.68333,italic:.15806,skew:0},89:{depth:0,height:.68333,italic:.19383,skew:0},90:{depth:0,height:.68333,italic:.14528,skew:0},91:{depth:.25,height:.75,italic:.1875,skew:0},915:{depth:0,height:.68333,italic:.13305,skew:0},916:{depth:0,height:.68333,italic:0,skew:0},920:{depth:0,height:.68333,italic:.09403,skew:0},923:{depth:0,height:.68333,italic:0,skew:0},926:{depth:0,height:.68333,italic:.15294,skew:0},928:{depth:0,height:.68333,italic:.16389,skew:0},93:{depth:.25,height:.75,italic:.10528,skew:0},931:{depth:0,height:.68333,italic:.12028,skew:0},933:{depth:0,height:.68333,italic:.11111,skew:0},934:{depth:0,height:.68333,italic:.05986,skew:0},936:{depth:0,height:.68333,italic:.11111,skew:0},937:{depth:0,height:.68333,italic:.10257,skew:0},94:{depth:0,height:.69444,italic:.06646,skew:0},95:{depth:.31,height:.12056,italic:.09208,skew:0},97:{depth:0,height:.43056,italic:.07671,skew:0},98:{depth:0,height:.69444,italic:.06312,skew:0},99:{depth:0,height:.43056,italic:.05653,skew:0}},"Main-Regular":{32:{depth:-0,height:0,italic:0,skew:0},160:{depth:-0,height:0,italic:0,skew:0},8230:{depth:-0,height:.12,italic:0,skew:0},8773:{depth:-.022,height:.589,italic:0,skew:0},8800:{depth:.215,height:.716,italic:0,skew:0},8942:{depth:.03,height:.9,italic:0,skew:0},8943:{depth:-.19,height:.31,italic:0,skew:0},8945:{depth:-.1,height:.82,italic:0,skew:0},100:{depth:0,height:.69444,italic:0,skew:0},101:{depth:0,height:.43056,italic:0,skew:0},102:{depth:0,height:.69444,italic:.07778,skew:0},10216:{depth:.25,height:.75,italic:0,skew:0},10217:{depth:.25,height:.75,italic:0,skew:0},103:{depth:.19444,height:.43056,italic:.01389,skew:0},104:{depth:0,height:.69444,italic:0,skew:0},105:{depth:0,height:.66786,italic:0,skew:0},106:{depth:.19444,height:.66786,italic:0,skew:0},107:{depth:0,height:.69444,italic:0,skew:0},108:{depth:0,height:.69444,italic:0,skew:0},10815:{depth:0,height:.68333,italic:0,skew:0},109:{depth:0,height:.43056,italic:0,skew:0},10927:{depth:.13597,height:.63597,italic:0,skew:0},10928:{depth:.13597,height:.63597,italic:0,skew:0},110:{depth:0,height:.43056,italic:0,skew:0},111:{depth:0,height:.43056,italic:0,skew:0},112:{depth:.19444,height:.43056,italic:0,skew:0},113:{depth:.19444,height:.43056,italic:0,skew:0},114:{depth:0,height:.43056,italic:0,skew:0},115:{depth:0,height:.43056,italic:0,skew:0},116:{depth:0,height:.61508,italic:0,skew:0},117:{depth:0,height:.43056,italic:0,skew:0},118:{depth:0,height:.43056,italic:.01389,skew:0},119:{depth:0,height:.43056,italic:.01389,skew:0},120:{depth:0,height:.43056,italic:0,skew:0},121:{depth:.19444,height:.43056,italic:.01389,skew:0},122:{depth:0,height:.43056,italic:0,skew:0},123:{depth:.25,height:.75,italic:0,skew:0},124:{depth:.25,height:.75,italic:0,skew:0},125:{depth:.25,height:.75,italic:0,skew:0},126:{depth:.35,height:.31786,italic:0,skew:0},168:{depth:0,height:.66786,italic:0,skew:0},172:{depth:0,height:.43056,italic:0,skew:0},175:{depth:0,height:.56778,italic:0,skew:0},176:{depth:0,height:.69444,italic:0,skew:0},177:{depth:.08333,height:.58333,italic:0,skew:0},180:{depth:0,height:.69444,italic:0,skew:0},215:{depth:.08333,height:.58333,italic:0,skew:0},247:{depth:.08333,height:.58333,italic:0,skew:0},305:{depth:0,height:.43056,italic:0,skew:0},33:{depth:0,height:.69444,italic:0,skew:0},34:{depth:0,height:.69444,italic:0,skew:0},35:{depth:.19444,height:.69444,italic:0,skew:0},36:{depth:.05556,height:.75,italic:0,skew:0},37:{depth:.05556,height:.75,italic:0,skew:0},38:{depth:0,height:.69444,italic:0,skew:0},39:{depth:0,height:.69444,italic:0,skew:0},40:{depth:.25,height:.75,italic:0,skew:0},41:{depth:.25,height:.75,italic:0,skew:0},42:{depth:0,height:.75,italic:0,skew:0},43:{depth:.08333,height:.58333,italic:0,skew:0},44:{depth:.19444,height:.10556,italic:0,skew:0},45:{depth:0,height:.43056,italic:0,skew:0},46:{depth:0,height:.10556,italic:0,skew:0},47:{depth:.25,height:.75,italic:0,skew:0},48:{depth:0,height:.64444,italic:0,skew:0},49:{depth:0,height:.64444,italic:0,skew:0},50:{depth:0,height:.64444,italic:0,skew:0},51:{depth:0,height:.64444,italic:0,skew:0},52:{depth:0,height:.64444,italic:0,skew:0},53:{depth:0,height:.64444,italic:0,skew:0},54:{depth:0,height:.64444,italic:0,skew:0},55:{depth:0,height:.64444,italic:0,skew:0},56:{depth:0,height:.64444,italic:0,skew:0},567:{depth:.19444,height:.43056,italic:0,skew:0},57:{depth:0,height:.64444,italic:0,skew:0},58:{depth:0,height:.43056,italic:0,skew:0},59:{depth:.19444,height:.43056,italic:0,skew:0},60:{depth:.0391,height:.5391,italic:0,skew:0},61:{depth:-.13313,height:.36687,italic:0,skew:0},62:{depth:.0391,height:.5391,italic:0,skew:0},63:{depth:0,height:.69444,italic:0,skew:0},64:{depth:0,height:.69444,italic:0,skew:0},65:{depth:0,height:.68333,italic:0,skew:0},66:{depth:0,height:.68333,italic:0,skew:0},67:{depth:0,height:.68333,italic:0,skew:0},68:{depth:0,height:.68333,italic:0,skew:0},69:{depth:0,height:.68333,italic:0,skew:0},70:{depth:0,height:.68333,italic:0,skew:0},71:{depth:0,height:.68333,italic:0,skew:0},710:{depth:0,height:.69444,italic:0,skew:0},711:{depth:0,height:.62847,italic:0,skew:0},713:{depth:0,height:.56778,italic:0,skew:0},714:{depth:0,height:.69444,italic:0,skew:0},715:{depth:0,height:.69444,italic:0,skew:0},72:{depth:0,height:.68333,italic:0,skew:0},728:{depth:0,height:.69444,italic:0,skew:0},729:{depth:0,height:.66786,italic:0,skew:0},73:{depth:0,height:.68333,italic:0,skew:0},730:{depth:0,height:.69444,italic:0,skew:0},732:{depth:0,height:.66786,italic:0,skew:0},74:{depth:0,height:.68333,italic:0,skew:0},75:{depth:0,height:.68333,italic:0,skew:0},76:{depth:0,height:.68333,italic:0,skew:0},768:{depth:0,height:.69444,italic:0,skew:0},769:{depth:0,height:.69444,italic:0,skew:0},77:{depth:0,height:.68333,italic:0,skew:0},770:{depth:0,height:.69444,italic:0,skew:0},771:{depth:0,height:.66786,italic:0,skew:0},772:{depth:0,height:.56778,italic:0,skew:0},774:{depth:0,height:.69444,italic:0,skew:0},775:{depth:0,height:.66786,italic:0,skew:0},776:{depth:0,height:.66786,italic:0,skew:0},778:{depth:0,height:.69444,italic:0,skew:0},779:{depth:0,height:.69444,italic:0,skew:0},78:{depth:0,height:.68333,italic:0,skew:0},780:{depth:0,height:.62847,italic:0,skew:0},79:{depth:0,height:.68333,italic:0,skew:0},80:{depth:0,height:.68333,italic:0,skew:0},81:{depth:.19444,height:.68333,italic:0,skew:0},82:{depth:0,height:.68333,italic:0,skew:0},8211:{depth:0,height:.43056,italic:.02778,skew:0},8212:{depth:0,height:.43056,italic:.02778,skew:0},8216:{depth:0,height:.69444,italic:0,skew:0},8217:{depth:0,height:.69444,italic:0,skew:0},8220:{depth:0,height:.69444,italic:0,skew:0},8221:{depth:0,height:.69444,italic:0,skew:0},8224:{depth:.19444,height:.69444,italic:0,skew:0},8225:{depth:.19444,height:.69444,italic:0,skew:0},824:{depth:.19444,height:.69444,italic:0,skew:0},8242:{depth:0,height:.55556,italic:0,skew:0},83:{depth:0,height:.68333,italic:0,skew:0},84:{depth:0,height:.68333,italic:0,skew:0},8407:{depth:0,height:.71444,italic:.15382,skew:0},8463:{depth:0,height:.68889,italic:0,skew:0},8465:{depth:0,height:.69444,italic:0,skew:0},8467:{depth:0,height:.69444,italic:0,skew:.11111},8472:{depth:.19444,height:.43056,italic:0,skew:.11111},8476:{depth:0,height:.69444,italic:0,skew:0},85:{depth:0,height:.68333,italic:0,skew:0},8501:{depth:0,height:.69444,italic:0,skew:0},8592:{depth:-.13313,height:.36687,italic:0,skew:0},8593:{depth:.19444,height:.69444,italic:0,skew:0},8594:{depth:-.13313,height:.36687,italic:0,skew:0},8595:{depth:.19444,height:.69444,italic:0,skew:0},8596:{depth:-.13313,height:.36687,italic:0,skew:0},8597:{depth:.25,height:.75,italic:0,skew:0},8598:{depth:.19444,height:.69444,italic:0,skew:0},8599:{depth:.19444,height:.69444,italic:0,skew:0},86:{depth:0,height:.68333,italic:.01389,skew:0},8600:{depth:.19444,height:.69444,italic:0,skew:0},8601:{depth:.19444,height:.69444,italic:0,skew:0},8636:{depth:-.13313,height:.36687,italic:0,skew:0},8637:{depth:-.13313,height:.36687,italic:0,skew:0},8640:{depth:-.13313,height:.36687,italic:0,skew:0},8641:{depth:-.13313,height:.36687,italic:0,skew:0},8656:{depth:-.13313,height:.36687,italic:0,skew:0},8657:{depth:.19444,height:.69444,italic:0,skew:0},8658:{depth:-.13313,height:.36687,italic:0,skew:0},8659:{depth:.19444,height:.69444,italic:0,skew:0},8660:{depth:-.13313,height:.36687,italic:0,skew:0},8661:{depth:.25,height:.75,italic:0,skew:0},87:{depth:0,height:.68333,italic:.01389,skew:0},8704:{depth:0,height:.69444,italic:0,skew:0},8706:{depth:0,height:.69444,italic:.05556,skew:.08334},8707:{depth:0,height:.69444,italic:0,skew:0},8709:{depth:.05556,height:.75,italic:0,skew:0},8711:{depth:0,height:.68333,italic:0,skew:0},8712:{depth:.0391,height:.5391,italic:0,skew:0},8715:{depth:.0391,height:.5391,italic:0,skew:0},8722:{depth:.08333,height:.58333,italic:0,skew:0},8723:{depth:.08333,height:.58333,italic:0,skew:0},8725:{depth:.25,height:.75,italic:0,skew:0},8726:{depth:.25,height:.75,italic:0,skew:0},8727:{depth:-.03472,height:.46528,italic:0,skew:0},8728:{depth:-.05555,height:.44445,italic:0,skew:0},8729:{depth:-.05555,height:.44445,italic:0,skew:0},8730:{depth:.2,height:.8,italic:0,skew:0},8733:{depth:0,height:.43056,italic:0,skew:0},8734:{depth:0,height:.43056,italic:0,skew:0},8736:{depth:0,height:.69224,italic:0,skew:0},8739:{depth:.25,height:.75,italic:0,skew:0},8741:{depth:.25,height:.75,italic:0,skew:0},8743:{depth:0,height:.55556,italic:0,skew:0},8744:{depth:0,height:.55556,italic:0,skew:0},8745:{depth:0,height:.55556,italic:0,skew:0},8746:{depth:0,height:.55556,italic:0,skew:0},8747:{depth:.19444,height:.69444,italic:.11111,skew:0},8764:{depth:-.13313,height:.36687,italic:0,skew:0},8768:{depth:.19444,height:.69444,italic:0,skew:0},8771:{depth:-.03625,height:.46375,italic:0,skew:0},8776:{depth:-.01688,height:.48312,italic:0,skew:0},8781:{depth:-.03625,height:.46375,italic:0,skew:0},88:{depth:0,height:.68333,italic:0,skew:0},8801:{depth:-.03625,height:.46375,italic:0,skew:0},8804:{depth:.13597,height:.63597,italic:0,skew:0},8805:{depth:.13597,height:.63597,italic:0,skew:0},8810:{depth:.0391,height:.5391,italic:0,skew:0},8811:{depth:.0391,height:.5391,italic:0,skew:0},8826:{depth:.0391,height:.5391,italic:0,skew:0},8827:{depth:.0391,height:.5391,italic:0,skew:0},8834:{depth:.0391,height:.5391,italic:0,skew:0},8835:{depth:.0391,height:.5391,italic:0,skew:0},8838:{depth:.13597,height:.63597,italic:0,skew:0},8839:{depth:.13597,height:.63597,italic:0,skew:0},8846:{depth:0,height:.55556,italic:0,skew:0},8849:{depth:.13597,height:.63597,italic:0,skew:0},8850:{depth:.13597,height:.63597,italic:0,skew:0},8851:{depth:0,height:.55556,italic:0,skew:0},8852:{depth:0,height:.55556,italic:0,skew:0},8853:{depth:.08333,height:.58333,italic:0,skew:0},8854:{depth:.08333,height:.58333,italic:0,skew:0},8855:{depth:.08333,height:.58333,italic:0,skew:0},8856:{depth:.08333,height:.58333,italic:0,skew:0},8857:{depth:.08333,height:.58333,italic:0,skew:0},8866:{depth:0,height:.69444,italic:0,skew:0},8867:{depth:0,height:.69444,italic:0,skew:0},8868:{depth:0,height:.69444,italic:0,skew:0},8869:{depth:0,height:.69444,italic:0,skew:0},89:{depth:0,height:.68333,italic:.025,skew:0},8900:{depth:-.05555,height:.44445,italic:0,skew:0},8901:{depth:-.05555,height:.44445,italic:0,skew:0},8902:{depth:-.03472,height:.46528,italic:0,skew:0},8968:{depth:.25,height:.75,italic:0,skew:0},8969:{depth:.25,height:.75,italic:0,skew:0},8970:{depth:.25,height:.75,italic:0,skew:0},8971:{depth:.25,height:.75,italic:0,skew:0},8994:{depth:-.14236,height:.35764,italic:0,skew:0},8995:{depth:-.14236,height:.35764,italic:0,skew:0},90:{depth:0,height:.68333,italic:0,skew:0},91:{depth:.25,height:.75,italic:0,skew:0},915:{depth:0,height:.68333,italic:0,skew:0},916:{depth:0,height:.68333,italic:0,skew:0},92:{depth:.25,height:.75,italic:0,skew:0},920:{depth:0,height:.68333,italic:0,skew:0},923:{depth:0,height:.68333,italic:0,skew:0},926:{depth:0,height:.68333,italic:0,skew:0},928:{depth:0,height:.68333,italic:0,skew:0},93:{depth:.25,height:.75,italic:0,skew:0},931:{depth:0,height:.68333,italic:0,skew:0},933:{depth:0,height:.68333,italic:0,skew:0},934:{depth:0,height:.68333,italic:0,skew:0},936:{depth:0,height:.68333,italic:0,skew:0},937:{depth:0,height:.68333,italic:0,skew:0},94:{depth:0,height:.69444,italic:0,skew:0},95:{depth:.31,height:.12056,italic:.02778,skew:0},96:{depth:0,height:.69444,italic:0,skew:0},9651:{depth:.19444,height:.69444,italic:0,skew:0},9657:{depth:-.03472,height:.46528,italic:0,skew:0},9661:{depth:.19444,height:.69444,italic:0,skew:0},9667:{depth:-.03472,height:.46528,italic:0,skew:0},97:{depth:0,height:.43056,italic:0,skew:0},9711:{depth:.19444,height:.69444,italic:0,skew:0},98:{depth:0,height:.69444,italic:0,skew:0},9824:{depth:.12963,height:.69444,italic:0,skew:0},9825:{depth:.12963,height:.69444,italic:0,skew:0},9826:{depth:.12963,height:.69444,italic:0,skew:0},9827:{depth:.12963,height:.69444,italic:0,skew:0},9837:{depth:0,height:.75,italic:0,skew:0},9838:{depth:.19444,height:.69444,italic:0,skew:0},9839:{depth:.19444,height:.69444,italic:0,skew:0},99:{depth:0,height:.43056,italic:0,skew:0}},"Math-BoldItalic":{100:{depth:0,height:.69444,italic:0,skew:0},1009:{depth:.19444,height:.44444,italic:0,skew:0},101:{depth:0,height:.44444,italic:0,skew:0},1013:{depth:0,height:.44444,italic:0,skew:0},102:{depth:.19444,height:.69444,italic:.11042,skew:0},103:{depth:.19444,height:.44444,italic:.03704,skew:0},104:{depth:0,height:.69444,italic:0,skew:0},105:{depth:0,height:.69326,italic:0,skew:0},106:{depth:.19444,height:.69326,italic:.0622,skew:0},107:{depth:0,height:.69444,italic:.01852,skew:0},108:{depth:0,height:.69444,italic:.0088,skew:0},109:{depth:0,height:.44444,italic:0,skew:0},110:{depth:0,height:.44444,italic:0,skew:0},111:{depth:0,height:.44444,italic:0,skew:0},112:{depth:.19444,height:.44444,italic:0,skew:0},113:{depth:.19444,height:.44444,italic:.03704,skew:0},114:{depth:0,height:.44444,italic:.03194,skew:0},115:{depth:0,height:.44444,italic:0,skew:0},116:{depth:0,height:.63492,italic:0,skew:0},117:{depth:0,height:.44444,italic:0,skew:0},118:{depth:0,height:.44444,italic:.03704,skew:0},119:{depth:0,height:.44444,italic:.02778,skew:0},120:{depth:0,height:.44444,italic:0,skew:0},121:{depth:.19444,height:.44444,italic:.03704,skew:0},122:{depth:0,height:.44444,italic:.04213,skew:0},47:{depth:.19444,height:.69444,italic:0,skew:0},65:{depth:0,height:.68611,italic:0,skew:0},66:{depth:0,height:.68611,italic:.04835,skew:0},67:{depth:0,height:.68611,italic:.06979,skew:0},68:{depth:0,height:.68611,italic:.03194,skew:0},69:{depth:0,height:.68611,italic:.05451,skew:0},70:{depth:0,height:.68611,italic:.15972,skew:0},71:{depth:0,height:.68611,italic:0,skew:0},72:{depth:0,height:.68611,italic:.08229,skew:0},73:{depth:0,height:.68611,italic:.07778,skew:0},74:{depth:0,height:.68611,italic:.10069,skew:0},75:{depth:0,height:.68611,italic:.06979,skew:0},76:{depth:0,height:.68611,italic:0,skew:0},77:{depth:0,height:.68611,italic:.11424,skew:0},78:{depth:0,height:.68611,italic:.11424,skew:0},79:{depth:0,height:.68611,italic:.03194,skew:0},80:{depth:0,height:.68611,italic:.15972,skew:0},81:{depth:.19444,height:.68611,italic:0,skew:0},82:{depth:0,height:.68611,italic:.00421,skew:0},83:{depth:0,height:.68611,italic:.05382,skew:0},84:{depth:0,height:.68611,italic:.15972,skew:0},85:{depth:0,height:.68611,italic:.11424,skew:0},86:{depth:0,height:.68611,italic:.25555,skew:0},87:{depth:0,height:.68611,italic:.15972,skew:0},88:{depth:0,height:.68611,italic:.07778,skew:0},89:{depth:0,height:.68611,italic:.25555,skew:0},90:{depth:0,height:.68611,italic:.06979,skew:0},915:{depth:0,height:.68611,italic:.15972,skew:0},916:{depth:0,height:.68611,italic:0,skew:0},920:{depth:0,height:.68611,italic:.03194,skew:0},923:{depth:0,height:.68611,italic:0,skew:0},926:{depth:0,height:.68611,italic:.07458,skew:0},928:{depth:0,height:.68611,italic:.08229,skew:0},931:{depth:0,height:.68611,italic:.05451,skew:0},933:{depth:0,height:.68611,italic:.15972,skew:0},934:{depth:0,height:.68611,italic:0,skew:0},936:{depth:0,height:.68611,italic:.11653,skew:0},937:{depth:0,height:.68611,italic:.04835,skew:0},945:{depth:0,height:.44444,italic:0,skew:0},946:{depth:.19444,height:.69444,italic:.03403,skew:0},947:{depth:.19444,height:.44444,italic:.06389,skew:0},948:{depth:0,height:.69444,italic:.03819,skew:0},949:{depth:0,height:.44444,italic:0,skew:0},950:{depth:.19444,height:.69444,italic:.06215,skew:0},951:{depth:.19444,height:.44444,italic:.03704,skew:0},952:{depth:0,height:.69444,italic:.03194,skew:0},953:{depth:0,height:.44444,italic:0,skew:0},954:{depth:0,height:.44444,italic:0,skew:0},955:{depth:0,height:.69444,italic:0,skew:0},956:{depth:.19444,height:.44444,italic:0,skew:0},957:{depth:0,height:.44444,italic:.06898,skew:0},958:{depth:.19444,height:.69444,italic:.03021,skew:0},959:{depth:0,height:.44444,italic:0,skew:0},960:{depth:0,height:.44444,italic:.03704,skew:0},961:{depth:.19444,height:.44444,italic:0,skew:0},962:{depth:.09722,height:.44444,italic:.07917,skew:0},963:{depth:0,height:.44444,italic:.03704,skew:0},964:{depth:0,height:.44444,italic:.13472,skew:0},965:{depth:0,height:.44444,italic:.03704,skew:0},966:{depth:.19444,height:.44444,italic:0,skew:0},967:{depth:.19444,height:.44444,italic:0,skew:0},968:{depth:.19444,height:.69444,italic:.03704,skew:0},969:{depth:0,height:.44444,italic:.03704,skew:0},97:{depth:0,height:.44444,italic:0,skew:0},977:{depth:0,height:.69444,italic:0,skew:0},98:{depth:0,height:.69444,italic:0,skew:0},981:{depth:.19444,height:.69444,italic:0,skew:0},982:{depth:0,height:.44444,italic:.03194,skew:0},99:{depth:0,height:.44444,italic:0,skew:0}},"Math-Italic":{100:{depth:0,height:.69444,italic:0,skew:.16667},1009:{depth:.19444,height:.43056,italic:0,skew:.08334},101:{depth:0,height:.43056,italic:0,skew:.05556},1013:{depth:0,height:.43056,italic:0,skew:.05556},102:{depth:.19444,height:.69444,italic:.10764,skew:.16667},103:{depth:.19444,height:.43056,italic:.03588,skew:.02778},104:{depth:0,height:.69444,italic:0,skew:0},105:{depth:0,height:.65952,italic:0,skew:0},106:{depth:.19444,height:.65952,italic:.05724,skew:0},107:{depth:0,height:.69444,italic:.03148,skew:0},108:{depth:0,height:.69444,italic:.01968,skew:.08334},109:{depth:0,height:.43056,italic:0,skew:0},110:{depth:0,height:.43056,italic:0,skew:0},111:{depth:0,height:.43056,italic:0,skew:.05556},112:{depth:.19444,height:.43056,italic:0,skew:.08334},113:{depth:.19444,height:.43056,italic:.03588,skew:.08334},114:{depth:0,height:.43056,italic:.02778,skew:.05556},115:{depth:0,height:.43056,italic:0,skew:.05556},116:{depth:0,height:.61508,italic:0,skew:.08334},117:{depth:0,height:.43056,italic:0,skew:.02778},118:{depth:0,height:.43056,italic:.03588,skew:.02778},119:{depth:0,height:.43056,italic:.02691,skew:.08334},120:{depth:0,height:.43056,italic:0,skew:.02778},121:{depth:.19444,height:.43056,italic:.03588,skew:.05556},122:{depth:0,height:.43056,italic:.04398,skew:.05556},47:{depth:.19444,height:.69444,italic:0,skew:0},65:{depth:0,height:.68333,italic:0,skew:.13889},66:{depth:0,height:.68333,italic:.05017,skew:.08334},67:{depth:0,height:.68333,italic:.07153,skew:.08334},68:{depth:0,height:.68333,italic:.02778,skew:.05556},69:{depth:0,height:.68333,italic:.05764,skew:.08334},70:{depth:0,height:.68333,italic:.13889,skew:.08334},71:{depth:0,height:.68333,italic:0,skew:.08334},72:{depth:0,height:.68333,italic:.08125,skew:.05556},73:{depth:0,height:.68333,italic:.07847,skew:.11111},74:{depth:0,height:.68333,italic:.09618,skew:.16667},75:{depth:0,height:.68333,italic:.07153,skew:.05556},76:{depth:0,height:.68333,italic:0,skew:.02778},77:{depth:0,height:.68333,italic:.10903,skew:.08334},78:{depth:0,height:.68333,italic:.10903,skew:.08334},79:{depth:0,height:.68333,italic:.02778,skew:.08334},80:{depth:0,height:.68333,italic:.13889,skew:.08334},81:{depth:.19444,height:.68333,italic:0,skew:.08334},82:{depth:0,height:.68333,italic:.00773,skew:.08334},83:{depth:0,height:.68333,italic:.05764,skew:.08334},84:{depth:0,height:.68333,italic:.13889,skew:.08334},85:{depth:0,height:.68333,italic:.10903,skew:.02778},86:{depth:0,height:.68333,italic:.22222,skew:0},87:{depth:0,height:.68333,italic:.13889,skew:0},88:{depth:0,height:.68333,italic:.07847,skew:.08334},89:{depth:0,height:.68333,italic:.22222,skew:0},90:{depth:0,height:.68333,italic:.07153,skew:.08334},915:{depth:0,height:.68333,italic:.13889,skew:.08334},916:{depth:0,height:.68333,italic:0,skew:.16667},920:{depth:0,height:.68333,italic:.02778,skew:.08334},923:{depth:0,height:.68333,italic:0,skew:.16667},926:{depth:0,height:.68333,italic:.07569,skew:.08334},928:{depth:0,height:.68333,italic:.08125,skew:.05556},931:{depth:0,height:.68333,italic:.05764,skew:.08334},933:{depth:0,height:.68333,italic:.13889,skew:.05556},934:{depth:0,height:.68333,italic:0,skew:.08334},936:{depth:0,height:.68333,italic:.11,skew:.05556},937:{depth:0,height:.68333,italic:.05017,skew:.08334},945:{depth:0,height:.43056,italic:.0037,skew:.02778},946:{depth:.19444,height:.69444,italic:.05278,skew:.08334},947:{depth:.19444,height:.43056,italic:.05556,skew:0},948:{depth:0,height:.69444,italic:.03785,skew:.05556},949:{depth:0,height:.43056,italic:0,skew:.08334},950:{depth:.19444,height:.69444,italic:.07378,skew:.08334},951:{depth:.19444,height:.43056,italic:.03588,skew:.05556},952:{depth:0,height:.69444,italic:.02778,skew:.08334},953:{depth:0,height:.43056,italic:0,skew:.05556},954:{depth:0,height:.43056,italic:0,skew:0},955:{depth:0,height:.69444,italic:0,skew:0},956:{depth:.19444,height:.43056,italic:0,skew:.02778},957:{depth:0,height:.43056,italic:.06366,skew:.02778},958:{depth:.19444,height:.69444,italic:.04601,skew:.11111},959:{depth:0,height:.43056,italic:0,skew:.05556},960:{depth:0,height:.43056,italic:.03588,skew:0},961:{depth:.19444,height:.43056,italic:0,skew:.08334},962:{depth:.09722,height:.43056,italic:.07986,skew:.08334},963:{depth:0,height:.43056,italic:.03588,skew:0},964:{depth:0,height:.43056,italic:.1132,skew:.02778},965:{depth:0,height:.43056,italic:.03588,skew:.02778},966:{depth:.19444,height:.43056,italic:0,skew:.08334},967:{depth:.19444,height:.43056,italic:0,skew:.05556},968:{depth:.19444,height:.69444,italic:.03588,skew:.11111},969:{depth:0,height:.43056,italic:.03588,skew:0},97:{depth:0,height:.43056,italic:0,skew:0},977:{depth:0,height:.69444,italic:0,skew:.08334},98:{depth:0,height:.69444,italic:0,skew:0},981:{depth:.19444,height:.69444,italic:0,skew:.08334},982:{depth:0,height:.43056,italic:.02778,skew:0},99:{depth:0,height:.43056,italic:0,skew:.05556}},"Math-Regular":{100:{depth:0,height:.69444,italic:0,skew:.16667},1009:{depth:.19444,height:.43056,italic:0,skew:.08334},101:{depth:0,height:.43056,italic:0,skew:.05556},1013:{depth:0,height:.43056,italic:0,skew:.05556},102:{depth:.19444,height:.69444,italic:.10764,skew:.16667},103:{depth:.19444,height:.43056,italic:.03588,skew:.02778},104:{depth:0,height:.69444,italic:0,skew:0},105:{depth:0,height:.65952,italic:0,skew:0},106:{depth:.19444,height:.65952,italic:.05724,skew:0},107:{depth:0,height:.69444,italic:.03148,skew:0},108:{depth:0,height:.69444,italic:.01968,skew:.08334},109:{depth:0,height:.43056,italic:0,skew:0},110:{depth:0,height:.43056,italic:0,skew:0},111:{depth:0,height:.43056,italic:0,skew:.05556},112:{depth:.19444,height:.43056,italic:0,skew:.08334},113:{depth:.19444,height:.43056,italic:.03588,skew:.08334},114:{depth:0,height:.43056,italic:.02778,skew:.05556},115:{depth:0,height:.43056,italic:0,skew:.05556},116:{depth:0,height:.61508,italic:0,skew:.08334},117:{depth:0,height:.43056,italic:0,skew:.02778},118:{depth:0,height:.43056,italic:.03588,skew:.02778},119:{depth:0,height:.43056,italic:.02691,skew:.08334},120:{depth:0,height:.43056,italic:0,skew:.02778},121:{depth:.19444,height:.43056,italic:.03588,skew:.05556},122:{depth:0,height:.43056,italic:.04398,skew:.05556},65:{depth:0,height:.68333,italic:0,skew:.13889},66:{depth:0,height:.68333,italic:.05017,skew:.08334},67:{depth:0,height:.68333,italic:.07153,skew:.08334},68:{depth:0,height:.68333,italic:.02778,skew:.05556},69:{depth:0,height:.68333,italic:.05764,skew:.08334},70:{depth:0,height:.68333,italic:.13889,skew:.08334},71:{depth:0,height:.68333,italic:0,skew:.08334},72:{depth:0,height:.68333,italic:.08125,skew:.05556},73:{depth:0,height:.68333,italic:.07847,skew:.11111},74:{depth:0,height:.68333,italic:.09618,skew:.16667},75:{depth:0,height:.68333,italic:.07153,skew:.05556},76:{depth:0,height:.68333,italic:0,skew:.02778},77:{depth:0,height:.68333,italic:.10903,skew:.08334},78:{depth:0,height:.68333,italic:.10903,skew:.08334},79:{depth:0,height:.68333,italic:.02778,skew:.08334},80:{depth:0,height:.68333,italic:.13889,skew:.08334},81:{depth:.19444,height:.68333,italic:0,skew:.08334},82:{depth:0,height:.68333,italic:.00773,skew:.08334},83:{depth:0,height:.68333,italic:.05764,skew:.08334},84:{depth:0,height:.68333,italic:.13889,skew:.08334},85:{depth:0,height:.68333,italic:.10903,skew:.02778},86:{depth:0,height:.68333,italic:.22222,skew:0},87:{depth:0,height:.68333,italic:.13889,skew:0},88:{depth:0,height:.68333,italic:.07847,skew:.08334},89:{depth:0,height:.68333,italic:.22222,skew:0},90:{depth:0,height:.68333,italic:.07153,skew:.08334},915:{depth:0,height:.68333,italic:.13889,skew:.08334},916:{depth:0,height:.68333,italic:0,skew:.16667},920:{depth:0,height:.68333,italic:.02778,skew:.08334},923:{depth:0,height:.68333,italic:0,skew:.16667},926:{depth:0,height:.68333,italic:.07569,skew:.08334},928:{depth:0,height:.68333,italic:.08125,skew:.05556},931:{depth:0,height:.68333,italic:.05764,skew:.08334},933:{depth:0,height:.68333,italic:.13889,skew:.05556},934:{depth:0,height:.68333,italic:0,skew:.08334},936:{depth:0,height:.68333,italic:.11,skew:.05556},937:{depth:0,height:.68333,italic:.05017,skew:.08334},945:{depth:0,height:.43056,italic:.0037,skew:.02778},946:{depth:.19444,height:.69444,italic:.05278,skew:.08334},947:{depth:.19444,height:.43056,italic:.05556,skew:0},948:{depth:0,height:.69444,italic:.03785,skew:.05556},949:{depth:0,height:.43056,italic:0,skew:.08334},950:{depth:.19444,height:.69444,italic:.07378,skew:.08334},951:{depth:.19444,height:.43056,italic:.03588,skew:.05556},952:{depth:0,height:.69444,italic:.02778,skew:.08334},953:{depth:0,height:.43056,italic:0,skew:.05556},954:{depth:0,height:.43056,italic:0,skew:0},955:{depth:0,height:.69444,italic:0,skew:0},956:{depth:.19444,height:.43056,italic:0,skew:.02778},957:{depth:0,height:.43056,italic:.06366,skew:.02778},958:{depth:.19444,height:.69444,italic:.04601,skew:.11111},959:{depth:0,height:.43056,italic:0,skew:.05556},960:{depth:0,height:.43056,italic:.03588,skew:0},961:{depth:.19444,height:.43056,italic:0,skew:.08334},962:{depth:.09722,height:.43056,italic:.07986,skew:.08334},963:{depth:0,height:.43056,italic:.03588,skew:0},964:{depth:0,height:.43056,italic:.1132,skew:.02778},965:{depth:0,height:.43056,italic:.03588,skew:.02778},966:{depth:.19444,height:.43056,italic:0,skew:.08334},967:{depth:.19444,height:.43056,italic:0,skew:.05556},968:{depth:.19444,height:.69444,italic:.03588,skew:.11111},969:{depth:0,height:.43056,italic:.03588,skew:0},97:{depth:0,height:.43056,italic:0,skew:0},977:{depth:0,height:.69444,italic:0,skew:.08334},98:{depth:0,height:.69444,italic:0,skew:0},981:{depth:.19444,height:.69444,italic:0,skew:.08334},982:{depth:0,height:.43056,italic:.02778,skew:0},99:{depth:0,height:.43056,italic:0,skew:.05556}},"Size1-Regular":{8748:{depth:.306,height:.805,italic:.19445,skew:0},8749:{depth:.306,height:.805,italic:.19445,skew:0},10216:{depth:.35001,height:.85,italic:0,skew:0},10217:{depth:.35001,height:.85,italic:0,skew:0},10752:{depth:.25001,height:.75,italic:0,skew:0},10753:{depth:.25001,height:.75,italic:0,skew:0},10754:{depth:.25001,height:.75,italic:0,skew:0},10756:{depth:.25001,height:.75,italic:0,skew:0},10758:{depth:.25001,height:.75,italic:0,skew:0},123:{depth:.35001,height:.85,italic:0,skew:0},125:{depth:.35001,height:.85,italic:0,skew:0},40:{depth:.35001,height:.85,italic:0,skew:0},41:{depth:.35001,height:.85,italic:0,skew:0},47:{depth:.35001,height:.85,italic:0,skew:0},710:{depth:0,height:.72222,italic:0,skew:0},732:{depth:0,height:.72222,italic:0,skew:0},770:{depth:0,height:.72222,italic:0,skew:0},771:{depth:0,height:.72222,italic:0,skew:0},8214:{depth:-99e-5,height:.601,italic:0,skew:0},8593:{depth:1e-5,height:.6,italic:0,skew:0},8595:{depth:1e-5,height:.6,italic:0,skew:0},8657:{depth:1e-5,height:.6,italic:0,skew:0},8659:{depth:1e-5,height:.6,italic:0,skew:0},8719:{depth:.25001,height:.75,italic:0,skew:0},8720:{depth:.25001,height:.75,italic:0,skew:0},8721:{depth:.25001,height:.75,italic:0,skew:0},8730:{depth:.35001,height:.85,italic:0,skew:0},8739:{depth:-.00599,height:.606,italic:0,skew:0},8741:{depth:-.00599,height:.606,italic:0,skew:0},8747:{depth:.30612,height:.805,italic:.19445,skew:0},8750:{depth:.30612,height:.805,italic:.19445,skew:0},8896:{depth:.25001,height:.75,italic:0,skew:0},8897:{depth:.25001,height:.75,italic:0,skew:0},8898:{depth:.25001,height:.75,italic:0,skew:0},8899:{depth:.25001,height:.75,italic:0,skew:0},8968:{depth:.35001,height:.85,italic:0,skew:0},8969:{depth:.35001,height:.85,italic:0,skew:0},8970:{depth:.35001,height:.85,italic:0,skew:0},8971:{depth:.35001,height:.85,italic:0,skew:0},91:{depth:.35001,height:.85,italic:0,skew:0},9168:{depth:-99e-5,height:.601,italic:0,skew:0},92:{depth:.35001,height:.85,italic:0,skew:0},93:{depth:.35001,height:.85,italic:0,skew:0}},"Size2-Regular":{8748:{depth:.862,height:1.36,italic:.44445,skew:0},8749:{depth:.862,height:1.36,italic:.44445,skew:0},10216:{depth:.65002,height:1.15,italic:0,skew:0},10217:{depth:.65002,height:1.15,italic:0,skew:0},10752:{depth:.55001,height:1.05,italic:0,skew:0},10753:{depth:.55001,height:1.05,italic:0,skew:0},10754:{depth:.55001,height:1.05,italic:0,skew:0},10756:{depth:.55001,height:1.05,italic:0,skew:0},10758:{depth:.55001,height:1.05,italic:0,skew:0},123:{depth:.65002,height:1.15,italic:0,skew:0},125:{depth:.65002,height:1.15,italic:0,skew:0},40:{depth:.65002,height:1.15,italic:0,skew:0},41:{depth:.65002,height:1.15,italic:0,skew:0},47:{depth:.65002,height:1.15,italic:0,skew:0},710:{depth:0,height:.75,italic:0,skew:0},732:{depth:0,height:.75,italic:0,skew:0},770:{depth:0,height:.75,italic:0,skew:0},771:{depth:0,height:.75,italic:0,skew:0},8719:{depth:.55001,height:1.05,italic:0,skew:0},8720:{depth:.55001,height:1.05,italic:0,skew:0},8721:{depth:.55001,height:1.05,italic:0,skew:0},8730:{depth:.65002,height:1.15,italic:0,skew:0},8747:{depth:.86225,height:1.36,italic:.44445,skew:0},8750:{depth:.86225,height:1.36,italic:.44445,skew:0},8896:{depth:.55001,height:1.05,italic:0,skew:0},8897:{depth:.55001,height:1.05,italic:0,skew:0},8898:{depth:.55001,height:1.05,italic:0,skew:0},8899:{depth:.55001,height:1.05,italic:0,skew:0},8968:{depth:.65002,height:1.15,italic:0,skew:0},8969:{depth:.65002,height:1.15,italic:0,skew:0},8970:{depth:.65002,height:1.15,italic:0,skew:0},8971:{depth:.65002,height:1.15,italic:0,skew:0},91:{depth:.65002,height:1.15,italic:0,skew:0},92:{depth:.65002,height:1.15,italic:0,skew:0},93:{depth:.65002,height:1.15,italic:0,skew:0}},"Size3-Regular":{10216:{depth:.95003,height:1.45,italic:0,skew:0},10217:{depth:.95003,height:1.45,italic:0,skew:0},123:{depth:.95003,height:1.45,italic:0,skew:0},125:{depth:.95003,height:1.45,italic:0,skew:0},40:{depth:.95003,height:1.45,italic:0,skew:0},41:{depth:.95003,height:1.45,italic:0,skew:0},47:{depth:.95003,height:1.45,italic:0,skew:0},710:{depth:0,height:.75,italic:0,skew:0},732:{depth:0,height:.75,italic:0,skew:0},770:{depth:0,height:.75,italic:0,skew:0},771:{depth:0,height:.75,italic:0,skew:0},8730:{depth:.95003,height:1.45,italic:0,skew:0},8968:{depth:.95003,height:1.45,italic:0,skew:0},8969:{depth:.95003,height:1.45,italic:0,skew:0},8970:{depth:.95003,height:1.45,italic:0,skew:0},8971:{depth:.95003,height:1.45,italic:0,skew:0},91:{depth:.95003,height:1.45,italic:0,skew:0},92:{depth:.95003,height:1.45,italic:0,skew:0},93:{depth:.95003,height:1.45,italic:0,skew:0}},"Size4-Regular":{10216:{depth:1.25003,height:1.75,italic:0,skew:0},10217:{depth:1.25003,height:1.75,italic:0,skew:0},123:{depth:1.25003,height:1.75,italic:0,skew:0},125:{depth:1.25003,height:1.75,italic:0,skew:0},40:{depth:1.25003,height:1.75,italic:0,skew:0},41:{depth:1.25003,height:1.75,italic:0,skew:0},47:{depth:1.25003,height:1.75,italic:0,skew:0},57344:{depth:-.00499,height:.605,italic:0,skew:0},57345:{depth:-.00499,height:.605,italic:0,skew:0},57680:{depth:0,height:.12,italic:0,skew:0},57681:{depth:0,height:.12,italic:0,skew:0},57682:{depth:0,height:.12,italic:0,skew:0},57683:{depth:0,height:.12,italic:0,skew:0},710:{depth:0,height:.825,italic:0,skew:0},732:{depth:0,height:.825,italic:0,skew:0},770:{depth:0,height:.825,italic:0,skew:0},771:{depth:0,height:.825,italic:0,skew:0},8730:{depth:1.25003,height:1.75,italic:0,skew:0},8968:{depth:1.25003,height:1.75,italic:0,skew:0},8969:{depth:1.25003,height:1.75,italic:0,skew:0},8970:{depth:1.25003,height:1.75,italic:0,skew:0},8971:{depth:1.25003,height:1.75,italic:0,skew:0},91:{depth:1.25003,height:1.75,italic:0,skew:0},9115:{depth:.64502,height:1.155,italic:0,skew:0},9116:{depth:1e-5,height:.6,italic:0,skew:0},9117:{depth:.64502,height:1.155,italic:0,skew:0},9118:{depth:.64502,height:1.155,italic:0,skew:0},9119:{depth:1e-5,height:.6,italic:0,skew:0},9120:{depth:.64502,height:1.155,italic:0,skew:0},9121:{depth:.64502,height:1.155,italic:0,skew:0},9122:{depth:-99e-5,height:.601,italic:0,skew:0},9123:{depth:.64502,height:1.155,italic:0,skew:0},9124:{depth:.64502,height:1.155,italic:0,skew:0},9125:{depth:-99e-5,height:.601,italic:0,skew:0},9126:{depth:.64502,height:1.155,italic:0,skew:0},9127:{depth:1e-5,height:.9,italic:0,skew:0},9128:{depth:.65002,height:1.15,italic:0,skew:0},9129:{depth:.90001,height:0,italic:0,skew:0},9130:{depth:0,height:.3,italic:0,skew:0},9131:{depth:1e-5,height:.9,italic:0,skew:0},9132:{depth:.65002,height:1.15,italic:0,skew:0},9133:{depth:.90001,height:0,italic:0,skew:0},9143:{depth:.88502,height:.915,italic:0,skew:0},92:{depth:1.25003,height:1.75,italic:0,skew:0},93:{depth:1.25003,height:1.75,italic:0,skew:0}}};
var getCharacterMetrics=function(character,style){return metricMap[style][character.charCodeAt(0)]};module.exports={metrics:metrics,getCharacterMetrics:getCharacterMetrics}},{"./Style":171}],177:[function(require,module,exports){var utils=require("./utils");var ParseError=require("./ParseError");var functions={"\\sqrt":{numArgs:1,numOptionalArgs:1,handler:function(func,optional,body,positions){if(optional!=null){throw new ParseError("Optional arguments to \\sqrt aren't supported yet",this.lexer,positions[1]-1)}return{type:"sqrt",body:body}}},"\\text":{numArgs:1,argTypes:["text"],greediness:2,handler:function(func,body){var inner;if(body.type==="ordgroup"){inner=body.value}else{inner=[body]}return{type:"text",body:inner}}},"\\color":{numArgs:2,allowedInText:true,argTypes:["color","original"],handler:function(func,color,body){var inner;if(body.type==="ordgroup"){inner=body.value}else{inner=[body]}return{type:"color",color:color.value,value:inner}}},"\\overline":{numArgs:1,handler:function(func,body){return{type:"overline",body:body}}},"\\rule":{numArgs:2,numOptionalArgs:1,argTypes:["size","size","size"],handler:function(func,shift,width,height){return{type:"rule",shift:shift&&shift.value,width:width.value,height:height.value}}},"\\KaTeX":{numArgs:0,handler:function(func){return{type:"katex"}}}};var delimiterSizes={"\\bigl":{type:"open",size:1},"\\Bigl":{type:"open",size:2},"\\biggl":{type:"open",size:3},"\\Biggl":{type:"open",size:4},"\\bigr":{type:"close",size:1},"\\Bigr":{type:"close",size:2},"\\biggr":{type:"close",size:3},"\\Biggr":{type:"close",size:4},"\\bigm":{type:"rel",size:1},"\\Bigm":{type:"rel",size:2},"\\biggm":{type:"rel",size:3},"\\Biggm":{type:"rel",size:4},"\\big":{type:"textord",size:1},"\\Big":{type:"textord",size:2},"\\bigg":{type:"textord",size:3},"\\Bigg":{type:"textord",size:4}};var delimiters=["(",")","[","\\lbrack","]","\\rbrack","\\{","\\lbrace","\\}","\\rbrace","\\lfloor","\\rfloor","\\lceil","\\rceil","<",">","\\langle","\\rangle","/","\\backslash","|","\\vert","\\|","\\Vert","\\uparrow","\\Uparrow","\\downarrow","\\Downarrow","\\updownarrow","\\Updownarrow","."];var duplicatedFunctions=[{funcs:["\\blue","\\orange","\\pink","\\red","\\green","\\gray","\\purple"],data:{numArgs:1,allowedInText:true,handler:function(func,body){var atoms;if(body.type==="ordgroup"){atoms=body.value}else{atoms=[body]}return{type:"color",color:"katex-"+func.slice(1),value:atoms}}}},{funcs:["\\arcsin","\\arccos","\\arctan","\\arg","\\cos","\\cosh","\\cot","\\coth","\\csc","\\deg","\\dim","\\exp","\\hom","\\ker","\\lg","\\ln","\\log","\\sec","\\sin","\\sinh","\\tan","\\tanh"],data:{numArgs:0,handler:function(func){return{type:"op",limits:false,symbol:false,body:func}}}},{funcs:["\\det","\\gcd","\\inf","\\lim","\\liminf","\\limsup","\\max","\\min","\\Pr","\\sup"],data:{numArgs:0,handler:function(func){return{type:"op",limits:true,symbol:false,body:func}}}},{funcs:["\\int","\\iint","\\iiint","\\oint"],data:{numArgs:0,handler:function(func){return{type:"op",limits:false,symbol:true,body:func}}}},{funcs:["\\coprod","\\bigvee","\\bigwedge","\\biguplus","\\bigcap","\\bigcup","\\intop","\\prod","\\sum","\\bigotimes","\\bigoplus","\\bigodot","\\bigsqcup","\\smallint"],data:{numArgs:0,handler:function(func){return{type:"op",limits:true,symbol:true,body:func}}}},{funcs:["\\dfrac","\\frac","\\tfrac","\\dbinom","\\binom","\\tbinom"],data:{numArgs:2,greediness:2,handler:function(func,numer,denom){var hasBarLine;var leftDelim=null;var rightDelim=null;var size="auto";switch(func){case"\\dfrac":case"\\frac":case"\\tfrac":hasBarLine=true;break;case"\\dbinom":case"\\binom":case"\\tbinom":hasBarLine=false;leftDelim="(";rightDelim=")";break;default:throw new Error("Unrecognized genfrac command")}switch(func){case"\\dfrac":case"\\dbinom":size="display";break;case"\\tfrac":case"\\tbinom":size="text";break}return{type:"genfrac",numer:numer,denom:denom,hasBarLine:hasBarLine,leftDelim:leftDelim,rightDelim:rightDelim,size:size}}}},{funcs:["\\llap","\\rlap"],data:{numArgs:1,allowedInText:true,handler:function(func,body){return{type:func.slice(1),body:body}}}},{funcs:["\\bigl","\\Bigl","\\biggl","\\Biggl","\\bigr","\\Bigr","\\biggr","\\Biggr","\\bigm","\\Bigm","\\biggm","\\Biggm","\\big","\\Big","\\bigg","\\Bigg","\\left","\\right"],data:{numArgs:1,handler:function(func,delim,positions){if(!utils.contains(delimiters,delim.value)){throw new ParseError("Invalid delimiter: '"+delim.value+"' after '"+func+"'",this.lexer,positions[1])}if(func==="\\left"||func==="\\right"){return{type:"leftright",value:delim.value}}else{return{type:"delimsizing",size:delimiterSizes[func].size,delimType:delimiterSizes[func].type,value:delim.value}}}}},{funcs:["\\tiny","\\scriptsize","\\footnotesize","\\small","\\normalsize","\\large","\\Large","\\LARGE","\\huge","\\Huge"],data:{numArgs:0}},{funcs:["\\displaystyle","\\textstyle","\\scriptstyle","\\scriptscriptstyle"],data:{numArgs:0}},{funcs:["\\acute","\\grave","\\ddot","\\tilde","\\bar","\\breve","\\check","\\hat","\\vec","\\dot"],data:{numArgs:1,handler:function(func,base){return{type:"accent",accent:func,base:base}}}},{funcs:["\\over","\\choose"],data:{numArgs:0,handler:function(func){var replaceWith;switch(func){case"\\over":replaceWith="\\frac";break;case"\\choose":replaceWith="\\binom";break;default:throw new Error("Unrecognized infix genfrac command")}return{type:"infix",replaceWith:replaceWith}}}}];var addFuncsWithData=function(funcs,data){for(var i=0;i<funcs.length;i++){functions[funcs[i]]=data}};for(var i=0;i<duplicatedFunctions.length;i++){addFuncsWithData(duplicatedFunctions[i].funcs,duplicatedFunctions[i].data)}var getGreediness=function(func){if(functions[func].greediness===undefined){return 1}else{return functions[func].greediness}};for(var f in functions){if(functions.hasOwnProperty(f)){var func=functions[f];functions[f]={numArgs:func.numArgs,argTypes:func.argTypes,greediness:func.greediness===undefined?1:func.greediness,allowedInText:func.allowedInText?func.allowedInText:false,numOptionalArgs:func.numOptionalArgs===undefined?0:func.numOptionalArgs,handler:func.handler}}}module.exports={funcs:functions,getGreediness:getGreediness}},{"./ParseError":169,"./utils":180}],178:[function(require,module,exports){var Parser=require("./Parser");var parseTree=function(toParse){var parser=new Parser(toParse);return parser.parse()};module.exports=parseTree},{"./Parser":170}],179:[function(require,module,exports){var symbols={math:{"`":{font:"main",group:"textord",replace:""},"\\$":{font:"main",group:"textord",replace:"$"},"\\%":{font:"main",group:"textord",replace:"%"},"\\_":{font:"main",group:"textord",replace:"_"},"\\angle":{font:"main",group:"textord",replace:""},"\\infty":{font:"main",group:"textord",replace:""},"\\prime":{font:"main",group:"textord",replace:""},"\\triangle":{font:"main",group:"textord",replace:""},"\\Gamma":{font:"main",group:"textord",replace:""},"\\Delta":{font:"main",group:"textord",replace:""},"\\Theta":{font:"main",group:"textord",replace:""},"\\Lambda":{font:"main",group:"textord",replace:""},"\\Xi":{font:"main",group:"textord",replace:""},"\\Pi":{font:"main",group:"textord",replace:""},"\\Sigma":{font:"main",group:"textord",replace:""},"\\Upsilon":{font:"main",group:"textord",replace:""},"\\Phi":{font:"main",group:"textord",replace:""},"\\Psi":{font:"main",group:"textord",replace:""},"\\Omega":{font:"main",group:"textord",replace:""},"\\neg":{font:"main",group:"textord",replace:""},"\\lnot":{font:"main",group:"textord",replace:""},"\\top":{font:"main",group:"textord",replace:""},"\\bot":{font:"main",group:"textord",replace:""},"\\emptyset":{font:"main",group:"textord",replace:""},"\\varnothing":{font:"ams",group:"textord",replace:""},"\\alpha":{font:"main",group:"mathord",replace:""},"\\beta":{font:"main",group:"mathord",replace:""},"\\gamma":{font:"main",group:"mathord",replace:""},"\\delta":{font:"main",group:"mathord",replace:""},"\\epsilon":{font:"main",group:"mathord",replace:""},"\\zeta":{font:"main",group:"mathord",replace:""},"\\eta":{font:"main",group:"mathord",replace:""},"\\theta":{font:"main",group:"mathord",replace:""},"\\iota":{font:"main",group:"mathord",replace:""},"\\kappa":{font:"main",group:"mathord",replace:""},"\\lambda":{font:"main",group:"mathord",replace:""},"\\mu":{font:"main",group:"mathord",replace:""},"\\nu":{font:"main",group:"mathord",replace:""},"\\xi":{font:"main",group:"mathord",replace:""},"\\omicron":{font:"main",group:"mathord",replace:"o"},"\\pi":{font:"main",group:"mathord",replace:""},"\\rho":{font:"main",group:"mathord",replace:""},"\\sigma":{font:"main",group:"mathord",replace:""},"\\tau":{font:"main",group:"mathord",replace:""},"\\upsilon":{font:"main",group:"mathord",replace:""},"\\phi":{font:"main",group:"mathord",replace:""},"\\chi":{font:"main",group:"mathord",replace:""},"\\psi":{font:"main",group:"mathord",replace:""},"\\omega":{font:"main",group:"mathord",replace:""},"\\varepsilon":{font:"main",group:"mathord",replace:""},"\\vartheta":{font:"main",group:"mathord",replace:""},"\\varpi":{font:"main",group:"mathord",replace:""},"\\varrho":{font:"main",group:"mathord",replace:""},"\\varsigma":{font:"main",group:"mathord",replace:""},"\\varphi":{font:"main",group:"mathord",replace:""},"*":{font:"main",group:"bin",replace:""},"+":{font:"main",group:"bin"},"-":{font:"main",group:"bin",replace:""},"\\cdot":{font:"main",group:"bin",replace:""},"\\circ":{font:"main",group:"bin",replace:""},"\\div":{font:"main",group:"bin",replace:""},"\\pm":{font:"main",group:"bin",replace:""},"\\times":{font:"main",group:"bin",replace:""},"\\cap":{font:"main",group:"bin",replace:""},"\\cup":{font:"main",group:"bin",replace:""},"\\setminus":{font:"main",group:"bin",replace:""},"\\land":{font:"main",group:"bin",replace:""},"\\lor":{font:"main",group:"bin",replace:""},"\\wedge":{font:"main",group:"bin",replace:""},"\\vee":{font:"main",group:"bin",replace:""},"\\surd":{font:"main",group:"textord",replace:""},"(":{font:"main",group:"open"},"[":{font:"main",group:"open"},"\\langle":{font:"main",group:"open",replace:""},"\\lvert":{font:"main",group:"open",replace:""},")":{font:"main",group:"close"},"]":{font:"main",group:"close"},"?":{font:"main",group:"close"},"!":{font:"main",group:"close"},"\\rangle":{font:"main",group:"close",replace:""},"\\rvert":{font:"main",group:"close",replace:""},"=":{font:"main",group:"rel"},"<":{font:"main",group:"rel"},">":{font:"main",group:"rel"},":":{font:"main",group:"rel"},"\\approx":{font:"main",group:"rel",replace:""},"\\cong":{font:"main",group:"rel",replace:""},"\\ge":{font:"main",group:"rel",replace:""},"\\geq":{font:"main",group:"rel",replace:""},"\\gets":{font:"main",group:"rel",replace:""},"\\in":{font:"main",group:"rel",replace:""},"\\notin":{font:"main",group:"rel",replace:""},"\\subset":{font:"main",group:"rel",replace:""},"\\supset":{font:"main",group:"rel",replace:""},"\\subseteq":{font:"main",group:"rel",replace:""},"\\supseteq":{font:"main",group:"rel",replace:""},"\\nsubseteq":{font:"ams",group:"rel",replace:""},"\\nsupseteq":{font:"ams",group:"rel",replace:""},"\\models":{font:"main",group:"rel",replace:""},"\\leftarrow":{font:"main",group:"rel",replace:""},"\\le":{font:"main",group:"rel",replace:""},"\\leq":{font:"main",group:"rel",replace:""},"\\ne":{font:"main",group:"rel",replace:""},"\\neq":{font:"main",group:"rel",replace:""},"\\rightarrow":{font:"main",group:"rel",replace:""},"\\to":{font:"main",group:"rel",replace:""},"\\ngeq":{font:"ams",group:"rel",replace:""},"\\nleq":{font:"ams",group:"rel",replace:""},"\\!":{font:"main",group:"spacing"},"\\ ":{font:"main",group:"spacing",replace:""},"~":{font:"main",group:"spacing",replace:""},"\\,":{font:"main",group:"spacing"},"\\:":{font:"main",group:"spacing"},"\\;":{font:"main",group:"spacing"},"\\enspace":{font:"main",group:"spacing"},"\\qquad":{font:"main",group:"spacing"},"\\quad":{font:"main",group:"spacing"},"\\space":{font:"main",group:"spacing",replace:""},",":{font:"main",group:"punct"},";":{font:"main",group:"punct"},"\\colon":{font:"main",group:"punct",replace:":"},"\\barwedge":{font:"ams",group:"textord",replace:""},"\\veebar":{font:"ams",group:"textord",replace:""},"\\odot":{font:"main",group:"textord",replace:""},"\\oplus":{font:"main",group:"textord",replace:""},"\\otimes":{font:"main",group:"textord",replace:""},"\\partial":{font:"main",group:"textord",replace:""},"\\oslash":{font:"main",group:"textord",replace:""},"\\circledcirc":{font:"ams",group:"textord",replace:""},"\\boxdot":{font:"ams",group:"textord",replace:""},"\\bigtriangleup":{font:"main",group:"textord",replace:""},"\\bigtriangledown":{font:"main",group:"textord",replace:""},"\\dagger":{font:"main",group:"textord",replace:""},"\\diamond":{font:"main",group:"textord",replace:""},"\\star":{font:"main",group:"textord",replace:""},"\\triangleleft":{font:"main",group:"textord",replace:""},"\\triangleright":{font:"main",group:"textord",replace:""},"\\{":{font:"main",group:"open",replace:"{"},"\\}":{font:"main",group:"close",replace:"}"},"\\lbrace":{font:"main",group:"open",replace:"{"},"\\rbrace":{font:"main",group:"close",replace:"}"},"\\lbrack":{font:"main",group:"open",replace:"["},"\\rbrack":{font:"main",group:"close",replace:"]"},"\\lfloor":{font:"main",group:"open",replace:""},"\\rfloor":{font:"main",group:"close",replace:""},"\\lceil":{font:"main",group:"open",replace:""},"\\rceil":{font:"main",group:"close",replace:""},"\\backslash":{font:"main",group:"textord",replace:"\\"},"|":{font:"main",group:"textord",replace:""},"\\vert":{font:"main",group:"textord",replace:""},"\\|":{font:"main",group:"textord",replace:""},"\\Vert":{font:"main",group:"textord",replace:""},"\\uparrow":{font:"main",group:"textord",replace:""},"\\Uparrow":{font:"main",group:"textord",replace:""},"\\downarrow":{font:"main",group:"textord",replace:""},"\\Downarrow":{font:"main",group:"textord",replace:""},"\\updownarrow":{font:"main",group:"textord",replace:""},"\\Updownarrow":{font:"main",group:"textord",replace:""},"\\coprod":{font:"math",group:"op",replace:""},"\\bigvee":{font:"math",group:"op",replace:""},"\\bigwedge":{font:"math",group:"op",replace:""},"\\biguplus":{font:"math",group:"op",replace:""},"\\bigcap":{font:"math",group:"op",replace:""},"\\bigcup":{font:"math",group:"op",replace:""},"\\int":{font:"math",group:"op",replace:""},"\\intop":{font:"math",group:"op",replace:""},"\\iint":{font:"math",group:"op",replace:""},"\\iiint":{font:"math",group:"op",replace:""},"\\prod":{font:"math",group:"op",replace:""},"\\sum":{font:"math",group:"op",replace:""},"\\bigotimes":{font:"math",group:"op",replace:""},"\\bigoplus":{font:"math",group:"op",replace:""},"\\bigodot":{font:"math",group:"op",replace:""},"\\oint":{font:"math",group:"op",replace:""},"\\bigsqcup":{font:"math",group:"op",replace:""},"\\smallint":{font:"math",group:"op",replace:""},"\\ldots":{font:"main",group:"punct",replace:""},"\\cdots":{font:"main",group:"inner",replace:""},"\\ddots":{font:"main",group:"inner",replace:""},"\\vdots":{font:"main",group:"textord",replace:""},"\\acute":{font:"main",group:"accent",replace:""},"\\grave":{font:"main",group:"accent",replace:"`"},"\\ddot":{font:"main",group:"accent",replace:""},"\\tilde":{font:"main",group:"accent",replace:"~"},"\\bar":{font:"main",group:"accent",replace:""},"\\breve":{font:"main",group:"accent",replace:""},"\\check":{font:"main",group:"accent",replace:""},"\\hat":{font:"main",group:"accent",replace:"^"},"\\vec":{font:"main",group:"accent",replace:""},"\\dot":{font:"main",group:"accent",replace:""}},text:{"\\ ":{font:"main",group:"spacing",replace:""}," ":{font:"main",group:"spacing",replace:""},"~":{font:"main",group:"spacing",replace:""}}};var mathTextSymbols='0123456789/@."';for(var i=0;i<mathTextSymbols.length;i++){var ch=mathTextSymbols.charAt(i);symbols.math[ch]={font:"main",group:"textord"}}var textSymbols="0123456789`!@*()-=+[]'\";:?/.,";for(var i=0;i<textSymbols.length;i++){var ch=textSymbols.charAt(i);symbols.text[ch]={font:"main",group:"textord"}}var letters="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";for(var i=0;i<letters.length;i++){var ch=letters.charAt(i);symbols.math[ch]={font:"main",group:"mathord"};symbols.text[ch]={font:"main",group:"textord"}}module.exports=symbols},{}],180:[function(require,module,exports){var nativeIndexOf=Array.prototype.indexOf;var indexOf=function(list,elem){if(list==null){return-1}if(nativeIndexOf&&list.indexOf===nativeIndexOf){return list.indexOf(elem)}var i=0,l=list.length;for(;i<l;i++){if(list[i]===elem){return i}}return-1};var contains=function(list,elem){return indexOf(list,elem)!==-1};var uppercase=/([A-Z])/g;var hyphenate=function(str){return str.replace(uppercase,"-$1").toLowerCase()};var ESCAPE_LOOKUP={"&":"&amp;",">":"&gt;","<":"&lt;",'"':"&quot;","'":"&#x27;"};var ESCAPE_REGEX=/[&><"']/g;function escaper(match){return ESCAPE_LOOKUP[match]}function escape(text){return(""+text).replace(ESCAPE_REGEX,escaper)}var setTextContent;if(typeof document!=="undefined"){var testNode=document.createElement("span");if("textContent"in testNode){setTextContent=function(node,text){node.textContent=text}}else{setTextContent=function(node,text){node.innerText=text}}}function clearNode(node){setTextContent(node,"")}module.exports={contains:contains,escape:escape,hyphenate:hyphenate,indexOf:indexOf,setTextContent:setTextContent,clearNode:clearNode}},{}],181:[function(require,module,exports){var Base62=function(my){my.chars=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"];my.encode=function(i){if(i===0){return"0"}var s="";while(i>0){s=this.chars[i%62]+s;i=Math.floor(i/62)}return s};my.decode=function(a,b,c,d){for(b=c=(a===(/\W|_|^$/.test(a+="")||a))-1;d=a.charCodeAt(c++);)b=b*62+d-[,48,29,87][d>>5];return b};return my}({});module.exports=Base62},{}],182:[function(require,module,exports){(function(root,factory){"use strict";if(typeof define==="function"&&define.amd){define(["exports"],factory)}else if(typeof exports!=="undefined"){factory(exports)}else{factory(root.esprima={})}})(this,function(exports){"use strict";var Token,TokenName,FnExprTokens,Syntax,PropertyKind,Messages,Regex,SyntaxTreeDelegate,XHTMLEntities,ClassPropertyType,source,strict,index,lineNumber,lineStart,length,delegate,lookahead,state,extra;Token={BooleanLiteral:1,EOF:2,Identifier:3,Keyword:4,NullLiteral:5,NumericLiteral:6,Punctuator:7,StringLiteral:8,RegularExpression:9,Template:10,XJSIdentifier:11,XJSText:12};TokenName={};TokenName[Token.BooleanLiteral]="Boolean";TokenName[Token.EOF]="<end>";TokenName[Token.Identifier]="Identifier";TokenName[Token.Keyword]="Keyword";TokenName[Token.NullLiteral]="Null";TokenName[Token.NumericLiteral]="Numeric";TokenName[Token.Punctuator]="Punctuator";TokenName[Token.StringLiteral]="String";TokenName[Token.XJSIdentifier]="XJSIdentifier";TokenName[Token.XJSText]="XJSText";TokenName[Token.RegularExpression]="RegularExpression";FnExprTokens=["(","{","[","in","typeof","instanceof","new","return","case","delete","throw","void","=","+=","-=","*=","/=","%=","<<=",">>=",">>>=","&=","|=","^=",",","+","-","*","/","%","++","--","<<",">>",">>>","&","|","^","!","~","&&","||","?",":","===","==",">=","<=","<",">","!=","!=="];Syntax={AnyTypeAnnotation:"AnyTypeAnnotation",ArrayExpression:"ArrayExpression",ArrayPattern:"ArrayPattern",ArrayTypeAnnotation:"ArrayTypeAnnotation",ArrowFunctionExpression:"ArrowFunctionExpression",AssignmentExpression:"AssignmentExpression",BinaryExpression:"BinaryExpression",BlockStatement:"BlockStatement",BooleanTypeAnnotation:"BooleanTypeAnnotation",BreakStatement:"BreakStatement",CallExpression:"CallExpression",CatchClause:"CatchClause",ClassBody:"ClassBody",ClassDeclaration:"ClassDeclaration",ClassExpression:"ClassExpression",ClassImplements:"ClassImplements",ClassProperty:"ClassProperty",ComprehensionBlock:"ComprehensionBlock",ComprehensionExpression:"ComprehensionExpression",ConditionalExpression:"ConditionalExpression",ContinueStatement:"ContinueStatement",DebuggerStatement:"DebuggerStatement",DeclareClass:"DeclareClass",DeclareFunction:"DeclareFunction",DeclareModule:"DeclareModule",DeclareVariable:"DeclareVariable",DoWhileStatement:"DoWhileStatement",EmptyStatement:"EmptyStatement",ExportDeclaration:"ExportDeclaration",ExportBatchSpecifier:"ExportBatchSpecifier",ExportSpecifier:"ExportSpecifier",ExpressionStatement:"ExpressionStatement",ForInStatement:"ForInStatement",ForOfStatement:"ForOfStatement",ForStatement:"ForStatement",FunctionDeclaration:"FunctionDeclaration",FunctionExpression:"FunctionExpression",FunctionTypeAnnotation:"FunctionTypeAnnotation",FunctionTypeParam:"FunctionTypeParam",GenericTypeAnnotation:"GenericTypeAnnotation",Identifier:"Identifier",IfStatement:"IfStatement",ImportDeclaration:"ImportDeclaration",ImportDefaultSpecifier:"ImportDefaultSpecifier",ImportNamespaceSpecifier:"ImportNamespaceSpecifier",ImportSpecifier:"ImportSpecifier",InterfaceDeclaration:"InterfaceDeclaration",InterfaceExtends:"InterfaceExtends",IntersectionTypeAnnotation:"IntersectionTypeAnnotation",LabeledStatement:"LabeledStatement",Literal:"Literal",LogicalExpression:"LogicalExpression",MemberExpression:"MemberExpression",MethodDefinition:"MethodDefinition",ModuleSpecifier:"ModuleSpecifier",NewExpression:"NewExpression",NullableTypeAnnotation:"NullableTypeAnnotation",NumberTypeAnnotation:"NumberTypeAnnotation",ObjectExpression:"ObjectExpression",ObjectPattern:"ObjectPattern",ObjectTypeAnnotation:"ObjectTypeAnnotation",ObjectTypeCallProperty:"ObjectTypeCallProperty",ObjectTypeIndexer:"ObjectTypeIndexer",ObjectTypeProperty:"ObjectTypeProperty",Program:"Program",Property:"Property",QualifiedTypeIdentifier:"QualifiedTypeIdentifier",ReturnStatement:"ReturnStatement",SequenceExpression:"SequenceExpression",SpreadElement:"SpreadElement",SpreadProperty:"SpreadProperty",StringLiteralTypeAnnotation:"StringLiteralTypeAnnotation",StringTypeAnnotation:"StringTypeAnnotation",SwitchCase:"SwitchCase",SwitchStatement:"SwitchStatement",TaggedTemplateExpression:"TaggedTemplateExpression",TemplateElement:"TemplateElement",TemplateLiteral:"TemplateLiteral",ThisExpression:"ThisExpression",ThrowStatement:"ThrowStatement",TupleTypeAnnotation:"TupleTypeAnnotation",TryStatement:"TryStatement",TypeAlias:"TypeAlias",TypeAnnotation:"TypeAnnotation",TypeofTypeAnnotation:"TypeofTypeAnnotation",TypeParameterDeclaration:"TypeParameterDeclaration",TypeParameterInstantiation:"TypeParameterInstantiation",UnaryExpression:"UnaryExpression",UnionTypeAnnotation:"UnionTypeAnnotation",UpdateExpression:"UpdateExpression",VariableDeclaration:"VariableDeclaration",VariableDeclarator:"VariableDeclarator",VoidTypeAnnotation:"VoidTypeAnnotation",WhileStatement:"WhileStatement",WithStatement:"WithStatement",XJSIdentifier:"XJSIdentifier",XJSNamespacedName:"XJSNamespacedName",XJSMemberExpression:"XJSMemberExpression",XJSEmptyExpression:"XJSEmptyExpression",XJSExpressionContainer:"XJSExpressionContainer",XJSElement:"XJSElement",XJSClosingElement:"XJSClosingElement",XJSOpeningElement:"XJSOpeningElement",XJSAttribute:"XJSAttribute",XJSSpreadAttribute:"XJSSpreadAttribute",XJSText:"XJSText",YieldExpression:"YieldExpression",AwaitExpression:"AwaitExpression"};PropertyKind={Data:1,Get:2,Set:4};ClassPropertyType={static:"static",prototype:"prototype"};Messages={UnexpectedToken:"Unexpected token %0",UnexpectedNumber:"Unexpected number",UnexpectedString:"Unexpected string",UnexpectedIdentifier:"Unexpected identifier",UnexpectedReserved:"Unexpected reserved word",UnexpectedTemplate:"Unexpected quasi %0",UnexpectedEOS:"Unexpected end of input",NewlineAfterThrow:"Illegal newline after throw",InvalidRegExp:"Invalid regular expression",UnterminatedRegExp:"Invalid regular expression: missing /",InvalidLHSInAssignment:"Invalid left-hand side in assignment",InvalidLHSInFormalsList:"Invalid left-hand side in formals list",InvalidLHSInForIn:"Invalid left-hand side in for-in",MultipleDefaultsInSwitch:"More than one default clause in switch statement",NoCatchOrFinally:"Missing catch or finally after try",UnknownLabel:"Undefined label '%0'",Redeclaration:"%0 '%1' has already been declared",IllegalContinue:"Illegal continue statement",IllegalBreak:"Illegal break statement",IllegalDuplicateClassProperty:"Illegal duplicate property in class definition",IllegalReturn:"Illegal return statement",IllegalSpread:"Illegal spread element",StrictModeWith:"Strict mode code may not include a with statement",StrictCatchVariable:"Catch variable may not be eval or arguments in strict mode",StrictVarName:"Variable name may not be eval or arguments in strict mode",StrictParamName:"Parameter name eval or arguments is not allowed in strict mode",StrictParamDupe:"Strict mode function may not have duplicate parameter names",ParameterAfterRestParameter:"Rest parameter must be final parameter of an argument list",DefaultRestParameter:"Rest parameter can not have a default value",ElementAfterSpreadElement:"Spread must be the final element of an element list",PropertyAfterSpreadProperty:"A rest property must be the final property of an object literal",ObjectPatternAsRestParameter:"Invalid rest parameter",ObjectPatternAsSpread:"Invalid spread argument",StrictFunctionName:"Function name may not be eval or arguments in strict mode",StrictOctalLiteral:"Octal literals are not allowed in strict mode.",StrictDelete:"Delete of an unqualified identifier in strict mode.",StrictDuplicateProperty:"Duplicate data property in object literal not allowed in strict mode",AccessorDataProperty:"Object literal may not have data and accessor property with the same name",AccessorGetSet:"Object literal may not have multiple get/set accessors with the same name",StrictLHSAssignment:"Assignment to eval or arguments is not allowed in strict mode",StrictLHSPostfix:"Postfix increment/decrement may not have eval or arguments operand in strict mode",StrictLHSPrefix:"Prefix increment/decrement may not have eval or arguments operand in strict mode",StrictReservedWord:"Use of future reserved word in strict mode",MissingFromClause:"Missing from clause",NoAsAfterImportNamespace:"Missing as after import *",InvalidModuleSpecifier:"Invalid module specifier",NoUnintializedConst:"Const must be initialized",ComprehensionRequiresBlock:"Comprehension must have at least one block",ComprehensionError:"Comprehension Error",EachNotAllowed:"Each is not supported",InvalidXJSAttributeValue:"XJS value should be either an expression or a quoted XJS text",ExpectedXJSClosingTag:"Expected corresponding XJS closing tag for %0",AdjacentXJSElements:"Adjacent XJS elements must be wrapped in an enclosing tag",ConfusedAboutFunctionType:"Unexpected token =>. It looks like "+"you are trying to write a function type, but you ended up "+"writing a grouped type followed by an =>, which is a syntax "+"error. Remember, function type parameters are named so function "+"types look like (name1: type1, name2: type2) => returnType. You "+"probably wrote (type1) => returnType"};Regex={NonAsciiIdentifierStart:new RegExp("[------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------]"),NonAsciiIdentifierPart:new RegExp("[------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------]"),LeadingZeros:new RegExp("^0+(?!$)")};function assert(condition,message){if(!condition){throw new Error("ASSERT: "+message)}}function isDecimalDigit(ch){return ch>=48&&ch<=57}function isHexDigit(ch){return"0123456789abcdefABCDEF".indexOf(ch)>=0}function isOctalDigit(ch){return"01234567".indexOf(ch)>=0}function isWhiteSpace(ch){return ch===32||ch===9||ch===11||ch===12||ch===160||ch>=5760&&"".indexOf(String.fromCharCode(ch))>0}function isLineTerminator(ch){return ch===10||ch===13||ch===8232||ch===8233}function isIdentifierStart(ch){return ch===36||ch===95||ch>=65&&ch<=90||ch>=97&&ch<=122||ch===92||ch>=128&&Regex.NonAsciiIdentifierStart.test(String.fromCharCode(ch))}function isIdentifierPart(ch){return ch===36||ch===95||ch>=65&&ch<=90||ch>=97&&ch<=122||ch>=48&&ch<=57||ch===92||ch>=128&&Regex.NonAsciiIdentifierPart.test(String.fromCharCode(ch))}function isFutureReservedWord(id){switch(id){case"class":case"enum":case"export":case"extends":case"import":case"super":return true;default:return false}}function isStrictModeReservedWord(id){switch(id){case"implements":case"interface":case"package":case"private":case"protected":case"public":case"static":case"yield":case"let":return true;default:return false}}function isRestrictedWord(id){return id==="eval"||id==="arguments"}function isKeyword(id){if(strict&&isStrictModeReservedWord(id)){return true}switch(id.length){case 2:return id==="if"||id==="in"||id==="do";case 3:return id==="var"||id==="for"||id==="new"||id==="try"||id==="let";case 4:return id==="this"||id==="else"||id==="case"||id==="void"||id==="with"||id==="enum";case 5:return id==="while"||id==="break"||id==="catch"||id==="throw"||id==="const"||id==="class"||id==="super";case 6:return id==="return"||id==="typeof"||id==="delete"||id==="switch"||id==="export"||id==="import";case 7:return id==="default"||id==="finally"||id==="extends";case 8:return id==="function"||id==="continue"||id==="debugger";case 10:return id==="instanceof";default:return false}}function skipComment(){var ch,blockComment,lineComment;blockComment=false;lineComment=false;while(index<length){ch=source.charCodeAt(index);if(lineComment){++index;if(isLineTerminator(ch)){lineComment=false;if(ch===13&&source.charCodeAt(index)===10){++index}++lineNumber;lineStart=index}}else if(blockComment){if(isLineTerminator(ch)){if(ch===13){++index}if(ch!==13||source.charCodeAt(index)===10){++lineNumber;++index;lineStart=index;if(index>=length){throwError({},Messages.UnexpectedToken,"ILLEGAL")}}}else{ch=source.charCodeAt(index++);if(index>=length){throwError({},Messages.UnexpectedToken,"ILLEGAL")}if(ch===42){ch=source.charCodeAt(index);
if(ch===47){++index;blockComment=false}}}}else if(ch===47){ch=source.charCodeAt(index+1);if(ch===47){index+=2;lineComment=true}else if(ch===42){index+=2;blockComment=true;if(index>=length){throwError({},Messages.UnexpectedToken,"ILLEGAL")}}else{break}}else if(isWhiteSpace(ch)){++index}else if(isLineTerminator(ch)){++index;if(ch===13&&source.charCodeAt(index)===10){++index}++lineNumber;lineStart=index}else{break}}}function scanHexEscape(prefix){var i,len,ch,code=0;len=prefix==="u"?4:2;for(i=0;i<len;++i){if(index<length&&isHexDigit(source[index])){ch=source[index++];code=code*16+"0123456789abcdef".indexOf(ch.toLowerCase())}else{return""}}return String.fromCharCode(code)}function scanUnicodeCodePointEscape(){var ch,code,cu1,cu2;ch=source[index];code=0;if(ch==="}"){throwError({},Messages.UnexpectedToken,"ILLEGAL")}while(index<length){ch=source[index++];if(!isHexDigit(ch)){break}code=code*16+"0123456789abcdef".indexOf(ch.toLowerCase())}if(code>1114111||ch!=="}"){throwError({},Messages.UnexpectedToken,"ILLEGAL")}if(code<=65535){return String.fromCharCode(code)}cu1=(code-65536>>10)+55296;cu2=(code-65536&1023)+56320;return String.fromCharCode(cu1,cu2)}function getEscapedIdentifier(){var ch,id;ch=source.charCodeAt(index++);id=String.fromCharCode(ch);if(ch===92){if(source.charCodeAt(index)!==117){throwError({},Messages.UnexpectedToken,"ILLEGAL")}++index;ch=scanHexEscape("u");if(!ch||ch==="\\"||!isIdentifierStart(ch.charCodeAt(0))){throwError({},Messages.UnexpectedToken,"ILLEGAL")}id=ch}while(index<length){ch=source.charCodeAt(index);if(!isIdentifierPart(ch)){break}++index;id+=String.fromCharCode(ch);if(ch===92){id=id.substr(0,id.length-1);if(source.charCodeAt(index)!==117){throwError({},Messages.UnexpectedToken,"ILLEGAL")}++index;ch=scanHexEscape("u");if(!ch||ch==="\\"||!isIdentifierPart(ch.charCodeAt(0))){throwError({},Messages.UnexpectedToken,"ILLEGAL")}id+=ch}}return id}function getIdentifier(){var start,ch;start=index++;while(index<length){ch=source.charCodeAt(index);if(ch===92){index=start;return getEscapedIdentifier()}if(isIdentifierPart(ch)){++index}else{break}}return source.slice(start,index)}function scanIdentifier(){var start,id,type;start=index;id=source.charCodeAt(index)===92?getEscapedIdentifier():getIdentifier();if(id.length===1){type=Token.Identifier}else if(isKeyword(id)){type=Token.Keyword}else if(id==="null"){type=Token.NullLiteral}else if(id==="true"||id==="false"){type=Token.BooleanLiteral}else{type=Token.Identifier}return{type:type,value:id,lineNumber:lineNumber,lineStart:lineStart,range:[start,index]}}function scanPunctuator(){var start=index,code=source.charCodeAt(index),code2,ch1=source[index],ch2,ch3,ch4;switch(code){case 40:case 41:case 59:case 44:case 123:case 125:case 91:case 93:case 58:case 63:case 126:++index;if(extra.tokenize){if(code===40){extra.openParenToken=extra.tokens.length}else if(code===123){extra.openCurlyToken=extra.tokens.length}}return{type:Token.Punctuator,value:String.fromCharCode(code),lineNumber:lineNumber,lineStart:lineStart,range:[start,index]};default:code2=source.charCodeAt(index+1);if(code2===61){switch(code){case 37:case 38:case 42:case 43:case 45:case 47:case 60:case 62:case 94:case 124:index+=2;return{type:Token.Punctuator,value:String.fromCharCode(code)+String.fromCharCode(code2),lineNumber:lineNumber,lineStart:lineStart,range:[start,index]};case 33:case 61:index+=2;if(source.charCodeAt(index)===61){++index}return{type:Token.Punctuator,value:source.slice(start,index),lineNumber:lineNumber,lineStart:lineStart,range:[start,index]};default:break}}break}ch2=source[index+1];ch3=source[index+2];ch4=source[index+3];if(ch1===">"&&ch2===">"&&ch3===">"){if(ch4==="="){index+=4;return{type:Token.Punctuator,value:">>>=",lineNumber:lineNumber,lineStart:lineStart,range:[start,index]}}}if(ch1===">"&&ch2===">"&&ch3===">"){index+=3;return{type:Token.Punctuator,value:">>>",lineNumber:lineNumber,lineStart:lineStart,range:[start,index]}}if(ch1==="<"&&ch2==="<"&&ch3==="="){index+=3;return{type:Token.Punctuator,value:"<<=",lineNumber:lineNumber,lineStart:lineStart,range:[start,index]}}if(ch1===">"&&ch2===">"&&ch3==="="){index+=3;return{type:Token.Punctuator,value:">>=",lineNumber:lineNumber,lineStart:lineStart,range:[start,index]}}if(ch1==="."&&ch2==="."&&ch3==="."){index+=3;return{type:Token.Punctuator,value:"...",lineNumber:lineNumber,lineStart:lineStart,range:[start,index]}}if(ch1===ch2&&"+-<>&|".indexOf(ch1)>=0&&!state.inType){index+=2;return{type:Token.Punctuator,value:ch1+ch2,lineNumber:lineNumber,lineStart:lineStart,range:[start,index]}}if(ch1==="="&&ch2===">"){index+=2;return{type:Token.Punctuator,value:"=>",lineNumber:lineNumber,lineStart:lineStart,range:[start,index]}}if("<>=!+-*%&|^/".indexOf(ch1)>=0){++index;return{type:Token.Punctuator,value:ch1,lineNumber:lineNumber,lineStart:lineStart,range:[start,index]}}if(ch1==="."){++index;return{type:Token.Punctuator,value:ch1,lineNumber:lineNumber,lineStart:lineStart,range:[start,index]}}throwError({},Messages.UnexpectedToken,"ILLEGAL")}function scanHexLiteral(start){var number="";while(index<length){if(!isHexDigit(source[index])){break}number+=source[index++]}if(number.length===0){throwError({},Messages.UnexpectedToken,"ILLEGAL")}if(isIdentifierStart(source.charCodeAt(index))){throwError({},Messages.UnexpectedToken,"ILLEGAL")}return{type:Token.NumericLiteral,value:parseInt("0x"+number,16),lineNumber:lineNumber,lineStart:lineStart,range:[start,index]}}function scanOctalLiteral(prefix,start){var number,octal;if(isOctalDigit(prefix)){octal=true;number="0"+source[index++]}else{octal=false;++index;number=""}while(index<length){if(!isOctalDigit(source[index])){break}number+=source[index++]}if(!octal&&number.length===0){throwError({},Messages.UnexpectedToken,"ILLEGAL")}if(isIdentifierStart(source.charCodeAt(index))||isDecimalDigit(source.charCodeAt(index))){throwError({},Messages.UnexpectedToken,"ILLEGAL")}return{type:Token.NumericLiteral,value:parseInt(number,8),octal:octal,lineNumber:lineNumber,lineStart:lineStart,range:[start,index]}}function scanNumericLiteral(){var number,start,ch,octal;ch=source[index];assert(isDecimalDigit(ch.charCodeAt(0))||ch===".","Numeric literal must start with a decimal digit or a decimal point");start=index;number="";if(ch!=="."){number=source[index++];ch=source[index];if(number==="0"){if(ch==="x"||ch==="X"){++index;return scanHexLiteral(start)}if(ch==="b"||ch==="B"){++index;number="";while(index<length){ch=source[index];if(ch!=="0"&&ch!=="1"){break}number+=source[index++]}if(number.length===0){throwError({},Messages.UnexpectedToken,"ILLEGAL")}if(index<length){ch=source.charCodeAt(index);if(isIdentifierStart(ch)||isDecimalDigit(ch)){throwError({},Messages.UnexpectedToken,"ILLEGAL")}}return{type:Token.NumericLiteral,value:parseInt(number,2),lineNumber:lineNumber,lineStart:lineStart,range:[start,index]}}if(ch==="o"||ch==="O"||isOctalDigit(ch)){return scanOctalLiteral(ch,start)}if(ch&&isDecimalDigit(ch.charCodeAt(0))){throwError({},Messages.UnexpectedToken,"ILLEGAL")}}while(isDecimalDigit(source.charCodeAt(index))){number+=source[index++]}ch=source[index]}if(ch==="."){number+=source[index++];while(isDecimalDigit(source.charCodeAt(index))){number+=source[index++]}ch=source[index]}if(ch==="e"||ch==="E"){number+=source[index++];ch=source[index];if(ch==="+"||ch==="-"){number+=source[index++]}if(isDecimalDigit(source.charCodeAt(index))){while(isDecimalDigit(source.charCodeAt(index))){number+=source[index++]}}else{throwError({},Messages.UnexpectedToken,"ILLEGAL")}}if(isIdentifierStart(source.charCodeAt(index))){throwError({},Messages.UnexpectedToken,"ILLEGAL")}return{type:Token.NumericLiteral,value:parseFloat(number),lineNumber:lineNumber,lineStart:lineStart,range:[start,index]}}function scanStringLiteral(){var str="",quote,start,ch,code,unescaped,restore,octal=false;quote=source[index];assert(quote==="'"||quote==='"',"String literal must starts with a quote");start=index;++index;while(index<length){ch=source[index++];if(ch===quote){quote="";break}else if(ch==="\\"){ch=source[index++];if(!ch||!isLineTerminator(ch.charCodeAt(0))){switch(ch){case"n":str+="\n";break;case"r":str+="\r";break;case"t":str+="	";break;case"u":case"x":if(source[index]==="{"){++index;str+=scanUnicodeCodePointEscape()}else{restore=index;unescaped=scanHexEscape(ch);if(unescaped){str+=unescaped}else{index=restore;str+=ch}}break;case"b":str+="\b";break;case"f":str+="\f";break;case"v":str+="";break;default:if(isOctalDigit(ch)){code="01234567".indexOf(ch);if(code!==0){octal=true}if(index<length&&isOctalDigit(source[index])){octal=true;code=code*8+"01234567".indexOf(source[index++]);if("0123".indexOf(ch)>=0&&index<length&&isOctalDigit(source[index])){code=code*8+"01234567".indexOf(source[index++])}}str+=String.fromCharCode(code)}else{str+=ch}break}}else{++lineNumber;if(ch==="\r"&&source[index]==="\n"){++index}lineStart=index}}else if(isLineTerminator(ch.charCodeAt(0))){break}else{str+=ch}}if(quote!==""){throwError({},Messages.UnexpectedToken,"ILLEGAL")}return{type:Token.StringLiteral,value:str,octal:octal,lineNumber:lineNumber,lineStart:lineStart,range:[start,index]}}function scanTemplate(){var cooked="",ch,start,terminated,tail,restore,unescaped,code,octal;terminated=false;tail=false;start=index;++index;while(index<length){ch=source[index++];if(ch==="`"){tail=true;terminated=true;break}else if(ch==="$"){if(source[index]==="{"){++index;terminated=true;break}cooked+=ch}else if(ch==="\\"){ch=source[index++];if(!isLineTerminator(ch.charCodeAt(0))){switch(ch){case"n":cooked+="\n";break;case"r":cooked+="\r";break;case"t":cooked+="	";break;case"u":case"x":if(source[index]==="{"){++index;cooked+=scanUnicodeCodePointEscape()}else{restore=index;unescaped=scanHexEscape(ch);if(unescaped){cooked+=unescaped}else{index=restore;cooked+=ch}}break;case"b":cooked+="\b";break;case"f":cooked+="\f";break;case"v":cooked+="";break;default:if(isOctalDigit(ch)){code="01234567".indexOf(ch);if(code!==0){octal=true}if(index<length&&isOctalDigit(source[index])){octal=true;code=code*8+"01234567".indexOf(source[index++]);if("0123".indexOf(ch)>=0&&index<length&&isOctalDigit(source[index])){code=code*8+"01234567".indexOf(source[index++])}}cooked+=String.fromCharCode(code)}else{cooked+=ch}break}}else{++lineNumber;if(ch==="\r"&&source[index]==="\n"){++index}lineStart=index}}else if(isLineTerminator(ch.charCodeAt(0))){++lineNumber;if(ch==="\r"&&source[index]==="\n"){++index}lineStart=index;cooked+="\n"}else{cooked+=ch}}if(!terminated){throwError({},Messages.UnexpectedToken,"ILLEGAL")}return{type:Token.Template,value:{cooked:cooked,raw:source.slice(start+1,index-(tail?1:2))},tail:tail,octal:octal,lineNumber:lineNumber,lineStart:lineStart,range:[start,index]}}function scanTemplateElement(option){var startsWith,template;lookahead=null;skipComment();startsWith=option.head?"`":"}";if(source[index]!==startsWith){throwError({},Messages.UnexpectedToken,"ILLEGAL")}template=scanTemplate();peek();return template}function scanRegExp(){var str,ch,start,pattern,flags,value,classMarker=false,restore,terminated=false,tmp;lookahead=null;skipComment();start=index;ch=source[index];assert(ch==="/","Regular expression literal must start with a slash");str=source[index++];while(index<length){ch=source[index++];str+=ch;if(classMarker){if(ch==="]"){classMarker=false}}else{if(ch==="\\"){ch=source[index++];if(isLineTerminator(ch.charCodeAt(0))){throwError({},Messages.UnterminatedRegExp)}str+=ch}else if(ch==="/"){terminated=true;break}else if(ch==="["){classMarker=true}else if(isLineTerminator(ch.charCodeAt(0))){throwError({},Messages.UnterminatedRegExp)}}}if(!terminated){throwError({},Messages.UnterminatedRegExp)}pattern=str.substr(1,str.length-2);flags="";while(index<length){ch=source[index];if(!isIdentifierPart(ch.charCodeAt(0))){break}++index;if(ch==="\\"&&index<length){ch=source[index];if(ch==="u"){++index;restore=index;ch=scanHexEscape("u");if(ch){flags+=ch;for(str+="\\u";restore<index;++restore){str+=source[restore]}}else{index=restore;flags+="u";str+="\\u"}}else{str+="\\"}}else{flags+=ch;str+=ch}}tmp=pattern;if(flags.indexOf("u")>=0){tmp=tmp.replace(/\\u\{([0-9a-fA-F]{5,6})\}/g,"x").replace(/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,"x")}try{value=new RegExp(tmp)}catch(e){throwError({},Messages.InvalidRegExp)}try{value=new RegExp(pattern,flags)}catch(exception){value=null}peek();if(extra.tokenize){return{type:Token.RegularExpression,value:value,regex:{pattern:pattern,flags:flags},lineNumber:lineNumber,lineStart:lineStart,range:[start,index]}}return{literal:str,value:value,regex:{pattern:pattern,flags:flags},range:[start,index]}}function isIdentifierName(token){return token.type===Token.Identifier||token.type===Token.Keyword||token.type===Token.BooleanLiteral||token.type===Token.NullLiteral}function advanceSlash(){var prevToken,checkToken;prevToken=extra.tokens[extra.tokens.length-1];if(!prevToken){return scanRegExp()}if(prevToken.type==="Punctuator"){if(prevToken.value===")"){checkToken=extra.tokens[extra.openParenToken-1];if(checkToken&&checkToken.type==="Keyword"&&(checkToken.value==="if"||checkToken.value==="while"||checkToken.value==="for"||checkToken.value==="with")){return scanRegExp()}return scanPunctuator()}if(prevToken.value==="}"){if(extra.tokens[extra.openCurlyToken-3]&&extra.tokens[extra.openCurlyToken-3].type==="Keyword"){checkToken=extra.tokens[extra.openCurlyToken-4];if(!checkToken){return scanPunctuator()}}else if(extra.tokens[extra.openCurlyToken-4]&&extra.tokens[extra.openCurlyToken-4].type==="Keyword"){checkToken=extra.tokens[extra.openCurlyToken-5];if(!checkToken){return scanRegExp()}}else{return scanPunctuator()}if(FnExprTokens.indexOf(checkToken.value)>=0){return scanPunctuator()}return scanRegExp()}return scanRegExp()}if(prevToken.type==="Keyword"){return scanRegExp()}return scanPunctuator()}function advance(){var ch;if(!state.inXJSChild){skipComment()}if(index>=length){return{type:Token.EOF,lineNumber:lineNumber,lineStart:lineStart,range:[index,index]}}if(state.inXJSChild){return advanceXJSChild()}ch=source.charCodeAt(index);if(ch===40||ch===41||ch===58){return scanPunctuator()}if(ch===39||ch===34){if(state.inXJSTag){return scanXJSStringLiteral()}return scanStringLiteral()}if(state.inXJSTag&&isXJSIdentifierStart(ch)){return scanXJSIdentifier()}if(ch===96){return scanTemplate()}if(isIdentifierStart(ch)){return scanIdentifier()}if(ch===46){if(isDecimalDigit(source.charCodeAt(index+1))){return scanNumericLiteral()}return scanPunctuator()}if(isDecimalDigit(ch)){return scanNumericLiteral()}if(extra.tokenize&&ch===47){return advanceSlash()}return scanPunctuator()}function lex(){var token;token=lookahead;index=token.range[1];lineNumber=token.lineNumber;lineStart=token.lineStart;lookahead=advance();index=token.range[1];lineNumber=token.lineNumber;lineStart=token.lineStart;return token}function peek(){var pos,line,start;pos=index;line=lineNumber;start=lineStart;lookahead=advance();index=pos;lineNumber=line;lineStart=start}function lookahead2(){var adv,pos,line,start,result;adv=typeof extra.advance==="function"?extra.advance:advance;pos=index;line=lineNumber;start=lineStart;if(lookahead===null){lookahead=adv()}index=lookahead.range[1];lineNumber=lookahead.lineNumber;lineStart=lookahead.lineStart;result=adv();index=pos;lineNumber=line;lineStart=start;return result}function rewind(token){index=token.range[0];lineNumber=token.lineNumber;lineStart=token.lineStart;lookahead=token}function markerCreate(){if(!extra.loc&&!extra.range){return undefined}skipComment();return{offset:index,line:lineNumber,col:index-lineStart}}function markerCreatePreserveWhitespace(){if(!extra.loc&&!extra.range){return undefined}return{offset:index,line:lineNumber,col:index-lineStart}}function processComment(node){var lastChild,trailingComments,bottomRight=extra.bottomRightStack,last=bottomRight[bottomRight.length-1];if(node.type===Syntax.Program){if(node.body.length>0){return}}if(extra.trailingComments.length>0){if(extra.trailingComments[0].range[0]>=node.range[1]){trailingComments=extra.trailingComments;extra.trailingComments=[]}else{extra.trailingComments.length=0}}else{if(last&&last.trailingComments&&last.trailingComments[0].range[0]>=node.range[1]){trailingComments=last.trailingComments;delete last.trailingComments}}if(last){while(last&&last.range[0]>=node.range[0]){lastChild=last;last=bottomRight.pop()}}if(lastChild){if(lastChild.leadingComments&&lastChild.leadingComments[lastChild.leadingComments.length-1].range[1]<=node.range[0]){node.leadingComments=lastChild.leadingComments;delete lastChild.leadingComments}}else if(extra.leadingComments.length>0&&extra.leadingComments[extra.leadingComments.length-1].range[1]<=node.range[0]){node.leadingComments=extra.leadingComments;extra.leadingComments=[]}if(trailingComments){node.trailingComments=trailingComments}bottomRight.push(node)}function markerApply(marker,node){if(extra.range){node.range=[marker.offset,index]}if(extra.loc){node.loc={start:{line:marker.line,column:marker.col},end:{line:lineNumber,column:index-lineStart}};node=delegate.postProcess(node)}if(extra.attachComment){processComment(node)}return node}SyntaxTreeDelegate={name:"SyntaxTree",postProcess:function(node){return node},createArrayExpression:function(elements){return{type:Syntax.ArrayExpression,elements:elements}},createAssignmentExpression:function(operator,left,right){return{type:Syntax.AssignmentExpression,operator:operator,left:left,right:right}},createBinaryExpression:function(operator,left,right){var type=operator==="||"||operator==="&&"?Syntax.LogicalExpression:Syntax.BinaryExpression;return{type:type,operator:operator,left:left,right:right}},createBlockStatement:function(body){return{type:Syntax.BlockStatement,body:body}},createBreakStatement:function(label){return{type:Syntax.BreakStatement,label:label}},createCallExpression:function(callee,args){return{type:Syntax.CallExpression,callee:callee,arguments:args}},createCatchClause:function(param,body){return{type:Syntax.CatchClause,param:param,body:body}},createConditionalExpression:function(test,consequent,alternate){return{type:Syntax.ConditionalExpression,test:test,consequent:consequent,alternate:alternate}},createContinueStatement:function(label){return{type:Syntax.ContinueStatement,label:label}},createDebuggerStatement:function(){return{type:Syntax.DebuggerStatement}},createDoWhileStatement:function(body,test){return{type:Syntax.DoWhileStatement,body:body,test:test}},createEmptyStatement:function(){return{type:Syntax.EmptyStatement}},createExpressionStatement:function(expression){return{type:Syntax.ExpressionStatement,expression:expression}},createForStatement:function(init,test,update,body){return{type:Syntax.ForStatement,init:init,test:test,update:update,body:body}},createForInStatement:function(left,right,body){return{type:Syntax.ForInStatement,left:left,right:right,body:body,each:false}},createForOfStatement:function(left,right,body){return{type:Syntax.ForOfStatement,left:left,right:right,body:body}},createFunctionDeclaration:function(id,params,defaults,body,rest,generator,expression,isAsync,returnType,typeParameters){var funDecl={type:Syntax.FunctionDeclaration,id:id,params:params,defaults:defaults,body:body,rest:rest,generator:generator,expression:expression,returnType:returnType,typeParameters:typeParameters};if(isAsync){funDecl.async=true}return funDecl},createFunctionExpression:function(id,params,defaults,body,rest,generator,expression,isAsync,returnType,typeParameters){var funExpr={type:Syntax.FunctionExpression,id:id,params:params,defaults:defaults,body:body,rest:rest,generator:generator,expression:expression,returnType:returnType,typeParameters:typeParameters};if(isAsync){funExpr.async=true}return funExpr},createIdentifier:function(name){return{type:Syntax.Identifier,name:name,typeAnnotation:undefined,optional:undefined}},createTypeAnnotation:function(typeAnnotation){return{type:Syntax.TypeAnnotation,typeAnnotation:typeAnnotation}},createFunctionTypeAnnotation:function(params,returnType,rest,typeParameters){return{type:Syntax.FunctionTypeAnnotation,params:params,returnType:returnType,rest:rest,typeParameters:typeParameters}},createFunctionTypeParam:function(name,typeAnnotation,optional){return{type:Syntax.FunctionTypeParam,name:name,typeAnnotation:typeAnnotation,optional:optional}},createNullableTypeAnnotation:function(typeAnnotation){return{type:Syntax.NullableTypeAnnotation,typeAnnotation:typeAnnotation}},createArrayTypeAnnotation:function(elementType){return{type:Syntax.ArrayTypeAnnotation,elementType:elementType}},createGenericTypeAnnotation:function(id,typeParameters){return{type:Syntax.GenericTypeAnnotation,id:id,typeParameters:typeParameters}},createQualifiedTypeIdentifier:function(qualification,id){return{type:Syntax.QualifiedTypeIdentifier,qualification:qualification,id:id}},createTypeParameterDeclaration:function(params){return{type:Syntax.TypeParameterDeclaration,params:params}},createTypeParameterInstantiation:function(params){return{type:Syntax.TypeParameterInstantiation,params:params}},createAnyTypeAnnotation:function(){return{type:Syntax.AnyTypeAnnotation}},createBooleanTypeAnnotation:function(){return{type:Syntax.BooleanTypeAnnotation}},createNumberTypeAnnotation:function(){return{type:Syntax.NumberTypeAnnotation}},createStringTypeAnnotation:function(){return{type:Syntax.StringTypeAnnotation}},createStringLiteralTypeAnnotation:function(token){return{type:Syntax.StringLiteralTypeAnnotation,value:token.value,raw:source.slice(token.range[0],token.range[1])}},createVoidTypeAnnotation:function(){return{type:Syntax.VoidTypeAnnotation}},createTypeofTypeAnnotation:function(argument){return{type:Syntax.TypeofTypeAnnotation,argument:argument}},createTupleTypeAnnotation:function(types){return{type:Syntax.TupleTypeAnnotation,types:types}},createObjectTypeAnnotation:function(properties,indexers,callProperties){return{type:Syntax.ObjectTypeAnnotation,properties:properties,indexers:indexers,callProperties:callProperties}},createObjectTypeIndexer:function(id,key,value,isStatic){return{type:Syntax.ObjectTypeIndexer,id:id,key:key,value:value,static:isStatic}},createObjectTypeCallProperty:function(value,isStatic){return{type:Syntax.ObjectTypeCallProperty,value:value,static:isStatic}},createObjectTypeProperty:function(key,value,optional,isStatic){return{type:Syntax.ObjectTypeProperty,key:key,value:value,optional:optional,static:isStatic}},createUnionTypeAnnotation:function(types){return{type:Syntax.UnionTypeAnnotation,types:types}},createIntersectionTypeAnnotation:function(types){return{type:Syntax.IntersectionTypeAnnotation,types:types}},createTypeAlias:function(id,typeParameters,right){return{type:Syntax.TypeAlias,id:id,typeParameters:typeParameters,right:right}},createInterface:function(id,typeParameters,body,extended){return{type:Syntax.InterfaceDeclaration,id:id,typeParameters:typeParameters,body:body,extends:extended}},createInterfaceExtends:function(id,typeParameters){return{type:Syntax.InterfaceExtends,id:id,typeParameters:typeParameters}},createDeclareFunction:function(id){return{type:Syntax.DeclareFunction,id:id}},createDeclareVariable:function(id){return{type:Syntax.DeclareVariable,id:id}},createDeclareModule:function(id,body){return{type:Syntax.DeclareModule,id:id,body:body}},createXJSAttribute:function(name,value){return{type:Syntax.XJSAttribute,name:name,value:value||null}},createXJSSpreadAttribute:function(argument){return{type:Syntax.XJSSpreadAttribute,argument:argument}},createXJSIdentifier:function(name){return{type:Syntax.XJSIdentifier,name:name}},createXJSNamespacedName:function(namespace,name){return{type:Syntax.XJSNamespacedName,namespace:namespace,name:name}},createXJSMemberExpression:function(object,property){return{type:Syntax.XJSMemberExpression,object:object,property:property}},createXJSElement:function(openingElement,closingElement,children){return{type:Syntax.XJSElement,openingElement:openingElement,closingElement:closingElement,children:children}},createXJSEmptyExpression:function(){return{type:Syntax.XJSEmptyExpression}},createXJSExpressionContainer:function(expression){return{type:Syntax.XJSExpressionContainer,expression:expression}},createXJSOpeningElement:function(name,attributes,selfClosing){return{type:Syntax.XJSOpeningElement,name:name,selfClosing:selfClosing,attributes:attributes}},createXJSClosingElement:function(name){return{type:Syntax.XJSClosingElement,name:name}},createIfStatement:function(test,consequent,alternate){return{type:Syntax.IfStatement,test:test,consequent:consequent,alternate:alternate}},createLabeledStatement:function(label,body){return{type:Syntax.LabeledStatement,label:label,body:body}},createLiteral:function(token){var object={type:Syntax.Literal,value:token.value,raw:source.slice(token.range[0],token.range[1])};if(token.regex){object.regex=token.regex}return object},createMemberExpression:function(accessor,object,property){return{type:Syntax.MemberExpression,computed:accessor==="[",object:object,property:property}},createNewExpression:function(callee,args){return{type:Syntax.NewExpression,callee:callee,arguments:args}},createObjectExpression:function(properties){return{type:Syntax.ObjectExpression,properties:properties}},createPostfixExpression:function(operator,argument){return{type:Syntax.UpdateExpression,operator:operator,argument:argument,prefix:false}},createProgram:function(body){return{type:Syntax.Program,body:body}},createProperty:function(kind,key,value,method,shorthand,computed){return{type:Syntax.Property,key:key,value:value,kind:kind,method:method,shorthand:shorthand,computed:computed}},createReturnStatement:function(argument){return{type:Syntax.ReturnStatement,argument:argument}},createSequenceExpression:function(expressions){return{type:Syntax.SequenceExpression,expressions:expressions}},createSwitchCase:function(test,consequent){return{type:Syntax.SwitchCase,test:test,consequent:consequent}},createSwitchStatement:function(discriminant,cases){return{type:Syntax.SwitchStatement,discriminant:discriminant,cases:cases}},createThisExpression:function(){return{type:Syntax.ThisExpression}},createThrowStatement:function(argument){return{type:Syntax.ThrowStatement,argument:argument}},createTryStatement:function(block,guardedHandlers,handlers,finalizer){return{type:Syntax.TryStatement,block:block,guardedHandlers:guardedHandlers,handlers:handlers,finalizer:finalizer}},createUnaryExpression:function(operator,argument){if(operator==="++"||operator==="--"){return{type:Syntax.UpdateExpression,operator:operator,argument:argument,prefix:true}}return{type:Syntax.UnaryExpression,operator:operator,argument:argument,prefix:true}},createVariableDeclaration:function(declarations,kind){return{type:Syntax.VariableDeclaration,declarations:declarations,kind:kind}},createVariableDeclarator:function(id,init){return{type:Syntax.VariableDeclarator,id:id,init:init}},createWhileStatement:function(test,body){return{type:Syntax.WhileStatement,test:test,body:body}},createWithStatement:function(object,body){return{type:Syntax.WithStatement,object:object,body:body}},createTemplateElement:function(value,tail){return{type:Syntax.TemplateElement,value:value,tail:tail}},createTemplateLiteral:function(quasis,expressions){return{type:Syntax.TemplateLiteral,quasis:quasis,expressions:expressions}},createSpreadElement:function(argument){return{type:Syntax.SpreadElement,argument:argument}},createSpreadProperty:function(argument){return{type:Syntax.SpreadProperty,argument:argument}},createTaggedTemplateExpression:function(tag,quasi){return{type:Syntax.TaggedTemplateExpression,tag:tag,quasi:quasi}},createArrowFunctionExpression:function(params,defaults,body,rest,expression,isAsync){var arrowExpr={type:Syntax.ArrowFunctionExpression,id:null,params:params,defaults:defaults,body:body,rest:rest,generator:false,expression:expression};if(isAsync){arrowExpr.async=true}return arrowExpr},createMethodDefinition:function(propertyType,kind,key,value){return{type:Syntax.MethodDefinition,key:key,value:value,kind:kind,static:propertyType===ClassPropertyType.static}},createClassProperty:function(key,typeAnnotation,computed,isStatic){return{type:Syntax.ClassProperty,key:key,typeAnnotation:typeAnnotation,computed:computed,static:isStatic}},createClassBody:function(body){return{type:Syntax.ClassBody,body:body}},createClassImplements:function(id,typeParameters){return{type:Syntax.ClassImplements,id:id,typeParameters:typeParameters}},createClassExpression:function(id,superClass,body,typeParameters,superTypeParameters,implemented){return{type:Syntax.ClassExpression,id:id,superClass:superClass,body:body,typeParameters:typeParameters,superTypeParameters:superTypeParameters,implements:implemented}},createClassDeclaration:function(id,superClass,body,typeParameters,superTypeParameters,implemented){return{type:Syntax.ClassDeclaration,id:id,superClass:superClass,body:body,typeParameters:typeParameters,superTypeParameters:superTypeParameters,implements:implemented}},createModuleSpecifier:function(token){return{type:Syntax.ModuleSpecifier,value:token.value,raw:source.slice(token.range[0],token.range[1])}},createExportSpecifier:function(id,name){return{type:Syntax.ExportSpecifier,id:id,name:name}},createExportBatchSpecifier:function(){return{type:Syntax.ExportBatchSpecifier}},createImportDefaultSpecifier:function(id){return{type:Syntax.ImportDefaultSpecifier,id:id}},createImportNamespaceSpecifier:function(id){return{type:Syntax.ImportNamespaceSpecifier,id:id}},createExportDeclaration:function(isDefault,declaration,specifiers,source){return{type:Syntax.ExportDeclaration,default:!!isDefault,declaration:declaration,specifiers:specifiers,source:source}},createImportSpecifier:function(id,name){return{type:Syntax.ImportSpecifier,id:id,name:name}},createImportDeclaration:function(specifiers,source){return{type:Syntax.ImportDeclaration,specifiers:specifiers,source:source}},createYieldExpression:function(argument,delegate){return{type:Syntax.YieldExpression,argument:argument,delegate:delegate}},createAwaitExpression:function(argument){return{type:Syntax.AwaitExpression,argument:argument}},createComprehensionExpression:function(filter,blocks,body){return{type:Syntax.ComprehensionExpression,filter:filter,blocks:blocks,body:body}}};function peekLineTerminator(){var pos,line,start,found;pos=index;line=lineNumber;start=lineStart;skipComment();found=lineNumber!==line;index=pos;lineNumber=line;lineStart=start;return found}function throwError(token,messageFormat){var error,args=Array.prototype.slice.call(arguments,2),msg=messageFormat.replace(/%(\d)/g,function(whole,index){assert(index<args.length,"Message reference must be in range");return args[index]});if(typeof token.lineNumber==="number"){error=new Error("Line "+token.lineNumber+": "+msg);error.index=token.range[0];error.lineNumber=token.lineNumber;error.column=token.range[0]-lineStart+1}else{error=new Error("Line "+lineNumber+": "+msg);error.index=index;error.lineNumber=lineNumber;error.column=index-lineStart+1}error.description=msg;throw error}function throwErrorTolerant(){try{throwError.apply(null,arguments)}catch(e){if(extra.errors){extra.errors.push(e)}else{throw e}}}function throwUnexpected(token){if(token.type===Token.EOF){throwError(token,Messages.UnexpectedEOS)}if(token.type===Token.NumericLiteral){throwError(token,Messages.UnexpectedNumber)}if(token.type===Token.StringLiteral||token.type===Token.XJSText){throwError(token,Messages.UnexpectedString)}if(token.type===Token.Identifier){throwError(token,Messages.UnexpectedIdentifier)}if(token.type===Token.Keyword){if(isFutureReservedWord(token.value)){throwError(token,Messages.UnexpectedReserved)}else if(strict&&isStrictModeReservedWord(token.value)){throwErrorTolerant(token,Messages.StrictReservedWord);return}throwError(token,Messages.UnexpectedToken,token.value)}if(token.type===Token.Template){throwError(token,Messages.UnexpectedTemplate,token.value.raw)}throwError(token,Messages.UnexpectedToken,token.value)}function expect(value){var token=lex();if(token.type!==Token.Punctuator||token.value!==value){throwUnexpected(token)}}function expectKeyword(keyword,contextual){var token=lex();
if(token.type!==(contextual?Token.Identifier:Token.Keyword)||token.value!==keyword){throwUnexpected(token)}}function expectContextualKeyword(keyword){return expectKeyword(keyword,true)}function match(value){return lookahead.type===Token.Punctuator&&lookahead.value===value}function matchKeyword(keyword,contextual){var expectedType=contextual?Token.Identifier:Token.Keyword;return lookahead.type===expectedType&&lookahead.value===keyword}function matchContextualKeyword(keyword){return matchKeyword(keyword,true)}function matchAssign(){var op;if(lookahead.type!==Token.Punctuator){return false}op=lookahead.value;return op==="="||op==="*="||op==="/="||op==="%="||op==="+="||op==="-="||op==="<<="||op===">>="||op===">>>="||op==="&="||op==="^="||op==="|="}function matchYield(){return state.yieldAllowed&&matchKeyword("yield",!strict)}function matchAsync(){var backtrackToken=lookahead,matches=false;if(matchContextualKeyword("async")){lex();matches=!peekLineTerminator();rewind(backtrackToken)}return matches}function matchAwait(){return state.awaitAllowed&&matchContextualKeyword("await")}function consumeSemicolon(){var line,oldIndex=index,oldLineNumber=lineNumber,oldLineStart=lineStart,oldLookahead=lookahead;if(source.charCodeAt(index)===59){lex();return}line=lineNumber;skipComment();if(lineNumber!==line){index=oldIndex;lineNumber=oldLineNumber;lineStart=oldLineStart;lookahead=oldLookahead;return}if(match(";")){lex();return}if(lookahead.type!==Token.EOF&&!match("}")){throwUnexpected(lookahead)}}function isLeftHandSide(expr){return expr.type===Syntax.Identifier||expr.type===Syntax.MemberExpression}function isAssignableLeftHandSide(expr){return isLeftHandSide(expr)||expr.type===Syntax.ObjectPattern||expr.type===Syntax.ArrayPattern}function parseArrayInitialiser(){var elements=[],blocks=[],filter=null,tmp,possiblecomprehension=true,body,marker=markerCreate();expect("[");while(!match("]")){if(lookahead.value==="for"&&lookahead.type===Token.Keyword){if(!possiblecomprehension){throwError({},Messages.ComprehensionError)}matchKeyword("for");tmp=parseForStatement({ignoreBody:true});tmp.of=tmp.type===Syntax.ForOfStatement;tmp.type=Syntax.ComprehensionBlock;if(tmp.left.kind){throwError({},Messages.ComprehensionError)}blocks.push(tmp)}else if(lookahead.value==="if"&&lookahead.type===Token.Keyword){if(!possiblecomprehension){throwError({},Messages.ComprehensionError)}expectKeyword("if");expect("(");filter=parseExpression();expect(")")}else if(lookahead.value===","&&lookahead.type===Token.Punctuator){possiblecomprehension=false;lex();elements.push(null)}else{tmp=parseSpreadOrAssignmentExpression();elements.push(tmp);if(tmp&&tmp.type===Syntax.SpreadElement){if(!match("]")){throwError({},Messages.ElementAfterSpreadElement)}}else if(!(match("]")||matchKeyword("for")||matchKeyword("if"))){expect(",");possiblecomprehension=false}}}expect("]");if(filter&&!blocks.length){throwError({},Messages.ComprehensionRequiresBlock)}if(blocks.length){if(elements.length!==1){throwError({},Messages.ComprehensionError)}return markerApply(marker,delegate.createComprehensionExpression(filter,blocks,elements[0]))}return markerApply(marker,delegate.createArrayExpression(elements))}function parsePropertyFunction(options){var previousStrict,previousYieldAllowed,previousAwaitAllowed,params,defaults,body,marker=markerCreate();previousStrict=strict;previousYieldAllowed=state.yieldAllowed;state.yieldAllowed=options.generator;previousAwaitAllowed=state.awaitAllowed;state.awaitAllowed=options.async;params=options.params||[];defaults=options.defaults||[];body=parseConciseBody();if(options.name&&strict&&isRestrictedWord(params[0].name)){throwErrorTolerant(options.name,Messages.StrictParamName)}strict=previousStrict;state.yieldAllowed=previousYieldAllowed;state.awaitAllowed=previousAwaitAllowed;return markerApply(marker,delegate.createFunctionExpression(null,params,defaults,body,options.rest||null,options.generator,body.type!==Syntax.BlockStatement,options.async,options.returnType,options.typeParameters))}function parsePropertyMethodFunction(options){var previousStrict,tmp,method;previousStrict=strict;strict=true;tmp=parseParams();if(tmp.stricted){throwErrorTolerant(tmp.stricted,tmp.message)}method=parsePropertyFunction({params:tmp.params,defaults:tmp.defaults,rest:tmp.rest,generator:options.generator,async:options.async,returnType:tmp.returnType,typeParameters:options.typeParameters});strict=previousStrict;return method}function parseObjectPropertyKey(){var marker=markerCreate(),token=lex(),propertyKey,result;if(token.type===Token.StringLiteral||token.type===Token.NumericLiteral){if(strict&&token.octal){throwErrorTolerant(token,Messages.StrictOctalLiteral)}return markerApply(marker,delegate.createLiteral(token))}if(token.type===Token.Punctuator&&token.value==="["){marker=markerCreate();propertyKey=parseAssignmentExpression();result=markerApply(marker,propertyKey);expect("]");return result}return markerApply(marker,delegate.createIdentifier(token.value))}function parseObjectProperty(){var token,key,id,value,param,expr,computed,marker=markerCreate(),returnType;token=lookahead;computed=token.value==="[";if(token.type===Token.Identifier||computed||matchAsync()){id=parseObjectPropertyKey();if(match(":")){lex();return markerApply(marker,delegate.createProperty("init",id,parseAssignmentExpression(),false,false,computed))}if(match("(")){return markerApply(marker,delegate.createProperty("init",id,parsePropertyMethodFunction({generator:false,async:false}),true,false,computed))}if(token.value==="get"){computed=lookahead.value==="[";key=parseObjectPropertyKey();expect("(");expect(")");if(match(":")){returnType=parseTypeAnnotation()}return markerApply(marker,delegate.createProperty("get",key,parsePropertyFunction({generator:false,async:false,returnType:returnType}),false,false,computed))}if(token.value==="set"){computed=lookahead.value==="[";key=parseObjectPropertyKey();expect("(");token=lookahead;param=[parseTypeAnnotatableIdentifier()];expect(")");if(match(":")){returnType=parseTypeAnnotation()}return markerApply(marker,delegate.createProperty("set",key,parsePropertyFunction({params:param,generator:false,async:false,name:token,returnType:returnType}),false,false,computed))}if(token.value==="async"){computed=lookahead.value==="[";key=parseObjectPropertyKey();return markerApply(marker,delegate.createProperty("init",key,parsePropertyMethodFunction({generator:false,async:true}),true,false,computed))}if(computed){throwUnexpected(lookahead)}return markerApply(marker,delegate.createProperty("init",id,id,false,true,false))}if(token.type===Token.EOF||token.type===Token.Punctuator){if(!match("*")){throwUnexpected(token)}lex();computed=lookahead.type===Token.Punctuator&&lookahead.value==="[";id=parseObjectPropertyKey();if(!match("(")){throwUnexpected(lex())}return markerApply(marker,delegate.createProperty("init",id,parsePropertyMethodFunction({generator:true}),true,false,computed))}key=parseObjectPropertyKey();if(match(":")){lex();return markerApply(marker,delegate.createProperty("init",key,parseAssignmentExpression(),false,false,false))}if(match("(")){return markerApply(marker,delegate.createProperty("init",key,parsePropertyMethodFunction({generator:false}),true,false,false))}throwUnexpected(lex())}function parseObjectSpreadProperty(){var marker=markerCreate();expect("...");return markerApply(marker,delegate.createSpreadProperty(parseAssignmentExpression()))}function parseObjectInitialiser(){var properties=[],property,name,key,kind,map={},toString=String,marker=markerCreate();expect("{");while(!match("}")){if(match("...")){property=parseObjectSpreadProperty()}else{property=parseObjectProperty();if(property.key.type===Syntax.Identifier){name=property.key.name}else{name=toString(property.key.value)}kind=property.kind==="init"?PropertyKind.Data:property.kind==="get"?PropertyKind.Get:PropertyKind.Set;key="$"+name;if(Object.prototype.hasOwnProperty.call(map,key)){if(map[key]===PropertyKind.Data){if(strict&&kind===PropertyKind.Data){throwErrorTolerant({},Messages.StrictDuplicateProperty)}else if(kind!==PropertyKind.Data){throwErrorTolerant({},Messages.AccessorDataProperty)}}else{if(kind===PropertyKind.Data){throwErrorTolerant({},Messages.AccessorDataProperty)}else if(map[key]&kind){throwErrorTolerant({},Messages.AccessorGetSet)}}map[key]|=kind}else{map[key]=kind}}properties.push(property);if(!match("}")){expect(",")}}expect("}");return markerApply(marker,delegate.createObjectExpression(properties))}function parseTemplateElement(option){var marker=markerCreate(),token=scanTemplateElement(option);if(strict&&token.octal){throwError(token,Messages.StrictOctalLiteral)}return markerApply(marker,delegate.createTemplateElement({raw:token.value.raw,cooked:token.value.cooked},token.tail))}function parseTemplateLiteral(){var quasi,quasis,expressions,marker=markerCreate();quasi=parseTemplateElement({head:true});quasis=[quasi];expressions=[];while(!quasi.tail){expressions.push(parseExpression());quasi=parseTemplateElement({head:false});quasis.push(quasi)}return markerApply(marker,delegate.createTemplateLiteral(quasis,expressions))}function parseGroupExpression(){var expr;expect("(");++state.parenthesizedCount;expr=parseExpression();expect(")");return expr}function matchAsyncFuncExprOrDecl(){var token;if(matchAsync()){token=lookahead2();if(token.type===Token.Keyword&&token.value==="function"){return true}}return false}function parsePrimaryExpression(){var marker,type,token,expr;type=lookahead.type;if(type===Token.Identifier){marker=markerCreate();return markerApply(marker,delegate.createIdentifier(lex().value))}if(type===Token.StringLiteral||type===Token.NumericLiteral){if(strict&&lookahead.octal){throwErrorTolerant(lookahead,Messages.StrictOctalLiteral)}marker=markerCreate();return markerApply(marker,delegate.createLiteral(lex()))}if(type===Token.Keyword){if(matchKeyword("this")){marker=markerCreate();lex();return markerApply(marker,delegate.createThisExpression())}if(matchKeyword("function")){return parseFunctionExpression()}if(matchKeyword("class")){return parseClassExpression()}if(matchKeyword("super")){marker=markerCreate();lex();return markerApply(marker,delegate.createIdentifier("super"))}}if(type===Token.BooleanLiteral){marker=markerCreate();token=lex();token.value=token.value==="true";return markerApply(marker,delegate.createLiteral(token))}if(type===Token.NullLiteral){marker=markerCreate();token=lex();token.value=null;return markerApply(marker,delegate.createLiteral(token))}if(match("[")){return parseArrayInitialiser()}if(match("{")){return parseObjectInitialiser()}if(match("(")){return parseGroupExpression()}if(match("/")||match("/=")){marker=markerCreate();return markerApply(marker,delegate.createLiteral(scanRegExp()))}if(type===Token.Template){return parseTemplateLiteral()}if(match("<")){return parseXJSElement()}throwUnexpected(lex())}function parseArguments(){var args=[],arg;expect("(");if(!match(")")){while(index<length){arg=parseSpreadOrAssignmentExpression();args.push(arg);if(match(")")){break}else if(arg.type===Syntax.SpreadElement){throwError({},Messages.ElementAfterSpreadElement)}expect(",")}}expect(")");return args}function parseSpreadOrAssignmentExpression(){if(match("...")){var marker=markerCreate();lex();return markerApply(marker,delegate.createSpreadElement(parseAssignmentExpression()))}return parseAssignmentExpression()}function parseNonComputedProperty(){var marker=markerCreate(),token=lex();if(!isIdentifierName(token)){throwUnexpected(token)}return markerApply(marker,delegate.createIdentifier(token.value))}function parseNonComputedMember(){expect(".");return parseNonComputedProperty()}function parseComputedMember(){var expr;expect("[");expr=parseExpression();expect("]");return expr}function parseNewExpression(){var callee,args,marker=markerCreate();expectKeyword("new");callee=parseLeftHandSideExpression();args=match("(")?parseArguments():[];return markerApply(marker,delegate.createNewExpression(callee,args))}function parseLeftHandSideExpressionAllowCall(){var expr,args,marker=markerCreate();expr=matchKeyword("new")?parseNewExpression():parsePrimaryExpression();while(match(".")||match("[")||match("(")||lookahead.type===Token.Template){if(match("(")){args=parseArguments();expr=markerApply(marker,delegate.createCallExpression(expr,args))}else if(match("[")){expr=markerApply(marker,delegate.createMemberExpression("[",expr,parseComputedMember()))}else if(match(".")){expr=markerApply(marker,delegate.createMemberExpression(".",expr,parseNonComputedMember()))}else{expr=markerApply(marker,delegate.createTaggedTemplateExpression(expr,parseTemplateLiteral()))}}return expr}function parseLeftHandSideExpression(){var expr,marker=markerCreate();expr=matchKeyword("new")?parseNewExpression():parsePrimaryExpression();while(match(".")||match("[")||lookahead.type===Token.Template){if(match("[")){expr=markerApply(marker,delegate.createMemberExpression("[",expr,parseComputedMember()))}else if(match(".")){expr=markerApply(marker,delegate.createMemberExpression(".",expr,parseNonComputedMember()))}else{expr=markerApply(marker,delegate.createTaggedTemplateExpression(expr,parseTemplateLiteral()))}}return expr}function parsePostfixExpression(){var marker=markerCreate(),expr=parseLeftHandSideExpressionAllowCall(),token;if(lookahead.type!==Token.Punctuator){return expr}if((match("++")||match("--"))&&!peekLineTerminator()){if(strict&&expr.type===Syntax.Identifier&&isRestrictedWord(expr.name)){throwErrorTolerant({},Messages.StrictLHSPostfix)}if(!isLeftHandSide(expr)){throwError({},Messages.InvalidLHSInAssignment)}token=lex();expr=markerApply(marker,delegate.createPostfixExpression(token.value,expr))}return expr}function parseUnaryExpression(){var marker,token,expr;if(lookahead.type!==Token.Punctuator&&lookahead.type!==Token.Keyword){return parsePostfixExpression()}if(match("++")||match("--")){marker=markerCreate();token=lex();expr=parseUnaryExpression();if(strict&&expr.type===Syntax.Identifier&&isRestrictedWord(expr.name)){throwErrorTolerant({},Messages.StrictLHSPrefix)}if(!isLeftHandSide(expr)){throwError({},Messages.InvalidLHSInAssignment)}return markerApply(marker,delegate.createUnaryExpression(token.value,expr))}if(match("+")||match("-")||match("~")||match("!")){marker=markerCreate();token=lex();expr=parseUnaryExpression();return markerApply(marker,delegate.createUnaryExpression(token.value,expr))}if(matchKeyword("delete")||matchKeyword("void")||matchKeyword("typeof")){marker=markerCreate();token=lex();expr=parseUnaryExpression();expr=markerApply(marker,delegate.createUnaryExpression(token.value,expr));if(strict&&expr.operator==="delete"&&expr.argument.type===Syntax.Identifier){throwErrorTolerant({},Messages.StrictDelete)}return expr}return parsePostfixExpression()}function binaryPrecedence(token,allowIn){var prec=0;if(token.type!==Token.Punctuator&&token.type!==Token.Keyword){return 0}switch(token.value){case"||":prec=1;break;case"&&":prec=2;break;case"|":prec=3;break;case"^":prec=4;break;case"&":prec=5;break;case"==":case"!=":case"===":case"!==":prec=6;break;case"<":case">":case"<=":case">=":case"instanceof":prec=7;break;case"in":prec=allowIn?7:0;break;case"<<":case">>":case">>>":prec=8;break;case"+":case"-":prec=9;break;case"*":case"/":case"%":prec=11;break;default:break}return prec}function parseBinaryExpression(){var expr,token,prec,previousAllowIn,stack,right,operator,left,i,marker,markers;previousAllowIn=state.allowIn;state.allowIn=true;marker=markerCreate();left=parseUnaryExpression();token=lookahead;prec=binaryPrecedence(token,previousAllowIn);if(prec===0){return left}token.prec=prec;lex();markers=[marker,markerCreate()];right=parseUnaryExpression();stack=[left,token,right];while((prec=binaryPrecedence(lookahead,previousAllowIn))>0){while(stack.length>2&&prec<=stack[stack.length-2].prec){right=stack.pop();operator=stack.pop().value;left=stack.pop();expr=delegate.createBinaryExpression(operator,left,right);markers.pop();marker=markers.pop();markerApply(marker,expr);stack.push(expr);markers.push(marker)}token=lex();token.prec=prec;stack.push(token);markers.push(markerCreate());expr=parseUnaryExpression();stack.push(expr)}state.allowIn=previousAllowIn;i=stack.length-1;expr=stack[i];markers.pop();while(i>1){expr=delegate.createBinaryExpression(stack[i-1].value,stack[i-2],expr);i-=2;marker=markers.pop();markerApply(marker,expr)}return expr}function parseConditionalExpression(){var expr,previousAllowIn,consequent,alternate,marker=markerCreate();expr=parseBinaryExpression();if(match("?")){lex();previousAllowIn=state.allowIn;state.allowIn=true;consequent=parseAssignmentExpression();state.allowIn=previousAllowIn;expect(":");alternate=parseAssignmentExpression();expr=markerApply(marker,delegate.createConditionalExpression(expr,consequent,alternate))}return expr}function reinterpretAsAssignmentBindingPattern(expr){var i,len,property,element;if(expr.type===Syntax.ObjectExpression){expr.type=Syntax.ObjectPattern;for(i=0,len=expr.properties.length;i<len;i+=1){property=expr.properties[i];if(property.type===Syntax.SpreadProperty){if(i<len-1){throwError({},Messages.PropertyAfterSpreadProperty)}reinterpretAsAssignmentBindingPattern(property.argument)}else{if(property.kind!=="init"){throwError({},Messages.InvalidLHSInAssignment)}reinterpretAsAssignmentBindingPattern(property.value)}}}else if(expr.type===Syntax.ArrayExpression){expr.type=Syntax.ArrayPattern;for(i=0,len=expr.elements.length;i<len;i+=1){element=expr.elements[i];if(element){reinterpretAsAssignmentBindingPattern(element)}}}else if(expr.type===Syntax.Identifier){if(isRestrictedWord(expr.name)){throwError({},Messages.InvalidLHSInAssignment)}}else if(expr.type===Syntax.SpreadElement){reinterpretAsAssignmentBindingPattern(expr.argument);if(expr.argument.type===Syntax.ObjectPattern){throwError({},Messages.ObjectPatternAsSpread)}}else{if(expr.type!==Syntax.MemberExpression&&expr.type!==Syntax.CallExpression&&expr.type!==Syntax.NewExpression){throwError({},Messages.InvalidLHSInAssignment)}}}function reinterpretAsDestructuredParameter(options,expr){var i,len,property,element;if(expr.type===Syntax.ObjectExpression){expr.type=Syntax.ObjectPattern;for(i=0,len=expr.properties.length;i<len;i+=1){property=expr.properties[i];if(property.type===Syntax.SpreadProperty){if(i<len-1){throwError({},Messages.PropertyAfterSpreadProperty)}reinterpretAsDestructuredParameter(options,property.argument)}else{if(property.kind!=="init"){throwError({},Messages.InvalidLHSInFormalsList)}reinterpretAsDestructuredParameter(options,property.value)}}}else if(expr.type===Syntax.ArrayExpression){expr.type=Syntax.ArrayPattern;for(i=0,len=expr.elements.length;i<len;i+=1){element=expr.elements[i];if(element){reinterpretAsDestructuredParameter(options,element)}}}else if(expr.type===Syntax.Identifier){validateParam(options,expr,expr.name)}else{if(expr.type!==Syntax.MemberExpression){throwError({},Messages.InvalidLHSInFormalsList)}}}function reinterpretAsCoverFormalsList(expressions){var i,len,param,params,defaults,defaultCount,options,rest;params=[];defaults=[];defaultCount=0;rest=null;options={paramSet:{}};for(i=0,len=expressions.length;i<len;i+=1){param=expressions[i];if(param.type===Syntax.Identifier){params.push(param);defaults.push(null);validateParam(options,param,param.name)}else if(param.type===Syntax.ObjectExpression||param.type===Syntax.ArrayExpression){reinterpretAsDestructuredParameter(options,param);params.push(param);defaults.push(null)}else if(param.type===Syntax.SpreadElement){assert(i===len-1,"It is guaranteed that SpreadElement is last element by parseExpression");reinterpretAsDestructuredParameter(options,param.argument);rest=param.argument}else if(param.type===Syntax.AssignmentExpression){params.push(param.left);defaults.push(param.right);++defaultCount;validateParam(options,param.left,param.left.name)}else{return null}}if(options.message===Messages.StrictParamDupe){throwError(strict?options.stricted:options.firstRestricted,options.message)}if(defaultCount===0){defaults=[]}return{params:params,defaults:defaults,rest:rest,stricted:options.stricted,firstRestricted:options.firstRestricted,message:options.message}}function parseArrowFunctionExpression(options,marker){var previousStrict,previousYieldAllowed,previousAwaitAllowed,body;expect("=>");previousStrict=strict;previousYieldAllowed=state.yieldAllowed;state.yieldAllowed=false;previousAwaitAllowed=state.awaitAllowed;state.awaitAllowed=!!options.async;body=parseConciseBody();if(strict&&options.firstRestricted){throwError(options.firstRestricted,options.message)}if(strict&&options.stricted){throwErrorTolerant(options.stricted,options.message)}strict=previousStrict;state.yieldAllowed=previousYieldAllowed;state.awaitAllowed=previousAwaitAllowed;return markerApply(marker,delegate.createArrowFunctionExpression(options.params,options.defaults,body,options.rest,body.type!==Syntax.BlockStatement,!!options.async))}function parseAssignmentExpression(){var marker,expr,token,params,oldParenthesizedCount,backtrackToken=lookahead,possiblyAsync=false;if(matchYield()){return parseYieldExpression()}if(matchAwait()){return parseAwaitExpression()}oldParenthesizedCount=state.parenthesizedCount;marker=markerCreate();if(matchAsyncFuncExprOrDecl()){return parseFunctionExpression()}if(matchAsync()){possiblyAsync=true;lex()}if(match("(")){token=lookahead2();if(token.type===Token.Punctuator&&token.value===")"||token.value==="..."){params=parseParams();if(!match("=>")){throwUnexpected(lex())}params.async=possiblyAsync;return parseArrowFunctionExpression(params,marker)}}token=lookahead;if(possiblyAsync&&!match("(")&&token.type!==Token.Identifier){possiblyAsync=false;rewind(backtrackToken)}expr=parseConditionalExpression();if(match("=>")&&(state.parenthesizedCount===oldParenthesizedCount||state.parenthesizedCount===oldParenthesizedCount+1)){if(expr.type===Syntax.Identifier){params=reinterpretAsCoverFormalsList([expr])}else if(expr.type===Syntax.SequenceExpression){params=reinterpretAsCoverFormalsList(expr.expressions)}if(params){params.async=possiblyAsync;return parseArrowFunctionExpression(params,marker)}}if(possiblyAsync){possiblyAsync=false;rewind(backtrackToken);expr=parseConditionalExpression()}if(matchAssign()){if(strict&&expr.type===Syntax.Identifier&&isRestrictedWord(expr.name)){throwErrorTolerant(token,Messages.StrictLHSAssignment)}if(match("=")&&(expr.type===Syntax.ObjectExpression||expr.type===Syntax.ArrayExpression)){reinterpretAsAssignmentBindingPattern(expr)}else if(!isLeftHandSide(expr)){throwError({},Messages.InvalidLHSInAssignment)}expr=markerApply(marker,delegate.createAssignmentExpression(lex().value,expr,parseAssignmentExpression()))}return expr}function parseExpression(){var marker,expr,expressions,sequence,coverFormalsList,spreadFound,oldParenthesizedCount;oldParenthesizedCount=state.parenthesizedCount;marker=markerCreate();expr=parseAssignmentExpression();expressions=[expr];if(match(",")){while(index<length){if(!match(",")){break}lex();expr=parseSpreadOrAssignmentExpression();expressions.push(expr);if(expr.type===Syntax.SpreadElement){spreadFound=true;if(!match(")")){throwError({},Messages.ElementAfterSpreadElement)}break}}sequence=markerApply(marker,delegate.createSequenceExpression(expressions))}if(match("=>")){if(state.parenthesizedCount===oldParenthesizedCount||state.parenthesizedCount===oldParenthesizedCount+1){expr=expr.type===Syntax.SequenceExpression?expr.expressions:expressions;coverFormalsList=reinterpretAsCoverFormalsList(expr);if(coverFormalsList){return parseArrowFunctionExpression(coverFormalsList,marker)}}throwUnexpected(lex())}if(spreadFound&&lookahead2().value!=="=>"){throwError({},Messages.IllegalSpread)}return sequence||expr}function parseStatementList(){var list=[],statement;while(index<length){if(match("}")){break}statement=parseSourceElement();if(typeof statement==="undefined"){break}list.push(statement)}return list}function parseBlock(){var block,marker=markerCreate();expect("{");block=parseStatementList();expect("}");return markerApply(marker,delegate.createBlockStatement(block))}function parseTypeParameterDeclaration(){var marker=markerCreate(),paramTypes=[];expect("<");while(!match(">")){paramTypes.push(parseVariableIdentifier());if(!match(">")){expect(",")}}expect(">");return markerApply(marker,delegate.createTypeParameterDeclaration(paramTypes))}function parseTypeParameterInstantiation(){var marker=markerCreate(),oldInType=state.inType,paramTypes=[];state.inType=true;expect("<");while(!match(">")){paramTypes.push(parseType());if(!match(">")){expect(",")}}expect(">");state.inType=oldInType;return markerApply(marker,delegate.createTypeParameterInstantiation(paramTypes))}function parseObjectTypeIndexer(marker,isStatic){var id,key,value;expect("[");id=parseObjectPropertyKey();expect(":");key=parseType();expect("]");expect(":");value=parseType();return markerApply(marker,delegate.createObjectTypeIndexer(id,key,value,isStatic))}function parseObjectTypeMethodish(marker){var params=[],rest=null,returnType,typeParameters=null;if(match("<")){typeParameters=parseTypeParameterDeclaration()}expect("(");while(lookahead.type===Token.Identifier){params.push(parseFunctionTypeParam());if(!match(")")){expect(",")}}if(match("...")){lex();rest=parseFunctionTypeParam()}expect(")");expect(":");returnType=parseType();return markerApply(marker,delegate.createFunctionTypeAnnotation(params,returnType,rest,typeParameters))}function parseObjectTypeMethod(marker,isStatic,key){var optional=false,value;value=parseObjectTypeMethodish(marker);return markerApply(marker,delegate.createObjectTypeProperty(key,value,optional,isStatic))}function parseObjectTypeCallProperty(marker,isStatic){var valueMarker=markerCreate();return markerApply(marker,delegate.createObjectTypeCallProperty(parseObjectTypeMethodish(valueMarker),isStatic))}function parseObjectType(allowStatic){var callProperties=[],indexers=[],marker,optional=false,properties=[],property,propertyKey,propertyTypeAnnotation,token,isStatic;expect("{");while(!match("}")){marker=markerCreate();if(allowStatic&&matchContextualKeyword("static")){token=lex();isStatic=true}if(match("[")){indexers.push(parseObjectTypeIndexer(marker,isStatic))}else if(match("(")||match("<")){callProperties.push(parseObjectTypeCallProperty(marker,allowStatic))}else{if(isStatic&&match(":")){propertyKey=markerApply(marker,delegate.createIdentifier(token));throwErrorTolerant(token,Messages.StrictReservedWord)}else{propertyKey=parseObjectPropertyKey()}if(match("<")||match("(")){properties.push(parseObjectTypeMethod(marker,isStatic,propertyKey))}else{if(match("?")){lex();optional=true}expect(":");propertyTypeAnnotation=parseType();properties.push(markerApply(marker,delegate.createObjectTypeProperty(propertyKey,propertyTypeAnnotation,optional,isStatic)))}}if(match(";")){lex()}else if(!match("}")){throwUnexpected(lookahead)}}expect("}");return delegate.createObjectTypeAnnotation(properties,indexers,callProperties)}function parseGenericType(){var marker=markerCreate(),returnType=null,typeParameters=null,typeIdentifier,typeIdentifierMarker=markerCreate;typeIdentifier=parseVariableIdentifier();while(match(".")){expect(".");typeIdentifier=markerApply(marker,delegate.createQualifiedTypeIdentifier(typeIdentifier,parseVariableIdentifier()))}if(match("<")){typeParameters=parseTypeParameterInstantiation()}return markerApply(marker,delegate.createGenericTypeAnnotation(typeIdentifier,typeParameters))}function parseVoidType(){var marker=markerCreate();expectKeyword("void");return markerApply(marker,delegate.createVoidTypeAnnotation())}function parseTypeofType(){var argument,marker=markerCreate();expectKeyword("typeof");argument=parsePrimaryType();return markerApply(marker,delegate.createTypeofTypeAnnotation(argument))}function parseTupleType(){var marker=markerCreate(),types=[];expect("[");while(index<length&&!match("]")){types.push(parseType());if(match("]")){break}expect(",")}expect("]");return markerApply(marker,delegate.createTupleTypeAnnotation(types))}function parseFunctionTypeParam(){var marker=markerCreate(),name,optional=false,typeAnnotation;name=parseVariableIdentifier();if(match("?")){lex();optional=true}expect(":");typeAnnotation=parseType();return markerApply(marker,delegate.createFunctionTypeParam(name,typeAnnotation,optional))}function parseFunctionTypeParams(){var ret={params:[],rest:null};while(lookahead.type===Token.Identifier){ret.params.push(parseFunctionTypeParam());if(!match(")")){expect(",")}}if(match("...")){lex();ret.rest=parseFunctionTypeParam()}return ret}function parsePrimaryType(){var typeIdentifier=null,params=null,returnType=null,marker=markerCreate(),rest=null,tmp,typeParameters,token,type,isGroupedType=false;switch(lookahead.type){case Token.Identifier:switch(lookahead.value){case"any":lex();return markerApply(marker,delegate.createAnyTypeAnnotation());case"bool":case"boolean":lex();return markerApply(marker,delegate.createBooleanTypeAnnotation());case"number":lex();return markerApply(marker,delegate.createNumberTypeAnnotation());case"string":lex();return markerApply(marker,delegate.createStringTypeAnnotation())}return markerApply(marker,parseGenericType());case Token.Punctuator:switch(lookahead.value){case"{":return markerApply(marker,parseObjectType());case"[":return parseTupleType();case"<":typeParameters=parseTypeParameterDeclaration();expect("(");tmp=parseFunctionTypeParams();params=tmp.params;rest=tmp.rest;expect(")");expect("=>");returnType=parseType();return markerApply(marker,delegate.createFunctionTypeAnnotation(params,returnType,rest,typeParameters));case"(":lex();if(!match(")")&&!match("...")){if(lookahead.type===Token.Identifier){token=lookahead2();isGroupedType=token.value!=="?"&&token.value!==":"}else{isGroupedType=true}}if(isGroupedType){type=parseType();expect(")");if(match("=>")){throwError({},Messages.ConfusedAboutFunctionType)}return type}tmp=parseFunctionTypeParams();params=tmp.params;rest=tmp.rest;expect(")");expect("=>");returnType=parseType();return markerApply(marker,delegate.createFunctionTypeAnnotation(params,returnType,rest,null))}break;case Token.Keyword:switch(lookahead.value){case"void":return markerApply(marker,parseVoidType());case"typeof":return markerApply(marker,parseTypeofType())}break;case Token.StringLiteral:token=lex();if(token.octal){throwError(token,Messages.StrictOctalLiteral)}return markerApply(marker,delegate.createStringLiteralTypeAnnotation(token))}throwUnexpected(lookahead)}function parsePostfixType(){var marker=markerCreate(),t=parsePrimaryType();if(match("[")){expect("[");expect("]");return markerApply(marker,delegate.createArrayTypeAnnotation(t))}return t}function parsePrefixType(){var marker=markerCreate();if(match("?")){lex();return markerApply(marker,delegate.createNullableTypeAnnotation(parsePrefixType()))}return parsePostfixType()}function parseIntersectionType(){var marker=markerCreate(),type,types;type=parsePrefixType();types=[type];while(match("&")){lex();types.push(parsePrefixType())}return types.length===1?type:markerApply(marker,delegate.createIntersectionTypeAnnotation(types))}function parseUnionType(){var marker=markerCreate(),type,types;type=parseIntersectionType();types=[type];while(match("|")){lex();types.push(parseIntersectionType())}return types.length===1?type:markerApply(marker,delegate.createUnionTypeAnnotation(types))}function parseType(){var oldInType=state.inType,type;state.inType=true;type=parseUnionType();state.inType=oldInType;return type}function parseTypeAnnotation(){var marker=markerCreate(),type;expect(":");type=parseType();return markerApply(marker,delegate.createTypeAnnotation(type))}function parseVariableIdentifier(){var marker=markerCreate(),token=lex();if(token.type!==Token.Identifier){throwUnexpected(token)}return markerApply(marker,delegate.createIdentifier(token.value))}function parseTypeAnnotatableIdentifier(requireTypeAnnotation,canBeOptionalParam){var marker=markerCreate(),ident=parseVariableIdentifier(),isOptionalParam=false;if(canBeOptionalParam&&match("?")){expect("?");isOptionalParam=true
}if(requireTypeAnnotation||match(":")){ident.typeAnnotation=parseTypeAnnotation();ident=markerApply(marker,ident)}if(isOptionalParam){ident.optional=true;ident=markerApply(marker,ident)}return ident}function parseVariableDeclaration(kind){var id,marker=markerCreate(),init=null,typeAnnotationMarker=markerCreate();if(match("{")){id=parseObjectInitialiser();reinterpretAsAssignmentBindingPattern(id);if(match(":")){id.typeAnnotation=parseTypeAnnotation();markerApply(typeAnnotationMarker,id)}}else if(match("[")){id=parseArrayInitialiser();reinterpretAsAssignmentBindingPattern(id);if(match(":")){id.typeAnnotation=parseTypeAnnotation();markerApply(typeAnnotationMarker,id)}}else{id=state.allowKeyword?parseNonComputedProperty():parseTypeAnnotatableIdentifier();if(strict&&isRestrictedWord(id.name)){throwErrorTolerant({},Messages.StrictVarName)}}if(kind==="const"){if(!match("=")){throwError({},Messages.NoUnintializedConst)}expect("=");init=parseAssignmentExpression()}else if(match("=")){lex();init=parseAssignmentExpression()}return markerApply(marker,delegate.createVariableDeclarator(id,init))}function parseVariableDeclarationList(kind){var list=[];do{list.push(parseVariableDeclaration(kind));if(!match(",")){break}lex()}while(index<length);return list}function parseVariableStatement(){var declarations,marker=markerCreate();expectKeyword("var");declarations=parseVariableDeclarationList();consumeSemicolon();return markerApply(marker,delegate.createVariableDeclaration(declarations,"var"))}function parseConstLetDeclaration(kind){var declarations,marker=markerCreate();expectKeyword(kind);declarations=parseVariableDeclarationList(kind);consumeSemicolon();return markerApply(marker,delegate.createVariableDeclaration(declarations,kind))}function parseModuleSpecifier(){var marker=markerCreate(),specifier;if(lookahead.type!==Token.StringLiteral){throwError({},Messages.InvalidModuleSpecifier)}specifier=delegate.createModuleSpecifier(lookahead);lex();return markerApply(marker,specifier)}function parseExportBatchSpecifier(){var marker=markerCreate();expect("*");return markerApply(marker,delegate.createExportBatchSpecifier())}function parseExportSpecifier(){var id,name=null,marker=markerCreate(),from;if(matchKeyword("default")){lex();id=markerApply(marker,delegate.createIdentifier("default"))}else{id=parseVariableIdentifier()}if(matchContextualKeyword("as")){lex();name=parseNonComputedProperty()}return markerApply(marker,delegate.createExportSpecifier(id,name))}function parseExportDeclaration(){var backtrackToken,id,previousAllowKeyword,declaration=null,isExportFromIdentifier,src=null,specifiers=[],marker=markerCreate();expectKeyword("export");if(matchKeyword("default")){lex();if(matchKeyword("function")||matchKeyword("class")){backtrackToken=lookahead;lex();if(isIdentifierName(lookahead)){id=parseNonComputedProperty();rewind(backtrackToken);return markerApply(marker,delegate.createExportDeclaration(true,parseSourceElement(),[id],null))}rewind(backtrackToken);switch(lookahead.value){case"class":return markerApply(marker,delegate.createExportDeclaration(true,parseClassExpression(),[],null));case"function":return markerApply(marker,delegate.createExportDeclaration(true,parseFunctionExpression(),[],null))}}if(matchContextualKeyword("from")){throwError({},Messages.UnexpectedToken,lookahead.value)}if(match("{")){declaration=parseObjectInitialiser()}else if(match("[")){declaration=parseArrayInitialiser()}else{declaration=parseAssignmentExpression()}consumeSemicolon();return markerApply(marker,delegate.createExportDeclaration(true,declaration,[],null))}if(lookahead.type===Token.Keyword){switch(lookahead.value){case"let":case"const":case"var":case"class":case"function":return markerApply(marker,delegate.createExportDeclaration(false,parseSourceElement(),specifiers,null))}}if(match("*")){specifiers.push(parseExportBatchSpecifier());if(!matchContextualKeyword("from")){throwError({},lookahead.value?Messages.UnexpectedToken:Messages.MissingFromClause,lookahead.value)}lex();src=parseModuleSpecifier();consumeSemicolon();return markerApply(marker,delegate.createExportDeclaration(false,null,specifiers,src))}expect("{");do{isExportFromIdentifier=isExportFromIdentifier||matchKeyword("default");specifiers.push(parseExportSpecifier())}while(match(",")&&lex());expect("}");if(matchContextualKeyword("from")){lex();src=parseModuleSpecifier();consumeSemicolon()}else if(isExportFromIdentifier){throwError({},lookahead.value?Messages.UnexpectedToken:Messages.MissingFromClause,lookahead.value)}else{consumeSemicolon()}return markerApply(marker,delegate.createExportDeclaration(false,declaration,specifiers,src))}function parseImportSpecifier(){var id,name=null,marker=markerCreate();id=parseNonComputedProperty();if(matchContextualKeyword("as")){lex();name=parseVariableIdentifier()}return markerApply(marker,delegate.createImportSpecifier(id,name))}function parseNamedImports(){var specifiers=[];expect("{");do{specifiers.push(parseImportSpecifier())}while(match(",")&&lex());expect("}");return specifiers}function parseImportDefaultSpecifier(){var id,marker=markerCreate();id=parseNonComputedProperty();return markerApply(marker,delegate.createImportDefaultSpecifier(id))}function parseImportNamespaceSpecifier(){var id,marker=markerCreate();expect("*");if(!matchContextualKeyword("as")){throwError({},Messages.NoAsAfterImportNamespace)}lex();id=parseNonComputedProperty();return markerApply(marker,delegate.createImportNamespaceSpecifier(id))}function parseImportDeclaration(){var specifiers,src,marker=markerCreate();expectKeyword("import");specifiers=[];if(lookahead.type===Token.StringLiteral){src=parseModuleSpecifier();consumeSemicolon();return markerApply(marker,delegate.createImportDeclaration(specifiers,src))}if(!matchKeyword("default")&&isIdentifierName(lookahead)){specifiers.push(parseImportDefaultSpecifier());if(match(",")){lex()}}if(match("*")){specifiers.push(parseImportNamespaceSpecifier())}else if(match("{")){specifiers=specifiers.concat(parseNamedImports())}if(!matchContextualKeyword("from")){throwError({},lookahead.value?Messages.UnexpectedToken:Messages.MissingFromClause,lookahead.value)}lex();src=parseModuleSpecifier();consumeSemicolon();return markerApply(marker,delegate.createImportDeclaration(specifiers,src))}function parseEmptyStatement(){var marker=markerCreate();expect(";");return markerApply(marker,delegate.createEmptyStatement())}function parseExpressionStatement(){var marker=markerCreate(),expr=parseExpression();consumeSemicolon();return markerApply(marker,delegate.createExpressionStatement(expr))}function parseIfStatement(){var test,consequent,alternate,marker=markerCreate();expectKeyword("if");expect("(");test=parseExpression();expect(")");consequent=parseStatement();if(matchKeyword("else")){lex();alternate=parseStatement()}else{alternate=null}return markerApply(marker,delegate.createIfStatement(test,consequent,alternate))}function parseDoWhileStatement(){var body,test,oldInIteration,marker=markerCreate();expectKeyword("do");oldInIteration=state.inIteration;state.inIteration=true;body=parseStatement();state.inIteration=oldInIteration;expectKeyword("while");expect("(");test=parseExpression();expect(")");if(match(";")){lex()}return markerApply(marker,delegate.createDoWhileStatement(body,test))}function parseWhileStatement(){var test,body,oldInIteration,marker=markerCreate();expectKeyword("while");expect("(");test=parseExpression();expect(")");oldInIteration=state.inIteration;state.inIteration=true;body=parseStatement();state.inIteration=oldInIteration;return markerApply(marker,delegate.createWhileStatement(test,body))}function parseForVariableDeclaration(){var marker=markerCreate(),token=lex(),declarations=parseVariableDeclarationList();return markerApply(marker,delegate.createVariableDeclaration(declarations,token.value))}function parseForStatement(opts){var init,test,update,left,right,body,operator,oldInIteration,marker=markerCreate();init=test=update=null;expectKeyword("for");if(matchContextualKeyword("each")){throwError({},Messages.EachNotAllowed)}expect("(");if(match(";")){lex()}else{if(matchKeyword("var")||matchKeyword("let")||matchKeyword("const")){state.allowIn=false;init=parseForVariableDeclaration();state.allowIn=true;if(init.declarations.length===1){if(matchKeyword("in")||matchContextualKeyword("of")){operator=lookahead;if(!((operator.value==="in"||init.kind!=="var")&&init.declarations[0].init)){lex();left=init;right=parseExpression();init=null}}}}else{state.allowIn=false;init=parseExpression();state.allowIn=true;if(matchContextualKeyword("of")){operator=lex();left=init;right=parseExpression();init=null}else if(matchKeyword("in")){if(!isAssignableLeftHandSide(init)){throwError({},Messages.InvalidLHSInForIn)}operator=lex();left=init;right=parseExpression();init=null}}if(typeof left==="undefined"){expect(";")}}if(typeof left==="undefined"){if(!match(";")){test=parseExpression()}expect(";");if(!match(")")){update=parseExpression()}}expect(")");oldInIteration=state.inIteration;state.inIteration=true;if(!(opts!==undefined&&opts.ignoreBody)){body=parseStatement()}state.inIteration=oldInIteration;if(typeof left==="undefined"){return markerApply(marker,delegate.createForStatement(init,test,update,body))}if(operator.value==="in"){return markerApply(marker,delegate.createForInStatement(left,right,body))}return markerApply(marker,delegate.createForOfStatement(left,right,body))}function parseContinueStatement(){var label=null,key,marker=markerCreate();expectKeyword("continue");if(source.charCodeAt(index)===59){lex();if(!state.inIteration){throwError({},Messages.IllegalContinue)}return markerApply(marker,delegate.createContinueStatement(null))}if(peekLineTerminator()){if(!state.inIteration){throwError({},Messages.IllegalContinue)}return markerApply(marker,delegate.createContinueStatement(null))}if(lookahead.type===Token.Identifier){label=parseVariableIdentifier();key="$"+label.name;if(!Object.prototype.hasOwnProperty.call(state.labelSet,key)){throwError({},Messages.UnknownLabel,label.name)}}consumeSemicolon();if(label===null&&!state.inIteration){throwError({},Messages.IllegalContinue)}return markerApply(marker,delegate.createContinueStatement(label))}function parseBreakStatement(){var label=null,key,marker=markerCreate();expectKeyword("break");if(source.charCodeAt(index)===59){lex();if(!(state.inIteration||state.inSwitch)){throwError({},Messages.IllegalBreak)}return markerApply(marker,delegate.createBreakStatement(null))}if(peekLineTerminator()){if(!(state.inIteration||state.inSwitch)){throwError({},Messages.IllegalBreak)}return markerApply(marker,delegate.createBreakStatement(null))}if(lookahead.type===Token.Identifier){label=parseVariableIdentifier();key="$"+label.name;if(!Object.prototype.hasOwnProperty.call(state.labelSet,key)){throwError({},Messages.UnknownLabel,label.name)}}consumeSemicolon();if(label===null&&!(state.inIteration||state.inSwitch)){throwError({},Messages.IllegalBreak)}return markerApply(marker,delegate.createBreakStatement(label))}function parseReturnStatement(){var argument=null,marker=markerCreate();expectKeyword("return");if(!state.inFunctionBody){throwErrorTolerant({},Messages.IllegalReturn)}if(source.charCodeAt(index)===32){if(isIdentifierStart(source.charCodeAt(index+1))){argument=parseExpression();consumeSemicolon();return markerApply(marker,delegate.createReturnStatement(argument))}}if(peekLineTerminator()){return markerApply(marker,delegate.createReturnStatement(null))}if(!match(";")){if(!match("}")&&lookahead.type!==Token.EOF){argument=parseExpression()}}consumeSemicolon();return markerApply(marker,delegate.createReturnStatement(argument))}function parseWithStatement(){var object,body,marker=markerCreate();if(strict){throwErrorTolerant({},Messages.StrictModeWith)}expectKeyword("with");expect("(");object=parseExpression();expect(")");body=parseStatement();return markerApply(marker,delegate.createWithStatement(object,body))}function parseSwitchCase(){var test,consequent=[],sourceElement,marker=markerCreate();if(matchKeyword("default")){lex();test=null}else{expectKeyword("case");test=parseExpression()}expect(":");while(index<length){if(match("}")||matchKeyword("default")||matchKeyword("case")){break}sourceElement=parseSourceElement();if(typeof sourceElement==="undefined"){break}consequent.push(sourceElement)}return markerApply(marker,delegate.createSwitchCase(test,consequent))}function parseSwitchStatement(){var discriminant,cases,clause,oldInSwitch,defaultFound,marker=markerCreate();expectKeyword("switch");expect("(");discriminant=parseExpression();expect(")");expect("{");cases=[];if(match("}")){lex();return markerApply(marker,delegate.createSwitchStatement(discriminant,cases))}oldInSwitch=state.inSwitch;state.inSwitch=true;defaultFound=false;while(index<length){if(match("}")){break}clause=parseSwitchCase();if(clause.test===null){if(defaultFound){throwError({},Messages.MultipleDefaultsInSwitch)}defaultFound=true}cases.push(clause)}state.inSwitch=oldInSwitch;expect("}");return markerApply(marker,delegate.createSwitchStatement(discriminant,cases))}function parseThrowStatement(){var argument,marker=markerCreate();expectKeyword("throw");if(peekLineTerminator()){throwError({},Messages.NewlineAfterThrow)}argument=parseExpression();consumeSemicolon();return markerApply(marker,delegate.createThrowStatement(argument))}function parseCatchClause(){var param,body,marker=markerCreate();expectKeyword("catch");expect("(");if(match(")")){throwUnexpected(lookahead)}param=parseExpression();if(strict&&param.type===Syntax.Identifier&&isRestrictedWord(param.name)){throwErrorTolerant({},Messages.StrictCatchVariable)}expect(")");body=parseBlock();return markerApply(marker,delegate.createCatchClause(param,body))}function parseTryStatement(){var block,handlers=[],finalizer=null,marker=markerCreate();expectKeyword("try");block=parseBlock();if(matchKeyword("catch")){handlers.push(parseCatchClause())}if(matchKeyword("finally")){lex();finalizer=parseBlock()}if(handlers.length===0&&!finalizer){throwError({},Messages.NoCatchOrFinally)}return markerApply(marker,delegate.createTryStatement(block,[],handlers,finalizer))}function parseDebuggerStatement(){var marker=markerCreate();expectKeyword("debugger");consumeSemicolon();return markerApply(marker,delegate.createDebuggerStatement())}function parseStatement(){var type=lookahead.type,marker,expr,labeledBody,key;if(type===Token.EOF){throwUnexpected(lookahead)}if(type===Token.Punctuator){switch(lookahead.value){case";":return parseEmptyStatement();case"{":return parseBlock();case"(":return parseExpressionStatement();default:break}}if(type===Token.Keyword){switch(lookahead.value){case"break":return parseBreakStatement();case"continue":return parseContinueStatement();case"debugger":return parseDebuggerStatement();case"do":return parseDoWhileStatement();case"for":return parseForStatement();case"function":return parseFunctionDeclaration();case"class":return parseClassDeclaration();case"if":return parseIfStatement();case"return":return parseReturnStatement();case"switch":return parseSwitchStatement();case"throw":return parseThrowStatement();case"try":return parseTryStatement();case"var":return parseVariableStatement();case"while":return parseWhileStatement();case"with":return parseWithStatement();default:break}}if(matchAsyncFuncExprOrDecl()){return parseFunctionDeclaration()}marker=markerCreate();expr=parseExpression();if(expr.type===Syntax.Identifier&&match(":")){lex();key="$"+expr.name;if(Object.prototype.hasOwnProperty.call(state.labelSet,key)){throwError({},Messages.Redeclaration,"Label",expr.name)}state.labelSet[key]=true;labeledBody=parseStatement();delete state.labelSet[key];return markerApply(marker,delegate.createLabeledStatement(expr,labeledBody))}consumeSemicolon();return markerApply(marker,delegate.createExpressionStatement(expr))}function parseConciseBody(){if(match("{")){return parseFunctionSourceElements()}return parseAssignmentExpression()}function parseFunctionSourceElements(){var sourceElement,sourceElements=[],token,directive,firstRestricted,oldLabelSet,oldInIteration,oldInSwitch,oldInFunctionBody,oldParenthesizedCount,marker=markerCreate();expect("{");while(index<length){if(lookahead.type!==Token.StringLiteral){break}token=lookahead;sourceElement=parseSourceElement();sourceElements.push(sourceElement);if(sourceElement.expression.type!==Syntax.Literal){break}directive=source.slice(token.range[0]+1,token.range[1]-1);if(directive==="use strict"){strict=true;if(firstRestricted){throwErrorTolerant(firstRestricted,Messages.StrictOctalLiteral)}}else{if(!firstRestricted&&token.octal){firstRestricted=token}}}oldLabelSet=state.labelSet;oldInIteration=state.inIteration;oldInSwitch=state.inSwitch;oldInFunctionBody=state.inFunctionBody;oldParenthesizedCount=state.parenthesizedCount;state.labelSet={};state.inIteration=false;state.inSwitch=false;state.inFunctionBody=true;state.parenthesizedCount=0;while(index<length){if(match("}")){break}sourceElement=parseSourceElement();if(typeof sourceElement==="undefined"){break}sourceElements.push(sourceElement)}expect("}");state.labelSet=oldLabelSet;state.inIteration=oldInIteration;state.inSwitch=oldInSwitch;state.inFunctionBody=oldInFunctionBody;state.parenthesizedCount=oldParenthesizedCount;return markerApply(marker,delegate.createBlockStatement(sourceElements))}function validateParam(options,param,name){var key="$"+name;if(strict){if(isRestrictedWord(name)){options.stricted=param;options.message=Messages.StrictParamName}if(Object.prototype.hasOwnProperty.call(options.paramSet,key)){options.stricted=param;options.message=Messages.StrictParamDupe}}else if(!options.firstRestricted){if(isRestrictedWord(name)){options.firstRestricted=param;options.message=Messages.StrictParamName}else if(isStrictModeReservedWord(name)){options.firstRestricted=param;options.message=Messages.StrictReservedWord}else if(Object.prototype.hasOwnProperty.call(options.paramSet,key)){options.firstRestricted=param;options.message=Messages.StrictParamDupe}}options.paramSet[key]=true}function parseParam(options){var marker,token,rest,param,def;token=lookahead;if(token.value==="..."){token=lex();rest=true}if(match("[")){marker=markerCreate();param=parseArrayInitialiser();reinterpretAsDestructuredParameter(options,param);if(match(":")){param.typeAnnotation=parseTypeAnnotation();markerApply(marker,param)}}else if(match("{")){marker=markerCreate();if(rest){throwError({},Messages.ObjectPatternAsRestParameter)}param=parseObjectInitialiser();reinterpretAsDestructuredParameter(options,param);if(match(":")){param.typeAnnotation=parseTypeAnnotation();markerApply(marker,param)}}else{param=rest?parseTypeAnnotatableIdentifier(false,false):parseTypeAnnotatableIdentifier(false,true);validateParam(options,token,token.value)}if(match("=")){if(rest){throwErrorTolerant(lookahead,Messages.DefaultRestParameter)}lex();def=parseAssignmentExpression();++options.defaultCount}if(rest){if(!match(")")){throwError({},Messages.ParameterAfterRestParameter)}options.rest=param;return false}options.params.push(param);options.defaults.push(def);return!match(")")}function parseParams(firstRestricted){var options,marker=markerCreate();options={params:[],defaultCount:0,defaults:[],rest:null,firstRestricted:firstRestricted};expect("(");if(!match(")")){options.paramSet={};while(index<length){if(!parseParam(options)){break}expect(",")}}expect(")");if(options.defaultCount===0){options.defaults=[]}if(match(":")){options.returnType=parseTypeAnnotation()}return markerApply(marker,options)}function parseFunctionDeclaration(){var id,body,token,tmp,firstRestricted,message,generator,isAsync,previousStrict,previousYieldAllowed,previousAwaitAllowed,marker=markerCreate(),typeParameters;isAsync=false;if(matchAsync()){lex();isAsync=true}expectKeyword("function");generator=false;if(match("*")){lex();generator=true}token=lookahead;id=parseVariableIdentifier();if(match("<")){typeParameters=parseTypeParameterDeclaration()}if(strict){if(isRestrictedWord(token.value)){throwErrorTolerant(token,Messages.StrictFunctionName)}}else{if(isRestrictedWord(token.value)){firstRestricted=token;message=Messages.StrictFunctionName}else if(isStrictModeReservedWord(token.value)){firstRestricted=token;message=Messages.StrictReservedWord}}tmp=parseParams(firstRestricted);firstRestricted=tmp.firstRestricted;if(tmp.message){message=tmp.message}previousStrict=strict;previousYieldAllowed=state.yieldAllowed;state.yieldAllowed=generator;previousAwaitAllowed=state.awaitAllowed;state.awaitAllowed=isAsync;body=parseFunctionSourceElements();if(strict&&firstRestricted){throwError(firstRestricted,message)}if(strict&&tmp.stricted){throwErrorTolerant(tmp.stricted,message)}strict=previousStrict;state.yieldAllowed=previousYieldAllowed;state.awaitAllowed=previousAwaitAllowed;return markerApply(marker,delegate.createFunctionDeclaration(id,tmp.params,tmp.defaults,body,tmp.rest,generator,false,isAsync,tmp.returnType,typeParameters))}function parseFunctionExpression(){var token,id=null,firstRestricted,message,tmp,body,generator,isAsync,previousStrict,previousYieldAllowed,previousAwaitAllowed,marker=markerCreate(),typeParameters;isAsync=false;if(matchAsync()){lex();isAsync=true}expectKeyword("function");generator=false;if(match("*")){lex();generator=true}if(!match("(")){if(!match("<")){token=lookahead;id=parseVariableIdentifier();if(strict){if(isRestrictedWord(token.value)){throwErrorTolerant(token,Messages.StrictFunctionName)}}else{if(isRestrictedWord(token.value)){firstRestricted=token;message=Messages.StrictFunctionName}else if(isStrictModeReservedWord(token.value)){firstRestricted=token;message=Messages.StrictReservedWord}}}if(match("<")){typeParameters=parseTypeParameterDeclaration()}}tmp=parseParams(firstRestricted);firstRestricted=tmp.firstRestricted;if(tmp.message){message=tmp.message}previousStrict=strict;previousYieldAllowed=state.yieldAllowed;state.yieldAllowed=generator;previousAwaitAllowed=state.awaitAllowed;state.awaitAllowed=isAsync;body=parseFunctionSourceElements();if(strict&&firstRestricted){throwError(firstRestricted,message)}if(strict&&tmp.stricted){throwErrorTolerant(tmp.stricted,message)}strict=previousStrict;state.yieldAllowed=previousYieldAllowed;state.awaitAllowed=previousAwaitAllowed;return markerApply(marker,delegate.createFunctionExpression(id,tmp.params,tmp.defaults,body,tmp.rest,generator,false,isAsync,tmp.returnType,typeParameters))}function parseYieldExpression(){var delegateFlag,expr,marker=markerCreate();expectKeyword("yield",!strict);delegateFlag=false;if(match("*")){lex();delegateFlag=true}expr=parseAssignmentExpression();return markerApply(marker,delegate.createYieldExpression(expr,delegateFlag))}function parseAwaitExpression(){var expr,marker=markerCreate();expectContextualKeyword("await");expr=parseAssignmentExpression();return markerApply(marker,delegate.createAwaitExpression(expr))}function parseMethodDefinition(existingPropNames,key,isStatic,generator,computed){var token,param,propType,isValidDuplicateProp=false,isAsync,typeParameters,tokenValue,returnType,annotationMarker;propType=isStatic?ClassPropertyType.static:ClassPropertyType.prototype;if(generator){return delegate.createMethodDefinition(propType,"",key,parsePropertyMethodFunction({generator:true}))}tokenValue=key.type==="Identifier"&&key.name;if(tokenValue==="get"&&!match("(")){key=parseObjectPropertyKey();if(existingPropNames[propType].hasOwnProperty(key.name)){isValidDuplicateProp=existingPropNames[propType][key.name].get===undefined&&existingPropNames[propType][key.name].data===undefined&&existingPropNames[propType][key.name].set!==undefined;if(!isValidDuplicateProp){throwError(key,Messages.IllegalDuplicateClassProperty)}}else{existingPropNames[propType][key.name]={}}existingPropNames[propType][key.name].get=true;expect("(");expect(")");if(match(":")){returnType=parseTypeAnnotation()}return delegate.createMethodDefinition(propType,"get",key,parsePropertyFunction({generator:false,returnType:returnType}))}if(tokenValue==="set"&&!match("(")){key=parseObjectPropertyKey();if(existingPropNames[propType].hasOwnProperty(key.name)){isValidDuplicateProp=existingPropNames[propType][key.name].set===undefined&&existingPropNames[propType][key.name].data===undefined&&existingPropNames[propType][key.name].get!==undefined;if(!isValidDuplicateProp){throwError(key,Messages.IllegalDuplicateClassProperty)}}else{existingPropNames[propType][key.name]={}}existingPropNames[propType][key.name].set=true;expect("(");token=lookahead;param=[parseTypeAnnotatableIdentifier()];expect(")");if(match(":")){returnType=parseTypeAnnotation()}return delegate.createMethodDefinition(propType,"set",key,parsePropertyFunction({params:param,generator:false,name:token,returnType:returnType}))}if(match("<")){typeParameters=parseTypeParameterDeclaration()}isAsync=tokenValue==="async"&&!match("(");if(isAsync){key=parseObjectPropertyKey()}if(existingPropNames[propType].hasOwnProperty(key.name)){throwError(key,Messages.IllegalDuplicateClassProperty)}else{existingPropNames[propType][key.name]={}}existingPropNames[propType][key.name].data=true;return delegate.createMethodDefinition(propType,"",key,parsePropertyMethodFunction({generator:false,async:isAsync,typeParameters:typeParameters}))}function parseClassProperty(existingPropNames,key,computed,isStatic){var typeAnnotation;typeAnnotation=parseTypeAnnotation();expect(";");return delegate.createClassProperty(key,typeAnnotation,computed,isStatic)}function parseClassElement(existingProps){var computed,generator=false,key,marker=markerCreate(),isStatic=false;if(match(";")){lex();return}if(lookahead.value==="static"){lex();isStatic=true}if(match("*")){lex();generator=true}computed=lookahead.value==="[";key=parseObjectPropertyKey();if(!generator&&lookahead.value===":"){return markerApply(marker,parseClassProperty(existingProps,key,computed,isStatic))}return markerApply(marker,parseMethodDefinition(existingProps,key,isStatic,generator,computed))}function parseClassBody(){var classElement,classElements=[],existingProps={},marker=markerCreate();existingProps[ClassPropertyType.static]={};existingProps[ClassPropertyType.prototype]={};expect("{");while(index<length){if(match("}")){break}classElement=parseClassElement(existingProps);if(typeof classElement!=="undefined"){classElements.push(classElement)}}expect("}");return markerApply(marker,delegate.createClassBody(classElements))}function parseClassImplements(){var id,implemented=[],marker,typeParameters;expectContextualKeyword("implements");while(index<length){marker=markerCreate();id=parseVariableIdentifier();if(match("<")){typeParameters=parseTypeParameterInstantiation()}else{typeParameters=null}implemented.push(markerApply(marker,delegate.createClassImplements(id,typeParameters)));if(!match(",")){break}expect(",")}return implemented}function parseClassExpression(){var id,implemented,previousYieldAllowed,superClass=null,superTypeParameters,marker=markerCreate(),typeParameters;expectKeyword("class");if(!matchKeyword("extends")&&!matchContextualKeyword("implements")&&!match("{")){id=parseVariableIdentifier()}if(match("<")){typeParameters=parseTypeParameterDeclaration()}if(matchKeyword("extends")){expectKeyword("extends");previousYieldAllowed=state.yieldAllowed;state.yieldAllowed=false;superClass=parseLeftHandSideExpressionAllowCall();if(match("<")){superTypeParameters=parseTypeParameterInstantiation()}state.yieldAllowed=previousYieldAllowed}if(matchContextualKeyword("implements")){implemented=parseClassImplements()}return markerApply(marker,delegate.createClassExpression(id,superClass,parseClassBody(),typeParameters,superTypeParameters,implemented))}function parseClassDeclaration(){var id,implemented,previousYieldAllowed,superClass=null,superTypeParameters,marker=markerCreate(),typeParameters;expectKeyword("class");id=parseVariableIdentifier();if(match("<")){typeParameters=parseTypeParameterDeclaration()}if(matchKeyword("extends")){expectKeyword("extends");previousYieldAllowed=state.yieldAllowed;state.yieldAllowed=false;superClass=parseLeftHandSideExpressionAllowCall();if(match("<")){superTypeParameters=parseTypeParameterInstantiation()}state.yieldAllowed=previousYieldAllowed}if(matchContextualKeyword("implements")){implemented=parseClassImplements()}return markerApply(marker,delegate.createClassDeclaration(id,superClass,parseClassBody(),typeParameters,superTypeParameters,implemented))}function parseSourceElement(){var token;if(lookahead.type===Token.Keyword){switch(lookahead.value){case"const":case"let":return parseConstLetDeclaration(lookahead.value);case"function":return parseFunctionDeclaration();default:return parseStatement()}}if(matchContextualKeyword("type")&&lookahead2().type===Token.Identifier){return parseTypeAlias()}if(matchContextualKeyword("interface")&&lookahead2().type===Token.Identifier){return parseInterface()}if(matchContextualKeyword("declare")){token=lookahead2();if(token.type===Token.Keyword){switch(token.value){case"class":return parseDeclareClass();case"function":return parseDeclareFunction();case"var":return parseDeclareVariable()}}else if(token.type===Token.Identifier&&token.value==="module"){return parseDeclareModule()}}if(lookahead.type!==Token.EOF){return parseStatement()}}function parseProgramElement(){if(lookahead.type===Token.Keyword){switch(lookahead.value){case"export":return parseExportDeclaration();case"import":return parseImportDeclaration()}}return parseSourceElement()}function parseProgramElements(){var sourceElement,sourceElements=[],token,directive,firstRestricted;while(index<length){token=lookahead;if(token.type!==Token.StringLiteral){break}sourceElement=parseProgramElement();sourceElements.push(sourceElement);if(sourceElement.expression.type!==Syntax.Literal){break}directive=source.slice(token.range[0]+1,token.range[1]-1);if(directive==="use strict"){strict=true;if(firstRestricted){throwErrorTolerant(firstRestricted,Messages.StrictOctalLiteral)}}else{if(!firstRestricted&&token.octal){firstRestricted=token}}}while(index<length){sourceElement=parseProgramElement();if(typeof sourceElement==="undefined"){break}sourceElements.push(sourceElement)}return sourceElements}function parseProgram(){var body,marker=markerCreate();strict=false;peek();body=parseProgramElements();return markerApply(marker,delegate.createProgram(body))}function addComment(type,value,start,end,loc){var comment;assert(typeof start==="number","Comment must have valid position");if(state.lastCommentStart>=start){return}state.lastCommentStart=start;comment={type:type,value:value};if(extra.range){comment.range=[start,end]}if(extra.loc){comment.loc=loc}extra.comments.push(comment);if(extra.attachComment){extra.leadingComments.push(comment);extra.trailingComments.push(comment)}}function scanComment(){var comment,ch,loc,start,blockComment,lineComment;comment="";blockComment=false;lineComment=false;while(index<length){ch=source[index];if(lineComment){ch=source[index++];if(isLineTerminator(ch.charCodeAt(0))){loc.end={line:lineNumber,column:index-lineStart-1};lineComment=false;addComment("Line",comment,start,index-1,loc);if(ch==="\r"&&source[index]==="\n"){++index}++lineNumber;lineStart=index;comment=""}else if(index>=length){lineComment=false;comment+=ch;loc.end={line:lineNumber,column:length-lineStart};addComment("Line",comment,start,length,loc)}else{comment+=ch}}else if(blockComment){if(isLineTerminator(ch.charCodeAt(0))){if(ch==="\r"){++index;comment+="\r"}if(ch!=="\r"||source[index]==="\n"){comment+=source[index];++lineNumber;++index;lineStart=index;if(index>=length){throwError({},Messages.UnexpectedToken,"ILLEGAL")}}}else{ch=source[index++];if(index>=length){throwError({},Messages.UnexpectedToken,"ILLEGAL")}comment+=ch;if(ch==="*"){ch=source[index];if(ch==="/"){comment=comment.substr(0,comment.length-1);blockComment=false;++index;loc.end={line:lineNumber,column:index-lineStart};addComment("Block",comment,start,index,loc);comment=""}}}}else if(ch==="/"){ch=source[index+1];if(ch==="/"){loc={start:{line:lineNumber,column:index-lineStart}};
start=index;index+=2;lineComment=true;if(index>=length){loc.end={line:lineNumber,column:index-lineStart};lineComment=false;addComment("Line",comment,start,index,loc)}}else if(ch==="*"){start=index;index+=2;blockComment=true;loc={start:{line:lineNumber,column:index-lineStart-2}};if(index>=length){throwError({},Messages.UnexpectedToken,"ILLEGAL")}}else{break}}else if(isWhiteSpace(ch.charCodeAt(0))){++index}else if(isLineTerminator(ch.charCodeAt(0))){++index;if(ch==="\r"&&source[index]==="\n"){++index}++lineNumber;lineStart=index}else{break}}}XHTMLEntities={quot:'"',amp:"&",apos:"'",lt:"<",gt:">",nbsp:"",iexcl:"",cent:"",pound:"",curren:"",yen:"",brvbar:"",sect:"",uml:"",copy:"",ordf:"",laquo:"",not:"",shy:"",reg:"",macr:"",deg:"",plusmn:"",sup2:"",sup3:"",acute:"",micro:"",para:"",middot:"",cedil:"",sup1:"",ordm:"",raquo:"",frac14:"",frac12:"",frac34:"",iquest:"",Agrave:"",Aacute:"",Acirc:"",Atilde:"",Auml:"",Aring:"",AElig:"",Ccedil:"",Egrave:"",Eacute:"",Ecirc:"",Euml:"",Igrave:"",Iacute:"",Icirc:"",Iuml:"",ETH:"",Ntilde:"",Ograve:"",Oacute:"",Ocirc:"",Otilde:"",Ouml:"",times:"",Oslash:"",Ugrave:"",Uacute:"",Ucirc:"",Uuml:"",Yacute:"",THORN:"",szlig:"",agrave:"",aacute:"",acirc:"",atilde:"",auml:"",aring:"",aelig:"",ccedil:"",egrave:"",eacute:"",ecirc:"",euml:"",igrave:"",iacute:"",icirc:"",iuml:"",eth:"",ntilde:"",ograve:"",oacute:"",ocirc:"",otilde:"",ouml:"",divide:"",oslash:"",ugrave:"",uacute:"",ucirc:"",uuml:"",yacute:"",thorn:"",yuml:"",OElig:"",oelig:"",Scaron:"",scaron:"",Yuml:"",fnof:"",circ:"",tilde:"",Alpha:"",Beta:"",Gamma:"",Delta:"",Epsilon:"",Zeta:"",Eta:"",Theta:"",Iota:"",Kappa:"",Lambda:"",Mu:"",Nu:"",Xi:"",Omicron:"",Pi:"",Rho:"",Sigma:"",Tau:"",Upsilon:"",Phi:"",Chi:"",Psi:"",Omega:"",alpha:"",beta:"",gamma:"",delta:"",epsilon:"",zeta:"",eta:"",theta:"",iota:"",kappa:"",lambda:"",mu:"",nu:"",xi:"",omicron:"",pi:"",rho:"",sigmaf:"",sigma:"",tau:"",upsilon:"",phi:"",chi:"",psi:"",omega:"",thetasym:"",upsih:"",piv:"",ensp:"",emsp:"",thinsp:"",zwnj:"",zwj:"",lrm:"",rlm:"",ndash:"",mdash:"",lsquo:"",rsquo:"",sbquo:"",ldquo:"",rdquo:"",bdquo:"",dagger:"",Dagger:"",bull:"",hellip:"",permil:"",prime:"",Prime:"",lsaquo:"",rsaquo:"",oline:"",frasl:"",euro:"",image:"",weierp:"",real:"",trade:"",alefsym:"",larr:"",uarr:"",rarr:"",darr:"",harr:"",crarr:"",lArr:"",uArr:"",rArr:"",dArr:"",hArr:"",forall:"",part:"",exist:"",empty:"",nabla:"",isin:"",notin:"",ni:"",prod:"",sum:"",minus:"",lowast:"",radic:"",prop:"",infin:"",ang:"",and:"",or:"",cap:"",cup:"",int:"",there4:"",sim:"",cong:"",asymp:"",ne:"",equiv:"",le:"",ge:"",sub:"",sup:"",nsub:"",sube:"",supe:"",oplus:"",otimes:"",perp:"",sdot:"",lceil:"",rceil:"",lfloor:"",rfloor:"",lang:"",rang:"",loz:"",spades:"",clubs:"",hearts:"",diams:""};function getQualifiedXJSName(object){if(object.type===Syntax.XJSIdentifier){return object.name}if(object.type===Syntax.XJSNamespacedName){return object.namespace.name+":"+object.name.name}if(object.type===Syntax.XJSMemberExpression){return getQualifiedXJSName(object.object)+"."+getQualifiedXJSName(object.property)}}function isXJSIdentifierStart(ch){return ch!==92&&isIdentifierStart(ch)}function isXJSIdentifierPart(ch){return ch!==92&&(ch===45||isIdentifierPart(ch))}function scanXJSIdentifier(){var ch,start,value="";start=index;while(index<length){ch=source.charCodeAt(index);if(!isXJSIdentifierPart(ch)){break}value+=source[index++]}return{type:Token.XJSIdentifier,value:value,lineNumber:lineNumber,lineStart:lineStart,range:[start,index]}}function scanXJSEntity(){var ch,str="",start=index,count=0,code;ch=source[index];assert(ch==="&","Entity must start with an ampersand");index++;while(index<length&&count++<10){ch=source[index++];if(ch===";"){break}str+=ch}if(ch===";"){if(str[0]==="#"){if(str[1]==="x"){code=+("0"+str.substr(1))}else{code=+str.substr(1).replace(Regex.LeadingZeros,"")}if(!isNaN(code)){return String.fromCharCode(code)}}else if(XHTMLEntities[str]){return XHTMLEntities[str]}}index=start+1;return"&"}function scanXJSText(stopChars){var ch,str="",start;start=index;while(index<length){ch=source[index];if(stopChars.indexOf(ch)!==-1){break}if(ch==="&"){str+=scanXJSEntity()}else{index++;if(ch==="\r"&&source[index]==="\n"){str+=ch;ch=source[index];index++}if(isLineTerminator(ch.charCodeAt(0))){++lineNumber;lineStart=index}str+=ch}}return{type:Token.XJSText,value:str,lineNumber:lineNumber,lineStart:lineStart,range:[start,index]}}function scanXJSStringLiteral(){var innerToken,quote,start;quote=source[index];assert(quote==="'"||quote==='"',"String literal must starts with a quote");start=index;++index;innerToken=scanXJSText([quote]);if(quote!==source[index]){throwError({},Messages.UnexpectedToken,"ILLEGAL")}++index;innerToken.range=[start,index];return innerToken}function advanceXJSChild(){var ch=source.charCodeAt(index);if(ch!==123&&ch!==60){return scanXJSText(["<","{"])}return scanPunctuator()}function parseXJSIdentifier(){var token,marker=markerCreate();if(lookahead.type!==Token.XJSIdentifier){throwUnexpected(lookahead)}token=lex();return markerApply(marker,delegate.createXJSIdentifier(token.value))}function parseXJSNamespacedName(){var namespace,name,marker=markerCreate();namespace=parseXJSIdentifier();expect(":");name=parseXJSIdentifier();return markerApply(marker,delegate.createXJSNamespacedName(namespace,name))}function parseXJSMemberExpression(){var marker=markerCreate(),expr=parseXJSIdentifier();while(match(".")){lex();expr=markerApply(marker,delegate.createXJSMemberExpression(expr,parseXJSIdentifier()))}return expr}function parseXJSElementName(){if(lookahead2().value===":"){return parseXJSNamespacedName()}if(lookahead2().value==="."){return parseXJSMemberExpression()}return parseXJSIdentifier()}function parseXJSAttributeName(){if(lookahead2().value===":"){return parseXJSNamespacedName()}return parseXJSIdentifier()}function parseXJSAttributeValue(){var value,marker;if(match("{")){value=parseXJSExpressionContainer();if(value.expression.type===Syntax.XJSEmptyExpression){throwError(value,"XJS attributes must only be assigned a non-empty "+"expression")}}else if(match("<")){value=parseXJSElement()}else if(lookahead.type===Token.XJSText){marker=markerCreate();value=markerApply(marker,delegate.createLiteral(lex()))}else{throwError({},Messages.InvalidXJSAttributeValue)}return value}function parseXJSEmptyExpression(){var marker=markerCreatePreserveWhitespace();while(source.charAt(index)!=="}"){index++}return markerApply(marker,delegate.createXJSEmptyExpression())}function parseXJSExpressionContainer(){var expression,origInXJSChild,origInXJSTag,marker=markerCreate();origInXJSChild=state.inXJSChild;origInXJSTag=state.inXJSTag;state.inXJSChild=false;state.inXJSTag=false;expect("{");if(match("}")){expression=parseXJSEmptyExpression()}else{expression=parseExpression()}state.inXJSChild=origInXJSChild;state.inXJSTag=origInXJSTag;expect("}");return markerApply(marker,delegate.createXJSExpressionContainer(expression))}function parseXJSSpreadAttribute(){var expression,origInXJSChild,origInXJSTag,marker=markerCreate();origInXJSChild=state.inXJSChild;origInXJSTag=state.inXJSTag;state.inXJSChild=false;state.inXJSTag=false;expect("{");expect("...");expression=parseAssignmentExpression();state.inXJSChild=origInXJSChild;state.inXJSTag=origInXJSTag;expect("}");return markerApply(marker,delegate.createXJSSpreadAttribute(expression))}function parseXJSAttribute(){var name,marker;if(match("{")){return parseXJSSpreadAttribute()}marker=markerCreate();name=parseXJSAttributeName();if(match("=")){lex();return markerApply(marker,delegate.createXJSAttribute(name,parseXJSAttributeValue()))}return markerApply(marker,delegate.createXJSAttribute(name))}function parseXJSChild(){var token,marker;if(match("{")){token=parseXJSExpressionContainer()}else if(lookahead.type===Token.XJSText){marker=markerCreatePreserveWhitespace();token=markerApply(marker,delegate.createLiteral(lex()))}else{token=parseXJSElement()}return token}function parseXJSClosingElement(){var name,origInXJSChild,origInXJSTag,marker=markerCreate();origInXJSChild=state.inXJSChild;origInXJSTag=state.inXJSTag;state.inXJSChild=false;state.inXJSTag=true;expect("<");expect("/");name=parseXJSElementName();state.inXJSChild=origInXJSChild;state.inXJSTag=origInXJSTag;expect(">");return markerApply(marker,delegate.createXJSClosingElement(name))}function parseXJSOpeningElement(){var name,attribute,attributes=[],selfClosing=false,origInXJSChild,origInXJSTag,marker=markerCreate();origInXJSChild=state.inXJSChild;origInXJSTag=state.inXJSTag;state.inXJSChild=false;state.inXJSTag=true;expect("<");name=parseXJSElementName();while(index<length&&lookahead.value!=="/"&&lookahead.value!==">"){attributes.push(parseXJSAttribute())}state.inXJSTag=origInXJSTag;if(lookahead.value==="/"){expect("/");state.inXJSChild=origInXJSChild;expect(">");selfClosing=true}else{state.inXJSChild=true;expect(">")}return markerApply(marker,delegate.createXJSOpeningElement(name,attributes,selfClosing))}function parseXJSElement(){var openingElement,closingElement=null,children=[],origInXJSChild,origInXJSTag,marker=markerCreate();origInXJSChild=state.inXJSChild;origInXJSTag=state.inXJSTag;openingElement=parseXJSOpeningElement();if(!openingElement.selfClosing){while(index<length){state.inXJSChild=false;if(lookahead.value==="<"&&lookahead2().value==="/"){break}state.inXJSChild=true;children.push(parseXJSChild())}state.inXJSChild=origInXJSChild;state.inXJSTag=origInXJSTag;closingElement=parseXJSClosingElement();if(getQualifiedXJSName(closingElement.name)!==getQualifiedXJSName(openingElement.name)){throwError({},Messages.ExpectedXJSClosingTag,getQualifiedXJSName(openingElement.name))}}if(!origInXJSChild&&match("<")){throwError(lookahead,Messages.AdjacentXJSElements)}return markerApply(marker,delegate.createXJSElement(openingElement,closingElement,children))}function parseTypeAlias(){var id,marker=markerCreate(),typeParameters=null,right;expectContextualKeyword("type");id=parseVariableIdentifier();if(match("<")){typeParameters=parseTypeParameterDeclaration()}expect("=");right=parseType();consumeSemicolon();return markerApply(marker,delegate.createTypeAlias(id,typeParameters,right))}function parseInterfaceExtends(){var marker=markerCreate(),id,typeParameters=null;id=parseVariableIdentifier();if(match("<")){typeParameters=parseTypeParameterInstantiation()}return markerApply(marker,delegate.createInterfaceExtends(id,typeParameters))}function parseInterfaceish(marker,allowStatic){var body,bodyMarker,extended=[],id,typeParameters=null;id=parseVariableIdentifier();if(match("<")){typeParameters=parseTypeParameterDeclaration()}if(matchKeyword("extends")){expectKeyword("extends");while(index<length){extended.push(parseInterfaceExtends());if(!match(",")){break}expect(",")}}bodyMarker=markerCreate();body=markerApply(bodyMarker,parseObjectType(allowStatic));return markerApply(marker,delegate.createInterface(id,typeParameters,body,extended))}function parseInterface(){var body,bodyMarker,extended=[],id,marker=markerCreate(),typeParameters=null;expectContextualKeyword("interface");return parseInterfaceish(marker,false)}function parseDeclareClass(){var marker=markerCreate(),ret;expectContextualKeyword("declare");expectKeyword("class");ret=parseInterfaceish(marker,true);ret.type=Syntax.DeclareClass;return ret}function parseDeclareFunction(){var id,idMarker,marker=markerCreate(),params,returnType,rest,tmp,typeParameters=null,value,valueMarker;expectContextualKeyword("declare");expectKeyword("function");idMarker=markerCreate();id=parseVariableIdentifier();valueMarker=markerCreate();if(match("<")){typeParameters=parseTypeParameterDeclaration()}expect("(");tmp=parseFunctionTypeParams();params=tmp.params;rest=tmp.rest;expect(")");expect(":");returnType=parseType();value=markerApply(valueMarker,delegate.createFunctionTypeAnnotation(params,returnType,rest,typeParameters));id.typeAnnotation=markerApply(valueMarker,delegate.createTypeAnnotation(value));markerApply(idMarker,id);consumeSemicolon();return markerApply(marker,delegate.createDeclareFunction(id))}function parseDeclareVariable(){var id,marker=markerCreate();expectContextualKeyword("declare");expectKeyword("var");id=parseTypeAnnotatableIdentifier();consumeSemicolon();return markerApply(marker,delegate.createDeclareVariable(id))}function parseDeclareModule(){var body=[],bodyMarker,id,idMarker,marker=markerCreate(),token;expectContextualKeyword("declare");expectContextualKeyword("module");if(lookahead.type===Token.StringLiteral){if(strict&&lookahead.octal){throwErrorTolerant(lookahead,Messages.StrictOctalLiteral)}idMarker=markerCreate();id=markerApply(idMarker,delegate.createLiteral(lex()))}else{id=parseVariableIdentifier()}bodyMarker=markerCreate();expect("{");while(index<length&&!match("}")){token=lookahead2();switch(token.value){case"class":body.push(parseDeclareClass());break;case"function":body.push(parseDeclareFunction());break;case"var":body.push(parseDeclareVariable());break;default:throwUnexpected(lookahead)}}expect("}");return markerApply(marker,delegate.createDeclareModule(id,markerApply(bodyMarker,delegate.createBlockStatement(body))))}function collectToken(){var start,loc,token,range,value,entry;if(!state.inXJSChild){skipComment()}start=index;loc={start:{line:lineNumber,column:index-lineStart}};token=extra.advance();loc.end={line:lineNumber,column:index-lineStart};if(token.type!==Token.EOF){range=[token.range[0],token.range[1]];value=source.slice(token.range[0],token.range[1]);entry={type:TokenName[token.type],value:value,range:range,loc:loc};if(token.regex){entry.regex={pattern:token.regex.pattern,flags:token.regex.flags}}extra.tokens.push(entry)}return token}function collectRegex(){var pos,loc,regex,token;skipComment();pos=index;loc={start:{line:lineNumber,column:index-lineStart}};regex=extra.scanRegExp();loc.end={line:lineNumber,column:index-lineStart};if(!extra.tokenize){if(extra.tokens.length>0){token=extra.tokens[extra.tokens.length-1];if(token.range[0]===pos&&token.type==="Punctuator"){if(token.value==="/"||token.value==="/="){extra.tokens.pop()}}}extra.tokens.push({type:"RegularExpression",value:regex.literal,regex:regex.regex,range:[pos,index],loc:loc})}return regex}function filterTokenLocation(){var i,entry,token,tokens=[];for(i=0;i<extra.tokens.length;++i){entry=extra.tokens[i];token={type:entry.type,value:entry.value};if(entry.regex){token.regex={pattern:entry.regex.pattern,flags:entry.regex.flags}}if(extra.range){token.range=entry.range}if(extra.loc){token.loc=entry.loc}tokens.push(token)}extra.tokens=tokens}function patch(){if(extra.comments){extra.skipComment=skipComment;skipComment=scanComment}if(typeof extra.tokens!=="undefined"){extra.advance=advance;extra.scanRegExp=scanRegExp;advance=collectToken;scanRegExp=collectRegex}}function unpatch(){if(typeof extra.skipComment==="function"){skipComment=extra.skipComment}if(typeof extra.scanRegExp==="function"){advance=extra.advance;scanRegExp=extra.scanRegExp}}function extend(object,properties){var entry,result={};for(entry in object){if(object.hasOwnProperty(entry)){result[entry]=object[entry]}}for(entry in properties){if(properties.hasOwnProperty(entry)){result[entry]=properties[entry]}}return result}function tokenize(code,options){var toString,token,tokens;toString=String;if(typeof code!=="string"&&!(code instanceof String)){code=toString(code)}delegate=SyntaxTreeDelegate;source=code;index=0;lineNumber=source.length>0?1:0;lineStart=0;length=source.length;lookahead=null;state={allowKeyword:true,allowIn:true,labelSet:{},inFunctionBody:false,inIteration:false,inSwitch:false,lastCommentStart:-1};extra={};options=options||{};options.tokens=true;extra.tokens=[];extra.tokenize=true;extra.openParenToken=-1;extra.openCurlyToken=-1;extra.range=typeof options.range==="boolean"&&options.range;extra.loc=typeof options.loc==="boolean"&&options.loc;if(typeof options.comment==="boolean"&&options.comment){extra.comments=[]}if(typeof options.tolerant==="boolean"&&options.tolerant){extra.errors=[]}if(length>0){if(typeof source[0]==="undefined"){if(code instanceof String){source=code.valueOf()}}}patch();try{peek();if(lookahead.type===Token.EOF){return extra.tokens}token=lex();while(lookahead.type!==Token.EOF){try{token=lex()}catch(lexError){token=lookahead;if(extra.errors){extra.errors.push(lexError);break}else{throw lexError}}}filterTokenLocation();tokens=extra.tokens;if(typeof extra.comments!=="undefined"){tokens.comments=extra.comments}if(typeof extra.errors!=="undefined"){tokens.errors=extra.errors}}catch(e){throw e}finally{unpatch();extra={}}return tokens}function parse(code,options){var program,toString;toString=String;if(typeof code!=="string"&&!(code instanceof String)){code=toString(code)}delegate=SyntaxTreeDelegate;source=code;index=0;lineNumber=source.length>0?1:0;lineStart=0;length=source.length;lookahead=null;state={allowKeyword:false,allowIn:true,labelSet:{},parenthesizedCount:0,inFunctionBody:false,inIteration:false,inSwitch:false,inXJSChild:false,inXJSTag:false,inType:false,lastCommentStart:-1,yieldAllowed:false,awaitAllowed:false};extra={};if(typeof options!=="undefined"){extra.range=typeof options.range==="boolean"&&options.range;extra.loc=typeof options.loc==="boolean"&&options.loc;extra.attachComment=typeof options.attachComment==="boolean"&&options.attachComment;if(extra.loc&&options.source!==null&&options.source!==undefined){delegate=extend(delegate,{postProcess:function(node){node.loc.source=toString(options.source);return node}})}if(typeof options.tokens==="boolean"&&options.tokens){extra.tokens=[]}if(typeof options.comment==="boolean"&&options.comment){extra.comments=[]}if(typeof options.tolerant==="boolean"&&options.tolerant){extra.errors=[]}if(extra.attachComment){extra.range=true;extra.comments=[];extra.bottomRightStack=[];extra.trailingComments=[];extra.leadingComments=[]}}if(length>0){if(typeof source[0]==="undefined"){if(code instanceof String){source=code.valueOf()}}}patch();try{program=parseProgram();if(typeof extra.comments!=="undefined"){program.comments=extra.comments}if(typeof extra.tokens!=="undefined"){filterTokenLocation();program.tokens=extra.tokens}if(typeof extra.errors!=="undefined"){program.errors=extra.errors}}catch(e){throw e}finally{unpatch();extra={}}return program}exports.version="8001.1001.0-dev-harmony-fb";exports.tokenize=tokenize;exports.parse=parse;exports.Syntax=function(){var name,types={};if(typeof Object.create==="function"){types=Object.create(null)}for(name in Syntax){if(Syntax.hasOwnProperty(name)){types[name]=Syntax[name]}}if(typeof Object.freeze==="function"){Object.freeze(types)}return types}()})},{}],183:[function(require,module,exports){arguments[4][137][0].apply(exports,arguments)},{"./source-map/source-map-consumer":188,"./source-map/source-map-generator":189,"./source-map/source-node":190,dup:137}],184:[function(require,module,exports){arguments[4][138][0].apply(exports,arguments)},{"./util":191,amdefine:192,dup:138}],185:[function(require,module,exports){arguments[4][152][0].apply(exports,arguments)},{"./base64":186,amdefine:192,dup:152}],186:[function(require,module,exports){arguments[4][140][0].apply(exports,arguments)},{amdefine:192,dup:140}],187:[function(require,module,exports){arguments[4][141][0].apply(exports,arguments)},{amdefine:192,dup:141}],188:[function(require,module,exports){arguments[4][155][0].apply(exports,arguments)},{"./array-set":184,"./base64-vlq":185,"./binary-search":187,"./util":191,amdefine:192,dup:155}],189:[function(require,module,exports){arguments[4][156][0].apply(exports,arguments)},{"./array-set":184,"./base64-vlq":185,"./util":191,amdefine:192,dup:156}],190:[function(require,module,exports){arguments[4][157][0].apply(exports,arguments)},{"./source-map-generator":189,"./util":191,amdefine:192,dup:157}],191:[function(require,module,exports){arguments[4][158][0].apply(exports,arguments)},{amdefine:192,dup:158}],192:[function(require,module,exports){(function(process,__filename){"use strict";function amdefine(module,requireFn){"use strict";var defineCache={},loaderCache={},alreadyCalled=false,path=require("path"),makeRequire,stringRequire;function trimDots(ary){var i,part;for(i=0;ary[i];i+=1){part=ary[i];if(part==="."){ary.splice(i,1);i-=1}else if(part===".."){if(i===1&&(ary[2]===".."||ary[0]==="..")){break}else if(i>0){ary.splice(i-1,2);i-=2}}}}function normalize(name,baseName){var baseParts;if(name&&name.charAt(0)==="."){if(baseName){baseParts=baseName.split("/");baseParts=baseParts.slice(0,baseParts.length-1);baseParts=baseParts.concat(name.split("/"));trimDots(baseParts);name=baseParts.join("/")}}return name}function makeNormalize(relName){return function(name){return normalize(name,relName)}}function makeLoad(id){function load(value){loaderCache[id]=value}load.fromText=function(id,text){throw new Error("amdefine does not implement load.fromText")};return load}makeRequire=function(systemRequire,exports,module,relId){function amdRequire(deps,callback){if(typeof deps==="string"){return stringRequire(systemRequire,exports,module,deps,relId)}else{deps=deps.map(function(depName){return stringRequire(systemRequire,exports,module,depName,relId)});process.nextTick(function(){callback.apply(null,deps)})}}amdRequire.toUrl=function(filePath){if(filePath.indexOf(".")===0){return normalize(filePath,path.dirname(module.filename))}else{return filePath}};return amdRequire};requireFn=requireFn||function req(){return module.require.apply(module,arguments)};function runFactory(id,deps,factory){var r,e,m,result;if(id){e=loaderCache[id]={};m={id:id,uri:__filename,exports:e};r=makeRequire(requireFn,e,m,id)}else{if(alreadyCalled){throw new Error("amdefine with no module ID cannot be called more than once per file.")}alreadyCalled=true;e=module.exports;m=module;r=makeRequire(requireFn,e,m,module.id)}if(deps){deps=deps.map(function(depName){return r(depName)})}if(typeof factory==="function"){result=factory.apply(m.exports,deps)}else{result=factory}if(result!==undefined){m.exports=result;if(id){loaderCache[id]=m.exports}}}stringRequire=function(systemRequire,exports,module,id,relId){var index=id.indexOf("!"),originalId=id,prefix,plugin;if(index===-1){id=normalize(id,relId);if(id==="require"){return makeRequire(systemRequire,exports,module,relId)}else if(id==="exports"){return exports}else if(id==="module"){return module}else if(loaderCache.hasOwnProperty(id)){return loaderCache[id]}else if(defineCache[id]){runFactory.apply(null,defineCache[id]);return loaderCache[id]}else{if(systemRequire){return systemRequire(originalId)}else{throw new Error("No module with ID: "+id)}}}else{prefix=id.substring(0,index);id=id.substring(index+1,id.length);plugin=stringRequire(systemRequire,exports,module,prefix,relId);if(plugin.normalize){id=plugin.normalize(id,makeNormalize(relId))}else{id=normalize(id,relId)}if(loaderCache[id]){return loaderCache[id]}else{plugin.load(id,makeRequire(systemRequire,exports,module,relId),makeLoad(id),{});return loaderCache[id]}}};function define(id,deps,factory){if(Array.isArray(id)){factory=deps;deps=id;id=undefined}else if(typeof id!=="string"){factory=id;id=deps=undefined}if(deps&&!Array.isArray(deps)){factory=deps;deps=undefined}if(!deps){deps=["require","exports","module"]}if(id){defineCache[id]=[id,deps,factory]}else{runFactory(id,deps,factory)}}define.require=function(id){if(loaderCache[id]){return loaderCache[id]}if(defineCache[id]){runFactory.apply(null,defineCache[id]);return loaderCache[id]}};define.amd={};return define}module.exports=amdefine}).call(this,require("_process"),"/node_modules/itreed/node_modules/reactify/node_modules/jstransform/node_modules/source-map/node_modules/amdefine/amdefine.js")},{_process:10,path:9}],193:[function(require,module,exports){arguments[4][160][0].apply(exports,arguments)},{dup:160}],194:[function(require,module,exports){"use strict";var esprima=require("esprima-fb");var utils=require("./utils");var getBoundaryNode=utils.getBoundaryNode;var declareIdentInScope=utils.declareIdentInLocalScope;var initScopeMetadata=utils.initScopeMetadata;var Syntax=esprima.Syntax;function _nodeIsClosureScopeBoundary(node,parentNode){if(node.type===Syntax.Program){return true}var parentIsFunction=parentNode.type===Syntax.FunctionDeclaration||parentNode.type===Syntax.FunctionExpression||parentNode.type===Syntax.ArrowFunctionExpression;return node.type===Syntax.BlockStatement&&parentIsFunction}function _nodeIsBlockScopeBoundary(node,parentNode){if(node.type===Syntax.Program){return false}return node.type===Syntax.BlockStatement&&parentNode.type===Syntax.CatchClause}function traverse(node,path,state){var parentNode=path[0];if(!Array.isArray(node)&&state.localScope.parentNode!==parentNode){if(_nodeIsClosureScopeBoundary(node,parentNode)){var scopeIsStrict=state.scopeIsStrict||node.body.length>0&&node.body[0].type===Syntax.ExpressionStatement&&node.body[0].expression.type===Syntax.Literal&&node.body[0].expression.value==="use strict";if(node.type===Syntax.Program){state=utils.updateState(state,{scopeIsStrict:scopeIsStrict})}else{state=utils.updateState(state,{localScope:{parentNode:parentNode,parentScope:state.localScope,identifiers:{},tempVarIndex:0},scopeIsStrict:scopeIsStrict});declareIdentInScope("arguments",initScopeMetadata(node),state);if(parentNode.params.length>0){var param;for(var i=0;i<parentNode.params.length;i++){param=parentNode.params[i];if(param.type===Syntax.Identifier){declareIdentInScope(param.name,initScopeMetadata(parentNode),state)}}}if(parentNode.type===Syntax.FunctionExpression&&parentNode.id){var metaData=initScopeMetadata(parentNode,path.parentNodeslice,parentNode);declareIdentInScope(parentNode.id.name,metaData,state)}}collectClosureIdentsAndTraverse(node,path,state)}if(_nodeIsBlockScopeBoundary(node,parentNode)){state=utils.updateState(state,{localScope:{parentNode:parentNode,parentScope:state.localScope,identifiers:{}}});if(parentNode.type===Syntax.CatchClause){declareIdentInScope(parentNode.param.name,initScopeMetadata(parentNode),state)}collectBlockIdentsAndTraverse(node,path,state)}}function traverser(node,path,state){node.range&&utils.catchup(node.range[0],state);traverse(node,path,state);node.range&&utils.catchup(node.range[1],state)}utils.analyzeAndTraverse(walker,traverser,node,path,state)}function collectClosureIdentsAndTraverse(node,path,state){utils.analyzeAndTraverse(visitLocalClosureIdentifiers,collectClosureIdentsAndTraverse,node,path,state)}function collectBlockIdentsAndTraverse(node,path,state){utils.analyzeAndTraverse(visitLocalBlockIdentifiers,collectBlockIdentsAndTraverse,node,path,state)}function visitLocalClosureIdentifiers(node,path,state){var metaData;switch(node.type){case Syntax.FunctionExpression:return false;case Syntax.ClassDeclaration:case Syntax.ClassExpression:case Syntax.FunctionDeclaration:if(node.id){metaData=initScopeMetadata(getBoundaryNode(path),path.slice(),node);declareIdentInScope(node.id.name,metaData,state)}return false;case Syntax.VariableDeclarator:if(path[0].kind==="var"){metaData=initScopeMetadata(getBoundaryNode(path),path.slice(),node);declareIdentInScope(node.id.name,metaData,state)}break}}function visitLocalBlockIdentifiers(node,path,state){if(node.type===Syntax.CatchClause){return false}}function walker(node,path,state){var visitors=state.g.visitors;for(var i=0;i<visitors.length;i++){if(visitors[i].test(node,path,state)){return visitors[i](traverse,node,path,state)}}}var _astCache={};function transform(visitors,source,options){options=options||{};var ast;try{var cachedAst=_astCache[source];ast=cachedAst||(_astCache[source]=esprima.parse(source,{comment:true,loc:true,range:true}))}catch(e){e.message="Parse Error: "+e.message;throw e}var state=utils.createState(source,ast,options);state.g.visitors=visitors;if(options.sourceMap){var SourceMapGenerator=require("source-map").SourceMapGenerator;state.g.sourceMap=new SourceMapGenerator({file:options.filename||"transformed.js"})}traverse(ast,[],state);utils.catchup(source.length,state);var ret={code:state.g.buffer,extra:state.g.extra};if(options.sourceMap){ret.sourceMap=state.g.sourceMap;ret.sourceMapFilename=options.filename||"source.js"}return ret}exports.transform=transform;exports.Syntax=Syntax},{"./utils":195,"esprima-fb":182,"source-map":183}],195:[function(require,module,exports){var Syntax=require("esprima-fb").Syntax;var leadingIndentRegexp=/(^|\n)( {2}|\t)/g;var nonWhiteRegexp=/(\S)/g;function createState(source,rootNode,transformOptions){return{localScope:{parentNode:rootNode,parentScope:null,identifiers:{},tempVarIndex:0},superClass:null,mungeNamespace:"",methodNode:null,methodFuncNode:null,className:null,scopeIsStrict:null,indentBy:0,g:{opts:transformOptions,position:0,extra:{},buffer:"",source:source,docblock:null,tagNamespaceUsed:false,isBolt:undefined,sourceMap:null,sourceMapFilename:"source.js",sourceLine:1,bufferLine:1,originalProgramAST:null,sourceColumn:0,bufferColumn:0}}}function updateState(state,update){var ret=Object.create(state);Object.keys(update).forEach(function(updatedKey){ret[updatedKey]=update[updatedKey]});return ret}function catchup(end,state,contentTransformer){if(end<state.g.position){return}var source=state.g.source.substring(state.g.position,end);var transformed=updateIndent(source,state);if(state.g.sourceMap&&transformed){state.g.sourceMap.addMapping({generated:{line:state.g.bufferLine,column:state.g.bufferColumn},original:{line:state.g.sourceLine,column:state.g.sourceColumn},source:state.g.sourceMapFilename});var sourceLines=source.split("\n");var transformedLines=transformed.split("\n");for(var i=1;i<sourceLines.length-1;i++){state.g.sourceMap.addMapping({generated:{line:state.g.bufferLine,column:0},original:{line:state.g.sourceLine,column:0},source:state.g.sourceMapFilename});state.g.sourceLine++;state.g.bufferLine++}if(sourceLines.length>1){state.g.sourceLine++;state.g.bufferLine++;state.g.sourceColumn=0;state.g.bufferColumn=0}state.g.sourceColumn+=sourceLines[sourceLines.length-1].length;state.g.bufferColumn+=transformedLines[transformedLines.length-1].length}state.g.buffer+=contentTransformer?contentTransformer(transformed):transformed;state.g.position=end}function getNodeSourceText(node,state){return state.g.source.substring(node.range[0],node.range[1])}function replaceNonWhite(value){return value.replace(nonWhiteRegexp," ")}function stripNonWhite(value){return value.replace(nonWhiteRegexp,"")}function catchupWhiteOut(end,state){catchup(end,state,replaceNonWhite)}function catchupWhiteSpace(end,state){catchup(end,state,stripNonWhite)}var reNonNewline=/[^\n]/g;function stripNonNewline(value){return value.replace(reNonNewline,function(){return""})}function catchupNewlines(end,state){catchup(end,state,stripNonNewline)}function move(end,state){if(state.g.sourceMap){if(end<state.g.position){state.g.position=0;state.g.sourceLine=1;state.g.sourceColumn=0}var source=state.g.source.substring(state.g.position,end);var sourceLines=source.split("\n");if(sourceLines.length>1){state.g.sourceLine+=sourceLines.length-1;state.g.sourceColumn=0}state.g.sourceColumn+=sourceLines[sourceLines.length-1].length}state.g.position=end}function append(str,state){if(state.g.sourceMap&&str){state.g.sourceMap.addMapping({generated:{line:state.g.bufferLine,column:state.g.bufferColumn},original:{line:state.g.sourceLine,column:state.g.sourceColumn},source:state.g.sourceMapFilename});var transformedLines=str.split("\n");if(transformedLines.length>1){state.g.bufferLine+=transformedLines.length-1;state.g.bufferColumn=0}state.g.bufferColumn+=transformedLines[transformedLines.length-1].length}state.g.buffer+=str}function updateIndent(str,state){var indentBy=state.indentBy;if(indentBy<0){for(var i=0;i<-indentBy;i++){str=str.replace(leadingIndentRegexp,"$1")}}else{for(var i=0;i<indentBy;i++){str=str.replace(leadingIndentRegexp,"$1$2$2")}}return str
}function indentBefore(start,state){var end=start;start=start-1;while(start>0&&state.g.source[start]!="\n"){if(!state.g.source[start].match(/[ \t]/)){end=start}start--}return state.g.source.substring(start+1,end)}function getDocblock(state){if(!state.g.docblock){var docblock=require("./docblock");state.g.docblock=docblock.parseAsObject(docblock.extract(state.g.source))}return state.g.docblock}function identWithinLexicalScope(identName,state,stopBeforeNode){var currScope=state.localScope;while(currScope){if(currScope.identifiers[identName]!==undefined){return true}if(stopBeforeNode&&currScope.parentNode===stopBeforeNode){break}currScope=currScope.parentScope}return false}function identInLocalScope(identName,state){return state.localScope.identifiers[identName]!==undefined}function initScopeMetadata(boundaryNode,path,node){return{boundaryNode:boundaryNode,bindingPath:path,bindingNode:node}}function declareIdentInLocalScope(identName,metaData,state){state.localScope.identifiers[identName]={boundaryNode:metaData.boundaryNode,path:metaData.bindingPath,node:metaData.bindingNode,state:Object.create(state)}}function getLexicalBindingMetadata(identName,state){return state.localScope.identifiers[identName]}function analyzeAndTraverse(analyzer,traverser,node,path,state){if(node.type){if(analyzer(node,path,state)===false){return}path.unshift(node)}getOrderedChildren(node).forEach(function(child){traverser(child,path,state)});node.type&&path.shift()}function getOrderedChildren(node){var queue=[];for(var key in node){if(node.hasOwnProperty(key)){enqueueNodeWithStartIndex(queue,node[key])}}queue.sort(function(a,b){return a[1]-b[1]});return queue.map(function(pair){return pair[0]})}function enqueueNodeWithStartIndex(queue,node){if(typeof node!=="object"||node===null){return}if(node.range){queue.push([node,node.range[0]])}else if(Array.isArray(node)){for(var ii=0;ii<node.length;ii++){enqueueNodeWithStartIndex(queue,node[ii])}}}function containsChildOfType(node,type){return containsChildMatching(node,function(node){return node.type===type})}function containsChildMatching(node,matcher){var foundMatchingChild=false;function nodeTypeAnalyzer(node){if(matcher(node)===true){foundMatchingChild=true;return false}}function nodeTypeTraverser(child,path,state){if(!foundMatchingChild){foundMatchingChild=containsChildMatching(child,matcher)}}analyzeAndTraverse(nodeTypeAnalyzer,nodeTypeTraverser,node,[]);return foundMatchingChild}var scopeTypes={};scopeTypes[Syntax.FunctionExpression]=true;scopeTypes[Syntax.FunctionDeclaration]=true;scopeTypes[Syntax.Program]=true;function getBoundaryNode(path){for(var ii=0;ii<path.length;++ii){if(scopeTypes[path[ii].type]){return path[ii]}}throw new Error("Expected to find a node with one of the following types in path:\n"+JSON.stringify(Object.keys(scopeTypes)))}function getTempVar(tempVarIndex){return"$__"+tempVarIndex}function getTempVarWithValue(tempVarIndex,tempVarValue){return getTempVar(tempVarIndex)+"="+tempVarValue}exports.append=append;exports.catchup=catchup;exports.catchupWhiteOut=catchupWhiteOut;exports.catchupWhiteSpace=catchupWhiteSpace;exports.catchupNewlines=catchupNewlines;exports.containsChildMatching=containsChildMatching;exports.containsChildOfType=containsChildOfType;exports.createState=createState;exports.declareIdentInLocalScope=declareIdentInLocalScope;exports.getBoundaryNode=getBoundaryNode;exports.getDocblock=getDocblock;exports.getLexicalBindingMetadata=getLexicalBindingMetadata;exports.initScopeMetadata=initScopeMetadata;exports.identWithinLexicalScope=identWithinLexicalScope;exports.identInLocalScope=identInLocalScope;exports.indentBefore=indentBefore;exports.move=move;exports.scopeTypes=scopeTypes;exports.updateIndent=updateIndent;exports.updateState=updateState;exports.analyzeAndTraverse=analyzeAndTraverse;exports.getOrderedChildren=getOrderedChildren;exports.getNodeSourceText=getNodeSourceText;exports.getTempVar=getTempVar;exports.getTempVarWithValue=getTempVarWithValue},{"./docblock":193,"esprima-fb":182}],196:[function(require,module,exports){var restParamVisitors=require("./es6-rest-param-visitors");var destructuringVisitors=require("./es6-destructuring-visitors");var Syntax=require("esprima-fb").Syntax;var utils=require("../src/utils");function visitArrowFunction(traverse,node,path,state){var notInExpression=path[0].type===Syntax.ExpressionStatement;if(notInExpression){utils.append("(",state)}utils.append("function",state);renderParams(traverse,node,path,state);utils.catchupWhiteSpace(node.body.range[0],state);var renderBody=node.body.type==Syntax.BlockStatement?renderStatementBody:renderExpressionBody;path.unshift(node);renderBody(traverse,node,path,state);path.shift();var containsBindingSyntax=utils.containsChildMatching(node.body,function(node){return node.type===Syntax.ThisExpression||node.type===Syntax.Identifier&&node.name==="super"});if(containsBindingSyntax){utils.append(".bind(this)",state)}utils.catchupWhiteSpace(node.range[1],state);if(notInExpression){utils.append(")",state)}return false}function renderParams(traverse,node,path,state){if(isParensFreeSingleParam(node,state)||!node.params.length){utils.append("(",state)}if(node.params.length!==0){path.unshift(node);traverse(node.params,path,state);path.unshift()}utils.append(")",state)}function isParensFreeSingleParam(node,state){return node.params.length===1&&state.g.source[state.g.position]!=="("}function renderExpressionBody(traverse,node,path,state){utils.append("{",state);if(node.rest){utils.append(restParamVisitors.renderRestParamSetup(node,state),state)}destructuringVisitors.renderDestructuredComponents(node,utils.updateState(state,{localScope:{parentNode:state.parentNode,parentScope:state.parentScope,identifiers:state.identifiers,tempVarIndex:0}}));utils.append("return ",state);renderStatementBody(traverse,node,path,state);utils.append(";}",state)}function renderStatementBody(traverse,node,path,state){traverse(node.body,path,state);utils.catchup(node.body.range[1],state)}visitArrowFunction.test=function(node,path,state){return node.type===Syntax.ArrowFunctionExpression};exports.visitorList=[visitArrowFunction]},{"../src/utils":195,"./es6-destructuring-visitors":198,"./es6-rest-param-visitors":201,"esprima-fb":182}],197:[function(require,module,exports){"use strict";var base62=require("base62");var Syntax=require("esprima-fb").Syntax;var utils=require("../src/utils");var reservedWordsHelper=require("./reserved-words-helper");var declareIdentInLocalScope=utils.declareIdentInLocalScope;var initScopeMetadata=utils.initScopeMetadata;var SUPER_PROTO_IDENT_PREFIX="____SuperProtoOf";var _anonClassUUIDCounter=0;var _mungedSymbolMaps={};function resetSymbols(){_anonClassUUIDCounter=0;_mungedSymbolMaps={}}function _generateAnonymousClassName(state){var mungeNamespace=state.mungeNamespace||"";return"____Class"+mungeNamespace+base62.encode(_anonClassUUIDCounter++)}function _getMungedName(identName,state){var mungeNamespace=state.mungeNamespace;var shouldMinify=state.g.opts.minify;if(shouldMinify){if(!_mungedSymbolMaps[mungeNamespace]){_mungedSymbolMaps[mungeNamespace]={symbolMap:{},identUUIDCounter:0}}var symbolMap=_mungedSymbolMaps[mungeNamespace].symbolMap;if(!symbolMap[identName]){symbolMap[identName]=base62.encode(_mungedSymbolMaps[mungeNamespace].identUUIDCounter++)}identName=symbolMap[identName]}return"$"+mungeNamespace+identName}function _getSuperClassInfo(node,state){var ret={name:null,expression:null};if(node.superClass){if(node.superClass.type===Syntax.Identifier){ret.name=node.superClass.name}else{ret.name=_generateAnonymousClassName(state);ret.expression=state.g.source.substring(node.superClass.range[0],node.superClass.range[1])}}return ret}function _isConstructorMethod(classElement){return classElement.type===Syntax.MethodDefinition&&classElement.key.type===Syntax.Identifier&&classElement.key.name==="constructor"}function _shouldMungeIdentifier(node,state){return!!state.methodFuncNode&&!utils.getDocblock(state).hasOwnProperty("preventMunge")&&/^_(?!_)/.test(node.name)}function visitClassMethod(traverse,node,path,state){if(!state.g.opts.es5&&(node.kind==="get"||node.kind==="set")){throw new Error("This transform does not support "+node.kind+"ter methods for ES6 "+"classes. (line: "+node.loc.start.line+", col: "+node.loc.start.column+")")}state=utils.updateState(state,{methodNode:node});utils.catchup(node.range[0],state);path.unshift(node);traverse(node.value,path,state);path.shift();return false}visitClassMethod.test=function(node,path,state){return node.type===Syntax.MethodDefinition};function visitClassFunctionExpression(traverse,node,path,state){var methodNode=path[0];var isGetter=methodNode.kind==="get";var isSetter=methodNode.kind==="set";state=utils.updateState(state,{methodFuncNode:node});if(methodNode.key.name==="constructor"){utils.append("function "+state.className,state)}else{var methodAccessor;var prototypeOrStatic=methodNode.static?"":".prototype";var objectAccessor=state.className+prototypeOrStatic;if(methodNode.key.type===Syntax.Identifier){methodAccessor=methodNode.key.name;if(_shouldMungeIdentifier(methodNode.key,state)){methodAccessor=_getMungedName(methodAccessor,state)}if(isGetter||isSetter){methodAccessor=JSON.stringify(methodAccessor)}else if(reservedWordsHelper.isReservedWord(methodAccessor)){methodAccessor="["+JSON.stringify(methodAccessor)+"]"}else{methodAccessor="."+methodAccessor}}else if(methodNode.key.type===Syntax.Literal){methodAccessor=JSON.stringify(methodNode.key.value);if(!(isGetter||isSetter)){methodAccessor="["+methodAccessor+"]"}}if(isSetter||isGetter){utils.append("Object.defineProperty("+objectAccessor+","+methodAccessor+","+"{enumerable:true,configurable:true,"+methodNode.kind+":function",state)}else{utils.append(objectAccessor+methodAccessor+"=function"+(node.generator?"*":""),state)}}utils.move(methodNode.key.range[1],state);utils.append("(",state);var params=node.params;if(params.length>0){utils.catchupNewlines(params[0].range[0],state);for(var i=0;i<params.length;i++){utils.catchup(node.params[i].range[0],state);path.unshift(node);traverse(params[i],path,state);path.shift()}}utils.append(")",state);utils.catchupWhiteSpace(node.body.range[0],state);utils.append("{",state);if(!state.scopeIsStrict){utils.append('"use strict";',state);state=utils.updateState(state,{scopeIsStrict:true})}utils.move(node.body.range[0]+"{".length,state);path.unshift(node);traverse(node.body,path,state);path.shift();utils.catchup(node.body.range[1],state);if(methodNode.key.name!=="constructor"){if(isGetter||isSetter){utils.append("})",state)}utils.append(";",state)}return false}visitClassFunctionExpression.test=function(node,path,state){return node.type===Syntax.FunctionExpression&&path[0].type===Syntax.MethodDefinition};function visitClassMethodParam(traverse,node,path,state){var paramName=node.name;if(_shouldMungeIdentifier(node,state)){paramName=_getMungedName(node.name,state)}utils.append(paramName,state);utils.move(node.range[1],state)}visitClassMethodParam.test=function(node,path,state){if(!path[0]||!path[1]){return}var parentFuncExpr=path[0];var parentClassMethod=path[1];return parentFuncExpr.type===Syntax.FunctionExpression&&parentClassMethod.type===Syntax.MethodDefinition&&node.type===Syntax.Identifier};function _renderClassBody(traverse,node,path,state){var className=state.className;var superClass=state.superClass;if(superClass.name){if(superClass.expression!==null){utils.append("var "+superClass.name+"="+superClass.expression+";",state)}var keyName=superClass.name+"____Key";var keyNameDeclarator="";if(!utils.identWithinLexicalScope(keyName,state)){keyNameDeclarator="var ";declareIdentInLocalScope(keyName,initScopeMetadata(node),state)}utils.append("for("+keyNameDeclarator+keyName+" in "+superClass.name+"){"+"if("+superClass.name+".hasOwnProperty("+keyName+")){"+className+"["+keyName+"]="+superClass.name+"["+keyName+"];"+"}"+"}",state);var superProtoIdentStr=SUPER_PROTO_IDENT_PREFIX+superClass.name;if(!utils.identWithinLexicalScope(superProtoIdentStr,state)){utils.append("var "+superProtoIdentStr+"="+superClass.name+"===null?"+"null:"+superClass.name+".prototype;",state);declareIdentInLocalScope(superProtoIdentStr,initScopeMetadata(node),state)}utils.append(className+".prototype=Object.create("+superProtoIdentStr+");",state);utils.append(className+".prototype.constructor="+className+";",state);utils.append(className+".__superConstructor__="+superClass.name+";",state)}if(!node.body.body.filter(_isConstructorMethod).pop()){utils.append("function "+className+"(){",state);if(!state.scopeIsStrict){utils.append('"use strict";',state)}if(superClass.name){utils.append("if("+superClass.name+"!==null){"+superClass.name+".apply(this,arguments);}",state)}utils.append("}",state)}utils.move(node.body.range[0]+"{".length,state);traverse(node.body,path,state);utils.catchupWhiteSpace(node.range[1],state)}function visitClassDeclaration(traverse,node,path,state){var className=node.id.name;var superClass=_getSuperClassInfo(node,state);state=utils.updateState(state,{mungeNamespace:className,className:className,superClass:superClass});_renderClassBody(traverse,node,path,state);return false}visitClassDeclaration.test=function(node,path,state){return node.type===Syntax.ClassDeclaration};function visitClassExpression(traverse,node,path,state){var className=node.id&&node.id.name||_generateAnonymousClassName(state);var superClass=_getSuperClassInfo(node,state);utils.append("(function(){",state);state=utils.updateState(state,{mungeNamespace:className,className:className,superClass:superClass});_renderClassBody(traverse,node,path,state);utils.append("return "+className+";})()",state);return false}visitClassExpression.test=function(node,path,state){return node.type===Syntax.ClassExpression};function visitPrivateIdentifier(traverse,node,path,state){utils.append(_getMungedName(node.name,state),state);utils.move(node.range[1],state)}visitPrivateIdentifier.test=function(node,path,state){if(node.type===Syntax.Identifier&&_shouldMungeIdentifier(node,state)){if(path[0].type===Syntax.MemberExpression&&path[0].object!==node&&path[0].computed===false){return true}if(utils.identWithinLexicalScope(node.name,state,state.methodFuncNode)){return true}if(path[0].type===Syntax.Property&&path[1].type===Syntax.ObjectExpression){return true}if(path[0].type===Syntax.FunctionExpression||path[0].type===Syntax.FunctionDeclaration||path[0].type===Syntax.ArrowFunctionExpression){for(var i=0;i<path[0].params.length;i++){if(path[0].params[i]===node){return true}}}}return false};function visitSuperCallExpression(traverse,node,path,state){var superClassName=state.superClass.name;if(node.callee.type===Syntax.Identifier){if(_isConstructorMethod(state.methodNode)){utils.append(superClassName+".call(",state)}else{var protoProp=SUPER_PROTO_IDENT_PREFIX+superClassName;if(state.methodNode.key.type===Syntax.Identifier){protoProp+="."+state.methodNode.key.name}else if(state.methodNode.key.type===Syntax.Literal){protoProp+="["+JSON.stringify(state.methodNode.key.value)+"]"}utils.append(protoProp+".call(",state)}utils.move(node.callee.range[1],state)}else if(node.callee.type===Syntax.MemberExpression){utils.append(SUPER_PROTO_IDENT_PREFIX+superClassName,state);utils.move(node.callee.object.range[1],state);if(node.callee.computed){utils.catchup(node.callee.property.range[1]+"]".length,state)}else{utils.append("."+node.callee.property.name,state)}utils.append(".call(",state);utils.move(node.callee.range[1],state)}utils.append("this",state);if(node.arguments.length>0){utils.append(",",state);utils.catchupWhiteSpace(node.arguments[0].range[0],state);traverse(node.arguments,path,state)}utils.catchupWhiteSpace(node.range[1],state);utils.append(")",state);return false}visitSuperCallExpression.test=function(node,path,state){if(state.superClass&&node.type===Syntax.CallExpression){var callee=node.callee;if(callee.type===Syntax.Identifier&&callee.name==="super"||callee.type==Syntax.MemberExpression&&callee.object.name==="super"){return true}}return false};function visitSuperMemberExpression(traverse,node,path,state){var superClassName=state.superClass.name;utils.append(SUPER_PROTO_IDENT_PREFIX+superClassName,state);utils.move(node.object.range[1],state)}visitSuperMemberExpression.test=function(node,path,state){return state.superClass&&node.type===Syntax.MemberExpression&&node.object.type===Syntax.Identifier&&node.object.name==="super"};exports.resetSymbols=resetSymbols;exports.visitorList=[visitClassDeclaration,visitClassExpression,visitClassFunctionExpression,visitClassMethod,visitClassMethodParam,visitPrivateIdentifier,visitSuperCallExpression,visitSuperMemberExpression]},{"../src/utils":195,"./reserved-words-helper":205,base62:181,"esprima-fb":182}],198:[function(require,module,exports){var Syntax=require("esprima-fb").Syntax;var utils=require("../src/utils");var reservedWordsHelper=require("./reserved-words-helper");var restParamVisitors=require("./es6-rest-param-visitors");var restPropertyHelpers=require("./es7-rest-property-helpers");function visitStructuredVariable(traverse,node,path,state){utils.append(utils.getTempVar(state.localScope.tempVarIndex)+"=",state);utils.catchupWhiteSpace(node.init.range[0],state);traverse(node.init,path,state);utils.catchup(node.init.range[1],state);utils.append(","+getDestructuredComponents(node.id,state),state);state.localScope.tempVarIndex++;return false}visitStructuredVariable.test=function(node,path,state){return node.type===Syntax.VariableDeclarator&&isStructuredPattern(node.id)};function isStructuredPattern(node){return node.type===Syntax.ObjectPattern||node.type===Syntax.ArrayPattern}function getDestructuredComponents(node,state){var tmpIndex=state.localScope.tempVarIndex;var components=[];var patternItems=getPatternItems(node);for(var idx=0;idx<patternItems.length;idx++){var item=patternItems[idx];if(!item){continue}if(item.type===Syntax.SpreadElement){components.push(item.argument.name+"=Array.prototype.slice.call("+utils.getTempVar(tmpIndex)+","+idx+")");continue}if(item.type===Syntax.SpreadProperty){var restExpression=restPropertyHelpers.renderRestExpression(utils.getTempVar(tmpIndex),patternItems);components.push(item.argument.name+"="+restExpression);continue}var accessor=getPatternItemAccessor(node,item,tmpIndex,idx);var value=getPatternItemValue(node,item);if(value.type===Syntax.Identifier){components.push(value.name+"="+accessor)}else{components.push(utils.getTempVarWithValue(++state.localScope.tempVarIndex,accessor)+","+getDestructuredComponents(value,state))}}return components.join(",")}function getPatternItems(node){return node.properties||node.elements}function getPatternItemAccessor(node,patternItem,tmpIndex,idx){var tmpName=utils.getTempVar(tmpIndex);if(node.type===Syntax.ObjectPattern){if(reservedWordsHelper.isReservedWord(patternItem.key.name)){return tmpName+'["'+patternItem.key.name+'"]'}else if(patternItem.key.type===Syntax.Literal){return tmpName+"["+JSON.stringify(patternItem.key.value)+"]"}else if(patternItem.key.type===Syntax.Identifier){return tmpName+"."+patternItem.key.name}}else if(node.type===Syntax.ArrayPattern){return tmpName+"["+idx+"]"}}function getPatternItemValue(node,patternItem){return node.type===Syntax.ObjectPattern?patternItem.value:patternItem}function visitStructuredAssignment(traverse,node,path,state){var exprNode=node.expression;utils.append("var "+utils.getTempVar(state.localScope.tempVarIndex)+"=",state);utils.catchupWhiteSpace(exprNode.right.range[0],state);traverse(exprNode.right,path,state);utils.catchup(exprNode.right.range[1],state);utils.append(";"+getDestructuredComponents(exprNode.left,state)+";",state);utils.catchupWhiteSpace(node.range[1],state);state.localScope.tempVarIndex++;return false}visitStructuredAssignment.test=function(node,path,state){return node.type===Syntax.ExpressionStatement&&node.expression.type===Syntax.AssignmentExpression&&isStructuredPattern(node.expression.left)};function visitStructuredParameter(traverse,node,path,state){utils.append(utils.getTempVar(getParamIndex(node,path)),state);utils.catchupWhiteSpace(node.range[1],state);return true}function getParamIndex(paramNode,path){var funcNode=path[0];var tmpIndex=0;for(var k=0;k<funcNode.params.length;k++){var param=funcNode.params[k];if(param===paramNode){break}if(isStructuredPattern(param)){tmpIndex++}}return tmpIndex}visitStructuredParameter.test=function(node,path,state){return isStructuredPattern(node)&&isFunctionNode(path[0])};function isFunctionNode(node){return node.type==Syntax.FunctionDeclaration||node.type==Syntax.FunctionExpression||node.type==Syntax.MethodDefinition||node.type==Syntax.ArrowFunctionExpression}function visitFunctionBodyForStructuredParameter(traverse,node,path,state){var funcNode=path[0];utils.catchup(funcNode.body.range[0]+1,state);renderDestructuredComponents(funcNode,state);if(funcNode.rest){utils.append(restParamVisitors.renderRestParamSetup(funcNode,state),state)}return true}function renderDestructuredComponents(funcNode,state){var destructuredComponents=[];for(var k=0;k<funcNode.params.length;k++){var param=funcNode.params[k];if(isStructuredPattern(param)){destructuredComponents.push(getDestructuredComponents(param,state));state.localScope.tempVarIndex++}}if(destructuredComponents.length){utils.append("var "+destructuredComponents.join(",")+";",state)}}visitFunctionBodyForStructuredParameter.test=function(node,path,state){return node.type===Syntax.BlockStatement&&isFunctionNode(path[0])};exports.visitorList=[visitStructuredVariable,visitStructuredAssignment,visitStructuredParameter,visitFunctionBodyForStructuredParameter];exports.renderDestructuredComponents=renderDestructuredComponents},{"../src/utils":195,"./es6-rest-param-visitors":201,"./es7-rest-property-helpers":203,"./reserved-words-helper":205,"esprima-fb":182}],199:[function(require,module,exports){var Syntax=require("esprima-fb").Syntax;var utils=require("../src/utils");var reservedWordsHelper=require("./reserved-words-helper");function visitObjectConciseMethod(traverse,node,path,state){var isGenerator=node.value.generator;if(isGenerator){utils.catchupWhiteSpace(node.range[0]+1,state)}if(node.computed){utils.catchup(node.key.range[1]+1,state)}else if(reservedWordsHelper.isReservedWord(node.key.name)){utils.catchup(node.key.range[0],state);utils.append('"',state);utils.catchup(node.key.range[1],state);utils.append('"',state)}utils.catchup(node.key.range[1],state);utils.append(":function"+(isGenerator?"*":""),state);path.unshift(node);traverse(node.value,path,state);path.shift();return false}visitObjectConciseMethod.test=function(node,path,state){return node.type===Syntax.Property&&node.value.type===Syntax.FunctionExpression&&node.method===true};exports.visitorList=[visitObjectConciseMethod]},{"../src/utils":195,"./reserved-words-helper":205,"esprima-fb":182}],200:[function(require,module,exports){var Syntax=require("esprima-fb").Syntax;var utils=require("../src/utils");function visitObjectLiteralShortNotation(traverse,node,path,state){utils.catchup(node.key.range[1],state);utils.append(":"+node.key.name,state);return false}visitObjectLiteralShortNotation.test=function(node,path,state){return node.type===Syntax.Property&&node.kind==="init"&&node.shorthand===true&&path[0].type!==Syntax.ObjectPattern};exports.visitorList=[visitObjectLiteralShortNotation]},{"../src/utils":195,"esprima-fb":182}],201:[function(require,module,exports){var Syntax=require("esprima-fb").Syntax;var utils=require("../src/utils");function _nodeIsFunctionWithRestParam(node){return(node.type===Syntax.FunctionDeclaration||node.type===Syntax.FunctionExpression||node.type===Syntax.ArrowFunctionExpression)&&node.rest}function visitFunctionParamsWithRestParam(traverse,node,path,state){if(node.parametricType){utils.catchup(node.parametricType.range[0],state);path.unshift(node);traverse(node.parametricType,path,state);path.shift()}if(node.params.length){path.unshift(node);traverse(node.params,path,state);path.shift()}else{utils.catchup(node.rest.range[0]-3,state)}utils.catchupWhiteSpace(node.rest.range[1],state);path.unshift(node);traverse(node.body,path,state);path.shift();return false}visitFunctionParamsWithRestParam.test=function(node,path,state){return _nodeIsFunctionWithRestParam(node)};function renderRestParamSetup(functionNode,state){var idx=state.localScope.tempVarIndex++;var len=state.localScope.tempVarIndex++;return"for (var "+functionNode.rest.name+"=[],"+utils.getTempVarWithValue(idx,functionNode.params.length)+","+utils.getTempVarWithValue(len,"arguments.length")+";"+utils.getTempVar(idx)+"<"+utils.getTempVar(len)+";"+utils.getTempVar(idx)+"++) "+functionNode.rest.name+".push(arguments["+utils.getTempVar(idx)+"]);"}function visitFunctionBodyWithRestParam(traverse,node,path,state){utils.catchup(node.range[0]+1,state);var parentNode=path[0];utils.append(renderRestParamSetup(parentNode,state),state);return true}visitFunctionBodyWithRestParam.test=function(node,path,state){return node.type===Syntax.BlockStatement&&_nodeIsFunctionWithRestParam(path[0])};exports.renderRestParamSetup=renderRestParamSetup;exports.visitorList=[visitFunctionParamsWithRestParam,visitFunctionBodyWithRestParam]},{"../src/utils":195,"esprima-fb":182}],202:[function(require,module,exports){"use strict";var Syntax=require("esprima-fb").Syntax;var utils=require("../src/utils");function visitTemplateLiteral(traverse,node,path,state){var templateElements=node.quasis;utils.append("(",state);for(var ii=0;ii<templateElements.length;ii++){var templateElement=templateElements[ii];if(templateElement.value.raw!==""){utils.append(getCookedValue(templateElement),state);if(!templateElement.tail){utils.append(" + ",state)}utils.move(templateElement.range[0],state);utils.catchupNewlines(templateElement.range[1],state)}else{if(ii>0&&!templateElement.tail){utils.append(" + ",state)}}utils.move(templateElement.range[1],state);if(!templateElement.tail){var substitution=node.expressions[ii];if(substitution.type===Syntax.Identifier||substitution.type===Syntax.MemberExpression||substitution.type===Syntax.CallExpression){utils.catchup(substitution.range[1],state)}else{utils.append("(",state);traverse(substitution,path,state);utils.catchup(substitution.range[1],state);utils.append(")",state)}if(templateElements[ii+1].value.cooked!==""){utils.append(" + ",state)}}}utils.move(node.range[1],state);utils.append(")",state);return false}visitTemplateLiteral.test=function(node,path,state){return node.type===Syntax.TemplateLiteral};function visitTaggedTemplateExpression(traverse,node,path,state){var template=node.quasi;var numQuasis=template.quasis.length;utils.move(node.tag.range[0],state);traverse(node.tag,path,state);utils.catchup(node.tag.range[1],state);utils.append("(function() { var siteObj = [",state);for(var ii=0;ii<numQuasis;ii++){utils.append(getCookedValue(template.quasis[ii]),state);if(ii!==numQuasis-1){utils.append(", ",state)}}utils.append("]; siteObj.raw = [",state);for(ii=0;ii<numQuasis;ii++){utils.append(getRawValue(template.quasis[ii]),state);if(ii!==numQuasis-1){utils.append(", ",state)}}utils.append("]; Object.freeze(siteObj.raw); Object.freeze(siteObj); return siteObj; }()",state);if(numQuasis>1){for(ii=0;ii<template.expressions.length;ii++){var expression=template.expressions[ii];utils.append(", ",state);utils.move(template.quasis[ii].range[0],state);utils.catchupNewlines(template.quasis[ii].range[1],state);utils.move(expression.range[0],state);traverse(expression,path,state);utils.catchup(expression.range[1],state)}}utils.catchupNewlines(node.range[1],state);utils.append(")",state);return false}visitTaggedTemplateExpression.test=function(node,path,state){return node.type===Syntax.TaggedTemplateExpression};function getCookedValue(templateElement){return JSON.stringify(templateElement.value.cooked)}function getRawValue(templateElement){return JSON.stringify(templateElement.value.raw)}exports.visitorList=[visitTemplateLiteral,visitTaggedTemplateExpression]},{"../src/utils":195,"esprima-fb":182}],203:[function(require,module,exports){arguments[4][165][0].apply(exports,arguments)},{"../src/utils":195,dup:165,"esprima-fb":182}],204:[function(require,module,exports){var Syntax=require("esprima-fb").Syntax;var utils=require("../src/utils");function visitObjectLiteralSpread(traverse,node,path,state){utils.catchup(node.range[0],state);utils.append("Object.assign({",state);utils.move(node.range[0]+1,state);var previousWasSpread=false;for(var i=0;i<node.properties.length;i++){var property=node.properties[i];if(property.type===Syntax.SpreadProperty){if(!previousWasSpread){utils.append("}",state)}if(i===0){utils.append(",",state)}utils.catchup(property.range[0],state);utils.move(property.range[0]+3,state);traverse(property.argument,path,state);utils.catchup(property.range[1],state);previousWasSpread=true}else{utils.catchup(property.range[0],state);if(previousWasSpread){utils.append("{",state)}traverse(property,path,state);utils.catchup(property.range[1],state);previousWasSpread=false}}utils.catchupWhiteSpace(node.range[1]-1,state);utils.move(node.range[1],state);if(!previousWasSpread){utils.append("}",state)}utils.append(")",state);return false}visitObjectLiteralSpread.test=function(node,path,state){if(node.type!==Syntax.ObjectExpression){return false}var hasAtLeastOneSpreadProperty=false;for(var i=0;i<node.properties.length;i++){var property=node.properties[i];if(property.type===Syntax.SpreadProperty){hasAtLeastOneSpreadProperty=true}else if(property.kind!=="init"){return false}}return hasAtLeastOneSpreadProperty};exports.visitorList=[visitObjectLiteralSpread]},{"../src/utils":195,"esprima-fb":182}],205:[function(require,module,exports){var KEYWORDS=["break","do","in","typeof","case","else","instanceof","var","catch","export","new","void","class","extends","return","while","const","finally","super","with","continue","for","switch","yield","debugger","function","this","default","if","throw","delete","import","try"];var FUTURE_RESERVED_WORDS=["enum","await","implements","package","protected","static","interface","private","public"];var LITERALS=["null","true","false"];var RESERVED_WORDS=[].concat(KEYWORDS,FUTURE_RESERVED_WORDS,LITERALS);var reservedWordsMap=Object.create(null);RESERVED_WORDS.forEach(function(k){reservedWordsMap[k]=true});exports.isReservedWord=function(word){return!!reservedWordsMap[word]}},{}],206:[function(require,module,exports){var esprima=require("esprima-fb");var utils=require("../src/utils");var Syntax=esprima.Syntax;function _isFunctionNode(node){return node.type===Syntax.FunctionDeclaration||node.type===Syntax.FunctionExpression||node.type===Syntax.ArrowFunctionExpression}function visitClassProperty(traverse,node,path,state){utils.catchup(node.range[0],state);utils.catchupWhiteOut(node.range[1],state);return false}visitClassProperty.test=function(node,path,state){return node.type===Syntax.ClassProperty};function visitTypeAlias(traverse,node,path,state){utils.catchupWhiteOut(node.range[1],state);return false}visitTypeAlias.test=function(node,path,state){return node.type===Syntax.TypeAlias};function visitInterfaceDeclaration(traverse,node,path,state){utils.catchupWhiteOut(node.range[1],state);return false}visitInterfaceDeclaration.test=function(node,path,state){return node.type===Syntax.InterfaceDeclaration};function visitDeclare(traverse,node,path,state){utils.catchupWhiteOut(node.range[1],state);return false}visitDeclare.test=function(node,path,state){switch(node.type){case Syntax.DeclareVariable:case Syntax.DeclareFunction:case Syntax.DeclareClass:case Syntax.DeclareModule:return true}return false};function visitFunctionParametricAnnotation(traverse,node,path,state){utils.catchup(node.range[0],state);utils.catchupWhiteOut(node.range[1],state);return false}visitFunctionParametricAnnotation.test=function(node,path,state){return node.type===Syntax.TypeParameterDeclaration&&path[0]&&_isFunctionNode(path[0])&&node===path[0].typeParameters};function visitFunctionReturnAnnotation(traverse,node,path,state){utils.catchup(node.range[0],state);
utils.catchupWhiteOut(node.range[1],state);return false}visitFunctionReturnAnnotation.test=function(node,path,state){return path[0]&&_isFunctionNode(path[0])&&node===path[0].returnType};function visitOptionalFunctionParameterAnnotation(traverse,node,path,state){utils.catchup(node.range[0]+node.name.length,state);utils.catchupWhiteOut(node.range[1],state);return false}visitOptionalFunctionParameterAnnotation.test=function(node,path,state){return node.type===Syntax.Identifier&&node.optional&&path[0]&&_isFunctionNode(path[0])};function visitTypeAnnotatedIdentifier(traverse,node,path,state){utils.catchup(node.typeAnnotation.range[0],state);utils.catchupWhiteOut(node.typeAnnotation.range[1],state);return false}visitTypeAnnotatedIdentifier.test=function(node,path,state){return node.type===Syntax.Identifier&&node.typeAnnotation};function visitTypeAnnotatedObjectOrArrayPattern(traverse,node,path,state){utils.catchup(node.typeAnnotation.range[0],state);utils.catchupWhiteOut(node.typeAnnotation.range[1],state);return false}visitTypeAnnotatedObjectOrArrayPattern.test=function(node,path,state){var rightType=node.type===Syntax.ObjectPattern||node.type===Syntax.ArrayPattern;return rightType&&node.typeAnnotation};function visitMethod(traverse,node,path,state){path.unshift(node);traverse(node.key,path,state);path.unshift(node.value);traverse(node.value.params,path,state);node.value.rest&&traverse(node.value.rest,path,state);node.value.returnType&&traverse(node.value.returnType,path,state);traverse(node.value.body,path,state);path.shift();path.shift();return false}visitMethod.test=function(node,path,state){return node.type==="Property"&&(node.method||node.kind==="set"||node.kind==="get")||node.type==="MethodDefinition"};exports.visitorList=[visitClassProperty,visitDeclare,visitInterfaceDeclaration,visitFunctionParametricAnnotation,visitFunctionReturnAnnotation,visitMethod,visitOptionalFunctionParameterAnnotation,visitTypeAlias,visitTypeAnnotatedIdentifier,visitTypeAnnotatedObjectOrArrayPattern]},{"../src/utils":195,"esprima-fb":182}],207:[function(require,module,exports){"use strict";var visitors=require("./vendor/fbtransform/visitors");var transform=require("jstransform").transform;var typesSyntax=require("jstransform/visitors/type-syntax");var Buffer=require("buffer").Buffer;module.exports={transform:function(input,options){var output=innerTransform(input,options);var result=output.code;if(options&&options.sourceMap){var map=inlineSourceMap(output.sourceMap,input,options.sourceFilename);result+="\n"+map}return result},transformWithDetails:function(input,options){var output=innerTransform(input,options);var result={};result.code=output.code;if(options&&options.sourceMap){result.sourceMap=output.sourceMap.toJSON()}return result}};function innerTransform(input,options){options=options||{};var visitorSets=["react"];if(options.harmony){visitorSets.push("harmony")}if(options.stripTypes){input=transform(typesSyntax.visitorList,input,options).code}var visitorList=visitors.getVisitorsBySet(visitorSets);return transform(visitorList,input,options)}function inlineSourceMap(sourceMap,sourceCode,sourceFilename){var json=sourceMap.toJSON();json.sources=[sourceFilename];json.sourcesContent=[sourceCode];var base64=Buffer(JSON.stringify(json)).toString("base64");return"//# sourceMappingURL=data:application/json;base64,"+base64}},{"./vendor/fbtransform/visitors":211,buffer:2,jstransform:194,"jstransform/visitors/type-syntax":206}],208:[function(require,module,exports){"use strict";var Syntax=require("jstransform").Syntax;var utils=require("jstransform/src/utils");var FALLBACK_TAGS=require("./xjs").knownTags;var renderXJSExpressionContainer=require("./xjs").renderXJSExpressionContainer;var renderXJSLiteral=require("./xjs").renderXJSLiteral;var quoteAttrName=require("./xjs").quoteAttrName;var trimLeft=require("./xjs").trimLeft;var reNonWhiteParen=/([^\s\(\)])/g;function stripNonWhiteParen(value){return value.replace(reNonWhiteParen,"")}var tagConvention=/^[a-z]|\-/;function isTagName(name){return tagConvention.test(name)}function visitReactTag(traverse,object,path,state){var openingElement=object.openingElement;var nameObject=openingElement.name;var attributesObject=openingElement.attributes;utils.catchup(openingElement.range[0],state,trimLeft);if(nameObject.type===Syntax.XJSNamespacedName&&nameObject.namespace){throw new Error("Namespace tags are not supported. ReactJSX is not XML.")}utils.append("React.createElement(",state);if(nameObject.type===Syntax.XJSIdentifier&&isTagName(nameObject.name)){if(!FALLBACK_TAGS.hasOwnProperty(nameObject.name)){throw new Error("Lower case component names ("+nameObject.name+") are no longer "+"supported in JSX: See http://fb.me/react-jsx-lower-case")}utils.append('"'+nameObject.name+'"',state);utils.move(nameObject.range[1],state)}else{utils.move(nameObject.range[0],state);utils.catchup(nameObject.range[1],state)}utils.append(", ",state);var hasAttributes=attributesObject.length;var hasAtLeastOneSpreadProperty=attributesObject.some(function(attr){return attr.type===Syntax.XJSSpreadAttribute});if(hasAtLeastOneSpreadProperty){utils.append("React.__spread({",state)}else if(hasAttributes){utils.append("{",state)}else{utils.append("null",state)}var previousWasSpread=false;attributesObject.forEach(function(attr,index){var isLast=index===attributesObject.length-1;if(attr.type===Syntax.XJSSpreadAttribute){if(!previousWasSpread){utils.append("}, ",state)}utils.catchup(attr.range[0],state,stripNonWhiteParen);utils.move(attr.range[0]+1,state);utils.catchup(attr.argument.range[0],state,stripNonWhiteParen);traverse(attr.argument,path,state);utils.catchup(attr.argument.range[1],state);utils.catchup(attr.range[1]-1,state,stripNonWhiteParen);if(!isLast){utils.append(", ",state)}utils.move(attr.range[1],state);previousWasSpread=true;return}if(!isLast){isLast=attributesObject[index+1].type===Syntax.XJSSpreadAttribute}if(attr.name.namespace){throw new Error("Namespace attributes are not supported. ReactJSX is not XML.")}var name=attr.name.name;utils.catchup(attr.range[0],state,trimLeft);if(previousWasSpread){utils.append("{",state)}utils.append(quoteAttrName(name),state);utils.append(": ",state);if(!attr.value){state.g.buffer+="true";state.g.position=attr.name.range[1];if(!isLast){utils.append(", ",state)}}else{utils.move(attr.name.range[1],state);utils.catchupNewlines(attr.value.range[0],state);if(attr.value.type===Syntax.Literal){renderXJSLiteral(attr.value,isLast,state)}else{renderXJSExpressionContainer(traverse,attr.value,isLast,path,state)}}utils.catchup(attr.range[1],state,trimLeft);previousWasSpread=false});if(!openingElement.selfClosing){utils.catchup(openingElement.range[1]-1,state,trimLeft);utils.move(openingElement.range[1],state)}if(hasAttributes&&!previousWasSpread){utils.append("}",state)}if(hasAtLeastOneSpreadProperty){utils.append(")",state)}var childrenToRender=object.children.filter(function(child){return!(child.type===Syntax.Literal&&typeof child.value==="string"&&child.value.match(/^[ \t]*[\r\n][ \t\r\n]*$/))});if(childrenToRender.length>0){var lastRenderableIndex;childrenToRender.forEach(function(child,index){if(child.type!==Syntax.XJSExpressionContainer||child.expression.type!==Syntax.XJSEmptyExpression){lastRenderableIndex=index}});if(lastRenderableIndex!==undefined){utils.append(", ",state)}childrenToRender.forEach(function(child,index){utils.catchup(child.range[0],state,trimLeft);var isLast=index>=lastRenderableIndex;if(child.type===Syntax.Literal){renderXJSLiteral(child,isLast,state)}else if(child.type===Syntax.XJSExpressionContainer){renderXJSExpressionContainer(traverse,child,isLast,path,state)}else{traverse(child,path,state);if(!isLast){utils.append(", ",state)}}utils.catchup(child.range[1],state,trimLeft)})}if(openingElement.selfClosing){utils.catchup(openingElement.range[1]-2,state,trimLeft);utils.move(openingElement.range[1],state)}else{utils.catchup(object.closingElement.range[0],state,trimLeft);utils.move(object.closingElement.range[1],state)}utils.append(")",state);return false}visitReactTag.test=function(object,path,state){return object.type===Syntax.XJSElement};exports.visitorList=[visitReactTag]},{"./xjs":210,jstransform:194,"jstransform/src/utils":195}],209:[function(require,module,exports){"use strict";var Syntax=require("jstransform").Syntax;var utils=require("jstransform/src/utils");function addDisplayName(displayName,object,state){if(object&&object.type===Syntax.CallExpression&&object.callee.type===Syntax.MemberExpression&&object.callee.object.type===Syntax.Identifier&&object.callee.object.name==="React"&&object.callee.property.type===Syntax.Identifier&&object.callee.property.name==="createClass"&&object["arguments"].length===1&&object["arguments"][0].type===Syntax.ObjectExpression){var properties=object["arguments"][0].properties;var safe=properties.every(function(property){var value=property.key.type===Syntax.Identifier?property.key.name:property.key.value;return value!=="displayName"});if(safe){utils.catchup(object["arguments"][0].range[0]+1,state);utils.append("displayName: '"+displayName+"',",state)}}}function visitReactDisplayName(traverse,object,path,state){var left,right;if(object.type===Syntax.AssignmentExpression){left=object.left;right=object.right}else if(object.type===Syntax.Property){left=object.key;right=object.value}else if(object.type===Syntax.VariableDeclarator){left=object.id;right=object.init}if(left&&left.type===Syntax.MemberExpression){left=left.property}if(left&&left.type===Syntax.Identifier){addDisplayName(left.name,right,state)}}visitReactDisplayName.test=function(object,path,state){return object.type===Syntax.AssignmentExpression||object.type===Syntax.Property||object.type===Syntax.VariableDeclarator};exports.visitorList=[visitReactDisplayName]},{jstransform:194,"jstransform/src/utils":195}],210:[function(require,module,exports){"use strict";var Syntax=require("jstransform").Syntax;var utils=require("jstransform/src/utils");var knownTags={a:true,abbr:true,address:true,applet:true,area:true,article:true,aside:true,audio:true,b:true,base:true,bdi:true,bdo:true,big:true,blockquote:true,body:true,br:true,button:true,canvas:true,caption:true,circle:true,cite:true,code:true,col:true,colgroup:true,command:true,data:true,datalist:true,dd:true,defs:true,del:true,details:true,dfn:true,dialog:true,div:true,dl:true,dt:true,ellipse:true,em:true,embed:true,fieldset:true,figcaption:true,figure:true,footer:true,form:true,g:true,h1:true,h2:true,h3:true,h4:true,h5:true,h6:true,head:true,header:true,hgroup:true,hr:true,html:true,i:true,iframe:true,img:true,input:true,ins:true,kbd:true,keygen:true,label:true,legend:true,li:true,line:true,linearGradient:true,link:true,main:true,map:true,mark:true,marquee:true,mask:false,menu:true,menuitem:true,meta:true,meter:true,nav:true,noscript:true,object:true,ol:true,optgroup:true,option:true,output:true,p:true,param:true,path:true,pattern:false,picture:true,polygon:true,polyline:true,pre:true,progress:true,q:true,radialGradient:true,rect:true,rp:true,rt:true,ruby:true,s:true,samp:true,script:true,section:true,select:true,small:true,source:true,span:true,stop:true,strong:true,style:true,sub:true,summary:true,sup:true,svg:true,table:true,tbody:true,td:true,text:true,textarea:true,tfoot:true,th:true,thead:true,time:true,title:true,tr:true,track:true,tspan:true,u:true,ul:true,var:true,video:true,wbr:true};function renderXJSLiteral(object,isLast,state,start,end){var lines=object.value.split(/\r\n|\n|\r/);if(start){utils.append(start,state)}var lastNonEmptyLine=0;lines.forEach(function(line,index){if(line.match(/[^ \t]/)){lastNonEmptyLine=index}});lines.forEach(function(line,index){var isFirstLine=index===0;var isLastLine=index===lines.length-1;var isLastNonEmptyLine=index===lastNonEmptyLine;var trimmedLine=line.replace(/\t/g," ");if(!isFirstLine){trimmedLine=trimmedLine.replace(/^[ ]+/,"")}if(!isLastLine){trimmedLine=trimmedLine.replace(/[ ]+$/,"")}if(!isFirstLine){utils.append(line.match(/^[ \t]*/)[0],state)}if(trimmedLine||isLastNonEmptyLine){utils.append(JSON.stringify(trimmedLine)+(!isLastNonEmptyLine?" + ' ' +":""),state);if(isLastNonEmptyLine){if(end){utils.append(end,state)}if(!isLast){utils.append(", ",state)}}if(trimmedLine&&!isLastLine){utils.append(line.match(/[ \t]*$/)[0],state)}}if(!isLastLine){utils.append("\n",state)}});utils.move(object.range[1],state)}function renderXJSExpressionContainer(traverse,object,isLast,path,state){utils.move(object.range[0]+1,state);traverse(object.expression,path,state);if(!isLast&&object.expression.type!==Syntax.XJSEmptyExpression){utils.catchup(object.expression.range[1],state,trimLeft);utils.append(", ",state)}utils.catchup(object.range[1]-1,state,trimLeft);utils.move(object.range[1],state);return false}function quoteAttrName(attr){if(!/^[a-z_$][a-z\d_$]*$/i.test(attr)){return"'"+attr+"'"}return attr}function trimLeft(value){return value.replace(/^[ ]+/,"")}exports.knownTags=knownTags;exports.renderXJSExpressionContainer=renderXJSExpressionContainer;exports.renderXJSLiteral=renderXJSLiteral;exports.quoteAttrName=quoteAttrName;exports.trimLeft=trimLeft},{jstransform:194,"jstransform/src/utils":195}],211:[function(require,module,exports){var es6ArrowFunctions=require("jstransform/visitors/es6-arrow-function-visitors");var es6Classes=require("jstransform/visitors/es6-class-visitors");var es6Destructuring=require("jstransform/visitors/es6-destructuring-visitors");var es6ObjectConciseMethod=require("jstransform/visitors/es6-object-concise-method-visitors");var es6ObjectShortNotation=require("jstransform/visitors/es6-object-short-notation-visitors");var es6RestParameters=require("jstransform/visitors/es6-rest-param-visitors");var es6Templates=require("jstransform/visitors/es6-template-visitors");var es7SpreadProperty=require("jstransform/visitors/es7-spread-property-visitors");var react=require("./transforms/react");var reactDisplayName=require("./transforms/reactDisplayName");var transformVisitors={"es6-arrow-functions":es6ArrowFunctions.visitorList,"es6-classes":es6Classes.visitorList,"es6-destructuring":es6Destructuring.visitorList,"es6-object-concise-method":es6ObjectConciseMethod.visitorList,"es6-object-short-notation":es6ObjectShortNotation.visitorList,"es6-rest-params":es6RestParameters.visitorList,"es6-templates":es6Templates.visitorList,"es7-spread-property":es7SpreadProperty.visitorList,react:react.visitorList.concat(reactDisplayName.visitorList)};var transformSets={harmony:["es6-arrow-functions","es6-object-concise-method","es6-object-short-notation","es6-classes","es6-rest-params","es6-templates","es6-destructuring","es7-spread-property"],react:["react"]};var transformRunOrder=["es6-arrow-functions","es6-object-concise-method","es6-object-short-notation","es6-classes","es6-rest-params","es6-templates","es6-destructuring","es7-spread-property","react"];function getAllVisitors(excludes){var ret=[];for(var i=0,il=transformRunOrder.length;i<il;i++){if(!excludes||excludes.indexOf(transformRunOrder[i])===-1){ret=ret.concat(transformVisitors[transformRunOrder[i]])}}return ret}function getVisitorsBySet(sets){var visitorsToInclude=sets.reduce(function(visitors,set){if(!transformSets.hasOwnProperty(set)){throw new Error("Unknown visitor set: "+set)}transformSets[set].forEach(function(visitor){visitors[visitor]=true});return visitors},{});var visitorList=[];for(var i=0;i<transformRunOrder.length;i++){if(visitorsToInclude.hasOwnProperty(transformRunOrder[i])){visitorList=visitorList.concat(transformVisitors[transformRunOrder[i]])}}return visitorList}exports.getVisitorsBySet=getVisitorsBySet;exports.getAllVisitors=getAllVisitors;exports.transformVisitors=transformVisitors},{"./transforms/react":208,"./transforms/reactDisplayName":209,"jstransform/visitors/es6-arrow-function-visitors":196,"jstransform/visitors/es6-class-visitors":197,"jstransform/visitors/es6-destructuring-visitors":198,"jstransform/visitors/es6-object-concise-method-visitors":199,"jstransform/visitors/es6-object-short-notation-visitors":200,"jstransform/visitors/es6-rest-param-visitors":201,"jstransform/visitors/es6-template-visitors":202,"jstransform/visitors/es7-spread-property-visitors":204}],212:[function(require,module,exports){var Promise=require("bluebird");var React=require("react/addons");var PT=React.PropTypes;module.exports=function(options){if("function"===typeof options){options={storeAttrs:options}}var pluginUpdates=[];var plugin={propTypes:{store:PT.object.isRequired},getInitialState:function(){var state=options.storeAttrs.call(this,this.props.store.getters,this.props);var extra;if(options.initStoreState){extra=options.initStoreState.call(this,state,this.props.store.getters,this.props);for(var name in extra)state[name]=extra[name]}for(var i=0;i<pluginUpdates.length;i++){extra=pluginUpdates[i].call(this,state,this.props.store.getters,this.props);for(name in extra)state[name]=extra[name]}return state},listen:function(){var changes=[].slice.call(arguments);if(arguments.length===1&&Array.isArray(arguments[0])){changes=arguments[0]}pluginUpdates=[];if(this.props.plugins){this.props.plugins.forEach(function(plugin){if(!plugin.listener)return;if(plugin.listener.updateStoreState){pluginUpdates.push(plugin.listener.updateStoreState)}if(plugin.listener.changes){changes=changes.concat(plugin.listener.changes)}})}this.props.store.on(changes,this._gotChanges);if(!this._flux)this._flux=[];this._flux.push([changes,this._gotChanges])},_gotChanges:function(){var state=options.storeAttrs.call(this,this.props.store.getters,this.props);var extra,name;if(options.updateStoreState){extra=options.updateStoreState.call(this,state,this.props.store.getters,this.props);for(name in extra)state[name]=extra[name]}for(var i=0;i<pluginUpdates.length;i++){extra=pluginUpdates[i].call(this,state,this.props.store.getters,this.props);for(name in extra)state[name]=extra[name]}if(window.DEBUG_CHANGES){console.log("got changes",state)}var p=Promise.pending();this.setState(state,function(){p.resolve()});return p},componentWillReceiveProps:options.shouldGetNew&&function(nextProps){if(options.shouldGetNew.call(this,nextProps)){if(options.getListeners){this._stopListening();this.listen(options.getListeners(nextProps,nextProps.store.events))}var state=options.storeAttrs.call(this,nextProps.store.getters,nextProps);var extra;if(options.initStoreState){extra=options.initStoreState.call(this,state,nextProps.store.getters,nextProps);for(var name in extra)state[name]=extra[name]}this.setState(state)}},_stopListening:function(){for(var i=0;i<this._flux.length;i++){this.props.store.off(this._flux[i][0],this._flux[i][1])}this._flux=null},componentWillUnmount:function(){if(!this._flux)return;this._stopListening()}};if(options.getListeners){plugin.componentWillMount=function(){this.listen(options.getListeners(this.props,this.props.store.events))}}return plugin}},{bluebird:215,"react/addons":"react/addons"}],213:[function(require,module,exports){"use strict";module.exports=function(Promise,Promise$_CreatePromiseArray,PromiseArray){var SomePromiseArray=require("./some_promise_array.js")(PromiseArray);function Promise$_Any(promises,useBound){var ret=Promise$_CreatePromiseArray(promises,SomePromiseArray,useBound===true&&promises._isBound()?promises._boundTo:void 0);var promise=ret.promise();if(promise.isRejected()){return promise}ret.setHowMany(1);ret.setUnwrap();ret.init();return promise}Promise.any=function Promise$Any(promises){return Promise$_Any(promises,false)};Promise.prototype.any=function Promise$any(){return Promise$_Any(this,true)}}},{"./some_promise_array.js":245}],214:[function(require,module,exports){"use strict";var schedule=require("./schedule.js");var Queue=require("./queue.js");var errorObj=require("./util.js").errorObj;var tryCatch1=require("./util.js").tryCatch1;var process=require("./global.js").process;function Async(){this._isTickUsed=false;this._length=0;this._lateBuffer=new Queue;this._functionBuffer=new Queue(25e3*3);var self=this;this.consumeFunctionBuffer=function Async$consumeFunctionBuffer(){self._consumeFunctionBuffer()}}Async.prototype.haveItemsQueued=function Async$haveItemsQueued(){return this._length>0};Async.prototype.invokeLater=function Async$invokeLater(fn,receiver,arg){if(process!==void 0&&process.domain!=null&&!fn.domain){fn=process.domain.bind(fn)}this._lateBuffer.push(fn,receiver,arg);this._queueTick()};Async.prototype.invoke=function Async$invoke(fn,receiver,arg){if(process!==void 0&&process.domain!=null&&!fn.domain){fn=process.domain.bind(fn)}var functionBuffer=this._functionBuffer;functionBuffer.push(fn,receiver,arg);this._length=functionBuffer.length();this._queueTick()};Async.prototype._consumeFunctionBuffer=function Async$_consumeFunctionBuffer(){var functionBuffer=this._functionBuffer;while(functionBuffer.length()>0){var fn=functionBuffer.shift();var receiver=functionBuffer.shift();var arg=functionBuffer.shift();fn.call(receiver,arg)}this._reset();this._consumeLateBuffer()};Async.prototype._consumeLateBuffer=function Async$_consumeLateBuffer(){var buffer=this._lateBuffer;while(buffer.length()>0){var fn=buffer.shift();var receiver=buffer.shift();var arg=buffer.shift();var res=tryCatch1(fn,receiver,arg);if(res===errorObj){this._queueTick();if(fn.domain!=null){fn.domain.emit("error",res.e)}else{throw res.e}}}};Async.prototype._queueTick=function Async$_queue(){if(!this._isTickUsed){schedule(this.consumeFunctionBuffer);this._isTickUsed=true}};Async.prototype._reset=function Async$_reset(){this._isTickUsed=false;this._length=0};module.exports=new Async},{"./global.js":227,"./queue.js":238,"./schedule.js":241,"./util.js":249}],215:[function(require,module,exports){"use strict";var Promise=require("./promise.js")();module.exports=Promise},{"./promise.js":231}],216:[function(require,module,exports){"use strict";module.exports=function(Promise){Promise.prototype.call=function Promise$call(propertyName){var $_len=arguments.length;var args=new Array($_len-1);for(var $_i=1;$_i<$_len;++$_i){args[$_i-1]=arguments[$_i]}return this._then(function(obj){return obj[propertyName].apply(obj,args)},void 0,void 0,void 0,void 0)};function Promise$getter(obj){var prop=typeof this==="string"?this:""+this;return obj[prop]}Promise.prototype.get=function Promise$get(propertyName){return this._then(Promise$getter,void 0,void 0,propertyName,void 0)}}},{}],217:[function(require,module,exports){"use strict";module.exports=function(Promise,INTERNAL){var errors=require("./errors.js");var async=require("./async.js");var CancellationError=errors.CancellationError;Promise.prototype._cancel=function Promise$_cancel(){if(!this.isCancellable())return this;var parent;var promiseToReject=this;while((parent=promiseToReject._cancellationParent)!==void 0&&parent.isCancellable()){promiseToReject=parent}var err=new CancellationError;promiseToReject._attachExtraTrace(err);promiseToReject._rejectUnchecked(err)};Promise.prototype.cancel=function Promise$cancel(){if(!this.isCancellable())return this;async.invokeLater(this._cancel,this,void 0);return this};Promise.prototype.cancellable=function Promise$cancellable(){if(this._cancellable())return this;this._setCancellable();this._cancellationParent=void 0;return this};Promise.prototype.uncancellable=function Promise$uncancellable(){var ret=new Promise(INTERNAL);ret._setTrace(this);ret._follow(this);ret._unsetCancellable();if(this._isBound())ret._setBoundTo(this._boundTo);return ret};Promise.prototype.fork=function Promise$fork(didFulfill,didReject,didProgress){var ret=this._then(didFulfill,didReject,didProgress,void 0,void 0);ret._setCancellable();ret._cancellationParent=void 0;return ret}}},{"./async.js":214,"./errors.js":221}],218:[function(require,module,exports){"use strict";module.exports=function(){var inherits=require("./util.js").inherits;var defineProperty=require("./es5.js").defineProperty;var rignore=new RegExp("\\b(?:[a-zA-Z0-9.]+\\$_\\w+|"+"tryCatch(?:1|2|Apply)|new \\w*PromiseArray|"+"\\w*PromiseArray\\.\\w*PromiseArray|"+"setTimeout|CatchFilter\\$_\\w+|makeNodePromisified|processImmediate|"+"process._tickCallback|nextTick|Async\\$\\w+)\\b");var rtraceline=null;var formatStack=null;function formatNonError(obj){var str;if(typeof obj==="function"){str="[function "+(obj.name||"anonymous")+"]"}else{str=obj.toString();var ruselessToString=/\[object [a-zA-Z0-9$_]+\]/;if(ruselessToString.test(str)){try{var newStr=JSON.stringify(obj);str=newStr}catch(e){}}if(str.length===0){str="(empty array)"}}return"(<"+snip(str)+">, no stack trace)"}function snip(str){var maxChars=41;if(str.length<maxChars){return str}return str.substr(0,maxChars-3)+"..."}function CapturedTrace(ignoreUntil,isTopLevel){this.captureStackTrace(CapturedTrace,isTopLevel)}inherits(CapturedTrace,Error);CapturedTrace.prototype.captureStackTrace=function CapturedTrace$captureStackTrace(ignoreUntil,isTopLevel){captureStackTrace(this,ignoreUntil,isTopLevel)};CapturedTrace.possiblyUnhandledRejection=function CapturedTrace$PossiblyUnhandledRejection(reason){if(typeof console==="object"){var message;if(typeof reason==="object"||typeof reason==="function"){var stack=reason.stack;message="Possibly unhandled "+formatStack(stack,reason)}else{message="Possibly unhandled "+String(reason)}if(typeof console.error==="function"||typeof console.error==="object"){console.error(message)}else if(typeof console.log==="function"||typeof console.log==="object"){console.log(message)}}};CapturedTrace.combine=function CapturedTrace$Combine(current,prev){var curLast=current.length-1;for(var i=prev.length-1;i>=0;--i){var line=prev[i];if(current[curLast]===line){current.pop();curLast--}else{break}}current.push("From previous event:");var lines=current.concat(prev);var ret=[];for(var i=0,len=lines.length;i<len;++i){if(rignore.test(lines[i])||i>0&&!rtraceline.test(lines[i])&&lines[i]!=="From previous event:"){continue}ret.push(lines[i])}return ret};CapturedTrace.isSupported=function CapturedTrace$IsSupported(){return typeof captureStackTrace==="function"};var captureStackTrace=function stackDetection(){if(typeof Error.stackTraceLimit==="number"&&typeof Error.captureStackTrace==="function"){rtraceline=/^\s*at\s*/;formatStack=function(stack,error){if(typeof stack==="string")return stack;if(error.name!==void 0&&error.message!==void 0){return error.name+". "+error.message}return formatNonError(error)};var captureStackTrace=Error.captureStackTrace;return function CapturedTrace$_captureStackTrace(receiver,ignoreUntil){captureStackTrace(receiver,ignoreUntil)}}var err=new Error;if(typeof err.stack==="string"&&typeof"".startsWith==="function"&&err.stack.startsWith("stackDetection@")&&stackDetection.name==="stackDetection"){defineProperty(Error,"stackTraceLimit",{writable:true,enumerable:false,configurable:false,value:25});rtraceline=/@/;var rline=/[@\n]/;formatStack=function(stack,error){if(typeof stack==="string"){return error.name+". "+error.message+"\n"+stack}if(error.name!==void 0&&error.message!==void 0){return error.name+". "+error.message}return formatNonError(error)};return function captureStackTrace(o){var stack=(new Error).stack;var split=stack.split(rline);var len=split.length;var ret="";for(var i=0;i<len;i+=2){ret+=split[i];ret+="@";ret+=split[i+1];ret+="\n"}o.stack=ret}}else{formatStack=function(stack,error){if(typeof stack==="string")return stack;if((typeof error==="object"||typeof error==="function")&&error.name!==void 0&&error.message!==void 0){return error.name+". "+error.message}return formatNonError(error)};return null}}();return CapturedTrace}},{"./es5.js":223,"./util.js":249}],219:[function(require,module,exports){"use strict";module.exports=function(NEXT_FILTER){var util=require("./util.js");var errors=require("./errors.js");var tryCatch1=util.tryCatch1;var errorObj=util.errorObj;var keys=require("./es5.js").keys;var TypeError=errors.TypeError;function CatchFilter(instances,callback,promise){this._instances=instances;this._callback=callback;this._promise=promise}function CatchFilter$_safePredicate(predicate,e){var safeObject={};var retfilter=tryCatch1(predicate,safeObject,e);if(retfilter===errorObj)return retfilter;var safeKeys=keys(safeObject);if(safeKeys.length){errorObj.e=new TypeError("Catch filter must inherit from Error "+"or be a simple predicate function");return errorObj}return retfilter}CatchFilter.prototype.doFilter=function CatchFilter$_doFilter(e){var cb=this._callback;var promise=this._promise;var boundTo=promise._isBound()?promise._boundTo:void 0;for(var i=0,len=this._instances.length;i<len;++i){var item=this._instances[i];var itemIsErrorType=item===Error||item!=null&&item.prototype instanceof Error;if(itemIsErrorType&&e instanceof item){var ret=tryCatch1(cb,boundTo,e);if(ret===errorObj){NEXT_FILTER.e=ret.e;return NEXT_FILTER}return ret}else if(typeof item==="function"&&!itemIsErrorType){var shouldHandle=CatchFilter$_safePredicate(item,e);if(shouldHandle===errorObj){var trace=errors.canAttach(errorObj.e)?errorObj.e:new Error(errorObj.e+"");this._promise._attachExtraTrace(trace);e=errorObj.e;break}else if(shouldHandle){var ret=tryCatch1(cb,boundTo,e);if(ret===errorObj){NEXT_FILTER.e=ret.e;return NEXT_FILTER}return ret}}}NEXT_FILTER.e=e;return NEXT_FILTER};return CatchFilter}},{"./errors.js":221,"./es5.js":223,"./util.js":249}],220:[function(require,module,exports){"use strict";var util=require("./util.js");var isPrimitive=util.isPrimitive;var wrapsPrimitiveReceiver=util.wrapsPrimitiveReceiver;module.exports=function(Promise){var returner=function Promise$_returner(){return this};var thrower=function Promise$_thrower(){throw this};var wrapper=function Promise$_wrapper(value,action){if(action===1){return function Promise$_thrower(){throw value}}else if(action===2){return function Promise$_returner(){return value}}};Promise.prototype["return"]=Promise.prototype.thenReturn=function Promise$thenReturn(value){if(wrapsPrimitiveReceiver&&isPrimitive(value)){return this._then(wrapper(value,2),void 0,void 0,void 0,void 0)}return this._then(returner,void 0,void 0,value,void 0)};Promise.prototype["throw"]=Promise.prototype.thenThrow=function Promise$thenThrow(reason){if(wrapsPrimitiveReceiver&&isPrimitive(reason)){return this._then(wrapper(reason,1),void 0,void 0,void 0,void 0)}return this._then(thrower,void 0,void 0,reason,void 0)}}},{"./util.js":249}],221:[function(require,module,exports){"use strict";var global=require("./global.js");var Objectfreeze=require("./es5.js").freeze;var util=require("./util.js");var inherits=util.inherits;var notEnumerableProp=util.notEnumerableProp;var Error=global.Error;function markAsOriginatingFromRejection(e){try{notEnumerableProp(e,"isAsync",true)}catch(ignore){}}function originatesFromRejection(e){if(e==null)return false;return e instanceof RejectionError||e["isAsync"]===true}function isError(obj){return obj instanceof Error}function canAttach(obj){return isError(obj)}function subError(nameProperty,defaultMessage){function SubError(message){if(!(this instanceof SubError))return new SubError(message);this.message=typeof message==="string"?message:defaultMessage;this.name=nameProperty;if(Error.captureStackTrace){Error.captureStackTrace(this,this.constructor)}}inherits(SubError,Error);return SubError}var TypeError=global.TypeError;if(typeof TypeError!=="function"){TypeError=subError("TypeError","type error")}var RangeError=global.RangeError;if(typeof RangeError!=="function"){RangeError=subError("RangeError","range error")}var CancellationError=subError("CancellationError","cancellation error");var TimeoutError=subError("TimeoutError","timeout error");function RejectionError(message){this.name="RejectionError";this.message=message;this.cause=message;this.isAsync=true;if(message instanceof Error){this.message=message.message;this.stack=message.stack}else if(Error.captureStackTrace){Error.captureStackTrace(this,this.constructor)}}inherits(RejectionError,Error);var key="__BluebirdErrorTypes__";var errorTypes=global[key];if(!errorTypes){errorTypes=Objectfreeze({CancellationError:CancellationError,TimeoutError:TimeoutError,RejectionError:RejectionError});
notEnumerableProp(global,key,errorTypes)}module.exports={Error:Error,TypeError:TypeError,RangeError:RangeError,CancellationError:errorTypes.CancellationError,RejectionError:errorTypes.RejectionError,TimeoutError:errorTypes.TimeoutError,originatesFromRejection:originatesFromRejection,markAsOriginatingFromRejection:markAsOriginatingFromRejection,canAttach:canAttach}},{"./es5.js":223,"./global.js":227,"./util.js":249}],222:[function(require,module,exports){"use strict";module.exports=function(Promise){var TypeError=require("./errors.js").TypeError;function apiRejection(msg){var error=new TypeError(msg);var ret=Promise.rejected(error);var parent=ret._peekContext();if(parent!=null){parent._attachExtraTrace(error)}return ret}return apiRejection}},{"./errors.js":221}],223:[function(require,module,exports){var isES5=function(){"use strict";return this===void 0}();if(isES5){module.exports={freeze:Object.freeze,defineProperty:Object.defineProperty,keys:Object.keys,getPrototypeOf:Object.getPrototypeOf,isArray:Array.isArray,isES5:isES5}}else{var has={}.hasOwnProperty;var str={}.toString;var proto={}.constructor.prototype;var ObjectKeys=function ObjectKeys(o){var ret=[];for(var key in o){if(has.call(o,key)){ret.push(key)}}return ret};var ObjectDefineProperty=function ObjectDefineProperty(o,key,desc){o[key]=desc.value;return o};var ObjectFreeze=function ObjectFreeze(obj){return obj};var ObjectGetPrototypeOf=function ObjectGetPrototypeOf(obj){try{return Object(obj).constructor.prototype}catch(e){return proto}};var ArrayIsArray=function ArrayIsArray(obj){try{return str.call(obj)==="[object Array]"}catch(e){return false}};module.exports={isArray:ArrayIsArray,keys:ObjectKeys,defineProperty:ObjectDefineProperty,freeze:ObjectFreeze,getPrototypeOf:ObjectGetPrototypeOf,isES5:isES5}}},{}],224:[function(require,module,exports){"use strict";module.exports=function(Promise){var isArray=require("./util.js").isArray;function Promise$_filter(booleans){var values=this instanceof Promise?this._settledValue:this;var len=values.length;var ret=new Array(len);var j=0;for(var i=0;i<len;++i){if(booleans[i])ret[j++]=values[i]}ret.length=j;return ret}var ref={ref:null};Promise.filter=function Promise$Filter(promises,fn){return Promise.map(promises,fn,ref)._then(Promise$_filter,void 0,void 0,ref.ref,void 0)};Promise.prototype.filter=function Promise$filter(fn){return this.map(fn,ref)._then(Promise$_filter,void 0,void 0,ref.ref,void 0)}}},{"./util.js":249}],225:[function(require,module,exports){"use strict";module.exports=function(Promise,NEXT_FILTER){var util=require("./util.js");var wrapsPrimitiveReceiver=util.wrapsPrimitiveReceiver;var isPrimitive=util.isPrimitive;var thrower=util.thrower;function returnThis(){return this}function throwThis(){throw this}function return$(r){return function Promise$_returner(){return r}}function throw$(r){return function Promise$_thrower(){throw r}}function promisedFinally(ret,reasonOrValue,isFulfilled){var then;if(wrapsPrimitiveReceiver&&isPrimitive(reasonOrValue)){then=isFulfilled?return$(reasonOrValue):throw$(reasonOrValue)}else{then=isFulfilled?returnThis:throwThis}return ret._then(then,thrower,void 0,reasonOrValue,void 0)}function finallyHandler(reasonOrValue){var promise=this.promise;var handler=this.handler;var ret=promise._isBound()?handler.call(promise._boundTo):handler();if(ret!==void 0){var maybePromise=Promise._cast(ret,void 0);if(maybePromise instanceof Promise){return promisedFinally(maybePromise,reasonOrValue,promise.isFulfilled())}}if(promise.isRejected()){NEXT_FILTER.e=reasonOrValue;return NEXT_FILTER}else{return reasonOrValue}}function tapHandler(value){var promise=this.promise;var handler=this.handler;var ret=promise._isBound()?handler.call(promise._boundTo,value):handler(value);if(ret!==void 0){var maybePromise=Promise._cast(ret,void 0);if(maybePromise instanceof Promise){return promisedFinally(maybePromise,value,true)}}return value}Promise.prototype._passThroughHandler=function Promise$_passThroughHandler(handler,isFinally){if(typeof handler!=="function")return this.then();var promiseAndHandler={promise:this,handler:handler};return this._then(isFinally?finallyHandler:tapHandler,isFinally?finallyHandler:void 0,void 0,promiseAndHandler,void 0)};Promise.prototype.lastly=Promise.prototype["finally"]=function Promise$finally(handler){return this._passThroughHandler(handler,true)};Promise.prototype.tap=function Promise$tap(handler){return this._passThroughHandler(handler,false)}}},{"./util.js":249}],226:[function(require,module,exports){"use strict";module.exports=function(Promise,apiRejection,INTERNAL){var PromiseSpawn=require("./promise_spawn.js")(Promise,INTERNAL);var errors=require("./errors.js");var TypeError=errors.TypeError;var deprecated=require("./util.js").deprecated;Promise.coroutine=function Promise$Coroutine(generatorFunction){if(typeof generatorFunction!=="function"){throw new TypeError("generatorFunction must be a function")}var PromiseSpawn$=PromiseSpawn;return function(){var generator=generatorFunction.apply(this,arguments);var spawn=new PromiseSpawn$(void 0,void 0);spawn._generator=generator;spawn._next(void 0);return spawn.promise()}};Promise.coroutine.addYieldHandler=PromiseSpawn.addYieldHandler;Promise.spawn=function Promise$Spawn(generatorFunction){deprecated("Promise.spawn is deprecated. Use Promise.coroutine instead.");if(typeof generatorFunction!=="function"){return apiRejection("generatorFunction must be a function")}var spawn=new PromiseSpawn(generatorFunction,this);var ret=spawn.promise();spawn._run(Promise.spawn);return ret}}},{"./errors.js":221,"./promise_spawn.js":234,"./util.js":249}],227:[function(require,module,exports){(function(global){module.exports=function(){if(this!==void 0)return this;try{return global}catch(e){}try{return window}catch(e){}try{return self}catch(e){}}()}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{}],228:[function(require,module,exports){"use strict";module.exports=function(Promise,PromiseArray,INTERNAL,apiRejection){var all=Promise.all;var util=require("./util.js");var canAttach=require("./errors.js").canAttach;var isArray=util.isArray;var _cast=Promise._cast;function unpack(values){return Promise$_Map(values,this[0],this[1],this[2])}function Promise$_Map(promises,fn,useBound,ref){if(typeof fn!=="function"){return apiRejection("fn must be a function")}var receiver=void 0;if(useBound===true){if(promises._isBound()){receiver=promises._boundTo}}else if(useBound!==false){receiver=useBound}var shouldUnwrapItems=ref!==void 0;if(shouldUnwrapItems)ref.ref=promises;if(promises instanceof Promise){var pack=[fn,receiver,ref];return promises._then(unpack,void 0,void 0,pack,void 0)}else if(!isArray(promises)){return apiRejection("expecting an array, a promise or a thenable")}var promise=new Promise(INTERNAL);if(receiver!==void 0)promise._setBoundTo(receiver);promise._setTrace(void 0);var mapping=new Mapping(promise,fn,promises,receiver,shouldUnwrapItems);mapping.init();return promise}var pending={};function Mapping(promise,callback,items,receiver,shouldUnwrapItems){this.shouldUnwrapItems=shouldUnwrapItems;this.index=0;this.items=items;this.callback=callback;this.receiver=receiver;this.promise=promise;this.result=new Array(items.length)}util.inherits(Mapping,PromiseArray);Mapping.prototype.init=function Mapping$init(){var items=this.items;var len=items.length;var result=this.result;var isRejected=false;for(var i=0;i<len;++i){var maybePromise=_cast(items[i],void 0);if(maybePromise instanceof Promise){if(maybePromise.isPending()){result[i]=pending;maybePromise._proxyPromiseArray(this,i)}else if(maybePromise.isFulfilled()){result[i]=maybePromise.value()}else{maybePromise._unsetRejectionIsUnhandled();if(!isRejected){this.reject(maybePromise.reason());isRejected=true}}}else{result[i]=maybePromise}}if(!isRejected)this.iterate()};Mapping.prototype.isResolved=function Mapping$isResolved(){return this.promise===null};Mapping.prototype._promiseProgressed=function Mapping$_promiseProgressed(value){if(this.isResolved())return;this.promise._progress(value)};Mapping.prototype._promiseFulfilled=function Mapping$_promiseFulfilled(value,index){if(this.isResolved())return;this.result[index]=value;if(this.shouldUnwrapItems)this.items[index]=value;if(this.index===index)this.iterate()};Mapping.prototype._promiseRejected=function Mapping$_promiseRejected(reason){this.reject(reason)};Mapping.prototype.reject=function Mapping$reject(reason){if(this.isResolved())return;var trace=canAttach(reason)?reason:new Error(reason+"");this.promise._attachExtraTrace(trace);this.promise._reject(reason,trace)};Mapping.prototype.iterate=function Mapping$iterate(){var i=this.index;var items=this.items;var result=this.result;var len=items.length;var result=this.result;var receiver=this.receiver;var callback=this.callback;for(;i<len;++i){var value=result[i];if(value===pending){this.index=i;return}try{result[i]=callback.call(receiver,value,i,len)}catch(e){return this.reject(e)}}this.promise._follow(all(result));this.items=this.result=this.callback=this.promise=null};Promise.prototype.map=function Promise$map(fn,ref){return Promise$_Map(this,fn,true,ref)};Promise.map=function Promise$Map(promises,fn,ref){return Promise$_Map(promises,fn,false,ref)}}},{"./errors.js":221,"./util.js":249}],229:[function(require,module,exports){"use strict";module.exports=function(Promise){var util=require("./util.js");var async=require("./async.js");var tryCatch2=util.tryCatch2;var tryCatch1=util.tryCatch1;var errorObj=util.errorObj;function thrower(r){throw r}function Promise$_successAdapter(val,receiver){var nodeback=this;var ret=val===void 0?tryCatch1(nodeback,receiver,null):tryCatch2(nodeback,receiver,null,val);if(ret===errorObj){async.invokeLater(thrower,void 0,ret.e)}}function Promise$_errorAdapter(reason,receiver){var nodeback=this;var ret=tryCatch1(nodeback,receiver,reason);if(ret===errorObj){async.invokeLater(thrower,void 0,ret.e)}}Promise.prototype.nodeify=function Promise$nodeify(nodeback){if(typeof nodeback=="function"){this._then(Promise$_successAdapter,Promise$_errorAdapter,void 0,nodeback,this._isBound()?this._boundTo:null)}return this}}},{"./async.js":214,"./util.js":249}],230:[function(require,module,exports){"use strict";module.exports=function(Promise,isPromiseArrayProxy){var util=require("./util.js");var async=require("./async.js");var errors=require("./errors.js");var tryCatch1=util.tryCatch1;var errorObj=util.errorObj;Promise.prototype.progressed=function Promise$progressed(handler){return this._then(void 0,void 0,handler,void 0,void 0)};Promise.prototype._progress=function Promise$_progress(progressValue){if(this._isFollowingOrFulfilledOrRejected())return;this._progressUnchecked(progressValue)};Promise.prototype._progressHandlerAt=function Promise$_progressHandlerAt(index){if(index===0)return this._progressHandler0;return this[index+2-5]};Promise.prototype._doProgressWith=function Promise$_doProgressWith(progression){var progressValue=progression.value;var handler=progression.handler;var promise=progression.promise;var receiver=progression.receiver;this._pushContext();var ret=tryCatch1(handler,receiver,progressValue);this._popContext();if(ret===errorObj){if(ret.e!=null&&ret.e.name!=="StopProgressPropagation"){var trace=errors.canAttach(ret.e)?ret.e:new Error(ret.e+"");promise._attachExtraTrace(trace);promise._progress(ret.e)}}else if(ret instanceof Promise){ret._then(promise._progress,null,null,promise,void 0)}else{promise._progress(ret)}};Promise.prototype._progressUnchecked=function Promise$_progressUnchecked(progressValue){if(!this.isPending())return;var len=this._length();var progress=this._progress;for(var i=0;i<len;i+=5){var handler=this._progressHandlerAt(i);var promise=this._promiseAt(i);if(!(promise instanceof Promise)){var receiver=this._receiverAt(i);if(typeof handler==="function"){handler.call(receiver,progressValue,promise)}else if(receiver instanceof Promise&&receiver._isProxied()){receiver._progressUnchecked(progressValue)}else if(isPromiseArrayProxy(receiver,promise)){receiver._promiseProgressed(progressValue,promise)}continue}if(typeof handler==="function"){async.invoke(this._doProgressWith,this,{handler:handler,promise:promise,receiver:this._receiverAt(i),value:progressValue})}else{async.invoke(progress,promise,progressValue)}}}}},{"./async.js":214,"./errors.js":221,"./util.js":249}],231:[function(require,module,exports){(function(process){"use strict";module.exports=function(){var global=require("./global.js");var util=require("./util.js");var async=require("./async.js");var errors=require("./errors.js");var INTERNAL=function(){};var APPLY={};var NEXT_FILTER={e:null};var PromiseArray=require("./promise_array.js")(Promise,INTERNAL);var CapturedTrace=require("./captured_trace.js")();var CatchFilter=require("./catch_filter.js")(NEXT_FILTER);var PromiseResolver=require("./promise_resolver.js");var isArray=util.isArray;var errorObj=util.errorObj;var tryCatch1=util.tryCatch1;var tryCatch2=util.tryCatch2;var tryCatchApply=util.tryCatchApply;var RangeError=errors.RangeError;var TypeError=errors.TypeError;var CancellationError=errors.CancellationError;var TimeoutError=errors.TimeoutError;var RejectionError=errors.RejectionError;var originatesFromRejection=errors.originatesFromRejection;var markAsOriginatingFromRejection=errors.markAsOriginatingFromRejection;var canAttach=errors.canAttach;var thrower=util.thrower;var apiRejection=require("./errors_api_rejection")(Promise);var makeSelfResolutionError=function Promise$_makeSelfResolutionError(){return new TypeError("circular promise resolution chain")};function isPromise(obj){if(obj===void 0)return false;return obj instanceof Promise}function isPromiseArrayProxy(receiver,promiseSlotValue){if(receiver instanceof PromiseArray){return promiseSlotValue>=0}return false}function Promise(resolver){if(typeof resolver!=="function"){throw new TypeError("the promise constructor requires a resolver function")}if(this.constructor!==Promise){throw new TypeError("the promise constructor cannot be invoked directly")}this._bitField=0;this._fulfillmentHandler0=void 0;this._rejectionHandler0=void 0;this._promise0=void 0;this._receiver0=void 0;this._settledValue=void 0;this._boundTo=void 0;if(resolver!==INTERNAL)this._resolveFromResolver(resolver)}Promise.prototype.bind=function Promise$bind(thisArg){var ret=new Promise(INTERNAL);ret._setTrace(this);ret._follow(this);ret._setBoundTo(thisArg);if(this._cancellable()){ret._setCancellable();ret._cancellationParent=this}return ret};Promise.prototype.toString=function Promise$toString(){return"[object Promise]"};Promise.prototype.caught=Promise.prototype["catch"]=function Promise$catch(fn){var len=arguments.length;if(len>1){var catchInstances=new Array(len-1),j=0,i;for(i=0;i<len-1;++i){var item=arguments[i];if(typeof item==="function"){catchInstances[j++]=item}else{var catchFilterTypeError=new TypeError("A catch filter must be an error constructor "+"or a filter function");this._attachExtraTrace(catchFilterTypeError);async.invoke(this._reject,this,catchFilterTypeError);return}}catchInstances.length=j;fn=arguments[i];this._resetTrace();var catchFilter=new CatchFilter(catchInstances,fn,this);return this._then(void 0,catchFilter.doFilter,void 0,catchFilter,void 0)}return this._then(void 0,fn,void 0,void 0,void 0)};Promise.prototype.then=function Promise$then(didFulfill,didReject,didProgress){return this._then(didFulfill,didReject,didProgress,void 0,void 0)};Promise.prototype.done=function Promise$done(didFulfill,didReject,didProgress){var promise=this._then(didFulfill,didReject,didProgress,void 0,void 0);promise._setIsFinal()};Promise.prototype.spread=function Promise$spread(didFulfill,didReject){return this._then(didFulfill,didReject,void 0,APPLY,void 0)};Promise.prototype.isCancellable=function Promise$isCancellable(){return!this.isResolved()&&this._cancellable()};Promise.prototype.toJSON=function Promise$toJSON(){var ret={isFulfilled:false,isRejected:false,fulfillmentValue:void 0,rejectionReason:void 0};if(this.isFulfilled()){ret.fulfillmentValue=this._settledValue;ret.isFulfilled=true}else if(this.isRejected()){ret.rejectionReason=this._settledValue;ret.isRejected=true}return ret};Promise.prototype.all=function Promise$all(){return Promise$_all(this,true)};Promise.is=isPromise;function Promise$_all(promises,useBound){return Promise$_CreatePromiseArray(promises,PromiseArray,useBound===true&&promises._isBound()?promises._boundTo:void 0).promise()}Promise.all=function Promise$All(promises){return Promise$_all(promises,false)};Promise.join=function Promise$Join(){var $_len=arguments.length;var args=new Array($_len);for(var $_i=0;$_i<$_len;++$_i){args[$_i]=arguments[$_i]}return Promise$_CreatePromiseArray(args,PromiseArray,void 0).promise()};Promise.resolve=Promise.fulfilled=function Promise$Resolve(value){var ret=new Promise(INTERNAL);ret._setTrace(void 0);if(ret._tryFollow(value)){return ret}ret._cleanValues();ret._setFulfilled();ret._settledValue=value;return ret};Promise.reject=Promise.rejected=function Promise$Reject(reason){var ret=new Promise(INTERNAL);ret._setTrace(void 0);markAsOriginatingFromRejection(reason);ret._cleanValues();ret._setRejected();ret._settledValue=reason;if(!canAttach(reason)){var trace=new Error(reason+"");ret._setCarriedStackTrace(trace)}ret._ensurePossibleRejectionHandled();return ret};Promise.prototype.error=function Promise$_error(fn){return this.caught(originatesFromRejection,fn)};Promise.prototype._resolveFromSyncValue=function Promise$_resolveFromSyncValue(value){if(value===errorObj){this._cleanValues();this._setRejected();this._settledValue=value.e;this._ensurePossibleRejectionHandled()}else{var maybePromise=Promise._cast(value,void 0);if(maybePromise instanceof Promise){this._follow(maybePromise)}else{this._cleanValues();this._setFulfilled();this._settledValue=value}}};Promise.method=function Promise$_Method(fn){if(typeof fn!=="function"){throw new TypeError("fn must be a function")}return function Promise$_method(){var value;switch(arguments.length){case 0:value=tryCatch1(fn,this,void 0);break;case 1:value=tryCatch1(fn,this,arguments[0]);break;case 2:value=tryCatch2(fn,this,arguments[0],arguments[1]);break;default:var $_len=arguments.length;var args=new Array($_len);for(var $_i=0;$_i<$_len;++$_i){args[$_i]=arguments[$_i]}value=tryCatchApply(fn,args,this);break}var ret=new Promise(INTERNAL);ret._setTrace(void 0);ret._resolveFromSyncValue(value);return ret}};Promise.attempt=Promise["try"]=function Promise$_Try(fn,args,ctx){if(typeof fn!=="function"){return apiRejection("fn must be a function")}var value=isArray(args)?tryCatchApply(fn,args,ctx):tryCatch1(fn,ctx,args);var ret=new Promise(INTERNAL);ret._setTrace(void 0);ret._resolveFromSyncValue(value);return ret};Promise.defer=Promise.pending=function Promise$Defer(){var promise=new Promise(INTERNAL);promise._setTrace(void 0);return new PromiseResolver(promise)};Promise.bind=function Promise$Bind(thisArg){var ret=new Promise(INTERNAL);ret._setTrace(void 0);ret._setFulfilled();ret._setBoundTo(thisArg);return ret};Promise.cast=function Promise$_Cast(obj){var ret=Promise._cast(obj,void 0);if(!(ret instanceof Promise)){return Promise.resolve(ret)}return ret};Promise.onPossiblyUnhandledRejection=function Promise$OnPossiblyUnhandledRejection(fn){CapturedTrace.possiblyUnhandledRejection=typeof fn==="function"?fn:void 0};var unhandledRejectionHandled;Promise.onUnhandledRejectionHandled=function Promise$onUnhandledRejectionHandled(fn){unhandledRejectionHandled=typeof fn==="function"?fn:void 0};var debugging=false||!!(typeof process!=="undefined"&&typeof process.execPath==="string"&&typeof process.env==="object"&&(process.env["BLUEBIRD_DEBUG"]||process.env["NODE_ENV"]==="development"));Promise.longStackTraces=function Promise$LongStackTraces(){if(async.haveItemsQueued()&&debugging===false){throw new Error("cannot enable long stack traces after promises have been created")}debugging=CapturedTrace.isSupported()};Promise.hasLongStackTraces=function Promise$HasLongStackTraces(){return debugging&&CapturedTrace.isSupported()};Promise.prototype._setProxyHandlers=function Promise$_setProxyHandlers(receiver,promiseSlotValue){var index=this._length();if(index>=524287-5){index=0;this._setLength(0)}if(index===0){this._promise0=promiseSlotValue;this._receiver0=receiver}else{var i=index-5;this[i+3]=promiseSlotValue;this[i+4]=receiver;this[i+0]=this[i+1]=this[i+2]=void 0}this._setLength(index+5)};Promise.prototype._proxyPromiseArray=function Promise$_proxyPromiseArray(promiseArray,index){this._setProxyHandlers(promiseArray,index)};Promise.prototype._proxyPromise=function Promise$_proxyPromise(promise){promise._setProxied();this._setProxyHandlers(promise,-1)};Promise.prototype._then=function Promise$_then(didFulfill,didReject,didProgress,receiver,internalData){var haveInternalData=internalData!==void 0;var ret=haveInternalData?internalData:new Promise(INTERNAL);if(debugging&&!haveInternalData){var haveSameContext=this._peekContext()===this._traceParent;ret._traceParent=haveSameContext?this._traceParent:this;ret._setTrace(this)}if(!haveInternalData&&this._isBound()){ret._setBoundTo(this._boundTo)}var callbackIndex=this._addCallbacks(didFulfill,didReject,didProgress,ret,receiver);if(!haveInternalData&&this._cancellable()){ret._setCancellable();ret._cancellationParent=this}if(this.isResolved()){async.invoke(this._queueSettleAt,this,callbackIndex)}return ret};Promise.prototype._length=function Promise$_length(){return this._bitField&524287};Promise.prototype._isFollowingOrFulfilledOrRejected=function Promise$_isFollowingOrFulfilledOrRejected(){return(this._bitField&939524096)>0};Promise.prototype._isFollowing=function Promise$_isFollowing(){return(this._bitField&536870912)===536870912};Promise.prototype._setLength=function Promise$_setLength(len){this._bitField=this._bitField&-524288|len&524287};Promise.prototype._setFulfilled=function Promise$_setFulfilled(){this._bitField=this._bitField|268435456};Promise.prototype._setRejected=function Promise$_setRejected(){this._bitField=this._bitField|134217728};Promise.prototype._setFollowing=function Promise$_setFollowing(){this._bitField=this._bitField|536870912};Promise.prototype._setIsFinal=function Promise$_setIsFinal(){this._bitField=this._bitField|33554432};Promise.prototype._isFinal=function Promise$_isFinal(){return(this._bitField&33554432)>0};Promise.prototype._cancellable=function Promise$_cancellable(){return(this._bitField&67108864)>0};Promise.prototype._setCancellable=function Promise$_setCancellable(){this._bitField=this._bitField|67108864};Promise.prototype._unsetCancellable=function Promise$_unsetCancellable(){this._bitField=this._bitField&~67108864};Promise.prototype._setRejectionIsUnhandled=function Promise$_setRejectionIsUnhandled(){this._bitField=this._bitField|2097152};Promise.prototype._unsetRejectionIsUnhandled=function Promise$_unsetRejectionIsUnhandled(){this._bitField=this._bitField&~2097152;if(this._isUnhandledRejectionNotified()){this._unsetUnhandledRejectionIsNotified();this._notifyUnhandledRejectionIsHandled()}};Promise.prototype._isRejectionUnhandled=function Promise$_isRejectionUnhandled(){return(this._bitField&2097152)>0};Promise.prototype._setUnhandledRejectionIsNotified=function Promise$_setUnhandledRejectionIsNotified(){this._bitField=this._bitField|524288};Promise.prototype._unsetUnhandledRejectionIsNotified=function Promise$_unsetUnhandledRejectionIsNotified(){this._bitField=this._bitField&~524288};Promise.prototype._isUnhandledRejectionNotified=function Promise$_isUnhandledRejectionNotified(){return(this._bitField&524288)>0};Promise.prototype._setCarriedStackTrace=function Promise$_setCarriedStackTrace(capturedTrace){this._bitField=this._bitField|1048576;this._fulfillmentHandler0=capturedTrace};Promise.prototype._unsetCarriedStackTrace=function Promise$_unsetCarriedStackTrace(){this._bitField=this._bitField&~1048576;this._fulfillmentHandler0=void 0};Promise.prototype._isCarryingStackTrace=function Promise$_isCarryingStackTrace(){return(this._bitField&1048576)>0};Promise.prototype._getCarriedStackTrace=function Promise$_getCarriedStackTrace(){return this._isCarryingStackTrace()?this._fulfillmentHandler0:void 0};Promise.prototype._receiverAt=function Promise$_receiverAt(index){var ret;if(index===0){ret=this._receiver0}else{ret=this[index+4-5]}if(this._isBound()&&ret===void 0){return this._boundTo}return ret};Promise.prototype._promiseAt=function Promise$_promiseAt(index){if(index===0)return this._promise0;return this[index+3-5]};Promise.prototype._fulfillmentHandlerAt=function Promise$_fulfillmentHandlerAt(index){if(index===0)return this._fulfillmentHandler0;return this[index+0-5]};Promise.prototype._rejectionHandlerAt=function Promise$_rejectionHandlerAt(index){if(index===0)return this._rejectionHandler0;return this[index+1-5]};Promise.prototype._unsetAt=function Promise$_unsetAt(index){if(index===0){this._rejectionHandler0=this._progressHandler0=this._promise0=this._receiver0=void 0;if(!this._isCarryingStackTrace()){this._fulfillmentHandler0=void 0}}else{this[index-5+0]=this[index-5+1]=this[index-5+2]=this[index-5+3]=this[index-5+4]=void 0}};Promise.prototype._resolveFromResolver=function Promise$_resolveFromResolver(resolver){var promise=this;this._setTrace(void 0);this._pushContext();function Promise$_resolver(val){if(promise._tryFollow(val)){return}promise._fulfill(val)}function Promise$_rejecter(val){var trace=canAttach(val)?val:new Error(val+"");promise._attachExtraTrace(trace);markAsOriginatingFromRejection(val);promise._reject(val,trace===val?void 0:trace)}var r=tryCatch2(resolver,void 0,Promise$_resolver,Promise$_rejecter);this._popContext();if(r!==void 0&&r===errorObj){var e=r.e;var trace=canAttach(e)?e:new Error(e+"");promise._reject(e,trace)}};Promise.prototype._addCallbacks=function Promise$_addCallbacks(fulfill,reject,progress,promise,receiver){var index=this._length();if(index>=524287-5){index=0;this._setLength(0)}if(index===0){this._promise0=promise;if(receiver!==void 0)this._receiver0=receiver;if(typeof fulfill==="function"&&!this._isCarryingStackTrace())this._fulfillmentHandler0=fulfill;if(typeof reject==="function")this._rejectionHandler0=reject;if(typeof progress==="function")this._progressHandler0=progress}else{var i=index-5;this[i+3]=promise;this[i+4]=receiver;this[i+0]=typeof fulfill==="function"?fulfill:void 0;this[i+1]=typeof reject==="function"?reject:void 0;this[i+2]=typeof progress==="function"?progress:void 0}this._setLength(index+5);return index};Promise.prototype._setBoundTo=function Promise$_setBoundTo(obj){if(obj!==void 0){this._bitField=this._bitField|8388608;this._boundTo=obj}else{this._bitField=this._bitField&~8388608}};Promise.prototype._isBound=function Promise$_isBound(){return(this._bitField&8388608)===8388608};Promise.prototype._spreadSlowCase=function Promise$_spreadSlowCase(targetFn,promise,values,boundTo){var promiseForAll=Promise$_CreatePromiseArray(values,PromiseArray,boundTo).promise()._then(function(){return targetFn.apply(boundTo,arguments)},void 0,void 0,APPLY,void 0);promise._follow(promiseForAll)};Promise.prototype._callSpread=function Promise$_callSpread(handler,promise,value,localDebugging){var boundTo=this._isBound()?this._boundTo:void 0;if(isArray(value)){for(var i=0,len=value.length;i<len;++i){if(isPromise(Promise._cast(value[i],void 0))){this._spreadSlowCase(handler,promise,value,boundTo);return}}}if(localDebugging)promise._pushContext();return tryCatchApply(handler,value,boundTo)};Promise.prototype._callHandler=function Promise$_callHandler(handler,receiver,promise,value,localDebugging){var x;if(receiver===APPLY&&!this.isRejected()){x=this._callSpread(handler,promise,value,localDebugging)}else{if(localDebugging)promise._pushContext();x=tryCatch1(handler,receiver,value)}if(localDebugging)promise._popContext();return x};Promise.prototype._settlePromiseFromHandler=function Promise$_settlePromiseFromHandler(handler,receiver,value,promise){if(!isPromise(promise)){handler.call(receiver,value,promise);return}var localDebugging=debugging;var x=this._callHandler(handler,receiver,promise,value,localDebugging);if(promise._isFollowing())return;if(x===errorObj||x===promise||x===NEXT_FILTER){var err=x===promise?makeSelfResolutionError():x.e;var trace=canAttach(err)?err:new Error(err+"");if(x!==NEXT_FILTER)promise._attachExtraTrace(trace);promise._rejectUnchecked(err,trace)}else{var castValue=Promise._cast(x,promise);if(isPromise(castValue)){if(castValue.isRejected()&&!castValue._isCarryingStackTrace()&&!canAttach(castValue._settledValue)){var trace=new Error(castValue._settledValue+"");promise._attachExtraTrace(trace);castValue._setCarriedStackTrace(trace)}promise._follow(castValue);if(castValue._cancellable()){promise._cancellationParent=castValue;promise._setCancellable()}}else{promise._fulfillUnchecked(x)}}};Promise.prototype._follow=function Promise$_follow(promise){this._setFollowing();if(promise.isPending()){if(promise._cancellable()){this._cancellationParent=promise;this._setCancellable()}promise._proxyPromise(this)}else if(promise.isFulfilled()){this._fulfillUnchecked(promise._settledValue)}else{this._rejectUnchecked(promise._settledValue,promise._getCarriedStackTrace())}if(promise._isRejectionUnhandled())promise._unsetRejectionIsUnhandled();if(debugging&&promise._traceParent==null){promise._traceParent=this}};Promise.prototype._tryFollow=function Promise$_tryFollow(value){if(this._isFollowingOrFulfilledOrRejected()||value===this){return false}var maybePromise=Promise._cast(value,void 0);if(!isPromise(maybePromise)){return false}this._follow(maybePromise);return true};Promise.prototype._resetTrace=function Promise$_resetTrace(){if(debugging){this._trace=new CapturedTrace(this._peekContext()===void 0)}};Promise.prototype._setTrace=function Promise$_setTrace(parent){if(debugging){var context=this._peekContext();this._traceParent=context;var isTopLevel=context===void 0;if(parent!==void 0&&parent._traceParent===context){this._trace=parent._trace}else{this._trace=new CapturedTrace(isTopLevel)}}return this};Promise.prototype._attachExtraTrace=function Promise$_attachExtraTrace(error){if(debugging){var promise=this;var stack=error.stack;stack=typeof stack==="string"?stack.split("\n"):[];var headerLineCount=1;while(promise!=null&&promise._trace!=null){stack=CapturedTrace.combine(stack,promise._trace.stack.split("\n"));promise=promise._traceParent}var max=Error.stackTraceLimit+headerLineCount;var len=stack.length;if(len>max){stack.length=max}if(stack.length<=headerLineCount){error.stack="(No stack trace)"}else{error.stack=stack.join("\n")}}};Promise.prototype._cleanValues=function Promise$_cleanValues(){if(this._cancellable()){this._cancellationParent=void 0}};Promise.prototype._fulfill=function Promise$_fulfill(value){if(this._isFollowingOrFulfilledOrRejected())return;this._fulfillUnchecked(value)};Promise.prototype._reject=function Promise$_reject(reason,carriedStackTrace){if(this._isFollowingOrFulfilledOrRejected())return;this._rejectUnchecked(reason,carriedStackTrace)};Promise.prototype._settlePromiseAt=function Promise$_settlePromiseAt(index){var handler=this.isFulfilled()?this._fulfillmentHandlerAt(index):this._rejectionHandlerAt(index);var value=this._settledValue;var receiver=this._receiverAt(index);var promise=this._promiseAt(index);if(typeof handler==="function"){this._settlePromiseFromHandler(handler,receiver,value,promise)}else{var done=false;var isFulfilled=this.isFulfilled();if(receiver!==void 0){if(receiver instanceof Promise&&receiver._isProxied()){receiver._unsetProxied();if(isFulfilled)receiver._fulfillUnchecked(value);else receiver._rejectUnchecked(value,this._getCarriedStackTrace());done=true}else if(isPromiseArrayProxy(receiver,promise)){if(isFulfilled)receiver._promiseFulfilled(value,promise);else receiver._promiseRejected(value,promise);done=true}}if(!done){if(isFulfilled)promise._fulfill(value);else promise._reject(value,this._getCarriedStackTrace())
}}if(index>=256){this._queueGC()}};Promise.prototype._isProxied=function Promise$_isProxied(){return(this._bitField&4194304)===4194304};Promise.prototype._setProxied=function Promise$_setProxied(){this._bitField=this._bitField|4194304};Promise.prototype._unsetProxied=function Promise$_unsetProxied(){this._bitField=this._bitField&~4194304};Promise.prototype._isGcQueued=function Promise$_isGcQueued(){return(this._bitField&-1073741824)===-1073741824};Promise.prototype._setGcQueued=function Promise$_setGcQueued(){this._bitField=this._bitField|-1073741824};Promise.prototype._unsetGcQueued=function Promise$_unsetGcQueued(){this._bitField=this._bitField&~-1073741824};Promise.prototype._queueGC=function Promise$_queueGC(){if(this._isGcQueued())return;this._setGcQueued();async.invokeLater(this._gc,this,void 0)};Promise.prototype._gc=function Promise$gc(){var len=this._length();this._unsetAt(0);for(var i=0;i<len;i++){delete this[i]}this._setLength(0);this._unsetGcQueued()};Promise.prototype._queueSettleAt=function Promise$_queueSettleAt(index){if(this._isRejectionUnhandled())this._unsetRejectionIsUnhandled();async.invoke(this._settlePromiseAt,this,index)};Promise.prototype._fulfillUnchecked=function Promise$_fulfillUnchecked(value){if(!this.isPending())return;if(value===this){var err=makeSelfResolutionError();this._attachExtraTrace(err);return this._rejectUnchecked(err,void 0)}this._cleanValues();this._setFulfilled();this._settledValue=value;var len=this._length();if(len>0){async.invoke(this._settlePromises,this,len)}};Promise.prototype._rejectUncheckedCheckError=function Promise$_rejectUncheckedCheckError(reason){var trace=canAttach(reason)?reason:new Error(reason+"");this._rejectUnchecked(reason,trace===reason?void 0:trace)};Promise.prototype._rejectUnchecked=function Promise$_rejectUnchecked(reason,trace){if(!this.isPending())return;if(reason===this){var err=makeSelfResolutionError();this._attachExtraTrace(err);return this._rejectUnchecked(err)}this._cleanValues();this._setRejected();this._settledValue=reason;if(this._isFinal()){async.invokeLater(thrower,void 0,trace===void 0?reason:trace);return}var len=this._length();if(trace!==void 0)this._setCarriedStackTrace(trace);if(len>0){async.invoke(this._rejectPromises,this,null)}else{this._ensurePossibleRejectionHandled()}};Promise.prototype._rejectPromises=function Promise$_rejectPromises(){this._settlePromises();this._unsetCarriedStackTrace()};Promise.prototype._settlePromises=function Promise$_settlePromises(){var len=this._length();for(var i=0;i<len;i+=5){this._settlePromiseAt(i)}};Promise.prototype._ensurePossibleRejectionHandled=function Promise$_ensurePossibleRejectionHandled(){this._setRejectionIsUnhandled();if(CapturedTrace.possiblyUnhandledRejection!==void 0){async.invokeLater(this._notifyUnhandledRejection,this,void 0)}};Promise.prototype._notifyUnhandledRejectionIsHandled=function Promise$_notifyUnhandledRejectionIsHandled(){if(typeof unhandledRejectionHandled==="function"){async.invokeLater(unhandledRejectionHandled,void 0,this)}};Promise.prototype._notifyUnhandledRejection=function Promise$_notifyUnhandledRejection(){if(this._isRejectionUnhandled()){var reason=this._settledValue;var trace=this._getCarriedStackTrace();this._setUnhandledRejectionIsNotified();if(trace!==void 0){this._unsetCarriedStackTrace();reason=trace}if(typeof CapturedTrace.possiblyUnhandledRejection==="function"){CapturedTrace.possiblyUnhandledRejection(reason,this)}}};var contextStack=[];Promise.prototype._peekContext=function Promise$_peekContext(){var lastIndex=contextStack.length-1;if(lastIndex>=0){return contextStack[lastIndex]}return void 0};Promise.prototype._pushContext=function Promise$_pushContext(){if(!debugging)return;contextStack.push(this)};Promise.prototype._popContext=function Promise$_popContext(){if(!debugging)return;contextStack.pop()};function Promise$_CreatePromiseArray(promises,PromiseArrayConstructor,boundTo){var list=null;if(isArray(promises)){list=promises}else{list=Promise._cast(promises,void 0);if(list!==promises){list._setBoundTo(boundTo)}else if(!isPromise(list)){list=null}}if(list!==null){return new PromiseArrayConstructor(list,boundTo)}return{promise:function(){return apiRejection("expecting an array, a promise or a thenable")}}}var old=global.Promise;Promise.noConflict=function(){if(global.Promise===Promise){global.Promise=old}return Promise};if(!CapturedTrace.isSupported()){Promise.longStackTraces=function(){};debugging=false}Promise._makeSelfResolutionError=makeSelfResolutionError;require("./finally.js")(Promise,NEXT_FILTER);require("./direct_resolve.js")(Promise);require("./thenables.js")(Promise,INTERNAL);require("./synchronous_inspection.js")(Promise);Promise.RangeError=RangeError;Promise.CancellationError=CancellationError;Promise.TimeoutError=TimeoutError;Promise.TypeError=TypeError;Promise.RejectionError=RejectionError;util.toFastProperties(Promise);util.toFastProperties(Promise.prototype);require("./timers.js")(Promise,INTERNAL);require("./any.js")(Promise,Promise$_CreatePromiseArray,PromiseArray);require("./race.js")(Promise,INTERNAL);require("./call_get.js")(Promise);require("./filter.js")(Promise,Promise$_CreatePromiseArray,PromiseArray,apiRejection);require("./generators.js")(Promise,apiRejection,INTERNAL);require("./map.js")(Promise,PromiseArray,INTERNAL,apiRejection);require("./nodeify.js")(Promise);require("./promisify.js")(Promise,INTERNAL);require("./props.js")(Promise,PromiseArray);require("./reduce.js")(Promise,Promise$_CreatePromiseArray,PromiseArray,apiRejection,INTERNAL);require("./settle.js")(Promise,Promise$_CreatePromiseArray,PromiseArray);require("./some.js")(Promise,Promise$_CreatePromiseArray,PromiseArray,apiRejection);require("./progress.js")(Promise,isPromiseArrayProxy);require("./cancel.js")(Promise,INTERNAL);Promise.prototype=Promise.prototype;return Promise}}).call(this,require("_process"))},{"./any.js":213,"./async.js":214,"./call_get.js":216,"./cancel.js":217,"./captured_trace.js":218,"./catch_filter.js":219,"./direct_resolve.js":220,"./errors.js":221,"./errors_api_rejection":222,"./filter.js":224,"./finally.js":225,"./generators.js":226,"./global.js":227,"./map.js":228,"./nodeify.js":229,"./progress.js":230,"./promise_array.js":232,"./promise_resolver.js":233,"./promisify.js":235,"./props.js":237,"./race.js":239,"./reduce.js":240,"./settle.js":242,"./some.js":244,"./synchronous_inspection.js":246,"./thenables.js":247,"./timers.js":248,"./util.js":249,_process:10}],232:[function(require,module,exports){"use strict";module.exports=function(Promise,INTERNAL){var canAttach=require("./errors.js").canAttach;var util=require("./util.js");var async=require("./async.js");var hasOwn={}.hasOwnProperty;var isArray=util.isArray;function toResolutionValue(val){switch(val){case-1:return void 0;case-2:return[];case-3:return{}}}function PromiseArray(values,boundTo){var promise=this._promise=new Promise(INTERNAL);var parent=void 0;if(values instanceof Promise){parent=values;if(values._cancellable()){promise._setCancellable();promise._cancellationParent=values}if(values._isBound()){promise._setBoundTo(boundTo)}}promise._setTrace(parent);this._values=values;this._length=0;this._totalResolved=0;this._init(void 0,-2)}PromiseArray.PropertiesPromiseArray=function(){};PromiseArray.prototype.length=function PromiseArray$length(){return this._length};PromiseArray.prototype.promise=function PromiseArray$promise(){return this._promise};PromiseArray.prototype._init=function PromiseArray$_init(_,resolveValueIfEmpty){var values=this._values;if(values instanceof Promise){if(values.isFulfilled()){values=values._settledValue;if(!isArray(values)){var err=new Promise.TypeError("expecting an array, a promise or a thenable");this.__hardReject__(err);return}this._values=values}else if(values.isPending()){values._then(this._init,this._reject,void 0,this,resolveValueIfEmpty);return}else{values._unsetRejectionIsUnhandled();this._reject(values._settledValue);return}}if(values.length===0){this._resolve(toResolutionValue(resolveValueIfEmpty));return}var len=values.length;var newLen=len;var newValues;if(this instanceof PromiseArray.PropertiesPromiseArray){newValues=this._values}else{newValues=new Array(len)}var isDirectScanNeeded=false;for(var i=0;i<len;++i){var promise=values[i];if(promise===void 0&&!hasOwn.call(values,i)){newLen--;continue}var maybePromise=Promise._cast(promise,void 0);if(maybePromise instanceof Promise){if(maybePromise.isPending()){maybePromise._proxyPromiseArray(this,i)}else{maybePromise._unsetRejectionIsUnhandled();isDirectScanNeeded=true}}else{isDirectScanNeeded=true}newValues[i]=maybePromise}if(newLen===0){if(resolveValueIfEmpty===-2){this._resolve(newValues)}else{this._resolve(toResolutionValue(resolveValueIfEmpty))}return}this._values=newValues;this._length=newLen;if(isDirectScanNeeded){var scanMethod=newLen===len?this._scanDirectValues:this._scanDirectValuesHoled;async.invoke(scanMethod,this,len)}};PromiseArray.prototype._settlePromiseAt=function PromiseArray$_settlePromiseAt(index){var value=this._values[index];if(!(value instanceof Promise)){this._promiseFulfilled(value,index)}else if(value.isFulfilled()){this._promiseFulfilled(value._settledValue,index)}else if(value.isRejected()){this._promiseRejected(value._settledValue,index)}};PromiseArray.prototype._scanDirectValuesHoled=function PromiseArray$_scanDirectValuesHoled(len){for(var i=0;i<len;++i){if(this._isResolved()){break}if(hasOwn.call(this._values,i)){this._settlePromiseAt(i)}}};PromiseArray.prototype._scanDirectValues=function PromiseArray$_scanDirectValues(len){for(var i=0;i<len;++i){if(this._isResolved()){break}this._settlePromiseAt(i)}};PromiseArray.prototype._isResolved=function PromiseArray$_isResolved(){return this._values===null};PromiseArray.prototype._resolve=function PromiseArray$_resolve(value){this._values=null;this._promise._fulfill(value)};PromiseArray.prototype.__hardReject__=PromiseArray.prototype._reject=function PromiseArray$_reject(reason){this._values=null;var trace=canAttach(reason)?reason:new Error(reason+"");this._promise._attachExtraTrace(trace);this._promise._reject(reason,trace)};PromiseArray.prototype._promiseProgressed=function PromiseArray$_promiseProgressed(progressValue,index){if(this._isResolved())return;this._promise._progress({index:index,value:progressValue})};PromiseArray.prototype._promiseFulfilled=function PromiseArray$_promiseFulfilled(value,index){if(this._isResolved())return;this._values[index]=value;var totalResolved=++this._totalResolved;if(totalResolved>=this._length){this._resolve(this._values)}};PromiseArray.prototype._promiseRejected=function PromiseArray$_promiseRejected(reason,index){if(this._isResolved())return;this._totalResolved++;this._reject(reason)};return PromiseArray}},{"./async.js":214,"./errors.js":221,"./util.js":249}],233:[function(require,module,exports){"use strict";var util=require("./util.js");var maybeWrapAsError=util.maybeWrapAsError;var errors=require("./errors.js");var TimeoutError=errors.TimeoutError;var RejectionError=errors.RejectionError;var async=require("./async.js");var haveGetters=util.haveGetters;var es5=require("./es5.js");function isUntypedError(obj){return obj instanceof Error&&es5.getPrototypeOf(obj)===Error.prototype}function wrapAsRejectionError(obj){var ret;if(isUntypedError(obj)){ret=new RejectionError(obj)}else{ret=obj}errors.markAsOriginatingFromRejection(ret);return ret}function nodebackForPromise(promise){function PromiseResolver$_callback(err,value){if(promise===null)return;if(err){var wrapped=wrapAsRejectionError(maybeWrapAsError(err));promise._attachExtraTrace(wrapped);promise._reject(wrapped)}else{if(arguments.length>2){var $_len=arguments.length;var args=new Array($_len-1);for(var $_i=1;$_i<$_len;++$_i){args[$_i-1]=arguments[$_i]}promise._fulfill(args)}else{promise._fulfill(value)}}promise=null}return PromiseResolver$_callback}var PromiseResolver;if(!haveGetters){PromiseResolver=function PromiseResolver(promise){this.promise=promise;this.asCallback=nodebackForPromise(promise);this.callback=this.asCallback}}else{PromiseResolver=function PromiseResolver(promise){this.promise=promise}}if(haveGetters){var prop={get:function(){return nodebackForPromise(this.promise)}};es5.defineProperty(PromiseResolver.prototype,"asCallback",prop);es5.defineProperty(PromiseResolver.prototype,"callback",prop)}PromiseResolver._nodebackForPromise=nodebackForPromise;PromiseResolver.prototype.toString=function PromiseResolver$toString(){return"[object PromiseResolver]"};PromiseResolver.prototype.resolve=PromiseResolver.prototype.fulfill=function PromiseResolver$resolve(value){var promise=this.promise;if(promise===void 0||promise._tryFollow===void 0){throw new TypeError("Illegal invocation, resolver resolve/reject must be called within a resolver context. Consider using the promise constructor instead.")}if(promise._tryFollow(value)){return}async.invoke(promise._fulfill,promise,value)};PromiseResolver.prototype.reject=function PromiseResolver$reject(reason){var promise=this.promise;if(promise===void 0||promise._attachExtraTrace===void 0){throw new TypeError("Illegal invocation, resolver resolve/reject must be called within a resolver context. Consider using the promise constructor instead.")}errors.markAsOriginatingFromRejection(reason);var trace=errors.canAttach(reason)?reason:new Error(reason+"");promise._attachExtraTrace(trace);async.invoke(promise._reject,promise,reason);if(trace!==reason){async.invoke(this._setCarriedStackTrace,this,trace)}};PromiseResolver.prototype.progress=function PromiseResolver$progress(value){async.invoke(this.promise._progress,this.promise,value)};PromiseResolver.prototype.cancel=function PromiseResolver$cancel(){async.invoke(this.promise.cancel,this.promise,void 0)};PromiseResolver.prototype.timeout=function PromiseResolver$timeout(){this.reject(new TimeoutError("timeout"))};PromiseResolver.prototype.isResolved=function PromiseResolver$isResolved(){return this.promise.isResolved()};PromiseResolver.prototype.toJSON=function PromiseResolver$toJSON(){return this.promise.toJSON()};PromiseResolver.prototype._setCarriedStackTrace=function PromiseResolver$_setCarriedStackTrace(trace){if(this.promise.isRejected()){this.promise._setCarriedStackTrace(trace)}};module.exports=PromiseResolver},{"./async.js":214,"./errors.js":221,"./es5.js":223,"./util.js":249}],234:[function(require,module,exports){"use strict";module.exports=function(Promise,INTERNAL){var errors=require("./errors.js");var TypeError=errors.TypeError;var util=require("./util.js");var isArray=util.isArray;var errorObj=util.errorObj;var tryCatch1=util.tryCatch1;var yieldHandlers=[];function promiseFromYieldHandler(value){var _yieldHandlers=yieldHandlers;var _errorObj=errorObj;var _Promise=Promise;var len=_yieldHandlers.length;for(var i=0;i<len;++i){var result=tryCatch1(_yieldHandlers[i],void 0,value);if(result===_errorObj){return _Promise.reject(_errorObj.e)}var maybePromise=_Promise._cast(result,promiseFromYieldHandler,void 0);if(maybePromise instanceof _Promise)return maybePromise}return null}function PromiseSpawn(generatorFunction,receiver){var promise=this._promise=new Promise(INTERNAL);promise._setTrace(void 0);this._generatorFunction=generatorFunction;this._receiver=receiver;this._generator=void 0}PromiseSpawn.prototype.promise=function PromiseSpawn$promise(){return this._promise};PromiseSpawn.prototype._run=function PromiseSpawn$_run(){this._generator=this._generatorFunction.call(this._receiver);this._receiver=this._generatorFunction=void 0;this._next(void 0)};PromiseSpawn.prototype._continue=function PromiseSpawn$_continue(result){if(result===errorObj){this._generator=void 0;var trace=errors.canAttach(result.e)?result.e:new Error(result.e+"");this._promise._attachExtraTrace(trace);this._promise._reject(result.e,trace);return}var value=result.value;if(result.done===true){this._generator=void 0;if(!this._promise._tryFollow(value)){this._promise._fulfill(value)}}else{var maybePromise=Promise._cast(value,PromiseSpawn$_continue,void 0);if(!(maybePromise instanceof Promise)){if(isArray(maybePromise)){maybePromise=Promise.all(maybePromise)}else{maybePromise=promiseFromYieldHandler(maybePromise)}if(maybePromise===null){this._throw(new TypeError("A value was yielded that could not be treated as a promise"));return}}maybePromise._then(this._next,this._throw,void 0,this,null)}};PromiseSpawn.prototype._throw=function PromiseSpawn$_throw(reason){if(errors.canAttach(reason))this._promise._attachExtraTrace(reason);this._continue(tryCatch1(this._generator["throw"],this._generator,reason))};PromiseSpawn.prototype._next=function PromiseSpawn$_next(value){this._continue(tryCatch1(this._generator.next,this._generator,value))};PromiseSpawn.addYieldHandler=function PromiseSpawn$AddYieldHandler(fn){if(typeof fn!=="function")throw new TypeError("fn must be a function");yieldHandlers.push(fn)};return PromiseSpawn}},{"./errors.js":221,"./util.js":249}],235:[function(require,module,exports){"use strict";module.exports=function(Promise,INTERNAL){var THIS={};var util=require("./util.js");var es5=require("./es5.js");var nodebackForPromise=require("./promise_resolver.js")._nodebackForPromise;var withAppended=util.withAppended;var maybeWrapAsError=util.maybeWrapAsError;var canEvaluate=util.canEvaluate;var deprecated=util.deprecated;var TypeError=require("./errors").TypeError;var rasyncSuffix=new RegExp("Async"+"$");function isPromisified(fn){return fn.__isPromisified__===true}function hasPromisified(obj,key){var containsKey=key+"Async"in obj;return containsKey?isPromisified(obj[key+"Async"]):false}function checkValid(ret){for(var i=0;i<ret.length;i+=2){var key=ret[i];if(rasyncSuffix.test(key)){var keyWithoutAsyncSuffix=key.replace(rasyncSuffix,"");for(var j=0;j<ret.length;j+=2){if(ret[j]===keyWithoutAsyncSuffix){throw new TypeError("Cannot promisify an API "+"that has normal methods with Async-suffix")}}}}}var inheritedMethods=function(){if(es5.isES5){var create=Object.create;var getOwnPropertyDescriptor=Object.getOwnPropertyDescriptor;return function(cur){var ret=[];var visitedKeys=create(null);var original=cur;while(cur!==null){var keys=es5.keys(cur);for(var i=0,len=keys.length;i<len;++i){var key=keys[i];if(visitedKeys[key])continue;visitedKeys[key]=true;var desc=getOwnPropertyDescriptor(cur,key);if(desc!=null&&typeof desc.value==="function"&&!isPromisified(desc.value)&&!hasPromisified(original,key)){ret.push(key,desc.value)}}cur=es5.getPrototypeOf(cur)}checkValid(ret);return ret}}else{return function(obj){var ret=[];for(var key in obj){var fn=obj[key];if(typeof fn==="function"&&!isPromisified(fn)&&!hasPromisified(obj,key)){ret.push(key,fn)}}checkValid(ret);return ret}}}();function switchCaseArgumentOrder(likelyArgumentCount){var ret=[likelyArgumentCount];var min=Math.max(0,likelyArgumentCount-1-5);for(var i=likelyArgumentCount-1;i>=min;--i){if(i===likelyArgumentCount)continue;ret.push(i)}for(var i=likelyArgumentCount+1;i<=5;++i){ret.push(i)}return ret}function parameterDeclaration(parameterCount){var ret=new Array(parameterCount);for(var i=0;i<ret.length;++i){ret[i]="_arg"+i}return ret.join(", ")}function parameterCount(fn){if(typeof fn.length==="number"){return Math.max(Math.min(fn.length,1023+1),0)}return 0}var rident=/^[a-z$_][a-z$_0-9]*$/i;function propertyAccess(id){if(rident.test(id)){return"."+id}else return"['"+id.replace(/(['\\])/g,"\\$1")+"']"}function makeNodePromisifiedEval(callback,receiver,originalName,fn){var newParameterCount=Math.max(0,parameterCount(fn)-1);var argumentOrder=switchCaseArgumentOrder(newParameterCount);var callbackName=typeof originalName==="string"?originalName+"Async":"promisified";function generateCallForArgumentCount(count){var args=new Array(count);for(var i=0,len=args.length;i<len;++i){args[i]="arguments["+i+"]"}var comma=count>0?",":"";if(typeof callback==="string"&&receiver===THIS){return"this"+propertyAccess(callback)+"("+args.join(",")+comma+" fn);"+"break;"}return(receiver===void 0?"callback("+args.join(",")+comma+" fn);":"callback.call("+(receiver===THIS?"this":"receiver")+", "+args.join(",")+comma+" fn);")+"break;"}if(!rident.test(callbackName)){callbackName="promisified"}function generateArgumentSwitchCase(){var ret="";for(var i=0;i<argumentOrder.length;++i){ret+="case "+argumentOrder[i]+":"+generateCallForArgumentCount(argumentOrder[i])}ret+="default: var args = new Array(len + 1);"+"var i = 0;"+"for (var i = 0; i < len; ++i) { "+"   args[i] = arguments[i];"+"}"+"args[i] = fn;"+(typeof callback==="string"?"this"+propertyAccess(callback)+".apply(":"callback.apply(")+(receiver===THIS?"this":"receiver")+", args); break;";return ret}return new Function("Promise","callback","receiver","withAppended","maybeWrapAsError","nodebackForPromise","INTERNAL","var ret = function "+callbackName+"("+parameterDeclaration(newParameterCount)+') {"use strict";'+"var len = arguments.length;"+"var promise = new Promise(INTERNAL);"+"promise._setTrace(void 0);"+"var fn = nodebackForPromise(promise);"+"try {"+"switch(len) {"+generateArgumentSwitchCase()+"}"+"}"+"catch(e){ "+"var wrapped = maybeWrapAsError(e);"+"promise._attachExtraTrace(wrapped);"+"promise._reject(wrapped);"+"}"+"return promise;"+""+"}; ret.__isPromisified__ = true; return ret;")(Promise,callback,receiver,withAppended,maybeWrapAsError,nodebackForPromise,INTERNAL)}function makeNodePromisifiedClosure(callback,receiver){function promisified(){var _receiver=receiver;if(receiver===THIS)_receiver=this;if(typeof callback==="string"){callback=_receiver[callback]}var promise=new Promise(INTERNAL);promise._setTrace(void 0);var fn=nodebackForPromise(promise);try{callback.apply(_receiver,withAppended(arguments,fn))}catch(e){var wrapped=maybeWrapAsError(e);promise._attachExtraTrace(wrapped);promise._reject(wrapped)}return promise}promisified.__isPromisified__=true;return promisified}var makeNodePromisified=canEvaluate?makeNodePromisifiedEval:makeNodePromisifiedClosure;function _promisify(callback,receiver,isAll){if(isAll){var methods=inheritedMethods(callback);for(var i=0,len=methods.length;i<len;i+=2){var key=methods[i];var fn=methods[i+1];var promisifiedKey=key+"Async";callback[promisifiedKey]=makeNodePromisified(key,THIS,key,fn)}util.toFastProperties(callback);return callback}else{return makeNodePromisified(callback,receiver,void 0,callback)}}Promise.promisify=function Promise$Promisify(fn,receiver){if(typeof fn==="object"&&fn!==null){deprecated("Promise.promisify for promisifying entire objects is deprecated. Use Promise.promisifyAll instead.");return _promisify(fn,receiver,true)}if(typeof fn!=="function"){throw new TypeError("fn must be a function")}if(isPromisified(fn)){return fn}return _promisify(fn,arguments.length<2?THIS:receiver,false)};Promise.promisifyAll=function Promise$PromisifyAll(target){if(typeof target!=="function"&&typeof target!=="object"){throw new TypeError("the target of promisifyAll must be an object or a function")}return _promisify(target,void 0,true)}}},{"./errors":221,"./es5.js":223,"./promise_resolver.js":233,"./util.js":249}],236:[function(require,module,exports){"use strict";module.exports=function(Promise,PromiseArray){var util=require("./util.js");var inherits=util.inherits;var es5=require("./es5.js");function PropertiesPromiseArray(obj,boundTo){var keys=es5.keys(obj);var values=new Array(keys.length);for(var i=0,len=values.length;i<len;++i){values[i]=obj[keys[i]]}this.constructor$(values,boundTo);if(!this._isResolved()){for(var i=0,len=keys.length;i<len;++i){values.push(keys[i])}}}inherits(PropertiesPromiseArray,PromiseArray);PropertiesPromiseArray.prototype._init=function PropertiesPromiseArray$_init(){this._init$(void 0,-3)};PropertiesPromiseArray.prototype._promiseFulfilled=function PropertiesPromiseArray$_promiseFulfilled(value,index){if(this._isResolved())return;this._values[index]=value;var totalResolved=++this._totalResolved;if(totalResolved>=this._length){var val={};var keyOffset=this.length();for(var i=0,len=this.length();i<len;++i){val[this._values[i+keyOffset]]=this._values[i]}this._resolve(val)}};PropertiesPromiseArray.prototype._promiseProgressed=function PropertiesPromiseArray$_promiseProgressed(value,index){if(this._isResolved())return;this._promise._progress({key:this._values[index+this.length()],value:value})};PromiseArray.PropertiesPromiseArray=PropertiesPromiseArray;return PropertiesPromiseArray}},{"./es5.js":223,"./util.js":249}],237:[function(require,module,exports){"use strict";module.exports=function(Promise,PromiseArray){var PropertiesPromiseArray=require("./properties_promise_array.js")(Promise,PromiseArray);var util=require("./util.js");var apiRejection=require("./errors_api_rejection")(Promise);var isObject=util.isObject;function Promise$_Props(promises,useBound){var ret;var castValue=Promise._cast(promises,void 0);if(!isObject(castValue)){return apiRejection("cannot await properties of a non-object")}else if(castValue instanceof Promise){ret=castValue._then(Promise.props,void 0,void 0,void 0,void 0)}else{ret=new PropertiesPromiseArray(castValue,useBound===true&&castValue._isBound()?castValue._boundTo:void 0).promise();useBound=false}if(useBound===true&&castValue._isBound()){ret._setBoundTo(castValue._boundTo)}return ret}Promise.prototype.props=function Promise$props(){return Promise$_Props(this,true)};Promise.props=function Promise$Props(promises){return Promise$_Props(promises,false)}}},{"./errors_api_rejection":222,"./properties_promise_array.js":236,"./util.js":249}],238:[function(require,module,exports){"use strict";function arrayCopy(src,srcIndex,dst,dstIndex,len){for(var j=0;j<len;++j){dst[j+dstIndex]=src[j+srcIndex]}}function pow2AtLeast(n){n=n>>>0;n=n-1;n=n|n>>1;n=n|n>>2;n=n|n>>4;n=n|n>>8;n=n|n>>16;return n+1}function getCapacity(capacity){if(typeof capacity!=="number")return 16;return pow2AtLeast(Math.min(Math.max(16,capacity),1073741824))}function Queue(capacity){this._capacity=getCapacity(capacity);this._length=0;this._front=0;this._makeCapacity()}Queue.prototype._willBeOverCapacity=function Queue$_willBeOverCapacity(size){return this._capacity<size};Queue.prototype._pushOne=function Queue$_pushOne(arg){var length=this.length();this._checkCapacity(length+1);var i=this._front+length&this._capacity-1;this[i]=arg;this._length=length+1};Queue.prototype.push=function Queue$push(fn,receiver,arg){var length=this.length()+3;if(this._willBeOverCapacity(length)){this._pushOne(fn);this._pushOne(receiver);this._pushOne(arg);return}var j=this._front+length-3;this._checkCapacity(length);var wrapMask=this._capacity-1;this[j+0&wrapMask]=fn;this[j+1&wrapMask]=receiver;this[j+2&wrapMask]=arg;this._length=length};Queue.prototype.shift=function Queue$shift(){var front=this._front,ret=this[front];this[front]=void 0;this._front=front+1&this._capacity-1;this._length--;return ret};Queue.prototype.length=function Queue$length(){return this._length};Queue.prototype._makeCapacity=function Queue$_makeCapacity(){var len=this._capacity;for(var i=0;i<len;++i){this[i]=void 0}};Queue.prototype._checkCapacity=function Queue$_checkCapacity(size){if(this._capacity<size){this._resizeTo(this._capacity<<3)}};Queue.prototype._resizeTo=function Queue$_resizeTo(capacity){var oldFront=this._front;var oldCapacity=this._capacity;var oldQueue=new Array(oldCapacity);var length=this.length();arrayCopy(this,0,oldQueue,0,oldCapacity);this._capacity=capacity;this._makeCapacity();this._front=0;if(oldFront+length<=oldCapacity){arrayCopy(oldQueue,oldFront,this,0,length)}else{var lengthBeforeWrapping=length-(oldFront+length&oldCapacity-1);arrayCopy(oldQueue,oldFront,this,0,lengthBeforeWrapping);arrayCopy(oldQueue,0,this,lengthBeforeWrapping,length-lengthBeforeWrapping)}};module.exports=Queue},{}],239:[function(require,module,exports){"use strict";module.exports=function(Promise,INTERNAL){var apiRejection=require("./errors_api_rejection.js")(Promise);var isArray=require("./util.js").isArray;var raceLater=function Promise$_raceLater(promise){return promise.then(function(array){return Promise$_Race(array,promise)})};var hasOwn={}.hasOwnProperty;function Promise$_Race(promises,parent){var maybePromise=Promise._cast(promises,void 0);if(maybePromise instanceof Promise){return raceLater(maybePromise)}else if(!isArray(promises)){return apiRejection("expecting an array, a promise or a thenable")}var ret=new Promise(INTERNAL);ret._setTrace(parent);if(parent!==void 0){if(parent._isBound()){ret._setBoundTo(parent._boundTo)}if(parent._cancellable()){ret._setCancellable();ret._cancellationParent=parent}}var fulfill=ret._fulfill;var reject=ret._reject;for(var i=0,len=promises.length;i<len;++i){var val=promises[i];if(val===void 0&&!hasOwn.call(promises,i)){continue}Promise.cast(val)._then(fulfill,reject,void 0,ret,null)}return ret}Promise.race=function Promise$Race(promises){return Promise$_Race(promises,void 0)};Promise.prototype.race=function Promise$race(){return Promise$_Race(this,void 0)}}},{"./errors_api_rejection.js":222,"./util.js":249}],240:[function(require,module,exports){"use strict";module.exports=function(Promise,Promise$_CreatePromiseArray,PromiseArray,apiRejection,INTERNAL){function Reduction(callback,index,accum,items,receiver){this.promise=new Promise(INTERNAL);this.index=index;this.length=items.length;this.items=items;this.callback=callback;this.receiver=receiver;this.accum=accum}Reduction.prototype.reject=function Reduction$reject(e){this.promise._reject(e)};Reduction.prototype.fulfill=function Reduction$fulfill(value,index){this.accum=value;this.index=index+1;this.iterate()};Reduction.prototype.iterate=function Reduction$iterate(){var i=this.index;var len=this.length;var items=this.items;var result=this.accum;var receiver=this.receiver;var callback=this.callback;for(;i<len;++i){result=callback.call(receiver,result,items[i],i,len);result=Promise._cast(result,void 0);if(result instanceof Promise){result._then(this.fulfill,this.reject,void 0,this,i);return}}this.promise._fulfill(result)};function Promise$_reducer(fulfilleds,initialValue){var fn=this;var receiver=void 0;if(typeof fn!=="function"){receiver=fn.receiver;fn=fn.fn}var len=fulfilleds.length;var accum=void 0;var startIndex=0;if(initialValue!==void 0){accum=initialValue;startIndex=0}else{startIndex=1;if(len>0)accum=fulfilleds[0]}var i=startIndex;if(i>=len){return accum}var reduction=new Reduction(fn,i,accum,fulfilleds,receiver);reduction.iterate();return reduction.promise}function Promise$_unpackReducer(fulfilleds){var fn=this.fn;var initialValue=this.initialValue;return Promise$_reducer.call(fn,fulfilleds,initialValue)}function Promise$_slowReduce(promises,fn,initialValue,useBound){return initialValue._then(function(initialValue){return Promise$_Reduce(promises,fn,initialValue,useBound)},void 0,void 0,void 0,void 0)}function Promise$_Reduce(promises,fn,initialValue,useBound){if(typeof fn!=="function"){return apiRejection("fn must be a function")}if(useBound===true&&promises._isBound()){fn={fn:fn,receiver:promises._boundTo}}if(initialValue!==void 0){if(initialValue instanceof Promise){if(initialValue.isFulfilled()){initialValue=initialValue._settledValue}else{return Promise$_slowReduce(promises,fn,initialValue,useBound)}}return Promise$_CreatePromiseArray(promises,PromiseArray,useBound===true&&promises._isBound()?promises._boundTo:void 0).promise()._then(Promise$_unpackReducer,void 0,void 0,{fn:fn,initialValue:initialValue},void 0)}return Promise$_CreatePromiseArray(promises,PromiseArray,useBound===true&&promises._isBound()?promises._boundTo:void 0).promise()._then(Promise$_reducer,void 0,void 0,fn,void 0)}Promise.reduce=function Promise$Reduce(promises,fn,initialValue){return Promise$_Reduce(promises,fn,initialValue,false)};Promise.prototype.reduce=function Promise$reduce(fn,initialValue){return Promise$_Reduce(this,fn,initialValue,true)}}},{}],241:[function(require,module,exports){(function(process){"use strict";var global=require("./global.js");var schedule;if(typeof process!=="undefined"&&process!==null&&typeof process.cwd==="function"&&typeof process.nextTick==="function"&&typeof process.version==="string"){schedule=function Promise$_Scheduler(fn){process.nextTick(fn)
}}else if((typeof global.MutationObserver==="function"||typeof global.WebkitMutationObserver==="function"||typeof global.WebKitMutationObserver==="function")&&typeof document!=="undefined"&&typeof document.createElement==="function"){schedule=function(){var MutationObserver=global.MutationObserver||global.WebkitMutationObserver||global.WebKitMutationObserver;var div=document.createElement("div");var queuedFn=void 0;var observer=new MutationObserver(function Promise$_Scheduler(){var fn=queuedFn;queuedFn=void 0;fn()});observer.observe(div,{attributes:true});return function Promise$_Scheduler(fn){queuedFn=fn;div.setAttribute("class","foo")}}()}else if(typeof global.postMessage==="function"&&typeof global.importScripts!=="function"&&typeof global.addEventListener==="function"&&typeof global.removeEventListener==="function"){var MESSAGE_KEY="bluebird_message_key_"+Math.random();schedule=function(){var queuedFn=void 0;function Promise$_Scheduler(e){if(e.source===global&&e.data===MESSAGE_KEY){var fn=queuedFn;queuedFn=void 0;fn()}}global.addEventListener("message",Promise$_Scheduler,false);return function Promise$_Scheduler(fn){queuedFn=fn;global.postMessage(MESSAGE_KEY,"*")}}()}else if(typeof global.MessageChannel==="function"){schedule=function(){var queuedFn=void 0;var channel=new global.MessageChannel;channel.port1.onmessage=function Promise$_Scheduler(){var fn=queuedFn;queuedFn=void 0;fn()};return function Promise$_Scheduler(fn){queuedFn=fn;channel.port2.postMessage(null)}}()}else if(global.setTimeout){schedule=function Promise$_Scheduler(fn){setTimeout(fn,4)}}else{schedule=function Promise$_Scheduler(fn){fn()}}module.exports=schedule}).call(this,require("_process"))},{"./global.js":227,_process:10}],242:[function(require,module,exports){"use strict";module.exports=function(Promise,Promise$_CreatePromiseArray,PromiseArray){var SettledPromiseArray=require("./settled_promise_array.js")(Promise,PromiseArray);function Promise$_Settle(promises,useBound){return Promise$_CreatePromiseArray(promises,SettledPromiseArray,useBound===true&&promises._isBound()?promises._boundTo:void 0).promise()}Promise.settle=function Promise$Settle(promises){return Promise$_Settle(promises,false)};Promise.prototype.settle=function Promise$settle(){return Promise$_Settle(this,true)}}},{"./settled_promise_array.js":243}],243:[function(require,module,exports){"use strict";module.exports=function(Promise,PromiseArray){var PromiseInspection=Promise.PromiseInspection;var util=require("./util.js");var inherits=util.inherits;function SettledPromiseArray(values,boundTo){this.constructor$(values,boundTo)}inherits(SettledPromiseArray,PromiseArray);SettledPromiseArray.prototype._promiseResolved=function SettledPromiseArray$_promiseResolved(index,inspection){this._values[index]=inspection;var totalResolved=++this._totalResolved;if(totalResolved>=this._length){this._resolve(this._values)}};SettledPromiseArray.prototype._promiseFulfilled=function SettledPromiseArray$_promiseFulfilled(value,index){if(this._isResolved())return;var ret=new PromiseInspection;ret._bitField=268435456;ret._settledValue=value;this._promiseResolved(index,ret)};SettledPromiseArray.prototype._promiseRejected=function SettledPromiseArray$_promiseRejected(reason,index){if(this._isResolved())return;var ret=new PromiseInspection;ret._bitField=134217728;ret._settledValue=reason;this._promiseResolved(index,ret)};return SettledPromiseArray}},{"./util.js":249}],244:[function(require,module,exports){"use strict";module.exports=function(Promise,Promise$_CreatePromiseArray,PromiseArray,apiRejection){var SomePromiseArray=require("./some_promise_array.js")(PromiseArray);function Promise$_Some(promises,howMany,useBound){if((howMany|0)!==howMany||howMany<0){return apiRejection("expecting a positive integer")}var ret=Promise$_CreatePromiseArray(promises,SomePromiseArray,useBound===true&&promises._isBound()?promises._boundTo:void 0);var promise=ret.promise();if(promise.isRejected()){return promise}ret.setHowMany(howMany);ret.init();return promise}Promise.some=function Promise$Some(promises,howMany){return Promise$_Some(promises,howMany,false)};Promise.prototype.some=function Promise$some(count){return Promise$_Some(this,count,true)}}},{"./some_promise_array.js":245}],245:[function(require,module,exports){"use strict";module.exports=function(PromiseArray){var util=require("./util.js");var RangeError=require("./errors.js").RangeError;var inherits=util.inherits;var isArray=util.isArray;function SomePromiseArray(values,boundTo){this.constructor$(values,boundTo);this._howMany=0;this._unwrap=false;this._initialized=false}inherits(SomePromiseArray,PromiseArray);SomePromiseArray.prototype._init=function SomePromiseArray$_init(){if(!this._initialized){return}if(this._howMany===0){this._resolve([]);return}this._init$(void 0,-2);var isArrayResolved=isArray(this._values);this._holes=isArrayResolved?this._values.length-this.length():0;if(!this._isResolved()&&isArrayResolved&&this._howMany>this._canPossiblyFulfill()){var message="(Promise.some) input array contains less than "+this._howMany+" promises";this._reject(new RangeError(message))}};SomePromiseArray.prototype.init=function SomePromiseArray$init(){this._initialized=true;this._init()};SomePromiseArray.prototype.setUnwrap=function SomePromiseArray$setUnwrap(){this._unwrap=true};SomePromiseArray.prototype.howMany=function SomePromiseArray$howMany(){return this._howMany};SomePromiseArray.prototype.setHowMany=function SomePromiseArray$setHowMany(count){if(this._isResolved())return;this._howMany=count};SomePromiseArray.prototype._promiseFulfilled=function SomePromiseArray$_promiseFulfilled(value){if(this._isResolved())return;this._addFulfilled(value);if(this._fulfilled()===this.howMany()){this._values.length=this.howMany();if(this.howMany()===1&&this._unwrap){this._resolve(this._values[0])}else{this._resolve(this._values)}}};SomePromiseArray.prototype._promiseRejected=function SomePromiseArray$_promiseRejected(reason){if(this._isResolved())return;this._addRejected(reason);if(this.howMany()>this._canPossiblyFulfill()){if(this._values.length===this.length()){this._reject([])}else{this._reject(this._values.slice(this.length()+this._holes))}}};SomePromiseArray.prototype._fulfilled=function SomePromiseArray$_fulfilled(){return this._totalResolved};SomePromiseArray.prototype._rejected=function SomePromiseArray$_rejected(){return this._values.length-this.length()-this._holes};SomePromiseArray.prototype._addRejected=function SomePromiseArray$_addRejected(reason){this._values.push(reason)};SomePromiseArray.prototype._addFulfilled=function SomePromiseArray$_addFulfilled(value){this._values[this._totalResolved++]=value};SomePromiseArray.prototype._canPossiblyFulfill=function SomePromiseArray$_canPossiblyFulfill(){return this.length()-this._rejected()};return SomePromiseArray}},{"./errors.js":221,"./util.js":249}],246:[function(require,module,exports){"use strict";module.exports=function(Promise){function PromiseInspection(promise){if(promise!==void 0){this._bitField=promise._bitField;this._settledValue=promise.isResolved()?promise._settledValue:void 0}else{this._bitField=0;this._settledValue=void 0}}PromiseInspection.prototype.isFulfilled=Promise.prototype.isFulfilled=function Promise$isFulfilled(){return(this._bitField&268435456)>0};PromiseInspection.prototype.isRejected=Promise.prototype.isRejected=function Promise$isRejected(){return(this._bitField&134217728)>0};PromiseInspection.prototype.isPending=Promise.prototype.isPending=function Promise$isPending(){return(this._bitField&402653184)===0};PromiseInspection.prototype.value=Promise.prototype.value=function Promise$value(){if(!this.isFulfilled()){throw new TypeError("cannot get fulfillment value of a non-fulfilled promise")}return this._settledValue};PromiseInspection.prototype.error=Promise.prototype.reason=function Promise$reason(){if(!this.isRejected()){throw new TypeError("cannot get rejection reason of a non-rejected promise")}return this._settledValue};PromiseInspection.prototype.isResolved=Promise.prototype.isResolved=function Promise$isResolved(){return(this._bitField&402653184)>0};Promise.prototype.inspect=function Promise$inspect(){return new PromiseInspection(this)};Promise.PromiseInspection=PromiseInspection}},{}],247:[function(require,module,exports){"use strict";module.exports=function(Promise,INTERNAL){var util=require("./util.js");var canAttach=require("./errors.js").canAttach;var errorObj=util.errorObj;var isObject=util.isObject;function getThen(obj){try{return obj.then}catch(e){errorObj.e=e;return errorObj}}function Promise$_Cast(obj,originalPromise){if(isObject(obj)){if(obj instanceof Promise){return obj}else if(isAnyBluebirdPromise(obj)){var ret=new Promise(INTERNAL);ret._setTrace(void 0);obj._then(ret._fulfillUnchecked,ret._rejectUncheckedCheckError,ret._progressUnchecked,ret,null);ret._setFollowing();return ret}var then=getThen(obj);if(then===errorObj){if(originalPromise!==void 0&&canAttach(then.e)){originalPromise._attachExtraTrace(then.e)}return Promise.reject(then.e)}else if(typeof then==="function"){return Promise$_doThenable(obj,then,originalPromise)}}return obj}var hasProp={}.hasOwnProperty;function isAnyBluebirdPromise(obj){return hasProp.call(obj,"_promise0")}function Promise$_doThenable(x,then,originalPromise){var resolver=Promise.defer();var called=false;try{then.call(x,Promise$_resolveFromThenable,Promise$_rejectFromThenable,Promise$_progressFromThenable)}catch(e){if(!called){called=true;var trace=canAttach(e)?e:new Error(e+"");if(originalPromise!==void 0){originalPromise._attachExtraTrace(trace)}resolver.promise._reject(e,trace)}}return resolver.promise;function Promise$_resolveFromThenable(y){if(called)return;called=true;if(x===y){var e=Promise._makeSelfResolutionError();if(originalPromise!==void 0){originalPromise._attachExtraTrace(e)}resolver.promise._reject(e,void 0);return}resolver.resolve(y)}function Promise$_rejectFromThenable(r){if(called)return;called=true;var trace=canAttach(r)?r:new Error(r+"");if(originalPromise!==void 0){originalPromise._attachExtraTrace(trace)}resolver.promise._reject(r,trace)}function Promise$_progressFromThenable(v){if(called)return;var promise=resolver.promise;if(typeof promise._progress==="function"){promise._progress(v)}}}Promise._cast=Promise$_Cast}},{"./errors.js":221,"./util.js":249}],248:[function(require,module,exports){"use strict";var global=require("./global.js");var setTimeout=function(fn,ms){var $_len=arguments.length;var args=new Array($_len-2);for(var $_i=2;$_i<$_len;++$_i){args[$_i-2]=arguments[$_i]}global.setTimeout(function(){fn.apply(void 0,args)},ms)};module.exports=function(Promise,INTERNAL){var util=require("./util.js");var errors=require("./errors.js");var apiRejection=require("./errors_api_rejection")(Promise);var TimeoutError=Promise.TimeoutError;var afterTimeout=function Promise$_afterTimeout(promise,message,ms){if(!promise.isPending())return;if(typeof message!=="string"){message="operation timed out after"+" "+ms+" ms"}var err=new TimeoutError(message);errors.markAsOriginatingFromRejection(err);promise._attachExtraTrace(err);promise._rejectUnchecked(err)};var afterDelay=function Promise$_afterDelay(value,promise){promise._fulfill(value)};var delay=Promise.delay=function Promise$Delay(value,ms){if(ms===void 0){ms=value;value=void 0}ms=+ms;var maybePromise=Promise._cast(value,void 0);var promise=new Promise(INTERNAL);if(maybePromise instanceof Promise){if(maybePromise._isBound()){promise._setBoundTo(maybePromise._boundTo)}if(maybePromise._cancellable()){promise._setCancellable();promise._cancellationParent=maybePromise}promise._setTrace(maybePromise);promise._follow(maybePromise);return promise.then(function(value){return Promise.delay(value,ms)})}else{promise._setTrace(void 0);setTimeout(afterDelay,ms,value,promise)}return promise};Promise.prototype.delay=function Promise$delay(ms){return delay(this,ms)};Promise.prototype.timeout=function Promise$timeout(ms,message){ms=+ms;var ret=new Promise(INTERNAL);ret._setTrace(this);if(this._isBound())ret._setBoundTo(this._boundTo);if(this._cancellable()){ret._setCancellable();ret._cancellationParent=this}ret._follow(this);setTimeout(afterTimeout,ms,ret,message,ms);return ret}}},{"./errors.js":221,"./errors_api_rejection":222,"./global.js":227,"./util.js":249}],249:[function(require,module,exports){"use strict";var global=require("./global.js");var es5=require("./es5.js");var haveGetters=function(){try{var o={};es5.defineProperty(o,"f",{get:function(){return 3}});return o.f===3}catch(e){return false}}();var canEvaluate=function(){if(typeof window!=="undefined"&&window!==null&&typeof window.document!=="undefined"&&typeof navigator!=="undefined"&&navigator!==null&&typeof navigator.appName==="string"&&window===global){return false}return true}();function deprecated(msg){if(typeof console!=="undefined"&&console!==null&&typeof console.warn==="function"){console.warn("Bluebird: "+msg)}}var errorObj={e:{}};function tryCatch1(fn,receiver,arg){try{return fn.call(receiver,arg)}catch(e){errorObj.e=e;return errorObj}}function tryCatch2(fn,receiver,arg,arg2){try{return fn.call(receiver,arg,arg2)}catch(e){errorObj.e=e;return errorObj}}function tryCatchApply(fn,args,receiver){try{return fn.apply(receiver,args)}catch(e){errorObj.e=e;return errorObj}}var inherits=function(Child,Parent){var hasProp={}.hasOwnProperty;function T(){this.constructor=Child;this.constructor$=Parent;for(var propertyName in Parent.prototype){if(hasProp.call(Parent.prototype,propertyName)&&propertyName.charAt(propertyName.length-1)!=="$"){this[propertyName+"$"]=Parent.prototype[propertyName]}}}T.prototype=Parent.prototype;Child.prototype=new T;return Child.prototype};function asString(val){return typeof val==="string"?val:""+val}function isPrimitive(val){return val==null||val===true||val===false||typeof val==="string"||typeof val==="number"}function isObject(value){return!isPrimitive(value)}function maybeWrapAsError(maybeError){if(!isPrimitive(maybeError))return maybeError;return new Error(asString(maybeError))}function withAppended(target,appendee){var len=target.length;var ret=new Array(len+1);var i;for(i=0;i<len;++i){ret[i]=target[i]}ret[i]=appendee;return ret}function notEnumerableProp(obj,name,value){if(isPrimitive(obj))return obj;var descriptor={value:value,configurable:true,enumerable:false,writable:true};es5.defineProperty(obj,name,descriptor);return obj}var wrapsPrimitiveReceiver=function(){return this!=="string"}.call("string");function thrower(r){throw r}function toFastProperties(obj){function f(){}f.prototype=obj;return f;eval(obj)}var ret={thrower:thrower,isArray:es5.isArray,haveGetters:haveGetters,notEnumerableProp:notEnumerableProp,isPrimitive:isPrimitive,isObject:isObject,canEvaluate:canEvaluate,deprecated:deprecated,errorObj:errorObj,tryCatch1:tryCatch1,tryCatch2:tryCatch2,tryCatchApply:tryCatchApply,inherits:inherits,withAppended:withAppended,asString:asString,maybeWrapAsError:maybeWrapAsError,wrapsPrimitiveReceiver:wrapsPrimitiveReceiver,toFastProperties:toFastProperties};module.exports=ret},{"./es5.js":223,"./global.js":227}],250:[function(require,module,exports){var LocationActions={PUSH:"push",REPLACE:"replace",POP:"pop"};module.exports=LocationActions},{}],251:[function(require,module,exports){var LocationActions=require("../actions/LocationActions");var ImitateBrowserBehavior={updateScrollPosition:function(position,actionType){switch(actionType){case LocationActions.PUSH:case LocationActions.REPLACE:window.scrollTo(0,0);break;case LocationActions.POP:if(position){window.scrollTo(position.x,position.y)}else{window.scrollTo(0,0)}break}}};module.exports=ImitateBrowserBehavior},{"../actions/LocationActions":250}],252:[function(require,module,exports){var ScrollToTopBehavior={updateScrollPosition:function(){window.scrollTo(0,0)}};module.exports=ScrollToTopBehavior},{}],253:[function(require,module,exports){var React=require("react");var FakeNode=require("../mixins/FakeNode");var PropTypes=require("../utils/PropTypes");var DefaultRoute=React.createClass({displayName:"DefaultRoute",mixins:[FakeNode],propTypes:{name:React.PropTypes.string,path:PropTypes.falsy,handler:React.PropTypes.func.isRequired}});module.exports=DefaultRoute},{"../mixins/FakeNode":263,"../utils/PropTypes":274,react:"react"}],254:[function(require,module,exports){var React=require("react");var classSet=require("react/lib/cx");var assign=require("react/lib/Object.assign");var Navigation=require("../mixins/Navigation");var State=require("../mixins/State");function isLeftClickEvent(event){return event.button===0}function isModifiedEvent(event){return!!(event.metaKey||event.altKey||event.ctrlKey||event.shiftKey)}var Link=React.createClass({displayName:"Link",mixins:[Navigation,State],propTypes:{activeClassName:React.PropTypes.string.isRequired,to:React.PropTypes.string.isRequired,params:React.PropTypes.object,query:React.PropTypes.object,onClick:React.PropTypes.func},getDefaultProps:function(){return{activeClassName:"active"}},handleClick:function(event){var allowTransition=true;var clickResult;if(this.props.onClick)clickResult=this.props.onClick(event);if(isModifiedEvent(event)||!isLeftClickEvent(event))return;if(clickResult===false||event.defaultPrevented===true)allowTransition=false;event.preventDefault();if(allowTransition)this.transitionTo(this.props.to,this.props.params,this.props.query)},getHref:function(){return this.makeHref(this.props.to,this.props.params,this.props.query)},getClassName:function(){var classNames={};if(this.props.className)classNames[this.props.className]=true;if(this.isActive(this.props.to,this.props.params,this.props.query))classNames[this.props.activeClassName]=true;return classSet(classNames)},render:function(){var props=assign({},this.props,{href:this.getHref(),className:this.getClassName(),onClick:this.handleClick});return React.DOM.a(props,this.props.children)}});module.exports=Link},{"../mixins/Navigation":264,"../mixins/State":268,react:"react","react/lib/Object.assign":294,"react/lib/cx":295}],255:[function(require,module,exports){var React=require("react");var FakeNode=require("../mixins/FakeNode");var PropTypes=require("../utils/PropTypes");var NotFoundRoute=React.createClass({displayName:"NotFoundRoute",mixins:[FakeNode],propTypes:{name:React.PropTypes.string,path:PropTypes.falsy,handler:React.PropTypes.func.isRequired}});module.exports=NotFoundRoute},{"../mixins/FakeNode":263,"../utils/PropTypes":274,react:"react"}],256:[function(require,module,exports){var React=require("react");var FakeNode=require("../mixins/FakeNode");var PropTypes=require("../utils/PropTypes");var Redirect=React.createClass({displayName:"Redirect",mixins:[FakeNode],propTypes:{path:React.PropTypes.string,from:React.PropTypes.string,to:React.PropTypes.string,handler:PropTypes.falsy}});module.exports=Redirect},{"../mixins/FakeNode":263,"../utils/PropTypes":274,react:"react"}],257:[function(require,module,exports){var React=require("react");var FakeNode=require("../mixins/FakeNode");var Route=React.createClass({displayName:"Route",mixins:[FakeNode],propTypes:{name:React.PropTypes.string,path:React.PropTypes.string,handler:React.PropTypes.func.isRequired,ignoreScrollBehavior:React.PropTypes.bool}});module.exports=Route},{"../mixins/FakeNode":263,react:"react"}],258:[function(require,module,exports){var React=require("react");var RouteHandlerMixin=require("../mixins/RouteHandler");var RouteHandler=React.createClass({displayName:"RouteHandler",mixins:[RouteHandlerMixin],getDefaultProps:function(){return{ref:"__routeHandler__"}},render:function(){return this.getRouteHandler()}});module.exports=RouteHandler},{"../mixins/RouteHandler":266,react:"react"}],259:[function(require,module,exports){exports.DefaultRoute=require("./components/DefaultRoute");exports.Link=require("./components/Link");exports.NotFoundRoute=require("./components/NotFoundRoute");exports.Redirect=require("./components/Redirect");exports.Route=require("./components/Route");exports.RouteHandler=require("./components/RouteHandler");exports.HashLocation=require("./locations/HashLocation");exports.HistoryLocation=require("./locations/HistoryLocation");exports.RefreshLocation=require("./locations/RefreshLocation");exports.ImitateBrowserBehavior=require("./behaviors/ImitateBrowserBehavior");exports.ScrollToTopBehavior=require("./behaviors/ScrollToTopBehavior");exports.Navigation=require("./mixins/Navigation");exports.State=require("./mixins/State");exports.create=require("./utils/createRouter");exports.run=require("./utils/runRouter");exports.History=require("./utils/History")},{"./behaviors/ImitateBrowserBehavior":251,"./behaviors/ScrollToTopBehavior":252,"./components/DefaultRoute":253,"./components/Link":254,"./components/NotFoundRoute":255,"./components/Redirect":256,"./components/Route":257,"./components/RouteHandler":258,"./locations/HashLocation":260,"./locations/HistoryLocation":261,"./locations/RefreshLocation":262,"./mixins/Navigation":264,"./mixins/State":268,"./utils/History":271,"./utils/createRouter":277,"./utils/runRouter":281}],260:[function(require,module,exports){var LocationActions=require("../actions/LocationActions");var History=require("../utils/History");var Path=require("../utils/Path");function getHashPath(){return Path.decode(window.location.href.split("#")[1]||"")}var _actionType;function ensureSlash(){var path=getHashPath();if(path.charAt(0)==="/")return true;HashLocation.replace("/"+path);return false}var _changeListeners=[];function notifyChange(type){if(type===LocationActions.PUSH)History.length+=1;var change={path:getHashPath(),type:type};_changeListeners.forEach(function(listener){listener(change)})}var _isListening=false;function onHashChange(){if(ensureSlash()){notifyChange(_actionType||LocationActions.POP);_actionType=null}}var HashLocation={addChangeListener:function(listener){_changeListeners.push(listener);ensureSlash();if(_isListening)return;if(window.addEventListener){window.addEventListener("hashchange",onHashChange,false)}else{window.attachEvent("onhashchange",onHashChange)}_isListening=true},removeChangeListener:function(listener){for(var i=0,l=_changeListeners.length;i<l;i++){if(_changeListeners[i]===listener){_changeListeners.splice(i,1);break}}if(window.removeEventListener){window.removeEventListener("hashchange",onHashChange,false)}else{window.removeEvent("onhashchange",onHashChange)}if(_changeListeners.length===0)_isListening=false},push:function(path){_actionType=LocationActions.PUSH;window.location.hash=Path.encode(path)},replace:function(path){_actionType=LocationActions.REPLACE;window.location.replace(window.location.pathname+"#"+Path.encode(path))},pop:function(){_actionType=LocationActions.POP;History.back()},getCurrentPath:getHashPath,toString:function(){return"<HashLocation>"}};module.exports=HashLocation},{"../actions/LocationActions":250,"../utils/History":271,"../utils/Path":272}],261:[function(require,module,exports){var LocationActions=require("../actions/LocationActions");var History=require("../utils/History");var Path=require("../utils/Path");function getWindowPath(){return Path.decode(window.location.pathname+window.location.search)}var _changeListeners=[];function notifyChange(type){var change={path:getWindowPath(),type:type};_changeListeners.forEach(function(listener){listener(change)})}var _isListening=false;function onPopState(){notifyChange(LocationActions.POP)}var HistoryLocation={addChangeListener:function(listener){_changeListeners.push(listener);if(_isListening)return;if(window.addEventListener){window.addEventListener("popstate",onPopState,false)}else{window.attachEvent("popstate",onPopState)}_isListening=true},removeChangeListener:function(listener){for(var i=0,l=_changeListeners.length;i<l;i++){if(_changeListeners[i]===listener){_changeListeners.splice(i,1);break}}if(window.addEventListener){window.removeEventListener("popstate",onPopState)}else{window.removeEvent("popstate",onPopState)}if(_changeListeners.length===0)_isListening=false},push:function(path){window.history.pushState({path:path},"",Path.encode(path));History.length+=1;notifyChange(LocationActions.PUSH)},replace:function(path){window.history.replaceState({path:path},"",Path.encode(path));notifyChange(LocationActions.REPLACE)},pop:History.back,getCurrentPath:getWindowPath,toString:function(){return"<HistoryLocation>"}};module.exports=HistoryLocation},{"../actions/LocationActions":250,"../utils/History":271,"../utils/Path":272}],262:[function(require,module,exports){var HistoryLocation=require("./HistoryLocation");var History=require("../utils/History");var Path=require("../utils/Path");var RefreshLocation={push:function(path){window.location=Path.encode(path)},replace:function(path){window.location.replace(Path.encode(path))},pop:History.back,getCurrentPath:HistoryLocation.getCurrentPath,toString:function(){return"<RefreshLocation>"}};module.exports=RefreshLocation},{"../utils/History":271,"../utils/Path":272,"./HistoryLocation":261}],263:[function(require,module,exports){var invariant=require("react/lib/invariant");var FakeNode={render:function(){invariant(false,"%s elements should not be rendered",this.constructor.displayName)}};module.exports=FakeNode},{"react/lib/invariant":297}],264:[function(require,module,exports){var React=require("react");var Navigation={contextTypes:{makePath:React.PropTypes.func.isRequired,makeHref:React.PropTypes.func.isRequired,transitionTo:React.PropTypes.func.isRequired,replaceWith:React.PropTypes.func.isRequired,goBack:React.PropTypes.func.isRequired},makePath:function(to,params,query){return this.context.makePath(to,params,query)},makeHref:function(to,params,query){return this.context.makeHref(to,params,query)},transitionTo:function(to,params,query){this.context.transitionTo(to,params,query)},replaceWith:function(to,params,query){this.context.replaceWith(to,params,query)},goBack:function(){this.context.goBack()}};module.exports=Navigation},{react:"react"}],265:[function(require,module,exports){var React=require("react");var NavigationContext={childContextTypes:{makePath:React.PropTypes.func.isRequired,makeHref:React.PropTypes.func.isRequired,transitionTo:React.PropTypes.func.isRequired,replaceWith:React.PropTypes.func.isRequired,goBack:React.PropTypes.func.isRequired},getChildContext:function(){return{makePath:this.constructor.makePath,makeHref:this.constructor.makeHref,transitionTo:this.constructor.transitionTo,replaceWith:this.constructor.replaceWith,goBack:this.constructor.goBack}}};module.exports=NavigationContext},{react:"react"}],266:[function(require,module,exports){var React=require("react");module.exports={contextTypes:{getRouteAtDepth:React.PropTypes.func.isRequired,getRouteComponents:React.PropTypes.func.isRequired,routeHandlers:React.PropTypes.array.isRequired},childContextTypes:{routeHandlers:React.PropTypes.array.isRequired},getChildContext:function(){return{routeHandlers:this.context.routeHandlers.concat([this])}},getRouteDepth:function(){return this.context.routeHandlers.length-1},componentDidMount:function(){this._updateRouteComponent()},componentDidUpdate:function(){this._updateRouteComponent()},_updateRouteComponent:function(){var depth=this.getRouteDepth();var components=this.context.getRouteComponents();components[depth]=this.refs[this.props.ref||"__routeHandler__"]},getRouteHandler:function(props){var route=this.context.getRouteAtDepth(this.getRouteDepth());return route?React.createElement(route.handler,props||this.props):null}}},{react:"react"}],267:[function(require,module,exports){var invariant=require("react/lib/invariant");var canUseDOM=require("react/lib/ExecutionEnvironment").canUseDOM;var getWindowScrollPosition=require("../utils/getWindowScrollPosition");function shouldUpdateScroll(state,prevState){if(!prevState)return true;if(state.pathname===prevState.pathname)return false;var routes=state.routes;var prevRoutes=prevState.routes;var sharedAncestorRoutes=routes.filter(function(route){return prevRoutes.indexOf(route)!==-1});return!sharedAncestorRoutes.some(function(route){return route.ignoreScrollBehavior})}var Scrolling={statics:{recordScrollPosition:function(path){if(!this.scrollHistory)this.scrollHistory={};this.scrollHistory[path]=getWindowScrollPosition()},getScrollPosition:function(path){if(!this.scrollHistory)this.scrollHistory={};return this.scrollHistory[path]||null}},componentWillMount:function(){invariant(this.getScrollBehavior()==null||canUseDOM,"Cannot use scroll behavior without a DOM")},componentDidMount:function(){this._updateScroll()},componentDidUpdate:function(prevProps,prevState){this._updateScroll(prevState)},_updateScroll:function(prevState){if(!shouldUpdateScroll(this.state,prevState))return;var scrollBehavior=this.getScrollBehavior();if(scrollBehavior)scrollBehavior.updateScrollPosition(this.constructor.getScrollPosition(this.state.path),this.state.action)}};module.exports=Scrolling},{"../utils/getWindowScrollPosition":279,"react/lib/ExecutionEnvironment":293,"react/lib/invariant":297}],268:[function(require,module,exports){var React=require("react");var State={contextTypes:{getCurrentPath:React.PropTypes.func.isRequired,getCurrentRoutes:React.PropTypes.func.isRequired,getCurrentPathname:React.PropTypes.func.isRequired,getCurrentParams:React.PropTypes.func.isRequired,getCurrentQuery:React.PropTypes.func.isRequired,isActive:React.PropTypes.func.isRequired},getPath:function(){return this.context.getCurrentPath()},getRoutes:function(){return this.context.getCurrentRoutes()},getPathname:function(){return this.context.getCurrentPathname()},getParams:function(){return this.context.getCurrentParams()},getQuery:function(){return this.context.getCurrentQuery()},isActive:function(to,params,query){return this.context.isActive(to,params,query)}};module.exports=State},{react:"react"}],269:[function(require,module,exports){var React=require("react");var assign=require("react/lib/Object.assign");var Path=require("../utils/Path");function routeIsActive(activeRoutes,routeName){return activeRoutes.some(function(route){return route.name===routeName})}function paramsAreActive(activeParams,params){for(var property in params)if(String(activeParams[property])!==String(params[property]))return false;return true}function queryIsActive(activeQuery,query){for(var property in query)if(String(activeQuery[property])!==String(query[property]))return false;return true}var StateContext={getCurrentPath:function(){return this.state.path},getCurrentRoutes:function(){return this.state.routes.slice(0)},getCurrentPathname:function(){return this.state.pathname},getCurrentParams:function(){return assign({},this.state.params)},getCurrentQuery:function(){return assign({},this.state.query)},isActive:function(to,params,query){if(Path.isAbsolute(to))return to===this.state.path;return routeIsActive(this.state.routes,to)&&paramsAreActive(this.state.params,params)&&(query==null||queryIsActive(this.state.query,query))},childContextTypes:{getCurrentPath:React.PropTypes.func.isRequired,getCurrentRoutes:React.PropTypes.func.isRequired,getCurrentPathname:React.PropTypes.func.isRequired,getCurrentParams:React.PropTypes.func.isRequired,getCurrentQuery:React.PropTypes.func.isRequired,isActive:React.PropTypes.func.isRequired},getChildContext:function(){return{getCurrentPath:this.getCurrentPath,getCurrentRoutes:this.getCurrentRoutes,getCurrentPathname:this.getCurrentPathname,getCurrentParams:this.getCurrentParams,getCurrentQuery:this.getCurrentQuery,isActive:this.isActive}}};module.exports=StateContext},{"../utils/Path":272,react:"react","react/lib/Object.assign":294}],270:[function(require,module,exports){function Cancellation(){}module.exports=Cancellation},{}],271:[function(require,module,exports){var invariant=require("react/lib/invariant");var canUseDOM=require("react/lib/ExecutionEnvironment").canUseDOM;var History={back:function(){invariant(canUseDOM,"Cannot use History.back without a DOM");History.length-=1;window.history.back()},length:1};module.exports=History},{"react/lib/ExecutionEnvironment":293,"react/lib/invariant":297}],272:[function(require,module,exports){var invariant=require("react/lib/invariant");
var merge=require("qs/lib/utils").merge;var qs=require("qs");var paramCompileMatcher=/:([a-zA-Z_$][a-zA-Z0-9_$]*)|[*.()\[\]\\+|{}^$]/g;var paramInjectMatcher=/:([a-zA-Z_$][a-zA-Z0-9_$?]*[?]?)|[*]/g;var paramInjectTrailingSlashMatcher=/\/\/\?|\/\?/g;var queryMatcher=/\?(.+)/;var _compiledPatterns={};function compilePattern(pattern){if(!(pattern in _compiledPatterns)){var paramNames=[];var source=pattern.replace(paramCompileMatcher,function(match,paramName){if(paramName){paramNames.push(paramName);return"([^/?#]+)"}else if(match==="*"){paramNames.push("splat");return"(.*?)"}else{return"\\"+match}});_compiledPatterns[pattern]={matcher:new RegExp("^"+source+"$","i"),paramNames:paramNames}}return _compiledPatterns[pattern]}var Path={decode:function(path){return decodeURI(path.replace(/\+/g," "))},encode:function(path){return encodeURI(path).replace(/%20/g,"+")},extractParamNames:function(pattern){return compilePattern(pattern).paramNames},extractParams:function(pattern,path){var object=compilePattern(pattern);var match=path.match(object.matcher);if(!match)return null;var params={};object.paramNames.forEach(function(paramName,index){params[paramName]=match[index+1]});return params},injectParams:function(pattern,params){params=params||{};var splatIndex=0;return pattern.replace(paramInjectMatcher,function(match,paramName){paramName=paramName||"splat";if(paramName.slice(-1)!=="?"){invariant(params[paramName]!=null,'Missing "'+paramName+'" parameter for path "'+pattern+'"')}else{paramName=paramName.slice(0,-1);if(params[paramName]==null)return""}var segment;if(paramName==="splat"&&Array.isArray(params[paramName])){segment=params[paramName][splatIndex++];invariant(segment!=null,"Missing splat # "+splatIndex+' for path "'+pattern+'"')}else{segment=params[paramName]}return segment}).replace(paramInjectTrailingSlashMatcher,"/")},extractQuery:function(path){var match=path.match(queryMatcher);return match&&qs.parse(match[1])},withoutQuery:function(path){return path.replace(queryMatcher,"")},withQuery:function(path,query){var existingQuery=Path.extractQuery(path);if(existingQuery)query=query?merge(existingQuery,query):existingQuery;var queryString=query&&qs.stringify(query);if(queryString)return Path.withoutQuery(path)+"?"+queryString;return path},isAbsolute:function(path){return path.charAt(0)==="/"},normalize:function(path,parentRoute){return path.replace(/^\/*/,"/")},join:function(a,b){return a.replace(/\/*$/,"/")+b}};module.exports=Path},{qs:283,"qs/lib/utils":287,"react/lib/invariant":297}],273:[function(require,module,exports){var Promise=require("when/lib/Promise");module.exports=Promise},{"when/lib/Promise":288}],274:[function(require,module,exports){var PropTypes={falsy:function(props,propName,componentName){if(props[propName])return new Error("<"+componentName+'> may not have a "'+propName+'" prop')}};module.exports=PropTypes},{}],275:[function(require,module,exports){function Redirect(to,params,query){this.to=to;this.params=params;this.query=query}module.exports=Redirect},{}],276:[function(require,module,exports){var assign=require("react/lib/Object.assign");var reversedArray=require("./reversedArray");var Redirect=require("./Redirect");var Promise=require("./Promise");function runHooks(hooks,callback){var promise;try{promise=hooks.reduce(function(promise,hook){return promise?promise.then(hook):hook()},null)}catch(error){return callback(error)}if(promise){promise.then(function(){setTimeout(callback)},function(error){setTimeout(function(){callback(error)})})}else{callback()}}function runTransitionFromHooks(transition,routes,components,callback){components=reversedArray(components);var hooks=reversedArray(routes).map(function(route,index){return function(){var handler=route.handler;if(!transition.isAborted&&handler.willTransitionFrom)return handler.willTransitionFrom(transition,components[index]);var promise=transition._promise;transition._promise=null;return promise}});runHooks(hooks,callback)}function runTransitionToHooks(transition,routes,params,query,callback){var hooks=routes.map(function(route){return function(){var handler=route.handler;if(!transition.isAborted&&handler.willTransitionTo)handler.willTransitionTo(transition,params,query);var promise=transition._promise;transition._promise=null;return promise}});runHooks(hooks,callback)}function Transition(path,retry){this.path=path;this.abortReason=null;this.isAborted=false;this.retry=retry.bind(this);this._promise=null}assign(Transition.prototype,{abort:function(reason){if(this.isAborted){return}this.abortReason=reason;this.isAborted=true},redirect:function(to,params,query){this.abort(new Redirect(to,params,query))},wait:function(value){this._promise=Promise.resolve(value)},from:function(routes,components,callback){return runTransitionFromHooks(this,routes,components,callback)},to:function(routes,params,query,callback){return runTransitionToHooks(this,routes,params,query,callback)}});module.exports=Transition},{"./Promise":273,"./Redirect":275,"./reversedArray":280,"react/lib/Object.assign":294}],277:[function(require,module,exports){(function(process){var React=require("react");var warning=require("react/lib/warning");var invariant=require("react/lib/invariant");var canUseDOM=require("react/lib/ExecutionEnvironment").canUseDOM;var ImitateBrowserBehavior=require("../behaviors/ImitateBrowserBehavior");var RouteHandler=require("../components/RouteHandler");var LocationActions=require("../actions/LocationActions");var HashLocation=require("../locations/HashLocation");var HistoryLocation=require("../locations/HistoryLocation");var RefreshLocation=require("../locations/RefreshLocation");var NavigationContext=require("../mixins/NavigationContext");var StateContext=require("../mixins/StateContext");var Scrolling=require("../mixins/Scrolling");var createRoutesFromChildren=require("./createRoutesFromChildren");var supportsHistory=require("./supportsHistory");var Transition=require("./Transition");var PropTypes=require("./PropTypes");var Redirect=require("./Redirect");var History=require("./History");var Cancellation=require("./Cancellation");var Path=require("./Path");var DEFAULT_LOCATION=canUseDOM?HashLocation:"/";var DEFAULT_SCROLL_BEHAVIOR=canUseDOM?ImitateBrowserBehavior:null;function defaultErrorHandler(error){throw error}function defaultAbortHandler(abortReason,location){if(typeof location==="string")throw new Error("Unhandled aborted transition! Reason: "+abortReason);if(abortReason instanceof Cancellation){return}else if(abortReason instanceof Redirect){location.replace(this.makePath(abortReason.to,abortReason.params,abortReason.query))}else{location.pop()}}function findMatch(pathname,routes,defaultRoute,notFoundRoute){var match,route,params;for(var i=0,len=routes.length;i<len;++i){route=routes[i];match=findMatch(pathname,route.childRoutes,route.defaultRoute,route.notFoundRoute);if(match!=null){match.routes.unshift(route);return match}params=Path.extractParams(route.path,pathname);if(params)return createMatch(route,params)}if(defaultRoute&&(params=Path.extractParams(defaultRoute.path,pathname)))return createMatch(defaultRoute,params);if(notFoundRoute&&(params=Path.extractParams(notFoundRoute.path,pathname)))return createMatch(notFoundRoute,params);return match}function createMatch(route,params){return{routes:[route],params:params}}function hasProperties(object,properties){for(var propertyName in properties)if(properties.hasOwnProperty(propertyName)&&object[propertyName]!==properties[propertyName])return false;return true}function hasMatch(routes,route,prevParams,nextParams,prevQuery,nextQuery){return routes.some(function(r){if(r!==route)return false;var paramNames=route.paramNames;var paramName;for(var i=0,len=paramNames.length;i<len;++i){paramName=paramNames[i];if(nextParams[paramName]!==prevParams[paramName])return false}return hasProperties(prevQuery,nextQuery)&&hasProperties(nextQuery,prevQuery)})}function createRouter(options){options=options||{};if(typeof options==="function"){options={routes:options}}else if(Array.isArray(options)){options={routes:options}}var routes=[];var namedRoutes={};var components=[];var location=options.location||DEFAULT_LOCATION;var scrollBehavior=options.scrollBehavior||DEFAULT_SCROLL_BEHAVIOR;var onError=options.onError||defaultErrorHandler;var onAbort=options.onAbort||defaultAbortHandler;var state={};var nextState={};var pendingTransition=null;function updateState(){state=nextState;nextState={}}if(typeof location==="string"){warning(!canUseDOM||process.env.NODE_ENV==="test","You should not use a static location in a DOM environment because "+"the router will not be kept in sync with the current URL")}else{invariant(canUseDOM,"You cannot use %s without a DOM",location)}if(location===HistoryLocation&&!supportsHistory())location=RefreshLocation;var router=React.createClass({displayName:"Router",mixins:[NavigationContext,StateContext,Scrolling],statics:{defaultRoute:null,notFoundRoute:null,addRoutes:function(children){routes.push.apply(routes,createRoutesFromChildren(children,this,namedRoutes))},makePath:function(to,params,query){var path;if(Path.isAbsolute(to)){path=Path.normalize(to)}else{var route=namedRoutes[to];invariant(route,'Unable to find <Route name="%s">',to);path=route.path}return Path.withQuery(Path.injectParams(path,params),query)},makeHref:function(to,params,query){var path=this.makePath(to,params,query);return location===HashLocation?"#"+path:path},transitionTo:function(to,params,query){invariant(typeof location!=="string","You cannot use transitionTo with a static location");var path=this.makePath(to,params,query);if(pendingTransition){location.replace(path)}else{location.push(path)}},replaceWith:function(to,params,query){invariant(typeof location!=="string","You cannot use replaceWith with a static location");location.replace(this.makePath(to,params,query))},goBack:function(){invariant(typeof location!=="string","You cannot use goBack with a static location");if(History.length>1||location===RefreshLocation){location.pop();return true}warning(false,"goBack() was ignored because there is no router history");return false},match:function(pathname){return findMatch(pathname,routes,this.defaultRoute,this.notFoundRoute)||null},dispatch:function(path,action,callback){if(pendingTransition){pendingTransition.abort(new Cancellation);pendingTransition=null}var prevPath=state.path;if(prevPath===path)return;if(prevPath&&action!==LocationActions.REPLACE)this.recordScrollPosition(prevPath);var pathname=Path.withoutQuery(path);var match=this.match(pathname);warning(match!=null,'No route matches path "%s". Make sure you have <Route path="%s"> somewhere in your routes',path,path);if(match==null)match={};var prevRoutes=state.routes||[];var prevParams=state.params||{};var prevQuery=state.query||{};var nextRoutes=match.routes||[];var nextParams=match.params||{};var nextQuery=Path.extractQuery(path)||{};var fromRoutes,toRoutes;if(prevRoutes.length){fromRoutes=prevRoutes.filter(function(route){return!hasMatch(nextRoutes,route,prevParams,nextParams,prevQuery,nextQuery)});toRoutes=nextRoutes.filter(function(route){return!hasMatch(prevRoutes,route,prevParams,nextParams,prevQuery,nextQuery)})}else{fromRoutes=[];toRoutes=nextRoutes}var transition=new Transition(path,this.replaceWith.bind(this,path));pendingTransition=transition;transition.from(fromRoutes,components,function(error){if(error||transition.isAborted)return callback.call(router,error,transition);transition.to(toRoutes,nextParams,nextQuery,function(error){if(error||transition.isAborted)return callback.call(router,error,transition);nextState.path=path;nextState.action=action;nextState.pathname=pathname;nextState.routes=nextRoutes;nextState.params=nextParams;nextState.query=nextQuery;callback.call(router,null,transition)})})},run:function(callback){var dispatchHandler=function(error,transition){pendingTransition=null;if(error){onError.call(router,error)}else if(transition.isAborted){onAbort.call(router,transition.abortReason,location)}else{callback.call(router,router,nextState)}};if(typeof location==="string"){router.dispatch(location,null,dispatchHandler)}else{var changeListener=function(change){router.dispatch(change.path,change.type,dispatchHandler)};if(location.addChangeListener)location.addChangeListener(changeListener);router.dispatch(location.getCurrentPath(),null,dispatchHandler)}},teardown:function(){location.removeChangeListener(this.changeListener)}},propTypes:{children:PropTypes.falsy},getLocation:function(){return location},getScrollBehavior:function(){return scrollBehavior},getRouteAtDepth:function(depth){var routes=this.state.routes;return routes&&routes[depth]},getRouteComponents:function(){return components},getInitialState:function(){updateState();return state},componentWillReceiveProps:function(){updateState();this.setState(state)},componentWillUnmount:function(){router.teardown()},render:function(){return this.getRouteAtDepth(0)?React.createElement(RouteHandler,this.props):null},childContextTypes:{getRouteAtDepth:React.PropTypes.func.isRequired,getRouteComponents:React.PropTypes.func.isRequired,routeHandlers:React.PropTypes.array.isRequired},getChildContext:function(){return{getRouteComponents:this.getRouteComponents,getRouteAtDepth:this.getRouteAtDepth,routeHandlers:[this]}}});if(options.routes)router.addRoutes(options.routes);return router}module.exports=createRouter}).call(this,require("_process"))},{"../actions/LocationActions":250,"../behaviors/ImitateBrowserBehavior":251,"../components/RouteHandler":258,"../locations/HashLocation":260,"../locations/HistoryLocation":261,"../locations/RefreshLocation":262,"../mixins/NavigationContext":265,"../mixins/Scrolling":267,"../mixins/StateContext":269,"./Cancellation":270,"./History":271,"./Path":272,"./PropTypes":274,"./Redirect":275,"./Transition":276,"./createRoutesFromChildren":278,"./supportsHistory":282,_process:10,react:"react","react/lib/ExecutionEnvironment":293,"react/lib/invariant":297,"react/lib/warning":298}],278:[function(require,module,exports){var React=require("react");var warning=require("react/lib/warning");var invariant=require("react/lib/invariant");var DefaultRoute=require("../components/DefaultRoute");var NotFoundRoute=require("../components/NotFoundRoute");var Redirect=require("../components/Redirect");var Route=require("../components/Route");var Path=require("./Path");var CONFIG_ELEMENT_TYPES=[DefaultRoute.type,NotFoundRoute.type,Redirect.type,Route.type];function createRedirectHandler(to,_params,_query){return React.createClass({statics:{willTransitionTo:function(transition,params,query){transition.redirect(to,_params||params,_query||query)}},render:function(){return null}})}function checkPropTypes(componentName,propTypes,props){for(var propName in propTypes){if(propTypes.hasOwnProperty(propName)){var error=propTypes[propName](props,propName,componentName);if(error instanceof Error)warning(false,error.message)}}}function createRoute(element,parentRoute,namedRoutes){var type=element.type;var props=element.props;var componentName=type&&type.displayName||"UnknownComponent";invariant(CONFIG_ELEMENT_TYPES.indexOf(type)!==-1,'Unrecognized route configuration element "<%s>"',componentName);if(type.propTypes)checkPropTypes(componentName,type.propTypes,props);var route={name:props.name};if(props.ignoreScrollBehavior){route.ignoreScrollBehavior=true}if(type===Redirect.type){route.handler=createRedirectHandler(props.to,props.params,props.query);props.path=props.path||props.from||"*"}else{route.handler=props.handler}var parentPath=parentRoute&&parentRoute.path||"/";if((props.path||props.name)&&type!==DefaultRoute.type&&type!==NotFoundRoute.type){var path=props.path||props.name;if(!Path.isAbsolute(path))path=Path.join(parentPath,path);route.path=Path.normalize(path)}else{route.path=parentPath;if(type===NotFoundRoute.type)route.path+="*"}route.paramNames=Path.extractParamNames(route.path);if(parentRoute&&Array.isArray(parentRoute.paramNames)){parentRoute.paramNames.forEach(function(paramName){invariant(route.paramNames.indexOf(paramName)!==-1,'The nested route path "%s" is missing the "%s" parameter of its parent path "%s"',route.path,paramName,parentRoute.path)})}if(props.name){invariant(namedRoutes[props.name]==null,'You cannot use the name "%s" for more than one route',props.name);namedRoutes[props.name]=route}if(type===NotFoundRoute.type){invariant(parentRoute,"<NotFoundRoute> must have a parent <Route>");invariant(parentRoute.notFoundRoute==null,"You may not have more than one <NotFoundRoute> per <Route>");parentRoute.notFoundRoute=route;return null}if(type===DefaultRoute.type){invariant(parentRoute,"<DefaultRoute> must have a parent <Route>");invariant(parentRoute.defaultRoute==null,"You may not have more than one <DefaultRoute> per <Route>");parentRoute.defaultRoute=route;return null}route.childRoutes=createRoutesFromChildren(props.children,route,namedRoutes);return route}function createRoutesFromChildren(children,parentRoute,namedRoutes){var routes=[];React.Children.forEach(children,function(child){if(child=createRoute(child,parentRoute,namedRoutes))routes.push(child)});return routes}module.exports=createRoutesFromChildren},{"../components/DefaultRoute":253,"../components/NotFoundRoute":255,"../components/Redirect":256,"../components/Route":257,"./Path":272,react:"react","react/lib/invariant":297,"react/lib/warning":298}],279:[function(require,module,exports){var invariant=require("react/lib/invariant");var canUseDOM=require("react/lib/ExecutionEnvironment").canUseDOM;function getWindowScrollPosition(){invariant(canUseDOM,"Cannot get current scroll position without a DOM");return{x:window.pageXOffset||document.documentElement.scrollLeft,y:window.pageYOffset||document.documentElement.scrollTop}}module.exports=getWindowScrollPosition},{"react/lib/ExecutionEnvironment":293,"react/lib/invariant":297}],280:[function(require,module,exports){function reversedArray(array){return array.slice(0).reverse()}module.exports=reversedArray},{}],281:[function(require,module,exports){var createRouter=require("./createRouter");function runRouter(routes,location,callback){if(typeof location==="function"){callback=location;location=null}var router=createRouter({routes:routes,location:location});router.run(callback);return router}module.exports=runRouter},{"./createRouter":277}],282:[function(require,module,exports){function supportsHistory(){var ua=navigator.userAgent;if((ua.indexOf("Android 2.")!==-1||ua.indexOf("Android 4.0")!==-1)&&ua.indexOf("Mobile Safari")!==-1&&ua.indexOf("Chrome")===-1&&ua.indexOf("Windows Phone")===-1){return false}return window.history&&"pushState"in window.history}module.exports=supportsHistory},{}],283:[function(require,module,exports){module.exports=require("./lib")},{"./lib":284}],284:[function(require,module,exports){var Stringify=require("./stringify");var Parse=require("./parse");var internals={};module.exports={stringify:Stringify,parse:Parse}},{"./parse":285,"./stringify":286}],285:[function(require,module,exports){var Utils=require("./utils");var internals={delimiter:"&",depth:5,arrayLimit:20,parameterLimit:1e3};internals.parseValues=function(str,options){var obj={};var parts=str.split(options.delimiter,options.parameterLimit===Infinity?undefined:options.parameterLimit);for(var i=0,il=parts.length;i<il;++i){var part=parts[i];var pos=part.indexOf("]=")===-1?part.indexOf("="):part.indexOf("]=")+1;if(pos===-1){obj[Utils.decode(part)]=""}else{var key=Utils.decode(part.slice(0,pos));var val=Utils.decode(part.slice(pos+1));if(!obj[key]){obj[key]=val}else{obj[key]=[].concat(obj[key]).concat(val)}}}return obj};internals.parseObject=function(chain,val,options){if(!chain.length){return val}var root=chain.shift();var obj={};if(root==="[]"){obj=[];obj=obj.concat(internals.parseObject(chain,val,options))}else{var cleanRoot=root[0]==="["&&root[root.length-1]==="]"?root.slice(1,root.length-1):root;var index=parseInt(cleanRoot,10);if(!isNaN(index)&&root!==cleanRoot&&index<=options.arrayLimit){obj=[];obj[index]=internals.parseObject(chain,val,options)}else{obj[cleanRoot]=internals.parseObject(chain,val,options)}}return obj};internals.parseKeys=function(key,val,options){if(!key){return}var parent=/^([^\[\]]*)/;var child=/(\[[^\[\]]*\])/g;var segment=parent.exec(key);if(Object.prototype.hasOwnProperty(segment[1])){return}var keys=[];if(segment[1]){keys.push(segment[1])}var i=0;while((segment=child.exec(key))!==null&&i<options.depth){++i;if(!Object.prototype.hasOwnProperty(segment[1].replace(/\[|\]/g,""))){keys.push(segment[1])}}if(segment){keys.push("["+key.slice(segment.index)+"]")}return internals.parseObject(keys,val,options)};module.exports=function(str,options){if(str===""||str===null||typeof str==="undefined"){return{}}options=options||{};options.delimiter=typeof options.delimiter==="string"||Utils.isRegExp(options.delimiter)?options.delimiter:internals.delimiter;options.depth=typeof options.depth==="number"?options.depth:internals.depth;options.arrayLimit=typeof options.arrayLimit==="number"?options.arrayLimit:internals.arrayLimit;options.parameterLimit=typeof options.parameterLimit==="number"?options.parameterLimit:internals.parameterLimit;var tempObj=typeof str==="string"?internals.parseValues(str,options):str;var obj={};var keys=Object.keys(tempObj);for(var i=0,il=keys.length;i<il;++i){var key=keys[i];var newObj=internals.parseKeys(key,tempObj[key],options);obj=Utils.merge(obj,newObj)}return Utils.compact(obj)}},{"./utils":287}],286:[function(require,module,exports){var Utils=require("./utils");var internals={delimiter:"&"};internals.stringify=function(obj,prefix){if(Utils.isBuffer(obj)){obj=obj.toString()}else if(obj instanceof Date){obj=obj.toISOString()}else if(obj===null){obj=""}if(typeof obj==="string"||typeof obj==="number"||typeof obj==="boolean"){return[encodeURIComponent(prefix)+"="+encodeURIComponent(obj)]}var values=[];for(var key in obj){if(obj.hasOwnProperty(key)){values=values.concat(internals.stringify(obj[key],prefix+"["+key+"]"))}}return values};module.exports=function(obj,options){options=options||{};var delimiter=typeof options.delimiter==="undefined"?internals.delimiter:options.delimiter;var keys=[];for(var key in obj){if(obj.hasOwnProperty(key)){keys=keys.concat(internals.stringify(obj[key],key))}}return keys.join(delimiter)}},{"./utils":287}],287:[function(require,module,exports){(function(Buffer){var internals={};exports.arrayToObject=function(source){var obj={};for(var i=0,il=source.length;i<il;++i){if(typeof source[i]!=="undefined"){obj[i]=source[i]}}return obj};exports.merge=function(target,source){if(!source){return target}if(Array.isArray(source)){for(var i=0,il=source.length;i<il;++i){if(typeof source[i]!=="undefined"){if(typeof target[i]==="object"){target[i]=exports.merge(target[i],source[i])}else{target[i]=source[i]}}}return target}if(Array.isArray(target)){if(typeof source!=="object"){target.push(source);return target}else{target=exports.arrayToObject(target)}}var keys=Object.keys(source);for(var k=0,kl=keys.length;k<kl;++k){var key=keys[k];var value=source[key];if(value&&typeof value==="object"){if(!target[key]){target[key]=value}else{target[key]=exports.merge(target[key],value)}}else{target[key]=value}}return target};exports.decode=function(str){try{return decodeURIComponent(str.replace(/\+/g," "))}catch(e){return str}};exports.compact=function(obj,refs){if(typeof obj!=="object"||obj===null){return obj}refs=refs||[];var lookup=refs.indexOf(obj);if(lookup!==-1){return refs[lookup]}refs.push(obj);if(Array.isArray(obj)){var compacted=[];for(var i=0,l=obj.length;i<l;++i){if(typeof obj[i]!=="undefined"){compacted.push(obj[i])}}return compacted}var keys=Object.keys(obj);for(var i=0,il=keys.length;i<il;++i){var key=keys[i];obj[key]=exports.compact(obj[key],refs)}return obj};exports.isRegExp=function(obj){return Object.prototype.toString.call(obj)==="[object RegExp]"};exports.isBuffer=function(obj){if(typeof Buffer!=="undefined"){return Buffer.isBuffer(obj)}else{return false}}}).call(this,require("buffer").Buffer)},{buffer:2}],288:[function(require,module,exports){(function(define){"use strict";define(function(require){var makePromise=require("./makePromise");var Scheduler=require("./Scheduler");var async=require("./async");return makePromise({scheduler:new Scheduler(async)})})})(typeof define==="function"&&define.amd?define:function(factory){module.exports=factory(require)})},{"./Scheduler":290,"./async":291,"./makePromise":292}],289:[function(require,module,exports){(function(define){"use strict";define(function(){function Queue(capacityPow2){this.head=this.tail=this.length=0;this.buffer=new Array(1<<capacityPow2)}Queue.prototype.push=function(x){if(this.length===this.buffer.length){this._ensureCapacity(this.length*2)}this.buffer[this.tail]=x;this.tail=this.tail+1&this.buffer.length-1;++this.length;return this.length};Queue.prototype.shift=function(){var x=this.buffer[this.head];this.buffer[this.head]=void 0;this.head=this.head+1&this.buffer.length-1;--this.length;return x};Queue.prototype._ensureCapacity=function(capacity){var head=this.head;var buffer=this.buffer;var newBuffer=new Array(capacity);var i=0;var len;if(head===0){len=this.length;for(;i<len;++i){newBuffer[i]=buffer[i]}}else{capacity=buffer.length;len=this.tail;for(;head<capacity;++i,++head){newBuffer[i]=buffer[head]}for(head=0;head<len;++i,++head){newBuffer[i]=buffer[head]}}this.buffer=newBuffer;this.head=0;this.tail=this.length};return Queue})})(typeof define==="function"&&define.amd?define:function(factory){module.exports=factory()})},{}],290:[function(require,module,exports){(function(define){"use strict";define(function(require){var Queue=require("./Queue");function Scheduler(async){this._async=async;this._queue=new Queue(15);this._afterQueue=new Queue(5);this._running=false;var self=this;this.drain=function(){self._drain()}}Scheduler.prototype.enqueue=function(task){this._add(this._queue,task)};Scheduler.prototype.afterQueue=function(task){this._add(this._afterQueue,task)};Scheduler.prototype._drain=function(){runQueue(this._queue);this._running=false;runQueue(this._afterQueue)};Scheduler.prototype._add=function(queue,task){queue.push(task);if(!this._running){this._running=true;this._async(this.drain)}};function runQueue(queue){while(queue.length>0){queue.shift().run()}}return Scheduler})})(typeof define==="function"&&define.amd?define:function(factory){module.exports=factory(require)})},{"./Queue":289}],291:[function(require,module,exports){(function(process){(function(define){"use strict";define(function(require){var nextTick,MutationObs;if(typeof process!=="undefined"&&process!==null&&typeof process.nextTick==="function"){nextTick=function(f){process.nextTick(f)}}else if(MutationObs=typeof MutationObserver==="function"&&MutationObserver||typeof WebKitMutationObserver==="function"&&WebKitMutationObserver){nextTick=function(document,MutationObserver){var scheduled;var el=document.createElement("div");var o=new MutationObserver(run);o.observe(el,{attributes:true});function run(){var f=scheduled;scheduled=void 0;f()}return function(f){scheduled=f;el.setAttribute("class","x")}}(document,MutationObs)}else{nextTick=function(cjsRequire){var vertx;try{vertx=cjsRequire("vertx")}catch(ignore){}if(vertx){if(typeof vertx.runOnLoop==="function"){return vertx.runOnLoop}if(typeof vertx.runOnContext==="function"){return vertx.runOnContext}}var capturedSetTimeout=setTimeout;return function(t){capturedSetTimeout(t,0)}}(require)}return nextTick})})(typeof define==="function"&&define.amd?define:function(factory){module.exports=factory(require)})}).call(this,require("_process"))},{_process:10}],292:[function(require,module,exports){(function(define){"use strict";define(function(){return function makePromise(environment){var tasks=environment.scheduler;var objectCreate=Object.create||function(proto){function Child(){}Child.prototype=proto;return new Child};function Promise(resolver,handler){this._handler=resolver===Handler?handler:init(resolver)}function init(resolver){var handler=new Pending;try{resolver(promiseResolve,promiseReject,promiseNotify)}catch(e){promiseReject(e)}return handler;function promiseResolve(x){handler.resolve(x)}function promiseReject(reason){handler.reject(reason)}function promiseNotify(x){handler.notify(x)}}Promise.resolve=resolve;Promise.reject=reject;Promise.never=never;Promise._defer=defer;Promise._handler=getHandler;function resolve(x){return isPromise(x)?x:new Promise(Handler,new Async(getHandler(x)))}function reject(x){return new Promise(Handler,new Async(new Rejected(x)))}function never(){return foreverPendingPromise}function defer(){return new Promise(Handler,new Pending)}Promise.prototype.then=function(onFulfilled,onRejected){var parent=this._handler;var state=parent.join().state();if(typeof onFulfilled!=="function"&&state>0||typeof onRejected!=="function"&&state<0){return new this.constructor(Handler,parent)}var p=this._beget();var child=p._handler;parent.chain(child,parent.receiver,onFulfilled,onRejected,arguments.length>2?arguments[2]:void 0);return p};Promise.prototype["catch"]=function(onRejected){return this.then(void 0,onRejected)};Promise.prototype._beget=function(){var parent=this._handler;var child=new Pending(parent.receiver,parent.join().context);return new this.constructor(Handler,child)};Promise.all=all;Promise.race=race;function all(promises){var resolver=new Pending;var pending=promises.length>>>0;var results=new Array(pending);var i,h,x,s;for(i=0;i<promises.length;++i){x=promises[i];if(x===void 0&&!(i in promises)){--pending;continue}if(maybeThenable(x)){h=getHandlerMaybeThenable(x);s=h.state();if(s===0){h.fold(settleAt,i,results,resolver)}else if(s>0){results[i]=h.value;--pending}else{unreportRemaining(promises,i+1,h);resolver.become(h);break}}else{results[i]=x;--pending}}if(pending===0){resolver.become(new Fulfilled(results))}return new Promise(Handler,resolver);function settleAt(i,x,resolver){this[i]=x;if(--pending===0){resolver.become(new Fulfilled(this))}}}function unreportRemaining(promises,start,rejectedHandler){var i,h,x;for(i=start;i<promises.length;++i){x=promises[i];if(maybeThenable(x)){h=getHandlerMaybeThenable(x);if(h!==rejectedHandler){h.visit(h,void 0,h._unreport)}}}}function race(promises){if(Object(promises)===promises&&promises.length===0){return never()}var h=new Pending;var i,x;for(i=0;i<promises.length;++i){x=promises[i];if(x!==void 0&&i in promises){getHandler(x).visit(h,h.resolve,h.reject)}}return new Promise(Handler,h)}function getHandler(x){if(isPromise(x)){return x._handler.join()}return maybeThenable(x)?getHandlerUntrusted(x):new Fulfilled(x)}function getHandlerMaybeThenable(x){return isPromise(x)?x._handler.join():getHandlerUntrusted(x)}function getHandlerUntrusted(x){try{var untrustedThen=x.then;return typeof untrustedThen==="function"?new Thenable(untrustedThen,x):new Fulfilled(x)}catch(e){return new Rejected(e)}}function Handler(){}Handler.prototype.when=Handler.prototype.become=Handler.prototype.notify=Handler.prototype.fail=Handler.prototype._unreport=Handler.prototype._report=noop;Handler.prototype._state=0;Handler.prototype.state=function(){return this._state};Handler.prototype.join=function(){var h=this;while(h.handler!==void 0){h=h.handler}return h};Handler.prototype.chain=function(to,receiver,fulfilled,rejected,progress){this.when({resolver:to,receiver:receiver,fulfilled:fulfilled,rejected:rejected,progress:progress})};Handler.prototype.visit=function(receiver,fulfilled,rejected,progress){this.chain(failIfRejected,receiver,fulfilled,rejected,progress)};Handler.prototype.fold=function(f,z,c,to){this.visit(to,function(x){f.call(c,z,x,this)},to.reject,to.notify)};function FailIfRejected(){}inherit(Handler,FailIfRejected);FailIfRejected.prototype.become=function(h){h.fail()};var failIfRejected=new FailIfRejected;function Pending(receiver,inheritedContext){Promise.createContext(this,inheritedContext);this.consumers=void 0;this.receiver=receiver;this.handler=void 0;this.resolved=false}inherit(Handler,Pending);
Pending.prototype._state=0;Pending.prototype.resolve=function(x){this.become(getHandler(x))};Pending.prototype.reject=function(x){if(this.resolved){return}this.become(new Rejected(x))};Pending.prototype.join=function(){if(!this.resolved){return this}var h=this;while(h.handler!==void 0){h=h.handler;if(h===this){return this.handler=cycle()}}return h};Pending.prototype.run=function(){var q=this.consumers;var handler=this.join();this.consumers=void 0;for(var i=0;i<q.length;++i){handler.when(q[i])}};Pending.prototype.become=function(handler){if(this.resolved){return}this.resolved=true;this.handler=handler;if(this.consumers!==void 0){tasks.enqueue(this)}if(this.context!==void 0){handler._report(this.context)}};Pending.prototype.when=function(continuation){if(this.resolved){tasks.enqueue(new ContinuationTask(continuation,this.handler))}else{if(this.consumers===void 0){this.consumers=[continuation]}else{this.consumers.push(continuation)}}};Pending.prototype.notify=function(x){if(!this.resolved){tasks.enqueue(new ProgressTask(x,this))}};Pending.prototype.fail=function(context){var c=typeof context==="undefined"?this.context:context;this.resolved&&this.handler.join().fail(c)};Pending.prototype._report=function(context){this.resolved&&this.handler.join()._report(context)};Pending.prototype._unreport=function(){this.resolved&&this.handler.join()._unreport()};function Async(handler){this.handler=handler}inherit(Handler,Async);Async.prototype.when=function(continuation){tasks.enqueue(new ContinuationTask(continuation,this))};Async.prototype._report=function(context){this.join()._report(context)};Async.prototype._unreport=function(){this.join()._unreport()};function Thenable(then,thenable){Pending.call(this);tasks.enqueue(new AssimilateTask(then,thenable,this))}inherit(Pending,Thenable);function Fulfilled(x){Promise.createContext(this);this.value=x}inherit(Handler,Fulfilled);Fulfilled.prototype._state=1;Fulfilled.prototype.fold=function(f,z,c,to){runContinuation3(f,z,this,c,to)};Fulfilled.prototype.when=function(cont){runContinuation1(cont.fulfilled,this,cont.receiver,cont.resolver)};var errorId=0;function Rejected(x){Promise.createContext(this);this.id=++errorId;this.value=x;this.handled=false;this.reported=false;this._report()}inherit(Handler,Rejected);Rejected.prototype._state=-1;Rejected.prototype.fold=function(f,z,c,to){to.become(this)};Rejected.prototype.when=function(cont){if(typeof cont.rejected==="function"){this._unreport()}runContinuation1(cont.rejected,this,cont.receiver,cont.resolver)};Rejected.prototype._report=function(context){tasks.afterQueue(new ReportTask(this,context))};Rejected.prototype._unreport=function(){this.handled=true;tasks.afterQueue(new UnreportTask(this))};Rejected.prototype.fail=function(context){Promise.onFatalRejection(this,context===void 0?this.context:context)};function ReportTask(rejection,context){this.rejection=rejection;this.context=context}ReportTask.prototype.run=function(){if(!this.rejection.handled){this.rejection.reported=true;Promise.onPotentiallyUnhandledRejection(this.rejection,this.context)}};function UnreportTask(rejection){this.rejection=rejection}UnreportTask.prototype.run=function(){if(this.rejection.reported){Promise.onPotentiallyUnhandledRejectionHandled(this.rejection)}};Promise.createContext=Promise.enterContext=Promise.exitContext=Promise.onPotentiallyUnhandledRejection=Promise.onPotentiallyUnhandledRejectionHandled=Promise.onFatalRejection=noop;var foreverPendingHandler=new Handler;var foreverPendingPromise=new Promise(Handler,foreverPendingHandler);function cycle(){return new Rejected(new TypeError("Promise cycle"))}function ContinuationTask(continuation,handler){this.continuation=continuation;this.handler=handler}ContinuationTask.prototype.run=function(){this.handler.join().when(this.continuation)};function ProgressTask(value,handler){this.handler=handler;this.value=value}ProgressTask.prototype.run=function(){var q=this.handler.consumers;if(q===void 0){return}for(var c,i=0;i<q.length;++i){c=q[i];runNotify(c.progress,this.value,this.handler,c.receiver,c.resolver)}};function AssimilateTask(then,thenable,resolver){this._then=then;this.thenable=thenable;this.resolver=resolver}AssimilateTask.prototype.run=function(){var h=this.resolver;tryAssimilate(this._then,this.thenable,_resolve,_reject,_notify);function _resolve(x){h.resolve(x)}function _reject(x){h.reject(x)}function _notify(x){h.notify(x)}};function tryAssimilate(then,thenable,resolve,reject,notify){try{then.call(thenable,resolve,reject,notify)}catch(e){reject(e)}}function isPromise(x){return x instanceof Promise}function maybeThenable(x){return(typeof x==="object"||typeof x==="function")&&x!==null}function runContinuation1(f,h,receiver,next){if(typeof f!=="function"){return next.become(h)}Promise.enterContext(h);tryCatchReject(f,h.value,receiver,next);Promise.exitContext()}function runContinuation3(f,x,h,receiver,next){if(typeof f!=="function"){return next.become(h)}Promise.enterContext(h);tryCatchReject3(f,x,h.value,receiver,next);Promise.exitContext()}function runNotify(f,x,h,receiver,next){if(typeof f!=="function"){return next.notify(x)}Promise.enterContext(h);tryCatchReturn(f,x,receiver,next);Promise.exitContext()}function tryCatchReject(f,x,thisArg,next){try{next.become(getHandler(f.call(thisArg,x)))}catch(e){next.become(new Rejected(e))}}function tryCatchReject3(f,x,y,thisArg,next){try{f.call(thisArg,x,y,next)}catch(e){next.become(new Rejected(e))}}function tryCatchReturn(f,x,thisArg,next){try{next.notify(f.call(thisArg,x))}catch(e){next.notify(e)}}function inherit(Parent,Child){Child.prototype=objectCreate(Parent.prototype);Child.prototype.constructor=Child}function noop(){}return Promise}})})(typeof define==="function"&&define.amd?define:function(factory){module.exports=factory()})},{}],293:[function(require,module,exports){"use strict";var canUseDOM=!!(typeof window!=="undefined"&&window.document&&window.document.createElement);var ExecutionEnvironment={canUseDOM:canUseDOM,canUseWorkers:typeof Worker!=="undefined",canUseEventListeners:canUseDOM&&!!(window.addEventListener||window.attachEvent),canUseViewport:canUseDOM&&!!window.screen,isInWorker:!canUseDOM};module.exports=ExecutionEnvironment},{}],294:[function(require,module,exports){function assign(target,sources){if(target==null){throw new TypeError("Object.assign target cannot be null or undefined")}var to=Object(target);var hasOwnProperty=Object.prototype.hasOwnProperty;for(var nextIndex=1;nextIndex<arguments.length;nextIndex++){var nextSource=arguments[nextIndex];if(nextSource==null){continue}var from=Object(nextSource);for(var key in from){if(hasOwnProperty.call(from,key)){to[key]=from[key]}}}return to}module.exports=assign},{}],295:[function(require,module,exports){function cx(classNames){if(typeof classNames=="object"){return Object.keys(classNames).filter(function(className){return classNames[className]}).join(" ")}else{return Array.prototype.join.call(arguments," ")}}module.exports=cx},{}],296:[function(require,module,exports){function makeEmptyFunction(arg){return function(){return arg}}function emptyFunction(){}emptyFunction.thatReturns=makeEmptyFunction;emptyFunction.thatReturnsFalse=makeEmptyFunction(false);emptyFunction.thatReturnsTrue=makeEmptyFunction(true);emptyFunction.thatReturnsNull=makeEmptyFunction(null);emptyFunction.thatReturnsThis=function(){return this};emptyFunction.thatReturnsArgument=function(arg){return arg};module.exports=emptyFunction},{}],297:[function(require,module,exports){(function(process){"use strict";var invariant=function(condition,format,a,b,c,d,e,f){if("production"!==process.env.NODE_ENV){if(format===undefined){throw new Error("invariant requires an error message argument")}}if(!condition){var error;if(format===undefined){error=new Error("Minified exception occurred; use the non-minified dev environment "+"for the full error message and additional helpful warnings.")}else{var args=[a,b,c,d,e,f];var argIndex=0;error=new Error("Invariant Violation: "+format.replace(/%s/g,function(){return args[argIndex++]}))}error.framesToPop=1;throw error}};module.exports=invariant}).call(this,require("_process"))},{_process:10}],298:[function(require,module,exports){(function(process){"use strict";var emptyFunction=require("./emptyFunction");var warning=emptyFunction;if("production"!==process.env.NODE_ENV){warning=function(condition,format){for(var args=[],$__0=2,$__1=arguments.length;$__0<$__1;$__0++)args.push(arguments[$__0]);if(format===undefined){throw new Error("`warning(condition, format, ...args)` requires a warning "+"message argument")}if(!condition){var argIndex=0;console.warn("Warning: "+format.replace(/%s/g,function(){return args[argIndex++]}))}}}module.exports=warning}).call(this,require("_process"))},{"./emptyFunction":296,_process:10}],299:[function(require,module,exports){var uuid=require("./lib/uuid");var verifyNodes=require("./util/verify-nodes");var treesToMap=require("./util/trees-to-map");module.exports=Db;function Db(pl,plugins){this.nodes={};this.pl=pl;this.plugins=plugins||[];this.addNewNodeAttrs=[];plugins.forEach(function(plugin){if(plugin.addNewNodeAttrs){this.addNewNodeAttrs.push(plugin.addNewNodeAttrs)}}.bind(this));if(!this.addNewNodeAttrs.length){this.addNewNodeAttrs=false}}Db.prototype={init:function(defaultData,done){this.pl.findAll("root",function(err,roots){if(err)return done(err);if(!roots.length)return this.makeRoot(defaultData,done);this.root=roots[0].id;this.pl.findAll("node",function(err,nodes){if(err)return done(err);var map={};nodes.forEach(function(node){return map[node.id]=node});var err=verifyNodes(this.root,map);if(err){return done(err)}this.nodes=map;done()}.bind(this))}.bind(this))},create:function(pid,ix,content,type){var id=uuid();var now=Date.now();var node={id:id,created:now,modified:now,collapsed:true,content:content||"",type:type||"base",children:[],parent:pid};if(this.addNewNodeAttrs){this.addNewNodeAttrs.map(function(fn){return fn(node)})}this.save(id,node);this.insertChild(pid,id,ix);return id},dump:function(pid,children,ix,done){var mapped=treesToMap(children,pid,true);this.batchSave(mapped.nodes,function(err){if(err)return done(err);var oldChildren=this.nodes[pid].children;if(!ix&&ix!==0){children=oldChildren.concat(mapped.roots)}else{children=oldChildren.slice();[].splice.apply(children,[ix,0].concat(mapped.roots))}this.set(pid,"children",children,function(err){done(err,{ids:mapped.roots,oldChildren:oldChildren})})}.bind(this))},exportTree:function(pid,keepIds){pid=pid||this.root;var node=this.nodes[pid],out={id:pid};for(var name in node){out[name]=node[name]}out.children=node.children.map(function(id){return this.exportTree(id,keepIds)}.bind(this));if(!keepIds)delete out.id;delete out.parent;return out},exportMany:function(ids,keepIds){return ids.map(function(id){return this.exportTree(id,keepIds)}.bind(this))},makeRoot:function(defaultData,done){this.root=defaultData&&defaultData.id||uuid();this.pl.save("root",this.root,{id:this.root},function(err){if(err)return done(err);this.nodes={};var now=Date.now();this.nodes[this.root]={id:this.root,created:now,modified:now,content:defaultData.content||"Home",parent:null,children:[]};this.pl.save("node",this.root,this.nodes[this.root],function(err){if(err)return done(err);this.dump(this.root,defaultData.children,null,done)}.bind(this))}.bind(this))},batchSave:function(nodes,done){for(var id in nodes){this.nodes[id]=nodes[id];this.nodes[id].modified=Date.now()}this.pl.batchSave("node",nodes,done)},save:function(id,value,modified){this.nodes[id]=value;this.nodes[id].modified=modified||Date.now();this.pl.save("node",id,value)},set:function(id,attr,value,done){this.nodes[id][attr]=value;this.nodes[id].modified=Date.now();this.pl.set("node",id,attr,value,done)},remove:function(id){delete this.nodes[id];this.pl.remove("node",id)},removeMany:function(ids){ids.forEach(this.remove.bind(this))},saveMany:function(nodes){nodes.forEach(function(node){return this.save(node.id,node)}.bind(this))},removeChild:function(pid,id,count){count=count||1;var ix=this.nodes[pid].children.indexOf(id);if(ix===-1)return-1;var ch=this.nodes[pid].children.slice();ch.splice(ix,count);this.set(pid,"children",ch);return ix},insertChild:function(pid,id,ix){var ch=this.nodes[pid].children.slice();ch.splice(ix,0,id);this.set(pid,"children",ch);return ix},insertChildren:function(pid,ids,ix){var ch=this.nodes[pid].children.slice();ch.splice.apply(ch,[ix,0].concat(ids));this.set(pid,"children",ch);return ix},setMany:function(attr,ids,value,done){var now=Date.now();if(Array.isArray(value)){ids.forEach(function(id,i){this.nodes[id][attr]=value[i];this.nodes[id].modified=now}.bind(this))}else{ids.forEach(function(id,i){this.nodes[id][attr]=value;this.nodes[id].modified=now}.bind(this))}this.pl.batchSet("node",attr,ids,value,done)},update:function(id,update,done){for(var name in update){this.nodes[id][name]=update[name]}this.nodes[id][name].modified=Date.now();this.pl.update("node",id,update,done)}}},{"./lib/uuid":305,"./util/trees-to-map":430,"./util/verify-nodes":431}],300:[function(require,module,exports){var React=require("react");var extend=require("./util/extend");var keyHandlers=require("./key-handlers");var defaultKeys=flattenKeySections(require("./views/tree/keys"));var KeyManager=require("./key-manager");var TreeView=require("./views/tree");var MainStore=require("./stores/main");function flattenKeySections(keys){var ret={};for(var name in keys){for(var sub in keys[name]){ret[sub]=keys[name][sub]}}return ret}var Db=require("./db");module.exports={quickstart:quickstart,initView:initView,initStore:initStore,pluginType:pluginType,viewConfig:viewConfig};function quickstart(el,options,done){options=extend({viewOptions:{},storeOptions:{},plugins:[]},options||{});if("string"===typeof el){var found=document.querySelector(el);if(!found)throw new Error("element not found: "+el);el=found}initStore(options.plugins,options.storeOptions,function(err,store){if(err)return done(err);var keyManager=new KeyManager;keyManager.attach(store);initView(el,store,keyManager,options.plugins,options.viewOptions,function(storeView){keyManager.listen(window);done&&done(err,store,keyManager,storeView)})})}function initStore(plugins,options,done){options=extend({PL:require("./pl/mem"),pl:null,data:null},options);var pl=options.pl||new options.PL;var db=new Db(pl,pluginType(plugins,"db"));window.db=db;db.init(options.data,function(err){if(err)return done(err);var store=new MainStore({plugins:pluginType(plugins,"store"),allPlugins:plugins,db:db});done(null,store)})}function viewConfig(store,plugins,options){options=extend({root:null,defaultKeys:defaultKeys},options);var storeView=store.registerView(options.root);var props={plugins:pluginType(plugins,"view"),nodePlugins:pluginType(plugins,"node"),store:storeView};return{keys:keyHandlers(options.defaultKeys,storeView.actions,pluginType(plugins,"keys"),plugins),view:storeView,props:props}}function initView(el,store,keyManager,plugins,options,done){options=extend({View:TreeView},options);var config=viewConfig(store,plugins,options);keyManager.addView(config.view.id,config.keys);React.renderComponent(options.View(config.props),el,function(){done(config.view)})}function pluginType(plugins,type){if(!plugins)return[];return plugins.reduce(function(list,plugin){return plugin[type]?[plugin[type]].concat(list):list},[])}},{"./db":299,"./key-handlers":301,"./key-manager":302,"./pl/mem":402,"./stores/main":425,"./util/extend":427,"./views/tree":441,"./views/tree/keys":443,react:"react"}],301:[function(require,module,exports){var keyHandler=require("./lib/keys");module.exports=keyHandlers;function keyHandlers(keys,actions,plugins,allPlugins){var modes=["visual","normal","insert"];var collected={};modes.forEach(function(mode){return collected[mode]={}});var typed={};modes.forEach(function(mode){return typed[mode]={}});var collect=function(keys){if("function"===typeof keys){keys=keys(allPlugins)}for(var actionName in keys){modes.forEach(function(mode){if(keys[actionName][mode]){if(keys[actionName].type){if(!typed[mode][keys[actionName][mode]]){typed[mode][keys[actionName][mode]]={}}typed[mode][keys[actionName][mode]][keys[actionName].type]=actionName}else{collected[mode][actionName]=keys[actionName][mode]}}})}};collect(keys);if(plugins){plugins.forEach(collect)}return{visual:bindKeys(collected.visual,typed.visual,actions),normal:bindKeys(collected.normal,typed.normal,actions),insert:bindKeys(collected.insert,typed.insert,actions)}}function camel(actionName){return actionName.replace(/ (\w)/g,function(full,letter){return letter.toUpperCase()})}function bindKeys(keys,typed,actions){var binds={};Object.keys(keys).forEach(function(actionName){var action=camel(actionName);if(!actions[action]){console.warn("[binding keys] unknown action: "+action);return}binds[keys[actionName]]=function(){return actions[action]()}});Object.keys(typed).forEach(function(keyBinding){var camels={};for(var type in typed[keyBinding]){camels[type]=camel(typed[keyBinding][type]);if(!actions[camels[type]]){console.warn("[binding keys] unknown action: "+camels[type]);delete camels[type]}}binds[keyBinding]=function(){var id=actions.view.active;type=actions.db.nodes[id].type;if(!camels[type]){return console.warn("Keybinding not defined for type: "+type)}return actions[camels[type]](id)}});return keyHandler(binds)}},{"./lib/keys":304}],302:[function(require,module,exports){var keys=require("./lib/keys");module.exports=KeyManager;function KeyManager(){this._keyDown=this.keyDown.bind(this);this.keys=null;this.store=null;this.state={};this.views={}}KeyManager.prototype={attach:function(store){this.store=store;store.on([store.events.activeViewChanged(),store.events.activeModeChanged()],this.update.bind(this));this.update()},update:function(){if(!this.store.views[this.store.activeView])return;this.state={active:this.store.activeView,mode:this.store.views[this.store.activeView].mode}},addView:function(vid,keys){this.views[vid]=keys},add:function(config){if(this.keys)return this.keys.add(config);this.keys=keys(config);return null},remove:function(lid){if(!this.keys)return false;return this.keys.remove(lid)},disable:function(){this.keys.disable()},enable:function(){this.keys.enable()},addKeys:function(config){if(this.keys)return this.keys.add(config);this.keys=keys(config)},keyDown:function(e){var res;if(this.keys){res=this.keys(e);if(typeof res!=="string"&&res!==true){if(this.store){this.views[this.state.active][this.state.mode].clear()}return res}else if(res===true){res=undefined}}if(this.store){this.views[this.state.active][this.state.mode](e,res)}},listen:function(window){window.addEventListener("keydown",this.keyDown)},unlisten:function(window){window.removeEventListener("keydown",this.keyDown)}}},{"./lib/keys":304}],303:[function(require,module,exports){var React=require("react/addons"),cx=React.addons.classSet,PT=React.PropTypes;var ContextMenu=React.createClass({displayName:"ContextMenu",propTypes:{onClose:PT.func.isRequired,onSelect:PT.func,config:PT.object},_onMouseDown:function(e){e.stopPropagation()},_onSelect:function(item){if(this.props.onSelect)this.props.onSelect(item);this.props.onClose()},render:function(){return React.DOM.div({style:{top:this.props.y,left:this.props.x,zIndex:1e3},onMouseDown:this._onMouseDown,className:"ContextMenu"},MenuBody({onSelect:this._onSelect,onClose:this.props.onClose,items:this.props.config,zIndex:1e3}))}});var MenuItem=React.createClass({displayName:"MenuItem",propTypes:{config:PT.object,selected:PT.bool,onSelect:PT.func,onHover:PT.func,onClose:PT.func,zIndex:PT.number},_onClick:function(){if(this.props.config.disabled)return;if(this.props.config.action){this.props.config.action();return this.props.onClose()}this.props.onSelect(this.props.config)},render:function(){return React.DOM.div({className:cx({ContextMenu_item:true,"ContextMenu_item-selected":this.props.selected,"ContextMenu_item-disabled":this.props.config.disabled,"ContextMenu_item-parent":this.props.config.children&&this.props.config.children.length})},React.DOM.div({className:"ContextMenu_item_title",onMouseOver:this.props.onHover,onClick:this._onClick},this.props.config.title,this.props.config.shortcut&&React.DOM.span({className:"ContextMenu_item_shortcut"},this.props.config.shortcut)),this.props.selected&&this.props.config.children&&MenuBody({onClose:this.props.onClose,onSelect:this.props.onSelect,zIndex:this.props.zIndex+1,items:this.props.config.children}))}});var MenuBody=React.createClass({displayName:"MenuBody",propTypes:{items:PT.array,zIndex:PT.number,onClose:PT.func,onSelect:PT.func},getInitialState:function(){return{selected:null}},_onHover:function(i){this.setState({selected:i})},render:function(){return React.DOM.ul({className:"ContextMenu_body",style:{zIndex:this.props.zIndex}},this.props.items.map(function(item,i){return MenuItem({config:item,zIndex:this.props.zIndex,onClose:this.props.onClose,onSelect:this.props.onSelect,onHover:this._onHover.bind(null,i),selected:this.state.selected===i})}.bind(this)))}});ContextMenu.show=function(definition,x,y,onSelect){var node=document.createElement("div");document.body.appendChild(node);var closeOut=function(e){window.removeEventListener("mousedown",closeOut);if(!node.parentNode)return;document.body.removeChild(node)};window.addEventListener("mousedown",closeOut);React.render(ContextMenu({x:x,y:y,config:definition,onSelect:onSelect,onClose:closeOut}),node)};module.exports=ContextMenu},{"react/addons":"react/addons"}],304:[function(require,module,exports){module.exports=keys;keys.keyName=keyName;var KEYS={8:"backspace",9:"tab",13:"enter",27:"escape",32:"space",33:"page-up",34:"page-down",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",46:"delete",113:"f2",186:";",188:"comma",190:".",191:"/",219:"[",221:"]"};function keyName(code){if(code<=90&&code>=65){return String.fromCharCode(code+32)}if(code>=48&&code<=57){return String.fromCharCode(code)}return KEYS[code]}function makeLayer(config){var layer={kmap:{},prefixes:{}},parts,part,seq;for(var key in config){parts=key.split(",");for(var i=0;i<parts.length;i++){part=parts[i].trim();if(window.DEBUG_KEYS&&layer.kmap[part]){console.log("Overrifing key:",part)}layer.kmap[part]=config[key];if(part.indexOf(" ")!==-1){seq=part.split(/\s+/g);var n="";for(var j=0;j<seq.length-1;j++){n+=seq[j];layer.prefixes[n]=true;n+=" "}}}}return layer}function modKeyName(e){var key=keyName(e.keyCode);if(!key){if(window.DEBUG_KEYS){console.log(e.keyCode)}return null}if(e.altKey)key="alt+"+key;if(e.shiftKey)key="shift+"+key;if(e.ctrlKey)key="ctrl+"+key;if(e.metaKey)key="cmd+"+key;return key}function keys(config){var kmap={},prefixes={},cur_prefix=null,disabled=false,layer_ids=[],layers={},id=1;function addLayer(config){var layer=makeLayer(config),lid=id++;layer_ids.push(lid);layers[lid]=layer;return lid}function removeLayer(lid){if(!layers[lid])return false;var ix=layer_ids.indexOf(lid);layer_ids.splice(ix,1);delete layers[lid];return true}function handleLayer(layer,key){if(layer.kmap[key]){return layer.kmap[key]}if(layer.prefixes[key]){return key}else{return null}}function findAction(key){if(cur_prefix){key=cur_prefix.key+" "+key;var got=handleLayer(layers[cur_prefix.lid],key);if("string"===typeof got){cur_prefix.key=got;return cur_prefix.key}cur_prefix=null;if(got===null){return true}return got}for(var i=layer_ids.length-1;i>=0;i--){var got=handleLayer(layers[layer_ids[i]],key);if(got===null)continue;if("string"===typeof got){cur_prefix={key:got,lid:layer_ids[i]};return cur_prefix.key}return got}return true}function handler(e,prefix){if(disabled)return;var key=modKeyName(e);if(window.DEBUG_KEYS){console.log(key)}var action=findAction(key);if(prefix&&(!cur_prefix||cur_prefix.key!==prefix))return;if("function"!==typeof action)return action;if(action.call(this,e)!==true){e.preventDefault();e.stopPropagation();return false}}handler.clear=function(){cur_prefix=null};handler.remove=removeLayer;handler.add=addLayer;handler.add(config);handler.disable=function(){disabled=true};handler.enable=function(){disabled=false};return handler}},{}],305:[function(require,module,exports){module.exports=uuid;var CHARS="0123456789abcdefghijklmnopqrstuvwxyz";function uuid(ln){ln=ln||32;var id="";for(var i=0;i<ln;i++){id+=CHARS[parseInt(Math.random()*CHARS.length)]}return id}},{}],306:[function(require,module,exports){arguments[4][212][0].apply(exports,arguments)},{bluebird:309,dup:212,"react/addons":"react/addons"}],307:[function(require,module,exports){arguments[4][213][0].apply(exports,arguments)},{"./some_promise_array.js":339,dup:213}],308:[function(require,module,exports){arguments[4][214][0].apply(exports,arguments)},{"./global.js":321,"./queue.js":332,"./schedule.js":335,"./util.js":343,dup:214}],309:[function(require,module,exports){arguments[4][215][0].apply(exports,arguments)},{"./promise.js":325,dup:215}],310:[function(require,module,exports){arguments[4][216][0].apply(exports,arguments)},{dup:216}],311:[function(require,module,exports){arguments[4][217][0].apply(exports,arguments)},{"./async.js":308,"./errors.js":315,dup:217}],312:[function(require,module,exports){arguments[4][218][0].apply(exports,arguments)},{"./es5.js":317,"./util.js":343,dup:218}],313:[function(require,module,exports){arguments[4][219][0].apply(exports,arguments)},{"./errors.js":315,"./es5.js":317,"./util.js":343,dup:219}],314:[function(require,module,exports){arguments[4][220][0].apply(exports,arguments)},{"./util.js":343,dup:220}],315:[function(require,module,exports){arguments[4][221][0].apply(exports,arguments)},{"./es5.js":317,"./global.js":321,"./util.js":343,dup:221}],316:[function(require,module,exports){arguments[4][222][0].apply(exports,arguments)},{"./errors.js":315,dup:222}],317:[function(require,module,exports){arguments[4][223][0].apply(exports,arguments)},{dup:223}],318:[function(require,module,exports){arguments[4][224][0].apply(exports,arguments)},{"./util.js":343,dup:224}],319:[function(require,module,exports){arguments[4][225][0].apply(exports,arguments)},{"./util.js":343,dup:225}],320:[function(require,module,exports){arguments[4][226][0].apply(exports,arguments)},{"./errors.js":315,"./promise_spawn.js":328,"./util.js":343,dup:226}],321:[function(require,module,exports){(function(global){module.exports=function(){if(this!==void 0)return this;try{return global}catch(e){}try{return window}catch(e){}try{return self}catch(e){}}()}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{}],322:[function(require,module,exports){arguments[4][228][0].apply(exports,arguments)},{"./errors.js":315,"./util.js":343,dup:228}],323:[function(require,module,exports){arguments[4][229][0].apply(exports,arguments)},{"./async.js":308,"./util.js":343,dup:229}],324:[function(require,module,exports){arguments[4][230][0].apply(exports,arguments)},{"./async.js":308,"./errors.js":315,"./util.js":343,dup:230}],325:[function(require,module,exports){(function(process){"use strict";module.exports=function(){var global=require("./global.js");var util=require("./util.js");var async=require("./async.js");var errors=require("./errors.js");var INTERNAL=function(){};var APPLY={};var NEXT_FILTER={e:null};var PromiseArray=require("./promise_array.js")(Promise,INTERNAL);var CapturedTrace=require("./captured_trace.js")();var CatchFilter=require("./catch_filter.js")(NEXT_FILTER);var PromiseResolver=require("./promise_resolver.js");var isArray=util.isArray;var errorObj=util.errorObj;var tryCatch1=util.tryCatch1;var tryCatch2=util.tryCatch2;var tryCatchApply=util.tryCatchApply;var RangeError=errors.RangeError;var TypeError=errors.TypeError;var CancellationError=errors.CancellationError;var TimeoutError=errors.TimeoutError;var RejectionError=errors.RejectionError;var originatesFromRejection=errors.originatesFromRejection;var markAsOriginatingFromRejection=errors.markAsOriginatingFromRejection;var canAttach=errors.canAttach;var thrower=util.thrower;var apiRejection=require("./errors_api_rejection")(Promise);var makeSelfResolutionError=function Promise$_makeSelfResolutionError(){return new TypeError("circular promise resolution chain")};function isPromise(obj){if(obj===void 0)return false;return obj instanceof Promise}function isPromiseArrayProxy(receiver,promiseSlotValue){if(receiver instanceof PromiseArray){return promiseSlotValue>=0}return false}function Promise(resolver){if(typeof resolver!=="function"){throw new TypeError("the promise constructor requires a resolver function")}if(this.constructor!==Promise){throw new TypeError("the promise constructor cannot be invoked directly")}this._bitField=0;this._fulfillmentHandler0=void 0;this._rejectionHandler0=void 0;this._promise0=void 0;this._receiver0=void 0;this._settledValue=void 0;this._boundTo=void 0;if(resolver!==INTERNAL)this._resolveFromResolver(resolver)}Promise.prototype.bind=function Promise$bind(thisArg){var ret=new Promise(INTERNAL);ret._setTrace(this);ret._follow(this);ret._setBoundTo(thisArg);if(this._cancellable()){ret._setCancellable();ret._cancellationParent=this}return ret};Promise.prototype.toString=function Promise$toString(){return"[object Promise]"};Promise.prototype.caught=Promise.prototype["catch"]=function Promise$catch(fn){var len=arguments.length;if(len>1){var catchInstances=new Array(len-1),j=0,i;for(i=0;i<len-1;++i){var item=arguments[i];if(typeof item==="function"){catchInstances[j++]=item}else{var catchFilterTypeError=new TypeError("A catch filter must be an error constructor "+"or a filter function");this._attachExtraTrace(catchFilterTypeError);async.invoke(this._reject,this,catchFilterTypeError);return}}catchInstances.length=j;fn=arguments[i];this._resetTrace();var catchFilter=new CatchFilter(catchInstances,fn,this);return this._then(void 0,catchFilter.doFilter,void 0,catchFilter,void 0)}return this._then(void 0,fn,void 0,void 0,void 0)};Promise.prototype.then=function Promise$then(didFulfill,didReject,didProgress){return this._then(didFulfill,didReject,didProgress,void 0,void 0)};Promise.prototype.done=function Promise$done(didFulfill,didReject,didProgress){var promise=this._then(didFulfill,didReject,didProgress,void 0,void 0);promise._setIsFinal()};Promise.prototype.spread=function Promise$spread(didFulfill,didReject){return this._then(didFulfill,didReject,void 0,APPLY,void 0)};Promise.prototype.isCancellable=function Promise$isCancellable(){return!this.isResolved()&&this._cancellable()};Promise.prototype.toJSON=function Promise$toJSON(){var ret={isFulfilled:false,isRejected:false,fulfillmentValue:void 0,rejectionReason:void 0};if(this.isFulfilled()){ret.fulfillmentValue=this._settledValue;ret.isFulfilled=true}else if(this.isRejected()){ret.rejectionReason=this._settledValue;ret.isRejected=true}return ret};Promise.prototype.all=function Promise$all(){return Promise$_all(this,true)};Promise.is=isPromise;function Promise$_all(promises,useBound){return Promise$_CreatePromiseArray(promises,PromiseArray,useBound===true&&promises._isBound()?promises._boundTo:void 0).promise()}Promise.all=function Promise$All(promises){return Promise$_all(promises,false)};Promise.join=function Promise$Join(){var $_len=arguments.length;var args=new Array($_len);for(var $_i=0;$_i<$_len;++$_i){args[$_i]=arguments[$_i]}return Promise$_CreatePromiseArray(args,PromiseArray,void 0).promise()};Promise.resolve=Promise.fulfilled=function Promise$Resolve(value){var ret=new Promise(INTERNAL);ret._setTrace(void 0);if(ret._tryFollow(value)){return ret}ret._cleanValues();ret._setFulfilled();ret._settledValue=value;return ret};Promise.reject=Promise.rejected=function Promise$Reject(reason){var ret=new Promise(INTERNAL);ret._setTrace(void 0);markAsOriginatingFromRejection(reason);ret._cleanValues();ret._setRejected();ret._settledValue=reason;if(!canAttach(reason)){var trace=new Error(reason+"");ret._setCarriedStackTrace(trace)}ret._ensurePossibleRejectionHandled();return ret};Promise.prototype.error=function Promise$_error(fn){return this.caught(originatesFromRejection,fn)
};Promise.prototype._resolveFromSyncValue=function Promise$_resolveFromSyncValue(value){if(value===errorObj){this._cleanValues();this._setRejected();this._settledValue=value.e;this._ensurePossibleRejectionHandled()}else{var maybePromise=Promise._cast(value,void 0);if(maybePromise instanceof Promise){this._follow(maybePromise)}else{this._cleanValues();this._setFulfilled();this._settledValue=value}}};Promise.method=function Promise$_Method(fn){if(typeof fn!=="function"){throw new TypeError("fn must be a function")}return function Promise$_method(){var value;switch(arguments.length){case 0:value=tryCatch1(fn,this,void 0);break;case 1:value=tryCatch1(fn,this,arguments[0]);break;case 2:value=tryCatch2(fn,this,arguments[0],arguments[1]);break;default:var $_len=arguments.length;var args=new Array($_len);for(var $_i=0;$_i<$_len;++$_i){args[$_i]=arguments[$_i]}value=tryCatchApply(fn,args,this);break}var ret=new Promise(INTERNAL);ret._setTrace(void 0);ret._resolveFromSyncValue(value);return ret}};Promise.attempt=Promise["try"]=function Promise$_Try(fn,args,ctx){if(typeof fn!=="function"){return apiRejection("fn must be a function")}var value=isArray(args)?tryCatchApply(fn,args,ctx):tryCatch1(fn,ctx,args);var ret=new Promise(INTERNAL);ret._setTrace(void 0);ret._resolveFromSyncValue(value);return ret};Promise.defer=Promise.pending=function Promise$Defer(){var promise=new Promise(INTERNAL);promise._setTrace(void 0);return new PromiseResolver(promise)};Promise.bind=function Promise$Bind(thisArg){var ret=new Promise(INTERNAL);ret._setTrace(void 0);ret._setFulfilled();ret._setBoundTo(thisArg);return ret};Promise.cast=function Promise$_Cast(obj){var ret=Promise._cast(obj,void 0);if(!(ret instanceof Promise)){return Promise.resolve(ret)}return ret};Promise.onPossiblyUnhandledRejection=function Promise$OnPossiblyUnhandledRejection(fn){CapturedTrace.possiblyUnhandledRejection=typeof fn==="function"?fn:void 0};var unhandledRejectionHandled;Promise.onUnhandledRejectionHandled=function Promise$onUnhandledRejectionHandled(fn){unhandledRejectionHandled=typeof fn==="function"?fn:void 0};var debugging=false||!!(typeof process!=="undefined"&&typeof process.execPath==="string"&&typeof process.env==="object"&&(process.env["BLUEBIRD_DEBUG"]||process.env["NODE_ENV"]==="development"));Promise.longStackTraces=function Promise$LongStackTraces(){if(async.haveItemsQueued()&&debugging===false){throw new Error("cannot enable long stack traces after promises have been created")}debugging=CapturedTrace.isSupported()};Promise.hasLongStackTraces=function Promise$HasLongStackTraces(){return debugging&&CapturedTrace.isSupported()};Promise.prototype._setProxyHandlers=function Promise$_setProxyHandlers(receiver,promiseSlotValue){var index=this._length();if(index>=524287-5){index=0;this._setLength(0)}if(index===0){this._promise0=promiseSlotValue;this._receiver0=receiver}else{var i=index-5;this[i+3]=promiseSlotValue;this[i+4]=receiver;this[i+0]=this[i+1]=this[i+2]=void 0}this._setLength(index+5)};Promise.prototype._proxyPromiseArray=function Promise$_proxyPromiseArray(promiseArray,index){this._setProxyHandlers(promiseArray,index)};Promise.prototype._proxyPromise=function Promise$_proxyPromise(promise){promise._setProxied();this._setProxyHandlers(promise,-1)};Promise.prototype._then=function Promise$_then(didFulfill,didReject,didProgress,receiver,internalData){var haveInternalData=internalData!==void 0;var ret=haveInternalData?internalData:new Promise(INTERNAL);if(debugging&&!haveInternalData){var haveSameContext=this._peekContext()===this._traceParent;ret._traceParent=haveSameContext?this._traceParent:this;ret._setTrace(this)}if(!haveInternalData&&this._isBound()){ret._setBoundTo(this._boundTo)}var callbackIndex=this._addCallbacks(didFulfill,didReject,didProgress,ret,receiver);if(!haveInternalData&&this._cancellable()){ret._setCancellable();ret._cancellationParent=this}if(this.isResolved()){async.invoke(this._queueSettleAt,this,callbackIndex)}return ret};Promise.prototype._length=function Promise$_length(){return this._bitField&524287};Promise.prototype._isFollowingOrFulfilledOrRejected=function Promise$_isFollowingOrFulfilledOrRejected(){return(this._bitField&939524096)>0};Promise.prototype._isFollowing=function Promise$_isFollowing(){return(this._bitField&536870912)===536870912};Promise.prototype._setLength=function Promise$_setLength(len){this._bitField=this._bitField&-524288|len&524287};Promise.prototype._setFulfilled=function Promise$_setFulfilled(){this._bitField=this._bitField|268435456};Promise.prototype._setRejected=function Promise$_setRejected(){this._bitField=this._bitField|134217728};Promise.prototype._setFollowing=function Promise$_setFollowing(){this._bitField=this._bitField|536870912};Promise.prototype._setIsFinal=function Promise$_setIsFinal(){this._bitField=this._bitField|33554432};Promise.prototype._isFinal=function Promise$_isFinal(){return(this._bitField&33554432)>0};Promise.prototype._cancellable=function Promise$_cancellable(){return(this._bitField&67108864)>0};Promise.prototype._setCancellable=function Promise$_setCancellable(){this._bitField=this._bitField|67108864};Promise.prototype._unsetCancellable=function Promise$_unsetCancellable(){this._bitField=this._bitField&~67108864};Promise.prototype._setRejectionIsUnhandled=function Promise$_setRejectionIsUnhandled(){this._bitField=this._bitField|2097152};Promise.prototype._unsetRejectionIsUnhandled=function Promise$_unsetRejectionIsUnhandled(){this._bitField=this._bitField&~2097152;if(this._isUnhandledRejectionNotified()){this._unsetUnhandledRejectionIsNotified();this._notifyUnhandledRejectionIsHandled()}};Promise.prototype._isRejectionUnhandled=function Promise$_isRejectionUnhandled(){return(this._bitField&2097152)>0};Promise.prototype._setUnhandledRejectionIsNotified=function Promise$_setUnhandledRejectionIsNotified(){this._bitField=this._bitField|524288};Promise.prototype._unsetUnhandledRejectionIsNotified=function Promise$_unsetUnhandledRejectionIsNotified(){this._bitField=this._bitField&~524288};Promise.prototype._isUnhandledRejectionNotified=function Promise$_isUnhandledRejectionNotified(){return(this._bitField&524288)>0};Promise.prototype._setCarriedStackTrace=function Promise$_setCarriedStackTrace(capturedTrace){this._bitField=this._bitField|1048576;this._fulfillmentHandler0=capturedTrace};Promise.prototype._unsetCarriedStackTrace=function Promise$_unsetCarriedStackTrace(){this._bitField=this._bitField&~1048576;this._fulfillmentHandler0=void 0};Promise.prototype._isCarryingStackTrace=function Promise$_isCarryingStackTrace(){return(this._bitField&1048576)>0};Promise.prototype._getCarriedStackTrace=function Promise$_getCarriedStackTrace(){return this._isCarryingStackTrace()?this._fulfillmentHandler0:void 0};Promise.prototype._receiverAt=function Promise$_receiverAt(index){var ret;if(index===0){ret=this._receiver0}else{ret=this[index+4-5]}if(this._isBound()&&ret===void 0){return this._boundTo}return ret};Promise.prototype._promiseAt=function Promise$_promiseAt(index){if(index===0)return this._promise0;return this[index+3-5]};Promise.prototype._fulfillmentHandlerAt=function Promise$_fulfillmentHandlerAt(index){if(index===0)return this._fulfillmentHandler0;return this[index+0-5]};Promise.prototype._rejectionHandlerAt=function Promise$_rejectionHandlerAt(index){if(index===0)return this._rejectionHandler0;return this[index+1-5]};Promise.prototype._unsetAt=function Promise$_unsetAt(index){if(index===0){this._rejectionHandler0=this._progressHandler0=this._promise0=this._receiver0=void 0;if(!this._isCarryingStackTrace()){this._fulfillmentHandler0=void 0}}else{this[index-5+0]=this[index-5+1]=this[index-5+2]=this[index-5+3]=this[index-5+4]=void 0}};Promise.prototype._resolveFromResolver=function Promise$_resolveFromResolver(resolver){var promise=this;this._setTrace(void 0);this._pushContext();function Promise$_resolver(val){if(promise._tryFollow(val)){return}promise._fulfill(val)}function Promise$_rejecter(val){var trace=canAttach(val)?val:new Error(val+"");promise._attachExtraTrace(trace);markAsOriginatingFromRejection(val);promise._reject(val,trace===val?void 0:trace)}var r=tryCatch2(resolver,void 0,Promise$_resolver,Promise$_rejecter);this._popContext();if(r!==void 0&&r===errorObj){var e=r.e;var trace=canAttach(e)?e:new Error(e+"");promise._reject(e,trace)}};Promise.prototype._addCallbacks=function Promise$_addCallbacks(fulfill,reject,progress,promise,receiver){var index=this._length();if(index>=524287-5){index=0;this._setLength(0)}if(index===0){this._promise0=promise;if(receiver!==void 0)this._receiver0=receiver;if(typeof fulfill==="function"&&!this._isCarryingStackTrace())this._fulfillmentHandler0=fulfill;if(typeof reject==="function")this._rejectionHandler0=reject;if(typeof progress==="function")this._progressHandler0=progress}else{var i=index-5;this[i+3]=promise;this[i+4]=receiver;this[i+0]=typeof fulfill==="function"?fulfill:void 0;this[i+1]=typeof reject==="function"?reject:void 0;this[i+2]=typeof progress==="function"?progress:void 0}this._setLength(index+5);return index};Promise.prototype._setBoundTo=function Promise$_setBoundTo(obj){if(obj!==void 0){this._bitField=this._bitField|8388608;this._boundTo=obj}else{this._bitField=this._bitField&~8388608}};Promise.prototype._isBound=function Promise$_isBound(){return(this._bitField&8388608)===8388608};Promise.prototype._spreadSlowCase=function Promise$_spreadSlowCase(targetFn,promise,values,boundTo){var promiseForAll=Promise$_CreatePromiseArray(values,PromiseArray,boundTo).promise()._then(function(){return targetFn.apply(boundTo,arguments)},void 0,void 0,APPLY,void 0);promise._follow(promiseForAll)};Promise.prototype._callSpread=function Promise$_callSpread(handler,promise,value,localDebugging){var boundTo=this._isBound()?this._boundTo:void 0;if(isArray(value)){for(var i=0,len=value.length;i<len;++i){if(isPromise(Promise._cast(value[i],void 0))){this._spreadSlowCase(handler,promise,value,boundTo);return}}}if(localDebugging)promise._pushContext();return tryCatchApply(handler,value,boundTo)};Promise.prototype._callHandler=function Promise$_callHandler(handler,receiver,promise,value,localDebugging){var x;if(receiver===APPLY&&!this.isRejected()){x=this._callSpread(handler,promise,value,localDebugging)}else{if(localDebugging)promise._pushContext();x=tryCatch1(handler,receiver,value)}if(localDebugging)promise._popContext();return x};Promise.prototype._settlePromiseFromHandler=function Promise$_settlePromiseFromHandler(handler,receiver,value,promise){if(!isPromise(promise)){handler.call(receiver,value,promise);return}var localDebugging=debugging;var x=this._callHandler(handler,receiver,promise,value,localDebugging);if(promise._isFollowing())return;if(x===errorObj||x===promise||x===NEXT_FILTER){var err=x===promise?makeSelfResolutionError():x.e;var trace=canAttach(err)?err:new Error(err+"");if(x!==NEXT_FILTER)promise._attachExtraTrace(trace);promise._rejectUnchecked(err,trace)}else{var castValue=Promise._cast(x,promise);if(isPromise(castValue)){if(castValue.isRejected()&&!castValue._isCarryingStackTrace()&&!canAttach(castValue._settledValue)){var trace=new Error(castValue._settledValue+"");promise._attachExtraTrace(trace);castValue._setCarriedStackTrace(trace)}promise._follow(castValue);if(castValue._cancellable()){promise._cancellationParent=castValue;promise._setCancellable()}}else{promise._fulfillUnchecked(x)}}};Promise.prototype._follow=function Promise$_follow(promise){this._setFollowing();if(promise.isPending()){if(promise._cancellable()){this._cancellationParent=promise;this._setCancellable()}promise._proxyPromise(this)}else if(promise.isFulfilled()){this._fulfillUnchecked(promise._settledValue)}else{this._rejectUnchecked(promise._settledValue,promise._getCarriedStackTrace())}if(promise._isRejectionUnhandled())promise._unsetRejectionIsUnhandled();if(debugging&&promise._traceParent==null){promise._traceParent=this}};Promise.prototype._tryFollow=function Promise$_tryFollow(value){if(this._isFollowingOrFulfilledOrRejected()||value===this){return false}var maybePromise=Promise._cast(value,void 0);if(!isPromise(maybePromise)){return false}this._follow(maybePromise);return true};Promise.prototype._resetTrace=function Promise$_resetTrace(){if(debugging){this._trace=new CapturedTrace(this._peekContext()===void 0)}};Promise.prototype._setTrace=function Promise$_setTrace(parent){if(debugging){var context=this._peekContext();this._traceParent=context;var isTopLevel=context===void 0;if(parent!==void 0&&parent._traceParent===context){this._trace=parent._trace}else{this._trace=new CapturedTrace(isTopLevel)}}return this};Promise.prototype._attachExtraTrace=function Promise$_attachExtraTrace(error){if(debugging){var promise=this;var stack=error.stack;stack=typeof stack==="string"?stack.split("\n"):[];var headerLineCount=1;while(promise!=null&&promise._trace!=null){stack=CapturedTrace.combine(stack,promise._trace.stack.split("\n"));promise=promise._traceParent}var max=Error.stackTraceLimit+headerLineCount;var len=stack.length;if(len>max){stack.length=max}if(stack.length<=headerLineCount){error.stack="(No stack trace)"}else{error.stack=stack.join("\n")}}};Promise.prototype._cleanValues=function Promise$_cleanValues(){if(this._cancellable()){this._cancellationParent=void 0}};Promise.prototype._fulfill=function Promise$_fulfill(value){if(this._isFollowingOrFulfilledOrRejected())return;this._fulfillUnchecked(value)};Promise.prototype._reject=function Promise$_reject(reason,carriedStackTrace){if(this._isFollowingOrFulfilledOrRejected())return;this._rejectUnchecked(reason,carriedStackTrace)};Promise.prototype._settlePromiseAt=function Promise$_settlePromiseAt(index){var handler=this.isFulfilled()?this._fulfillmentHandlerAt(index):this._rejectionHandlerAt(index);var value=this._settledValue;var receiver=this._receiverAt(index);var promise=this._promiseAt(index);if(typeof handler==="function"){this._settlePromiseFromHandler(handler,receiver,value,promise)}else{var done=false;var isFulfilled=this.isFulfilled();if(receiver!==void 0){if(receiver instanceof Promise&&receiver._isProxied()){receiver._unsetProxied();if(isFulfilled)receiver._fulfillUnchecked(value);else receiver._rejectUnchecked(value,this._getCarriedStackTrace());done=true}else if(isPromiseArrayProxy(receiver,promise)){if(isFulfilled)receiver._promiseFulfilled(value,promise);else receiver._promiseRejected(value,promise);done=true}}if(!done){if(isFulfilled)promise._fulfill(value);else promise._reject(value,this._getCarriedStackTrace())}}if(index>=256){this._queueGC()}};Promise.prototype._isProxied=function Promise$_isProxied(){return(this._bitField&4194304)===4194304};Promise.prototype._setProxied=function Promise$_setProxied(){this._bitField=this._bitField|4194304};Promise.prototype._unsetProxied=function Promise$_unsetProxied(){this._bitField=this._bitField&~4194304};Promise.prototype._isGcQueued=function Promise$_isGcQueued(){return(this._bitField&-1073741824)===-1073741824};Promise.prototype._setGcQueued=function Promise$_setGcQueued(){this._bitField=this._bitField|-1073741824};Promise.prototype._unsetGcQueued=function Promise$_unsetGcQueued(){this._bitField=this._bitField&~-1073741824};Promise.prototype._queueGC=function Promise$_queueGC(){if(this._isGcQueued())return;this._setGcQueued();async.invokeLater(this._gc,this,void 0)};Promise.prototype._gc=function Promise$gc(){var len=this._length();this._unsetAt(0);for(var i=0;i<len;i++){delete this[i]}this._setLength(0);this._unsetGcQueued()};Promise.prototype._queueSettleAt=function Promise$_queueSettleAt(index){if(this._isRejectionUnhandled())this._unsetRejectionIsUnhandled();async.invoke(this._settlePromiseAt,this,index)};Promise.prototype._fulfillUnchecked=function Promise$_fulfillUnchecked(value){if(!this.isPending())return;if(value===this){var err=makeSelfResolutionError();this._attachExtraTrace(err);return this._rejectUnchecked(err,void 0)}this._cleanValues();this._setFulfilled();this._settledValue=value;var len=this._length();if(len>0){async.invoke(this._settlePromises,this,len)}};Promise.prototype._rejectUncheckedCheckError=function Promise$_rejectUncheckedCheckError(reason){var trace=canAttach(reason)?reason:new Error(reason+"");this._rejectUnchecked(reason,trace===reason?void 0:trace)};Promise.prototype._rejectUnchecked=function Promise$_rejectUnchecked(reason,trace){if(!this.isPending())return;if(reason===this){var err=makeSelfResolutionError();this._attachExtraTrace(err);return this._rejectUnchecked(err)}this._cleanValues();this._setRejected();this._settledValue=reason;if(this._isFinal()){async.invokeLater(thrower,void 0,trace===void 0?reason:trace);return}var len=this._length();if(trace!==void 0)this._setCarriedStackTrace(trace);if(len>0){async.invoke(this._rejectPromises,this,null)}else{this._ensurePossibleRejectionHandled()}};Promise.prototype._rejectPromises=function Promise$_rejectPromises(){this._settlePromises();this._unsetCarriedStackTrace()};Promise.prototype._settlePromises=function Promise$_settlePromises(){var len=this._length();for(var i=0;i<len;i+=5){this._settlePromiseAt(i)}};Promise.prototype._ensurePossibleRejectionHandled=function Promise$_ensurePossibleRejectionHandled(){this._setRejectionIsUnhandled();if(CapturedTrace.possiblyUnhandledRejection!==void 0){async.invokeLater(this._notifyUnhandledRejection,this,void 0)}};Promise.prototype._notifyUnhandledRejectionIsHandled=function Promise$_notifyUnhandledRejectionIsHandled(){if(typeof unhandledRejectionHandled==="function"){async.invokeLater(unhandledRejectionHandled,void 0,this)}};Promise.prototype._notifyUnhandledRejection=function Promise$_notifyUnhandledRejection(){if(this._isRejectionUnhandled()){var reason=this._settledValue;var trace=this._getCarriedStackTrace();this._setUnhandledRejectionIsNotified();if(trace!==void 0){this._unsetCarriedStackTrace();reason=trace}if(typeof CapturedTrace.possiblyUnhandledRejection==="function"){CapturedTrace.possiblyUnhandledRejection(reason,this)}}};var contextStack=[];Promise.prototype._peekContext=function Promise$_peekContext(){var lastIndex=contextStack.length-1;if(lastIndex>=0){return contextStack[lastIndex]}return void 0};Promise.prototype._pushContext=function Promise$_pushContext(){if(!debugging)return;contextStack.push(this)};Promise.prototype._popContext=function Promise$_popContext(){if(!debugging)return;contextStack.pop()};function Promise$_CreatePromiseArray(promises,PromiseArrayConstructor,boundTo){var list=null;if(isArray(promises)){list=promises}else{list=Promise._cast(promises,void 0);if(list!==promises){list._setBoundTo(boundTo)}else if(!isPromise(list)){list=null}}if(list!==null){return new PromiseArrayConstructor(list,boundTo)}return{promise:function(){return apiRejection("expecting an array, a promise or a thenable")}}}var old=global.Promise;Promise.noConflict=function(){if(global.Promise===Promise){global.Promise=old}return Promise};if(!CapturedTrace.isSupported()){Promise.longStackTraces=function(){};debugging=false}Promise._makeSelfResolutionError=makeSelfResolutionError;require("./finally.js")(Promise,NEXT_FILTER);require("./direct_resolve.js")(Promise);require("./thenables.js")(Promise,INTERNAL);require("./synchronous_inspection.js")(Promise);Promise.RangeError=RangeError;Promise.CancellationError=CancellationError;Promise.TimeoutError=TimeoutError;Promise.TypeError=TypeError;Promise.RejectionError=RejectionError;util.toFastProperties(Promise);util.toFastProperties(Promise.prototype);require("./timers.js")(Promise,INTERNAL);require("./any.js")(Promise,Promise$_CreatePromiseArray,PromiseArray);require("./race.js")(Promise,INTERNAL);require("./call_get.js")(Promise);require("./filter.js")(Promise,Promise$_CreatePromiseArray,PromiseArray,apiRejection);require("./generators.js")(Promise,apiRejection,INTERNAL);require("./map.js")(Promise,PromiseArray,INTERNAL,apiRejection);require("./nodeify.js")(Promise);require("./promisify.js")(Promise,INTERNAL);require("./props.js")(Promise,PromiseArray);require("./reduce.js")(Promise,Promise$_CreatePromiseArray,PromiseArray,apiRejection,INTERNAL);require("./settle.js")(Promise,Promise$_CreatePromiseArray,PromiseArray);require("./some.js")(Promise,Promise$_CreatePromiseArray,PromiseArray,apiRejection);require("./progress.js")(Promise,isPromiseArrayProxy);require("./cancel.js")(Promise,INTERNAL);Promise.prototype=Promise.prototype;return Promise}}).call(this,require("_process"))},{"./any.js":307,"./async.js":308,"./call_get.js":310,"./cancel.js":311,"./captured_trace.js":312,"./catch_filter.js":313,"./direct_resolve.js":314,"./errors.js":315,"./errors_api_rejection":316,"./filter.js":318,"./finally.js":319,"./generators.js":320,"./global.js":321,"./map.js":322,"./nodeify.js":323,"./progress.js":324,"./promise_array.js":326,"./promise_resolver.js":327,"./promisify.js":329,"./props.js":331,"./race.js":333,"./reduce.js":334,"./settle.js":336,"./some.js":338,"./synchronous_inspection.js":340,"./thenables.js":341,"./timers.js":342,"./util.js":343,_process:10}],326:[function(require,module,exports){arguments[4][232][0].apply(exports,arguments)},{"./async.js":308,"./errors.js":315,"./util.js":343,dup:232}],327:[function(require,module,exports){arguments[4][233][0].apply(exports,arguments)},{"./async.js":308,"./errors.js":315,"./es5.js":317,"./util.js":343,dup:233}],328:[function(require,module,exports){arguments[4][234][0].apply(exports,arguments)},{"./errors.js":315,"./util.js":343,dup:234}],329:[function(require,module,exports){arguments[4][235][0].apply(exports,arguments)},{"./errors":315,"./es5.js":317,"./promise_resolver.js":327,"./util.js":343,dup:235}],330:[function(require,module,exports){arguments[4][236][0].apply(exports,arguments)},{"./es5.js":317,"./util.js":343,dup:236}],331:[function(require,module,exports){arguments[4][237][0].apply(exports,arguments)},{"./errors_api_rejection":316,"./properties_promise_array.js":330,"./util.js":343,dup:237}],332:[function(require,module,exports){arguments[4][238][0].apply(exports,arguments)},{dup:238}],333:[function(require,module,exports){arguments[4][239][0].apply(exports,arguments)},{"./errors_api_rejection.js":316,"./util.js":343,dup:239}],334:[function(require,module,exports){arguments[4][240][0].apply(exports,arguments)},{dup:240}],335:[function(require,module,exports){(function(process){"use strict";var global=require("./global.js");var schedule;if(typeof process!=="undefined"&&process!==null&&typeof process.cwd==="function"&&typeof process.nextTick==="function"&&typeof process.version==="string"){schedule=function Promise$_Scheduler(fn){process.nextTick(fn)}}else if((typeof global.MutationObserver==="function"||typeof global.WebkitMutationObserver==="function"||typeof global.WebKitMutationObserver==="function")&&typeof document!=="undefined"&&typeof document.createElement==="function"){schedule=function(){var MutationObserver=global.MutationObserver||global.WebkitMutationObserver||global.WebKitMutationObserver;var div=document.createElement("div");var queuedFn=void 0;var observer=new MutationObserver(function Promise$_Scheduler(){var fn=queuedFn;queuedFn=void 0;fn()});observer.observe(div,{attributes:true});return function Promise$_Scheduler(fn){queuedFn=fn;div.setAttribute("class","foo")}}()}else if(typeof global.postMessage==="function"&&typeof global.importScripts!=="function"&&typeof global.addEventListener==="function"&&typeof global.removeEventListener==="function"){var MESSAGE_KEY="bluebird_message_key_"+Math.random();schedule=function(){var queuedFn=void 0;function Promise$_Scheduler(e){if(e.source===global&&e.data===MESSAGE_KEY){var fn=queuedFn;queuedFn=void 0;fn()}}global.addEventListener("message",Promise$_Scheduler,false);return function Promise$_Scheduler(fn){queuedFn=fn;global.postMessage(MESSAGE_KEY,"*")}}()}else if(typeof global.MessageChannel==="function"){schedule=function(){var queuedFn=void 0;var channel=new global.MessageChannel;channel.port1.onmessage=function Promise$_Scheduler(){var fn=queuedFn;queuedFn=void 0;fn()};return function Promise$_Scheduler(fn){queuedFn=fn;channel.port2.postMessage(null)}}()}else if(global.setTimeout){schedule=function Promise$_Scheduler(fn){setTimeout(fn,4)}}else{schedule=function Promise$_Scheduler(fn){fn()}}module.exports=schedule}).call(this,require("_process"))},{"./global.js":321,_process:10}],336:[function(require,module,exports){arguments[4][242][0].apply(exports,arguments)},{"./settled_promise_array.js":337,dup:242}],337:[function(require,module,exports){arguments[4][243][0].apply(exports,arguments)},{"./util.js":343,dup:243}],338:[function(require,module,exports){arguments[4][244][0].apply(exports,arguments)},{"./some_promise_array.js":339,dup:244}],339:[function(require,module,exports){arguments[4][245][0].apply(exports,arguments)},{"./errors.js":315,"./util.js":343,dup:245}],340:[function(require,module,exports){arguments[4][246][0].apply(exports,arguments)},{dup:246}],341:[function(require,module,exports){arguments[4][247][0].apply(exports,arguments)},{"./errors.js":315,"./util.js":343,dup:247}],342:[function(require,module,exports){arguments[4][248][0].apply(exports,arguments)},{"./errors.js":315,"./errors_api_rejection":316,"./global.js":321,"./util.js":343,dup:248}],343:[function(require,module,exports){arguments[4][249][0].apply(exports,arguments)},{"./es5.js":317,"./global.js":321,dup:249}],344:[function(require,module,exports){(function(Buffer){module.exports=Level;var IDB=require("idb-wrapper");var AbstractLevelDOWN=require("abstract-leveldown").AbstractLevelDOWN;var util=require("util");var Iterator=require("./iterator");var isBuffer=require("isbuffer");var xtend=require("xtend");var toBuffer=require("typedarray-to-buffer");function Level(location){if(!(this instanceof Level))return new Level(location);if(!location)throw new Error("constructor requires at least a location argument");this.IDBOptions={};this.location=location}util.inherits(Level,AbstractLevelDOWN);Level.prototype._open=function(options,callback){var self=this;var idbOpts={storeName:this.location,autoIncrement:false,keyPath:null,onStoreReady:function(){callback&&callback(null,self.idb)},onError:function(err){callback&&callback(err)}};xtend(idbOpts,options);this.IDBOptions=idbOpts;this.idb=new IDB(idbOpts)};Level.prototype._get=function(key,options,callback){this.idb.get(key,function(value){if(value===undefined){return callback(new Error("NotFound"))}var asBuffer=true;if(options.asBuffer===false)asBuffer=false;if(options.raw)asBuffer=false;if(asBuffer){if(value instanceof Uint8Array)value=toBuffer(value);else value=new Buffer(String(value))}return callback(null,value,key)},callback)};Level.prototype._del=function(id,options,callback){this.idb.remove(id,callback,callback)};Level.prototype._put=function(key,value,options,callback){if(value instanceof ArrayBuffer){value=toBuffer(new Uint8Array(value))}var obj=this.convertEncoding(key,value,options);if(Buffer.isBuffer(obj.value)){obj.value=new Uint8Array(value.toArrayBuffer())}this.idb.put(obj.key,obj.value,function(){callback()},callback)};Level.prototype.convertEncoding=function(key,value,options){if(options.raw)return{key:key,value:value};if(value){var stringed=value.toString();if(stringed==="NaN")value="NaN"}var valEnc=options.valueEncoding;var obj={key:key,value:value};if(value&&(!valEnc||valEnc!=="binary")){if(typeof obj.value!=="object"){obj.value=stringed}}return obj};Level.prototype.iterator=function(options){if(typeof options!=="object")options={};return new Iterator(this.idb,options)};Level.prototype._batch=function(array,options,callback){var op;var i;var k;var copiedOp;var currentOp;var modified=[];if(array.length===0)return setTimeout(callback,0);for(i=0;i<array.length;i++){copiedOp={};currentOp=array[i];modified[i]=copiedOp;var converted=this.convertEncoding(currentOp.key,currentOp.value,options);currentOp.key=converted.key;currentOp.value=converted.value;for(k in currentOp){if(k==="type"&&currentOp[k]=="del"){copiedOp[k]="remove"}else{copiedOp[k]=currentOp[k]}}}return this.idb.batch(modified,function(){callback()},callback)};Level.prototype._close=function(callback){this.idb.db.close();callback()};Level.prototype._approximateSize=function(start,end,callback){var err=new Error("Not implemented");if(callback)return callback(err);throw err};Level.prototype._isBuffer=function(obj){return Buffer.isBuffer(obj)};Level.destroy=function(db,callback){if(typeof db==="object"){var prefix=db.IDBOptions.storePrefix||"IDBWrapper-";var dbname=db.location}else{var prefix="IDBWrapper-";var dbname=db}var request=indexedDB.deleteDatabase(prefix+dbname);request.onsuccess=function(){callback()};request.onerror=function(err){callback(err)}};var checkKeyValue=Level.prototype._checkKeyValue=function(obj,type){if(obj===null||obj===undefined)return new Error(type+" cannot be `null` or `undefined`");if(obj===null||obj===undefined)return new Error(type+" cannot be `null` or `undefined`");if(isBuffer(obj)&&obj.byteLength===0)return new Error(type+" cannot be an empty ArrayBuffer");if(String(obj)==="")return new Error(type+" cannot be an empty String");if(obj.length===0)return new Error(type+" cannot be an empty Array")}}).call(this,require("buffer").Buffer)},{"./iterator":345,"abstract-leveldown":348,buffer:2,"idb-wrapper":350,isbuffer:351,"typedarray-to-buffer":353,util:25,xtend:355}],345:[function(require,module,exports){var util=require("util");var AbstractIterator=require("abstract-leveldown").AbstractIterator;var ltgt=require("ltgt");module.exports=Iterator;function Iterator(db,options){if(!options)options={};this.options=options;AbstractIterator.call(this,db);this._order=options.reverse?"DESC":"ASC";this._limit=options.limit;this._count=0;this._done=false;var lower=ltgt.lowerBound(options);var upper=ltgt.upperBound(options);this._keyRange=lower||upper?this.db.makeKeyRange({lower:lower,upper:upper,excludeLower:ltgt.lowerBoundExclusive(options),excludeUpper:ltgt.upperBoundExclusive(options)}):null;this.callback=null}util.inherits(Iterator,AbstractIterator);Iterator.prototype.createIterator=function(){var self=this;self.iterator=self.db.iterate(function(){self.onItem.apply(self,arguments)},{keyRange:self._keyRange,autoContinue:false,order:self._order,onError:function(err){console.log("horrible error",err)}})};Iterator.prototype.onItem=function(value,cursor,cursorTransaction){if(!cursor&&this.callback){this.callback();this.callback=false;return}var shouldCall=true;if(!!this._limit&&this._limit>0&&this._count++>=this._limit)shouldCall=false;if(shouldCall)this.callback(false,cursor.key,cursor.value);if(cursor)cursor["continue"]()};Iterator.prototype._next=function(callback){if(!callback)return new Error("next() requires a callback argument");if(!this._started){this.createIterator();this._started=true}this.callback=callback}},{"abstract-leveldown":348,ltgt:352,util:25}],346:[function(require,module,exports){(function(process){function AbstractChainedBatch(db){this._db=db;this._operations=[];this._written=false}AbstractChainedBatch.prototype._checkWritten=function(){if(this._written)throw new Error("write() already called on this batch")};AbstractChainedBatch.prototype.put=function(key,value){this._checkWritten();var err=this._db._checkKeyValue(key,"key",this._db._isBuffer);if(err)throw err;err=this._db._checkKeyValue(value,"value",this._db._isBuffer);if(err)throw err;if(!this._db._isBuffer(key))key=String(key);if(!this._db._isBuffer(value))value=String(value);if(typeof this._put=="function")this._put(key,value);else this._operations.push({type:"put",key:key,value:value});return this};AbstractChainedBatch.prototype.del=function(key){this._checkWritten();var err=this._db._checkKeyValue(key,"key",this._db._isBuffer);if(err)throw err;if(!this._db._isBuffer(key))key=String(key);if(typeof this._del=="function")this._del(key);else this._operations.push({type:"del",key:key});return this};AbstractChainedBatch.prototype.clear=function(){this._checkWritten();this._operations=[];if(typeof this._clear=="function")this._clear();return this};AbstractChainedBatch.prototype.write=function(options,callback){this._checkWritten();
if(typeof options=="function")callback=options;if(typeof callback!="function")throw new Error("write() requires a callback argument");if(typeof options!="object")options={};this._written=true;if(typeof this._write=="function")return this._write(callback);if(typeof this._db._batch=="function")return this._db._batch(this._operations,options,callback);process.nextTick(callback)};module.exports=AbstractChainedBatch}).call(this,require("_process"))},{_process:10}],347:[function(require,module,exports){(function(process){function AbstractIterator(db){this.db=db;this._ended=false;this._nexting=false}AbstractIterator.prototype.next=function(callback){var self=this;if(typeof callback!="function")throw new Error("next() requires a callback argument");if(self._ended)return callback(new Error("cannot call next() after end()"));if(self._nexting)return callback(new Error("cannot call next() before previous next() has completed"));self._nexting=true;if(typeof self._next=="function"){return self._next(function(){self._nexting=false;callback.apply(null,arguments)})}process.nextTick(function(){self._nexting=false;callback()})};AbstractIterator.prototype.end=function(callback){if(typeof callback!="function")throw new Error("end() requires a callback argument");if(this._ended)return callback(new Error("end() already called on iterator"));this._ended=true;if(typeof this._end=="function")return this._end(callback);process.nextTick(callback)};module.exports=AbstractIterator}).call(this,require("_process"))},{_process:10}],348:[function(require,module,exports){(function(process,Buffer){var xtend=require("xtend"),AbstractIterator=require("./abstract-iterator"),AbstractChainedBatch=require("./abstract-chained-batch");function AbstractLevelDOWN(location){if(!arguments.length||location===undefined)throw new Error("constructor requires at least a location argument");if(typeof location!="string")throw new Error("constructor requires a location string argument");this.location=location}AbstractLevelDOWN.prototype.open=function(options,callback){if(typeof options=="function")callback=options;if(typeof callback!="function")throw new Error("open() requires a callback argument");if(typeof options!="object")options={};if(typeof this._open=="function")return this._open(options,callback);process.nextTick(callback)};AbstractLevelDOWN.prototype.close=function(callback){if(typeof callback!="function")throw new Error("close() requires a callback argument");if(typeof this._close=="function")return this._close(callback);process.nextTick(callback)};AbstractLevelDOWN.prototype.get=function(key,options,callback){var err;if(typeof options=="function")callback=options;if(typeof callback!="function")throw new Error("get() requires a callback argument");if(err=this._checkKeyValue(key,"key",this._isBuffer))return callback(err);if(!this._isBuffer(key))key=String(key);if(typeof options!="object")options={};if(typeof this._get=="function")return this._get(key,options,callback);process.nextTick(function(){callback(new Error("NotFound"))})};AbstractLevelDOWN.prototype.put=function(key,value,options,callback){var err;if(typeof options=="function")callback=options;if(typeof callback!="function")throw new Error("put() requires a callback argument");if(err=this._checkKeyValue(key,"key",this._isBuffer))return callback(err);if(err=this._checkKeyValue(value,"value",this._isBuffer))return callback(err);if(!this._isBuffer(key))key=String(key);if(!this._isBuffer(value)&&!process.browser)value=String(value);if(typeof options!="object")options={};if(typeof this._put=="function")return this._put(key,value,options,callback);process.nextTick(callback)};AbstractLevelDOWN.prototype.del=function(key,options,callback){var err;if(typeof options=="function")callback=options;if(typeof callback!="function")throw new Error("del() requires a callback argument");if(err=this._checkKeyValue(key,"key",this._isBuffer))return callback(err);if(!this._isBuffer(key))key=String(key);if(typeof options!="object")options={};if(typeof this._del=="function")return this._del(key,options,callback);process.nextTick(callback)};AbstractLevelDOWN.prototype.batch=function(array,options,callback){if(!arguments.length)return this._chainedBatch();if(typeof options=="function")callback=options;if(typeof callback!="function")throw new Error("batch(array) requires a callback argument");if(!Array.isArray(array))return callback(new Error("batch(array) requires an array argument"));if(typeof options!="object")options={};var i=0,l=array.length,e,err;for(;i<l;i++){e=array[i];if(typeof e!="object")continue;if(err=this._checkKeyValue(e.type,"type",this._isBuffer))return callback(err);if(err=this._checkKeyValue(e.key,"key",this._isBuffer))return callback(err);if(e.type=="put"){if(err=this._checkKeyValue(e.value,"value",this._isBuffer))return callback(err)}}if(typeof this._batch=="function")return this._batch(array,options,callback);process.nextTick(callback)};AbstractLevelDOWN.prototype.approximateSize=function(start,end,callback){if(start==null||end==null||typeof start=="function"||typeof end=="function"){throw new Error("approximateSize() requires valid `start`, `end` and `callback` arguments")}if(typeof callback!="function")throw new Error("approximateSize() requires a callback argument");if(!this._isBuffer(start))start=String(start);if(!this._isBuffer(end))end=String(end);if(typeof this._approximateSize=="function")return this._approximateSize(start,end,callback);process.nextTick(function(){callback(null,0)})};AbstractLevelDOWN.prototype._setupIteratorOptions=function(options){var self=this;options=xtend(options);["start","end","gt","gte","lt","lte"].forEach(function(o){if(options[o]&&self._isBuffer(options[o])&&options[o].length===0)delete options[o]});options.reverse=!!options.reverse;if(options.reverse&&options.lt)options.start=options.lt;if(options.reverse&&options.lte)options.start=options.lte;if(!options.reverse&&options.gt)options.start=options.gt;if(!options.reverse&&options.gte)options.start=options.gte;if(options.reverse&&options.lt&&!options.lte||!options.reverse&&options.gt&&!options.gte)options.exclusiveStart=true;return options};AbstractLevelDOWN.prototype.iterator=function(options){if(typeof options!="object")options={};options=this._setupIteratorOptions(options);if(typeof this._iterator=="function")return this._iterator(options);return new AbstractIterator(this)};AbstractLevelDOWN.prototype._chainedBatch=function(){return new AbstractChainedBatch(this)};AbstractLevelDOWN.prototype._isBuffer=function(obj){return Buffer.isBuffer(obj)};AbstractLevelDOWN.prototype._checkKeyValue=function(obj,type){if(obj===null||obj===undefined)return new Error(type+" cannot be `null` or `undefined`");if(this._isBuffer(obj)){if(obj.length===0)return new Error(type+" cannot be an empty Buffer")}else if(String(obj)==="")return new Error(type+" cannot be an empty String")};module.exports.AbstractLevelDOWN=AbstractLevelDOWN;module.exports.AbstractIterator=AbstractIterator;module.exports.AbstractChainedBatch=AbstractChainedBatch}).call(this,require("_process"),require("buffer").Buffer)},{"./abstract-chained-batch":346,"./abstract-iterator":347,_process:10,buffer:2,xtend:349}],349:[function(require,module,exports){module.exports=extend;function extend(){var target={};for(var i=0;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(source.hasOwnProperty(key)){target[key]=source[key]}}}return target}},{}],350:[function(require,module,exports){(function(name,definition,global){if(typeof define==="function"){define(definition)}else if(typeof module!=="undefined"&&module.exports){module.exports=definition()}else{global[name]=definition()}})("IDBStore",function(){"use strict";var defaultErrorHandler=function(error){throw error};var defaults={storeName:"Store",storePrefix:"IDBWrapper-",dbVersion:1,keyPath:"id",autoIncrement:true,onStoreReady:function(){},onError:defaultErrorHandler,indexes:[]};var IDBStore=function(kwArgs,onStoreReady){if(typeof onStoreReady=="undefined"&&typeof kwArgs=="function"){onStoreReady=kwArgs}if(Object.prototype.toString.call(kwArgs)!="[object Object]"){kwArgs={}}for(var key in defaults){this[key]=typeof kwArgs[key]!="undefined"?kwArgs[key]:defaults[key]}this.dbName=this.storePrefix+this.storeName;this.dbVersion=parseInt(this.dbVersion,10)||1;onStoreReady&&(this.onStoreReady=onStoreReady);var env=typeof window=="object"?window:self;this.idb=env.indexedDB||env.webkitIndexedDB||env.mozIndexedDB;this.keyRange=env.IDBKeyRange||env.webkitIDBKeyRange||env.mozIDBKeyRange;this.features={hasAutoIncrement:!env.mozIndexedDB};this.consts={READ_ONLY:"readonly",READ_WRITE:"readwrite",VERSION_CHANGE:"versionchange",NEXT:"next",NEXT_NO_DUPLICATE:"nextunique",PREV:"prev",PREV_NO_DUPLICATE:"prevunique"};this.openDB()};IDBStore.prototype={constructor:IDBStore,version:"1.4.1",db:null,dbName:null,dbVersion:null,store:null,storeName:null,keyPath:null,autoIncrement:null,indexes:null,features:null,onStoreReady:null,onError:null,_insertIdCount:0,openDB:function(){var openRequest=this.idb.open(this.dbName,this.dbVersion);var preventSuccessCallback=false;openRequest.onerror=function(error){var gotVersionErr=false;if("error"in error.target){gotVersionErr=error.target.error.name=="VersionError"}else if("errorCode"in error.target){gotVersionErr=error.target.errorCode==12}if(gotVersionErr){this.onError(new Error("The version number provided is lower than the existing one."))}else{this.onError(error)}}.bind(this);openRequest.onsuccess=function(event){if(preventSuccessCallback){return}if(this.db){this.onStoreReady();return}this.db=event.target.result;if(typeof this.db.version=="string"){this.onError(new Error("The IndexedDB implementation in this browser is outdated. Please upgrade your browser."));return}if(!this.db.objectStoreNames.contains(this.storeName)){this.onError(new Error("Something is wrong with the IndexedDB implementation in this browser. Please upgrade your browser."));return}var emptyTransaction=this.db.transaction([this.storeName],this.consts.READ_ONLY);this.store=emptyTransaction.objectStore(this.storeName);var existingIndexes=Array.prototype.slice.call(this.getIndexList());this.indexes.forEach(function(indexData){var indexName=indexData.name;if(!indexName){preventSuccessCallback=true;this.onError(new Error("Cannot create index: No index name given."));return}this.normalizeIndexData(indexData);if(this.hasIndex(indexName)){var actualIndex=this.store.index(indexName);var complies=this.indexComplies(actualIndex,indexData);if(!complies){preventSuccessCallback=true;this.onError(new Error('Cannot modify index "'+indexName+'" for current version. Please bump version number to '+(this.dbVersion+1)+"."))}existingIndexes.splice(existingIndexes.indexOf(indexName),1)}else{preventSuccessCallback=true;this.onError(new Error('Cannot create new index "'+indexName+'" for current version. Please bump version number to '+(this.dbVersion+1)+"."))}},this);if(existingIndexes.length){preventSuccessCallback=true;this.onError(new Error('Cannot delete index(es) "'+existingIndexes.toString()+'" for current version. Please bump version number to '+(this.dbVersion+1)+"."))}preventSuccessCallback||this.onStoreReady()}.bind(this);openRequest.onupgradeneeded=function(event){this.db=event.target.result;if(this.db.objectStoreNames.contains(this.storeName)){this.store=event.target.transaction.objectStore(this.storeName)}else{var optionalParameters={autoIncrement:this.autoIncrement};if(this.keyPath!==null){optionalParameters.keyPath=this.keyPath}this.store=this.db.createObjectStore(this.storeName,optionalParameters)}var existingIndexes=Array.prototype.slice.call(this.getIndexList());this.indexes.forEach(function(indexData){var indexName=indexData.name;if(!indexName){preventSuccessCallback=true;this.onError(new Error("Cannot create index: No index name given."))}this.normalizeIndexData(indexData);if(this.hasIndex(indexName)){var actualIndex=this.store.index(indexName);var complies=this.indexComplies(actualIndex,indexData);if(!complies){this.store.deleteIndex(indexName);this.store.createIndex(indexName,indexData.keyPath,{unique:indexData.unique,multiEntry:indexData.multiEntry})}existingIndexes.splice(existingIndexes.indexOf(indexName),1)}else{this.store.createIndex(indexName,indexData.keyPath,{unique:indexData.unique,multiEntry:indexData.multiEntry})}},this);if(existingIndexes.length){existingIndexes.forEach(function(_indexName){this.store.deleteIndex(_indexName)},this)}}.bind(this)},deleteDatabase:function(){if(this.idb.deleteDatabase){this.idb.deleteDatabase(this.dbName)}},put:function(key,value,onSuccess,onError){if(this.keyPath!==null){onError=onSuccess;onSuccess=value;value=key}onError||(onError=defaultErrorHandler);onSuccess||(onSuccess=noop);var hasSuccess=false,result=null,putRequest;var putTransaction=this.db.transaction([this.storeName],this.consts.READ_WRITE);putTransaction.oncomplete=function(){var callback=hasSuccess?onSuccess:onError;callback(result)};putTransaction.onabort=onError;putTransaction.onerror=onError;if(this.keyPath!==null){this._addIdPropertyIfNeeded(value);putRequest=putTransaction.objectStore(this.storeName).put(value)}else{putRequest=putTransaction.objectStore(this.storeName).put(value,key)}putRequest.onsuccess=function(event){hasSuccess=true;result=event.target.result};putRequest.onerror=onError;return putTransaction},get:function(key,onSuccess,onError){onError||(onError=defaultErrorHandler);onSuccess||(onSuccess=noop);var hasSuccess=false,result=null;var getTransaction=this.db.transaction([this.storeName],this.consts.READ_ONLY);getTransaction.oncomplete=function(){var callback=hasSuccess?onSuccess:onError;callback(result)};getTransaction.onabort=onError;getTransaction.onerror=onError;var getRequest=getTransaction.objectStore(this.storeName).get(key);getRequest.onsuccess=function(event){hasSuccess=true;result=event.target.result};getRequest.onerror=onError;return getTransaction},remove:function(key,onSuccess,onError){onError||(onError=defaultErrorHandler);onSuccess||(onSuccess=noop);var hasSuccess=false,result=null;var removeTransaction=this.db.transaction([this.storeName],this.consts.READ_WRITE);removeTransaction.oncomplete=function(){var callback=hasSuccess?onSuccess:onError;callback(result)};removeTransaction.onabort=onError;removeTransaction.onerror=onError;var deleteRequest=removeTransaction.objectStore(this.storeName)["delete"](key);deleteRequest.onsuccess=function(event){hasSuccess=true;result=event.target.result};deleteRequest.onerror=onError;return removeTransaction},batch:function(dataArray,onSuccess,onError){onError||(onError=defaultErrorHandler);onSuccess||(onSuccess=noop);if(Object.prototype.toString.call(dataArray)!="[object Array]"){onError(new Error("dataArray argument must be of type Array."))}var batchTransaction=this.db.transaction([this.storeName],this.consts.READ_WRITE);batchTransaction.oncomplete=function(){var callback=hasSuccess?onSuccess:onError;callback(hasSuccess)};batchTransaction.onabort=onError;batchTransaction.onerror=onError;var count=dataArray.length;var called=false;var hasSuccess=false;var onItemSuccess=function(){count--;if(count===0&&!called){called=true;hasSuccess=true}};dataArray.forEach(function(operation){var type=operation.type;var key=operation.key;var value=operation.value;var onItemError=function(err){batchTransaction.abort();if(!called){called=true;onError(err,type,key)}};if(type=="remove"){var deleteRequest=batchTransaction.objectStore(this.storeName)["delete"](key);deleteRequest.onsuccess=onItemSuccess;deleteRequest.onerror=onItemError}else if(type=="put"){var putRequest;if(this.keyPath!==null){this._addIdPropertyIfNeeded(value);putRequest=batchTransaction.objectStore(this.storeName).put(value)}else{putRequest=batchTransaction.objectStore(this.storeName).put(value,key)}putRequest.onsuccess=onItemSuccess;putRequest.onerror=onItemError}},this);return batchTransaction},putBatch:function(dataArray,onSuccess,onError){var batchData=dataArray.map(function(item){return{type:"put",value:item}});return this.batch(batchData,onSuccess,onError)},removeBatch:function(keyArray,onSuccess,onError){var batchData=keyArray.map(function(key){return{type:"remove",key:key}});return this.batch(batchData,onSuccess,onError)},getBatch:function(keyArray,onSuccess,onError,arrayType){onError||(onError=defaultErrorHandler);onSuccess||(onSuccess=noop);arrayType||(arrayType="sparse");if(Object.prototype.toString.call(keyArray)!="[object Array]"){onError(new Error("keyArray argument must be of type Array."))}var batchTransaction=this.db.transaction([this.storeName],this.consts.READ_ONLY);batchTransaction.oncomplete=function(){var callback=hasSuccess?onSuccess:onError;callback(result)};batchTransaction.onabort=onError;batchTransaction.onerror=onError;var data=[];var count=keyArray.length;var called=false;var hasSuccess=false;var result=null;var onItemSuccess=function(event){if(event.target.result||arrayType=="dense"){data.push(event.target.result)}else if(arrayType=="sparse"){data.length++}count--;if(count===0){called=true;hasSuccess=true;result=data}};keyArray.forEach(function(key){var onItemError=function(err){called=true;result=err;onError(err);batchTransaction.abort()};var getRequest=batchTransaction.objectStore(this.storeName).get(key);getRequest.onsuccess=onItemSuccess;getRequest.onerror=onItemError},this);return batchTransaction},getAll:function(onSuccess,onError){onError||(onError=defaultErrorHandler);onSuccess||(onSuccess=noop);var getAllTransaction=this.db.transaction([this.storeName],this.consts.READ_ONLY);var store=getAllTransaction.objectStore(this.storeName);if(store.getAll){this._getAllNative(getAllTransaction,store,onSuccess,onError)}else{this._getAllCursor(getAllTransaction,store,onSuccess,onError)}return getAllTransaction},_getAllNative:function(getAllTransaction,store,onSuccess,onError){var hasSuccess=false,result=null;getAllTransaction.oncomplete=function(){var callback=hasSuccess?onSuccess:onError;callback(result)};getAllTransaction.onabort=onError;getAllTransaction.onerror=onError;var getAllRequest=store.getAll();getAllRequest.onsuccess=function(event){hasSuccess=true;result=event.target.result};getAllRequest.onerror=onError},_getAllCursor:function(getAllTransaction,store,onSuccess,onError){var all=[],hasSuccess=false,result=null;getAllTransaction.oncomplete=function(){var callback=hasSuccess?onSuccess:onError;callback(result)};getAllTransaction.onabort=onError;getAllTransaction.onerror=onError;var cursorRequest=store.openCursor();cursorRequest.onsuccess=function(event){var cursor=event.target.result;if(cursor){all.push(cursor.value);cursor["continue"]()}else{hasSuccess=true;result=all}};cursorRequest.onError=onError},clear:function(onSuccess,onError){onError||(onError=defaultErrorHandler);onSuccess||(onSuccess=noop);var hasSuccess=false,result=null;var clearTransaction=this.db.transaction([this.storeName],this.consts.READ_WRITE);clearTransaction.oncomplete=function(){var callback=hasSuccess?onSuccess:onError;callback(result)};clearTransaction.onabort=onError;clearTransaction.onerror=onError;var clearRequest=clearTransaction.objectStore(this.storeName).clear();clearRequest.onsuccess=function(event){hasSuccess=true;result=event.target.result};clearRequest.onerror=onError;return clearTransaction},_addIdPropertyIfNeeded:function(dataObj){if(!this.features.hasAutoIncrement&&typeof dataObj[this.keyPath]=="undefined"){dataObj[this.keyPath]=this._insertIdCount++ +Date.now()}},getIndexList:function(){return this.store.indexNames},hasIndex:function(indexName){return this.store.indexNames.contains(indexName)},normalizeIndexData:function(indexData){indexData.keyPath=indexData.keyPath||indexData.name;indexData.unique=!!indexData.unique;indexData.multiEntry=!!indexData.multiEntry},indexComplies:function(actual,expected){var complies=["keyPath","unique","multiEntry"].every(function(key){if(key=="multiEntry"&&actual[key]===undefined&&expected[key]===false){return true}if(key=="keyPath"&&Object.prototype.toString.call(expected[key])=="[object Array]"){var exp=expected.keyPath;var act=actual.keyPath;if(typeof act=="string"){return exp.toString()==act}if(!(typeof act.contains=="function"||typeof act.indexOf=="function")){return false}if(act.length!==exp.length){return false}for(var i=0,m=exp.length;i<m;i++){if(!(act.contains&&act.contains(exp[i])||act.indexOf(exp[i]!==-1))){return false}}return true}return expected[key]==actual[key]});return complies},iterate:function(onItem,options){options=mixin({index:null,order:"ASC",autoContinue:true,filterDuplicates:false,keyRange:null,writeAccess:false,onEnd:null,onError:defaultErrorHandler},options||{});var directionType=options.order.toLowerCase()=="desc"?"PREV":"NEXT";if(options.filterDuplicates){directionType+="_NO_DUPLICATE"}var hasSuccess=false;var cursorTransaction=this.db.transaction([this.storeName],this.consts[options.writeAccess?"READ_WRITE":"READ_ONLY"]);var cursorTarget=cursorTransaction.objectStore(this.storeName);if(options.index){cursorTarget=cursorTarget.index(options.index)}cursorTransaction.oncomplete=function(){if(!hasSuccess){options.onError(null);return}if(options.onEnd){options.onEnd()}else{onItem(null)}};cursorTransaction.onabort=options.onError;cursorTransaction.onerror=options.onError;var cursorRequest=cursorTarget.openCursor(options.keyRange,this.consts[directionType]);cursorRequest.onerror=options.onError;cursorRequest.onsuccess=function(event){var cursor=event.target.result;if(cursor){onItem(cursor.value,cursor,cursorTransaction);if(options.autoContinue){cursor["continue"]()}}else{hasSuccess=true}};return cursorTransaction},query:function(onSuccess,options){var result=[];options=options||{};options.onEnd=function(){onSuccess(result)};return this.iterate(function(item){result.push(item)},options)},count:function(onSuccess,options){options=mixin({index:null,keyRange:null},options||{});var onError=options.onError||defaultErrorHandler;var hasSuccess=false,result=null;var cursorTransaction=this.db.transaction([this.storeName],this.consts.READ_ONLY);cursorTransaction.oncomplete=function(){var callback=hasSuccess?onSuccess:onError;callback(result)};cursorTransaction.onabort=onError;cursorTransaction.onerror=onError;var cursorTarget=cursorTransaction.objectStore(this.storeName);if(options.index){cursorTarget=cursorTarget.index(options.index)}var countRequest=cursorTarget.count(options.keyRange);countRequest.onsuccess=function(evt){hasSuccess=true;result=evt.target.result};countRequest.onError=onError;return cursorTransaction},makeKeyRange:function(options){var keyRange,hasLower=typeof options.lower!="undefined",hasUpper=typeof options.upper!="undefined",isOnly=typeof options.only!="undefined";switch(true){case isOnly:keyRange=this.keyRange.only(options.only);break;case hasLower&&hasUpper:keyRange=this.keyRange.bound(options.lower,options.upper,options.excludeLower,options.excludeUpper);break;case hasLower:keyRange=this.keyRange.lowerBound(options.lower,options.excludeLower);break;case hasUpper:keyRange=this.keyRange.upperBound(options.upper,options.excludeUpper);break;default:throw new Error('Cannot create KeyRange. Provide one or both of "lower" or "upper" value, or an "only" value.')}return keyRange}};var noop=function(){};var empty={};var mixin=function(target,source){var name,s;for(name in source){s=source[name];if(s!==empty[name]&&s!==target[name]){target[name]=s}}return target};IDBStore.version=IDBStore.prototype.version;return IDBStore},this)},{}],351:[function(require,module,exports){var Buffer=require("buffer").Buffer;module.exports=isBuffer;function isBuffer(o){return Buffer.isBuffer(o)||/\[object (.+Array|Array.+)\]/.test(Object.prototype.toString.call(o))}},{buffer:2}],352:[function(require,module,exports){(function(Buffer){exports.compare=function(a,b){if(Buffer.isBuffer(a)){var l=Math.min(a.length,b.length);for(var i=0;i<l;i++){var cmp=a[i]-b[i];if(cmp)return cmp}return a.length-b.length}return a<b?-1:a>b?1:0};function has(obj,key){return Object.hasOwnProperty.call(obj,key)}function isDef(val){return val!==undefined&&val!==""}function has(range,name){return Object.hasOwnProperty.call(range,name)}function hasKey(range,name){return Object.hasOwnProperty.call(range,name)&&name}var lowerBoundKey=exports.lowerBoundKey=function(range){return hasKey(range,"gt")||hasKey(range,"gte")||hasKey(range,"min")||(range.reverse?hasKey(range,"end"):hasKey(range,"start"))||undefined};var lowerBound=exports.lowerBound=function(range){var k=lowerBoundKey(range);return k&&range[k];return has(range,"gt")?range.gt:has(range,"gte")?range.gte:has(range,"min")?range.min:has(range,"start")&&!range.reverse?range.start:has(range,"end")&&range.reverse?range.end:undefined};exports.lowerBoundInclusive=function(range){return has(range,"gt")?false:true};exports.upperBoundInclusive=function(range){return has(range,"lt")||!range.minEx?false:true};var lowerBoundExclusive=exports.lowerBoundExclusive=function(range){return has(range,"gt")||range.minEx?true:false};var upperBoundExclusive=exports.upperBoundExclusive=function(range){return has(range,"lt")?true:false};var upperBoundKey=exports.upperBoundKey=function(range){return hasKey(range,"lt")||hasKey(range,"lte")||hasKey(range,"max")||(range.reverse?hasKey(range,"start"):hasKey(range,"end"))||undefined};var upperBound=exports.upperBound=function(range){var k=upperBoundKey(range);return k&&range[k]};function id(e){return e}exports.toLtgt=function(range,_range,map,lower,upper){_range=_range||{};map=map||id;var defaults=arguments.length>3;var lb=exports.lowerBoundKey(range);var ub=exports.upperBoundKey(range);if(lb){if(lb==="gt")_range.gt=map(range.gt);else _range.gte=map(range[lb])}else if(defaults)_range.gte=lower;if(ub){if(ub==="lt")_range.lt=map(range.lt);else _range.lte=map(range[ub])}else if(defaults)_range.lte=upper;_range.reverse=!!range.reverse;return _range};exports.contains=function(range,key,compare){compare=compare||exports.compare;var lb=lowerBound(range);if(isDef(lb)){var cmp=compare(key,lb);if(cmp<0||cmp===0&&lowerBoundExclusive(range))return false}var ub=upperBound(range);if(isDef(ub)){var cmp=compare(key,ub);if(cmp>0||cmp===0&&upperBoundExclusive(range))return false}return true};exports.filter=function(range,compare){return function(key){return exports.contains(range,key,compare)}}}).call(this,require("buffer").Buffer)},{buffer:2}],353:[function(require,module,exports){(function(Buffer){module.exports=function(arr){if(typeof Buffer._augment==="function"&&Buffer.TYPED_ARRAY_SUPPORT){return Buffer._augment(arr)}else{return new Buffer(arr)}}}).call(this,require("buffer").Buffer)},{buffer:2}],354:[function(require,module,exports){module.exports=hasKeys;function hasKeys(source){return source!==null&&(typeof source==="object"||typeof source==="function")}},{}],355:[function(require,module,exports){var Keys=require("object-keys");var hasKeys=require("./has-keys");module.exports=extend;function extend(){var target={};for(var i=0;i<arguments.length;i++){var source=arguments[i];if(!hasKeys(source)){continue}var keys=Keys(source);for(var j=0;j<keys.length;j++){var name=keys[j];target[name]=source[name]}}return target}},{"./has-keys":354,"object-keys":357}],356:[function(require,module,exports){var hasOwn=Object.prototype.hasOwnProperty;var toString=Object.prototype.toString;var isFunction=function(fn){var isFunc=typeof fn==="function"&&!(fn instanceof RegExp)||toString.call(fn)==="[object Function]";if(!isFunc&&typeof window!=="undefined"){isFunc=fn===window.setTimeout||fn===window.alert||fn===window.confirm||fn===window.prompt}return isFunc};module.exports=function forEach(obj,fn){if(!isFunction(fn)){throw new TypeError("iterator must be a function")}var i,k,isString=typeof obj==="string",l=obj.length,context=arguments.length>2?arguments[2]:null;if(l===+l){for(i=0;i<l;i++){if(context===null){fn(isString?obj.charAt(i):obj[i],i,obj)}else{fn.call(context,isString?obj.charAt(i):obj[i],i,obj)}}}else{for(k in obj){if(hasOwn.call(obj,k)){if(context===null){fn(obj[k],k,obj)}else{fn.call(context,obj[k],k,obj)}}}}}},{}],357:[function(require,module,exports){module.exports=Object.keys||require("./shim")},{"./shim":359}],358:[function(require,module,exports){var toString=Object.prototype.toString;module.exports=function isArguments(value){var str=toString.call(value);var isArguments=str==="[object Arguments]";if(!isArguments){isArguments=str!=="[object Array]"&&value!==null&&typeof value==="object"&&typeof value.length==="number"&&value.length>=0&&toString.call(value.callee)==="[object Function]"}return isArguments}},{}],359:[function(require,module,exports){(function(){"use strict";var has=Object.prototype.hasOwnProperty,toString=Object.prototype.toString,forEach=require("./foreach"),isArgs=require("./isArguments"),hasDontEnumBug=!{toString:null}.propertyIsEnumerable("toString"),hasProtoEnumBug=function(){}.propertyIsEnumerable("prototype"),dontEnums=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],keysShim;keysShim=function keys(object){var isObject=object!==null&&typeof object==="object",isFunction=toString.call(object)==="[object Function]",isArguments=isArgs(object),theKeys=[];if(!isObject&&!isFunction&&!isArguments){throw new TypeError("Object.keys called on a non-object")}if(isArguments){forEach(object,function(value){theKeys.push(value)})}else{var name,skipProto=hasProtoEnumBug&&isFunction;for(name in object){if(!(skipProto&&name==="prototype")&&has.call(object,name)){theKeys.push(name)}}}if(hasDontEnumBug){var ctor=object.constructor,skipConstructor=ctor&&ctor.prototype===object;forEach(dontEnums,function(dontEnum){if(!(skipConstructor&&dontEnum==="constructor")&&has.call(object,dontEnum)){theKeys.push(dontEnum)}})}return theKeys};module.exports=keysShim})()},{"./foreach":356,"./isArguments":358}],360:[function(require,module,exports){var util=require("./util"),WriteError=require("./errors").WriteError,getOptions=util.getOptions,dispatchError=util.dispatchError;function Batch(levelup,codec){this._levelup=levelup;this._codec=codec;this.batch=levelup.db.batch();this.ops=[]}Batch.prototype.put=function(key_,value_,options){options=getOptions(this._levelup,options);var key=this._codec.encodeKey(key_,options),value=this._codec.encodeValue(value_,options);try{this.batch.put(key,value)}catch(e){throw new WriteError(e)}this.ops.push({type:"put",key:key,value:value});return this};Batch.prototype.del=function(key_,options){options=getOptions(this._levelup,options);var key=this._codec.encodeKey(key_,options);try{this.batch.del(key)}catch(err){throw new WriteError(err)}this.ops.push({type:"del",key:key});return this};Batch.prototype.clear=function(){try{this.batch.clear()}catch(err){throw new WriteError(err)}this.ops=[];return this};Batch.prototype.write=function(callback){var levelup=this._levelup,ops=this.ops;try{this.batch.write(function(err){if(err)return dispatchError(levelup,new WriteError(err),callback);levelup.emit("batch",ops);if(callback)callback()})}catch(err){throw new WriteError(err)}};module.exports=Batch},{"./errors":363,"./util":366}],361:[function(require,module,exports){var encodings=require("./encodings");function getKeyEncoder(options,op){var type=op&&op.keyEncoding||options.keyEncoding||"utf8";return encodings[type]||type}function getValueEncoder(options,op){var type=op&&(op.valueEncoding||op.encoding)||options.valueEncoding||options.encoding||"utf8";return encodings[type]||type}function encodeKey(key,options,op){return getKeyEncoder(options,op).encode(key)}function encodeValue(value,options,op){return getValueEncoder(options,op).encode(value)}function decodeKey(key,options){return getKeyEncoder(options).decode(key)}function decodeValue(value,options){return getValueEncoder(options).decode(value)}function isValueAsBuffer(options,op){return getValueEncoder(options,op).buffer}function isKeyAsBuffer(options,op){return getKeyEncoder(options,op).buffer}module.exports={encodeKey:encodeKey,encodeValue:encodeValue,isValueAsBuffer:isValueAsBuffer,isKeyAsBuffer:isKeyAsBuffer,decodeValue:decodeValue,decodeKey:decodeKey}
},{"./encodings":362}],362:[function(require,module,exports){(function(Buffer){var encodingNames=["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le"];module.exports=function(){function isBinary(data){return data===undefined||data===null||Buffer.isBuffer(data)}var encodings={};encodings.utf8=encodings["utf-8"]={encode:function(data){return isBinary(data)?data:String(data)},decode:function(data){return data},buffer:false,type:"utf8"};encodings.json={encode:JSON.stringify,decode:JSON.parse,buffer:false,type:"json"};encodings.binary={encode:function(data){return isBinary(data)?data:new Buffer(data)},decode:function(data){return data},buffer:true,type:"binary"};encodingNames.forEach(function(type){if(encodings[type])return;encodings[type]={encode:function(data){return isBinary(data)?data:new Buffer(data,type)},decode:function(buffer){return buffer.toString(type)},buffer:true,type:type}});return encodings}()}).call(this,require("buffer").Buffer)},{buffer:2}],363:[function(require,module,exports){var createError=require("errno").create,LevelUPError=createError("LevelUPError"),NotFoundError=createError("NotFoundError",LevelUPError);NotFoundError.prototype.notFound=true;NotFoundError.prototype.status=404;module.exports={LevelUPError:LevelUPError,InitializationError:createError("InitializationError",LevelUPError),OpenError:createError("OpenError",LevelUPError),ReadError:createError("ReadError",LevelUPError),WriteError:createError("WriteError",LevelUPError),NotFoundError:NotFoundError,EncodingError:createError("EncodingError",LevelUPError)}},{errno:374}],364:[function(require,module,exports){(function(process){var EventEmitter=require("events").EventEmitter,inherits=require("util").inherits,extend=require("xtend"),prr=require("prr"),DeferredLevelDOWN=require("deferred-leveldown"),WriteError=require("./errors").WriteError,ReadError=require("./errors").ReadError,NotFoundError=require("./errors").NotFoundError,OpenError=require("./errors").OpenError,EncodingError=require("./errors").EncodingError,InitializationError=require("./errors").InitializationError,ReadStream=require("./read-stream"),WriteStream=require("./write-stream"),util=require("./util"),Batch=require("./batch"),codec=require("./codec"),getOptions=util.getOptions,defaultOptions=util.defaultOptions,getLevelDOWN=util.getLevelDOWN,dispatchError=util.dispatchError,isDefined=util.isDefined;function getCallback(options,callback){return typeof options=="function"?options:callback}function LevelUP(location,options,callback){if(!(this instanceof LevelUP))return new LevelUP(location,options,callback);var error;EventEmitter.call(this);this.setMaxListeners(Infinity);if(typeof location=="function"){options=typeof options=="object"?options:{};options.db=location;location=null}else if(typeof location=="object"&&typeof location.db=="function"){options=location;location=null}if(typeof options=="function"){callback=options;options={}}if((!options||typeof options.db!="function")&&typeof location!="string"){error=new InitializationError("Must provide a location for the database");if(callback){return process.nextTick(function(){callback(error)})}throw error}options=getOptions(this,options);this.options=extend(defaultOptions,options);this._codec=options.codec||codec;this._status="new";prr(this,"location",location,"e");this.open(callback)}inherits(LevelUP,EventEmitter);LevelUP.prototype.open=function(callback){var self=this,dbFactory,db;if(this.isOpen()){if(callback)process.nextTick(function(){callback(null,self)});return this}if(this._isOpening()){return callback&&this.once("open",function(){callback(null,self)})}this.emit("opening");this._status="opening";this.db=new DeferredLevelDOWN(this.location);dbFactory=this.options.db||getLevelDOWN();db=dbFactory(this.location);db.open(this.options,function(err){if(err){return dispatchError(self,new OpenError(err),callback)}else{self.db.setDb(db);self.db=db;self._status="open";if(callback)callback(null,self);self.emit("open");self.emit("ready")}})};LevelUP.prototype.close=function(callback){var self=this;if(this.isOpen()){this._status="closing";this.db.close(function(){self._status="closed";self.emit("closed");if(callback)callback.apply(null,arguments)});this.emit("closing");this.db=null}else if(this._status=="closed"&&callback){return process.nextTick(callback)}else if(this._status=="closing"&&callback){this.once("closed",callback)}else if(this._isOpening()){this.once("open",function(){self.close(callback)})}};LevelUP.prototype.isOpen=function(){return this._status=="open"};LevelUP.prototype._isOpening=function(){return this._status=="opening"};LevelUP.prototype.isClosed=function(){return/^clos/.test(this._status)};function maybeError(db,options,callback){if(!db._isOpening()&&!db.isOpen()){dispatchError(db,new ReadError("Database is not open"),callback);return true}}function writeError(db,message,callback){dispatchError(db,new WriteError(message),callback)}function readError(db,message,callback){dispatchError(db,new ReadError(message),callback);return true}LevelUP.prototype.get=function(key_,options,callback){var self=this,key;callback=getCallback(options,callback);if(maybeError(this,options,callback))return;if(key_===null||key_===undefined||"function"!==typeof callback)return readError(this,"get() requires key and callback arguments",callback);options=util.getOptions(this,options);key=this._codec.encodeKey(key_,options);options.asBuffer=this._codec.isValueAsBuffer(options);this.db.get(key,options,function(err,value){if(err){if(/notfound/i.test(err)){err=new NotFoundError("Key not found in database ["+key_+"]",err)}else{err=new ReadError(err)}return dispatchError(self,err,callback)}if(callback){try{value=self._codec.decodeValue(value,options)}catch(e){return callback(new EncodingError(e))}callback(null,value)}})};LevelUP.prototype.put=function(key_,value_,options,callback){var self=this,key,value;callback=getCallback(options,callback);if(key_===null||key_===undefined||value_===null||value_===undefined)return writeError(this,"put() requires key and value arguments",callback);if(maybeError(this,options,callback))return;options=getOptions(this,options);key=this._codec.encodeKey(key_,options);value=this._codec.encodeValue(value_,options);this.db.put(key,value,options,function(err){if(err){return dispatchError(self,new WriteError(err),callback)}else{self.emit("put",key_,value_);if(callback)callback()}})};LevelUP.prototype.del=function(key_,options,callback){var self=this,key;callback=getCallback(options,callback);if(key_===null||key_===undefined)return writeError(this,"del() requires a key argument",callback);if(maybeError(this,options,callback))return;options=getOptions(this,options);key=this._codec.encodeKey(key_,options);this.db.del(key,options,function(err){if(err){return dispatchError(self,new WriteError(err),callback)}else{self.emit("del",key_);if(callback)callback()}})};LevelUP.prototype.batch=function(arr_,options,callback){var self=this,keyEnc,valueEnc,arr;if(!arguments.length)return new Batch(this,codec);callback=getCallback(options,callback);if(!Array.isArray(arr_))return writeError(this,"batch() requires an array argument",callback);if(maybeError(this,options,callback))return;options=getOptions(this,options);keyEnc=options.keyEncoding;valueEnc=options.valueEncoding;arr=arr_.map(function(e){if(e.type===undefined||e.key===undefined)return{};var kEnc=e.keyEncoding||keyEnc,vEnc=e.valueEncoding||e.encoding||valueEnc,o;if(kEnc!="utf8"&&kEnc!="binary"||vEnc!="utf8"&&vEnc!="binary"){o={type:e.type,key:self._codec.encodeKey(e.key,options,e)};if(e.value!==undefined)o.value=self._codec.encodeValue(e.value,options,e);return o}else{return e}});this.db.batch(arr,options,function(err){if(err){return dispatchError(self,new WriteError(err),callback)}else{self.emit("batch",arr_);if(callback)callback()}})};LevelUP.prototype.approximateSize=function(start_,end_,options,callback){var self=this,start,end;callback=getCallback(options,callback);options=getOptions(options,callback);if(start_===null||start_===undefined||end_===null||end_===undefined||"function"!==typeof callback)return readError(this,"approximateSize() requires start, end and callback arguments",callback);start=this._codec.encodeKey(start_,this.options);end=this._codec.encodeKey(end_,this.options);this.db.approximateSize(start,end,function(err,size){if(err){return dispatchError(self,new OpenError(err),callback)}else if(callback){callback(null,size)}})};LevelUP.prototype.readStream=LevelUP.prototype.createReadStream=function(options){var self=this;options=extend({keys:true,values:true},this.options,options);options.keyEncoding=options.keyEncoding||options.encoding;options.valueEncoding=options.valueEncoding||options.encoding;if(isDefined(options.start))options.start=this._codec.encodeKey(options.start,options);if(isDefined(options.end))options.end=this._codec.encodeKey(options.end,options);if(isDefined(options.gte))options.gte=this._codec.encodeKey(options.gte,options);if(isDefined(options.gt))options.gt=this._codec.encodeKey(options.gt,options);if(isDefined(options.lte))options.lte=this._codec.encodeKey(options.lte,options);if(isDefined(options.lt))options.lt=this._codec.encodeKey(options.lt,options);if("number"!==typeof options.limit)options.limit=-1;options.keyAsBuffer=this._codec.isKeyAsBuffer(options);options.valueAsBuffer=this._codec.isValueAsBuffer(options);var makeData=options.keys&&options.values?function(key,value){return{key:self._codec.decodeKey(key,options),value:self._codec.decodeValue(value,options)}}:options.keys?function(key){return self._codec.decodeKey(key,options)}:options.values?function(_,value){return self._codec.decodeValue(value,options)}:function(){};var stream=new ReadStream(options,makeData);if(this.isOpen()){stream.setIterator(self.db.iterator(options))}else{this.once("ready",function(){stream.setIterator(self.db.iterator(options))})}return stream};LevelUP.prototype.keyStream=LevelUP.prototype.createKeyStream=function(options){return this.createReadStream(extend(options,{keys:true,values:false}))};LevelUP.prototype.valueStream=LevelUP.prototype.createValueStream=function(options){return this.createReadStream(extend(options,{keys:false,values:true}))};LevelUP.prototype.writeStream=LevelUP.prototype.createWriteStream=function(options){return new WriteStream(extend(options),this)};LevelUP.prototype.toString=function(){return"LevelUP"};function utilStatic(name){return function(location,callback){getLevelDOWN()[name](location,callback||function(){})}}module.exports=LevelUP;module.exports.copy=util.copy;module.exports.destroy=utilStatic("destroy");module.exports.repair=utilStatic("repair")}).call(this,require("_process"))},{"./batch":360,"./codec":361,"./errors":363,"./read-stream":365,"./util":366,"./write-stream":367,_process:10,"deferred-leveldown":369,events:6,prr:375,util:25,xtend:386}],365:[function(require,module,exports){var Readable=require("readable-stream").Readable,inherits=require("util").inherits,extend=require("xtend"),EncodingError=require("./errors").EncodingError,util=require("./util");function ReadStream(options,makeData){if(!(this instanceof ReadStream))return new ReadStream(options,makeData);Readable.call(this,{objectMode:true,highWaterMark:options.highWaterMark});this._waiting=false;this._options=options;this._makeData=makeData}inherits(ReadStream,Readable);ReadStream.prototype.setIterator=function(it){var self=this;this._iterator=it;if(this._destroyed)return it.end(function(){});if(this._waiting){this._waiting=false;return this._read()}return this};ReadStream.prototype._read=function read(){var self=this;if(self._destroyed)return;if(!self._iterator)return this._waiting=true;self._iterator.next(function(err,key,value){if(err||key===undefined&&value===undefined){if(!err&&!self._destroyed)self.push(null);return self._cleanup(err)}try{value=self._makeData(key,value)}catch(e){return self._cleanup(new EncodingError(e))}if(!self._destroyed)self.push(value)})};ReadStream.prototype._cleanup=function(err){if(this._destroyed)return;this._destroyed=true;var self=this;if(err)self.emit("error",err);if(self._iterator){self._iterator.end(function(){self._iterator=null;self.emit("close")})}else{self.emit("close")}};ReadStream.prototype.destroy=function(){this._cleanup()};ReadStream.prototype.toString=function(){return"LevelUP.ReadStream"};module.exports=ReadStream},{"./errors":363,"./util":366,"readable-stream":385,util:25,xtend:386}],366:[function(require,module,exports){var extend=require("xtend"),LevelUPError=require("./errors").LevelUPError,encodings=require("./encodings"),defaultOptions={createIfMissing:true,errorIfExists:false,keyEncoding:"utf8",valueEncoding:"utf8",compression:true},leveldown,encodingOpts=function(){var eo={};for(var e in encodings)eo[e]={valueEncoding:encodings[e]};return eo}();function copy(srcdb,dstdb,callback){srcdb.readStream().pipe(dstdb.writeStream()).on("close",callback?callback:function(){}).on("error",callback?callback:function(err){throw err})}function getOptions(levelup,options){var s=typeof options=="string";if(!s&&options&&options.encoding&&!options.valueEncoding)options.valueEncoding=options.encoding;return extend(levelup&&levelup.options||{},s?encodingOpts[options]||encodingOpts[defaultOptions.valueEncoding]:options)}function getLevelDOWN(){if(leveldown)return leveldown;var requiredVersion=require("../package.json").devDependencies.leveldown,missingLevelDOWNError="Could not locate LevelDOWN, try `npm install leveldown`",leveldownVersion;try{leveldownVersion=require("leveldown/package").version}catch(e){throw new LevelUPError(missingLevelDOWNError)}if(!require("semver").satisfies(leveldownVersion,requiredVersion)){throw new LevelUPError("Installed version of LevelDOWN ("+leveldownVersion+") does not match required version ("+requiredVersion+")")}try{return leveldown=require("leveldown")}catch(e){throw new LevelUPError(missingLevelDOWNError)}}function dispatchError(levelup,error,callback){return typeof callback=="function"?callback(error):levelup.emit("error",error)}function isDefined(v){return typeof v!=="undefined"}module.exports={defaultOptions:defaultOptions,copy:copy,getOptions:getOptions,getLevelDOWN:getLevelDOWN,dispatchError:dispatchError,isDefined:isDefined}},{"../package.json":387,"./encodings":362,"./errors":363,leveldown:1,"leveldown/package":1,semver:1,xtend:386}],367:[function(require,module,exports){(function(process,global){var Stream=require("stream").Stream,inherits=require("util").inherits,extend=require("xtend"),bl=require("bl"),setImmediate=global.setImmediate||process.nextTick,getOptions=require("./util").getOptions,defaultOptions={type:"put"};function WriteStream(options,db){if(!(this instanceof WriteStream))return new WriteStream(options,db);Stream.call(this);this._options=extend(defaultOptions,getOptions(db,options));this._db=db;this._buffer=[];this._status="init";this._end=false;this.writable=true;this.readable=false;var self=this,ready=function(){if(!self.writable)return;self._status="ready";self.emit("ready");self._process()};if(db.isOpen())setImmediate(ready);else db.once("ready",ready)}inherits(WriteStream,Stream);WriteStream.prototype.write=function(data){if(!this.writable)return false;this._buffer.push(data);if(this._status!="init")this._processDelayed();if(this._options.maxBufferLength&&this._buffer.length>this._options.maxBufferLength){this._writeBlock=true;return false}return true};WriteStream.prototype.end=function(data){var self=this;if(data)this.write(data);setImmediate(function(){self._end=true;self._process()})};WriteStream.prototype.destroy=function(){this.writable=false;this.end()};WriteStream.prototype.destroySoon=function(){this.end()};WriteStream.prototype.add=function(entry){if(!entry.props)return;if(entry.props.Directory)entry.pipe(this._db.writeStream(this._options));else if(entry.props.File||entry.File||entry.type=="File")this._write(entry);return true};WriteStream.prototype._processDelayed=function(){var self=this;setImmediate(function(){self._process()})};WriteStream.prototype._process=function(){var buffer,self=this,cb=function(err){if(!self.writable)return;if(self._status!="closed")self._status="ready";if(err){self.writable=false;return self.emit("error",err)}self._process()};if(self._status!="ready"&&self.writable){if(self._buffer.length&&self._status!="closed")self._processDelayed();return}if(self._buffer.length&&self.writable){self._status="writing";buffer=self._buffer;self._buffer=[];self._db.batch(buffer.map(function(d){return{type:d.type||self._options.type,key:d.key,value:d.value,keyEncoding:d.keyEncoding||self._options.keyEncoding,valueEncoding:d.valueEncoding||d.encoding||self._options.valueEncoding}}),cb);if(self._writeBlock){self._writeBlock=false;self.emit("drain")}return}if(self._end&&self._status!="closed"){self._status="closed";self.writable=false;self.emit("close")}};WriteStream.prototype._write=function(entry){var key=entry.path||entry.props.path,self=this;if(!key)return;entry.pipe(bl(function(err,data){if(err){self.writable=false;return self.emit("error",err)}if(self._options.fstreamRoot&&key.indexOf(self._options.fstreamRoot)>-1)key=key.substr(self._options.fstreamRoot.length+1);self.write({key:key,value:data.slice(0)})}))};WriteStream.prototype.toString=function(){return"LevelUP.WriteStream"};module.exports=WriteStream}).call(this,require("_process"),typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"./util":366,_process:10,bl:368,stream:22,util:25,xtend:386}],368:[function(require,module,exports){(function(Buffer){var DuplexStream=require("readable-stream").Duplex,util=require("util");function BufferList(callback){if(!(this instanceof BufferList))return new BufferList(callback);this._bufs=[];this.length=0;if(typeof callback=="function"){this._callback=callback;var piper=function(err){if(this._callback){this._callback(err);this._callback=null}}.bind(this);this.on("pipe",function(src){src.on("error",piper)});this.on("unpipe",function(src){src.removeListener("error",piper)})}else if(Buffer.isBuffer(callback))this.append(callback);else if(Array.isArray(callback)){callback.forEach(function(b){Buffer.isBuffer(b)&&this.append(b)}.bind(this))}DuplexStream.call(this)}util.inherits(BufferList,DuplexStream);BufferList.prototype._offset=function(offset){var tot=0,i=0,_t;for(;i<this._bufs.length;i++){_t=tot+this._bufs[i].length;if(offset<_t)return[i,offset-tot];tot=_t}};BufferList.prototype.append=function(buf){this._bufs.push(Buffer.isBuffer(buf)?buf:new Buffer(buf));this.length+=buf.length;return this};BufferList.prototype._write=function(buf,encoding,callback){this.append(buf);if(callback)callback()};BufferList.prototype._read=function(size){if(!this.length)return this.push(null);size=Math.min(size,this.length);this.push(this.slice(0,size));this.consume(size)};BufferList.prototype.end=function(chunk){DuplexStream.prototype.end.call(this,chunk);if(this._callback){this._callback(null,this.slice());this._callback=null}};BufferList.prototype.get=function(index){return this.slice(index,index+1)[0]};BufferList.prototype.slice=function(start,end){return this.copy(null,0,start,end)};BufferList.prototype.copy=function(dst,dstStart,srcStart,srcEnd){if(typeof srcStart!="number"||srcStart<0)srcStart=0;if(typeof srcEnd!="number"||srcEnd>this.length)srcEnd=this.length;if(srcStart>=this.length)return dst||new Buffer(0);if(srcEnd<=0)return dst||new Buffer(0);var copy=!!dst,off=this._offset(srcStart),len=srcEnd-srcStart,bytes=len,bufoff=copy&&dstStart||0,start=off[1],l,i;if(srcStart===0&&srcEnd==this.length){if(!copy)return Buffer.concat(this._bufs);for(i=0;i<this._bufs.length;i++){this._bufs[i].copy(dst,bufoff);bufoff+=this._bufs[i].length}return dst}if(bytes<=this._bufs[off[0]].length-start){return copy?this._bufs[off[0]].copy(dst,dstStart,start,start+bytes):this._bufs[off[0]].slice(start,start+bytes)}if(!copy)dst=new Buffer(len);for(i=off[0];i<this._bufs.length;i++){l=this._bufs[i].length-start;if(bytes>l){this._bufs[i].copy(dst,bufoff,start)}else{this._bufs[i].copy(dst,bufoff,start,start+bytes);break}bufoff+=l;bytes-=l;if(start)start=0}return dst};BufferList.prototype.toString=function(encoding,start,end){return this.slice(start,end).toString(encoding)};BufferList.prototype.consume=function(bytes){while(this._bufs.length){if(bytes>this._bufs[0].length){bytes-=this._bufs[0].length;this.length-=this._bufs[0].length;this._bufs.shift()}else{this._bufs[0]=this._bufs[0].slice(bytes);this.length-=bytes;break}}return this};BufferList.prototype.duplicate=function(){var i=0,copy=new BufferList;for(;i<this._bufs.length;i++)copy.append(this._bufs[i]);return copy};BufferList.prototype.destroy=function(){this._bufs.length=0;this.length=0;this.push(null)};(function(){var methods={readDoubleBE:8,readDoubleLE:8,readFloatBE:4,readFloatLE:4,readInt32BE:4,readInt32LE:4,readUInt32BE:4,readUInt32LE:4,readInt16BE:2,readInt16LE:2,readUInt16BE:2,readUInt16LE:2,readInt8:1,readUInt8:1};for(var m in methods){(function(m){BufferList.prototype[m]=function(offset){return this.slice(offset,offset+methods[m])[m](0)}})(m)}})();module.exports=BufferList}).call(this,require("buffer").Buffer)},{buffer:2,"readable-stream":385,util:25}],369:[function(require,module,exports){(function(process,Buffer){var util=require("util"),AbstractLevelDOWN=require("abstract-leveldown").AbstractLevelDOWN;function DeferredLevelDOWN(location){AbstractLevelDOWN.call(this,typeof location=="string"?location:"");this._db=undefined;this._operations=[]}util.inherits(DeferredLevelDOWN,AbstractLevelDOWN);DeferredLevelDOWN.prototype.setDb=function(db){this._db=db;this._operations.forEach(function(op){db[op.method].apply(db,op.args)})};DeferredLevelDOWN.prototype._open=function(options,callback){return process.nextTick(callback)};DeferredLevelDOWN.prototype._operation=function(method,args){if(this._db)return this._db[method].apply(this._db,args);this._operations.push({method:method,args:args})};"put get del batch approximateSize".split(" ").forEach(function(m){DeferredLevelDOWN.prototype["_"+m]=function(){this._operation(m,arguments)}});DeferredLevelDOWN.prototype._isBuffer=function(obj){return Buffer.isBuffer(obj)};DeferredLevelDOWN.prototype._iterator=function(){throw new TypeError("not implemented")};module.exports=DeferredLevelDOWN}).call(this,require("_process"),require("buffer").Buffer)},{_process:10,"abstract-leveldown":372,buffer:2,util:25}],370:[function(require,module,exports){(function(process){function AbstractChainedBatch(db){this._db=db;this._operations=[];this._written=false}AbstractChainedBatch.prototype._checkWritten=function(){if(this._written)throw new Error("write() already called on this batch")};AbstractChainedBatch.prototype.put=function(key,value){this._checkWritten();var err=this._db._checkKeyValue(key,"key",this._db._isBuffer);if(err)throw err;err=this._db._checkKeyValue(value,"value",this._db._isBuffer);if(err)throw err;if(!this._db._isBuffer(key))key=String(key);if(!this._db._isBuffer(value))value=String(value);if(typeof this._put=="function")this._put(key,value);else this._operations.push({type:"put",key:key,value:value});return this};AbstractChainedBatch.prototype.del=function(key){this._checkWritten();var err=this._db._checkKeyValue(key,"key",this._db._isBuffer);if(err)throw err;if(!this._db._isBuffer(key))key=String(key);if(typeof this._del=="function")this._del(key);else this._operations.push({type:"del",key:key});return this};AbstractChainedBatch.prototype.clear=function(){this._checkWritten();this._operations=[];if(typeof this._clear=="function")this._clear();return this};AbstractChainedBatch.prototype.write=function(options,callback){this._checkWritten();if(typeof options=="function")callback=options;if(typeof callback!="function")throw new Error("write() requires a callback argument");if(typeof options!="object")options={};this._written=true;if(typeof this._write=="function")return this._write(callback);if(typeof this._db._batch=="function")return this._db._batch(this._operations,options,callback);process.nextTick(callback)};module.exports=AbstractChainedBatch}).call(this,require("_process"))},{_process:10}],371:[function(require,module,exports){(function(process){function AbstractIterator(db){this.db=db;this._ended=false;this._nexting=false}AbstractIterator.prototype.next=function(callback){var self=this;if(typeof callback!="function")throw new Error("next() requires a callback argument");if(self._ended)return callback(new Error("cannot call next() after end()"));if(self._nexting)return callback(new Error("cannot call next() before previous next() has completed"));self._nexting=true;if(typeof self._next=="function"){return self._next(function(){self._nexting=false;callback.apply(null,arguments)})}process.nextTick(function(){self._nexting=false;callback()})};AbstractIterator.prototype.end=function(callback){if(typeof callback!="function")throw new Error("end() requires a callback argument");if(this._ended)return callback(new Error("end() already called on iterator"));this._ended=true;if(typeof this._end=="function")return this._end(callback);process.nextTick(callback)};module.exports=AbstractIterator}).call(this,require("_process"))},{_process:10}],372:[function(require,module,exports){(function(process,Buffer){var xtend=require("xtend"),AbstractIterator=require("./abstract-iterator"),AbstractChainedBatch=require("./abstract-chained-batch");function AbstractLevelDOWN(location){if(!arguments.length||location===undefined)throw new Error("constructor requires at least a location argument");if(typeof location!="string")throw new Error("constructor requires a location string argument");this.location=location}AbstractLevelDOWN.prototype.open=function(options,callback){if(typeof options=="function")callback=options;if(typeof callback!="function")throw new Error("open() requires a callback argument");if(typeof options!="object")options={};if(typeof this._open=="function")return this._open(options,callback);process.nextTick(callback)};AbstractLevelDOWN.prototype.close=function(callback){if(typeof callback!="function")throw new Error("close() requires a callback argument");if(typeof this._close=="function")return this._close(callback);process.nextTick(callback)};AbstractLevelDOWN.prototype.get=function(key,options,callback){var err;if(typeof options=="function")callback=options;if(typeof callback!="function")throw new Error("get() requires a callback argument");if(err=this._checkKeyValue(key,"key",this._isBuffer))return callback(err);if(!this._isBuffer(key))key=String(key);if(typeof options!="object")options={};if(typeof this._get=="function")return this._get(key,options,callback);process.nextTick(function(){callback(new Error("NotFound"))})};AbstractLevelDOWN.prototype.put=function(key,value,options,callback){var err;if(typeof options=="function")callback=options;if(typeof callback!="function")throw new Error("put() requires a callback argument");if(err=this._checkKeyValue(key,"key",this._isBuffer))return callback(err);if(err=this._checkKeyValue(value,"value",this._isBuffer))return callback(err);if(!this._isBuffer(key))key=String(key);if(!this._isBuffer(value)&&!process.browser)value=String(value);if(typeof options!="object")options={};if(typeof this._put=="function")return this._put(key,value,options,callback);process.nextTick(callback)};AbstractLevelDOWN.prototype.del=function(key,options,callback){var err;if(typeof options=="function")callback=options;if(typeof callback!="function")throw new Error("del() requires a callback argument");if(err=this._checkKeyValue(key,"key",this._isBuffer))return callback(err);if(!this._isBuffer(key))key=String(key);if(typeof options!="object")options={};if(typeof this._del=="function")return this._del(key,options,callback);process.nextTick(callback)};AbstractLevelDOWN.prototype.batch=function(array,options,callback){if(!arguments.length)return this._chainedBatch();if(typeof options=="function")callback=options;if(typeof callback!="function")throw new Error("batch(array) requires a callback argument");if(!Array.isArray(array))return callback(new Error("batch(array) requires an array argument"));if(typeof options!="object")options={};var i=0,l=array.length,e,err;for(;i<l;i++){e=array[i];if(typeof e!="object")continue;if(err=this._checkKeyValue(e.type,"type",this._isBuffer))return callback(err);if(err=this._checkKeyValue(e.key,"key",this._isBuffer))return callback(err);if(e.type=="put"){if(err=this._checkKeyValue(e.value,"value",this._isBuffer))return callback(err)}}if(typeof this._batch=="function")return this._batch(array,options,callback);process.nextTick(callback)};AbstractLevelDOWN.prototype.approximateSize=function(start,end,callback){if(start==null||end==null||typeof start=="function"||typeof end=="function"){throw new Error("approximateSize() requires valid `start`, `end` and `callback` arguments")}if(typeof callback!="function")throw new Error("approximateSize() requires a callback argument");if(!this._isBuffer(start))start=String(start);if(!this._isBuffer(end))end=String(end);if(typeof this._approximateSize=="function")return this._approximateSize(start,end,callback);process.nextTick(function(){callback(null,0)})};AbstractLevelDOWN.prototype._setupIteratorOptions=function(options){var self=this;options=xtend(options);["start","end","gt","gte","lt","lte"].forEach(function(o){if(options[o]&&self._isBuffer(options[o])&&options[o].length===0)delete options[o]});options.reverse=!!options.reverse;if(options.reverse&&options.lt)options.start=options.lt;if(options.reverse&&options.lte)options.start=options.lte;if(!options.reverse&&options.gt)options.start=options.gt;if(!options.reverse&&options.gte)options.start=options.gte;if(options.reverse&&options.lt&&!options.lte||!options.reverse&&options.gt&&!options.gte)options.exclusiveStart=true;return options};AbstractLevelDOWN.prototype.iterator=function(options){if(typeof options!="object")options={};options=this._setupIteratorOptions(options);if(typeof this._iterator=="function")return this._iterator(options);return new AbstractIterator(this)};AbstractLevelDOWN.prototype._chainedBatch=function(){return new AbstractChainedBatch(this)};AbstractLevelDOWN.prototype._isBuffer=function(obj){return Buffer.isBuffer(obj)};AbstractLevelDOWN.prototype._checkKeyValue=function(obj,type){if(obj===null||obj===undefined)return new Error(type+" cannot be `null` or `undefined`");if(this._isBuffer(obj)){if(obj.length===0)return new Error(type+" cannot be an empty Buffer")}else if(String(obj)==="")return new Error(type+" cannot be an empty String")};module.exports.AbstractLevelDOWN=AbstractLevelDOWN;module.exports.AbstractIterator=AbstractIterator;module.exports.AbstractChainedBatch=AbstractChainedBatch}).call(this,require("_process"),require("buffer").Buffer)},{"./abstract-chained-batch":370,"./abstract-iterator":371,_process:10,buffer:2,xtend:386}],373:[function(require,module,exports){var prr=require("prr");function init(type,message,cause){prr(this,{type:type,name:type,cause:typeof message!="string"?message:cause,message:!!message&&typeof message!="string"?message.message:message},"ewr")}function CustomError(message,cause){Error.call(this);if(Error.captureStackTrace)Error.captureStackTrace(this,arguments.callee);init.call(this,"CustomError",message,cause)}CustomError.prototype=new Error;function createError(errno,type,proto){var err=function(message,cause){init.call(this,type,message,cause);if(type=="FilesystemError"){this.code=this.cause.code;this.path=this.cause.path;this.errno=this.cause.errno;this.message=(errno.errno[this.cause.errno]?errno.errno[this.cause.errno].description:this.cause.message)+(this.cause.path?" ["+this.cause.path+"]":"")}Error.call(this);if(Error.captureStackTrace)Error.captureStackTrace(this,arguments.callee)};err.prototype=!!proto?new proto:new CustomError;return err}module.exports=function(errno){var ce=function(type,proto){return createError(errno,type,proto)};return{CustomError:CustomError,FilesystemError:ce("FilesystemError"),createError:ce}
}},{prr:375}],374:[function(require,module,exports){var all=module.exports.all=[{errno:-1,code:"UNKNOWN",description:"unknown error"},{errno:0,code:"OK",description:"success"},{errno:1,code:"EOF",description:"end of file"},{errno:2,code:"EADDRINFO",description:"getaddrinfo error"},{errno:3,code:"EACCES",description:"permission denied"},{errno:4,code:"EAGAIN",description:"resource temporarily unavailable"},{errno:5,code:"EADDRINUSE",description:"address already in use"},{errno:6,code:"EADDRNOTAVAIL",description:"address not available"},{errno:7,code:"EAFNOSUPPORT",description:"address family not supported"},{errno:8,code:"EALREADY",description:"connection already in progress"},{errno:9,code:"EBADF",description:"bad file descriptor"},{errno:10,code:"EBUSY",description:"resource busy or locked"},{errno:11,code:"ECONNABORTED",description:"software caused connection abort"},{errno:12,code:"ECONNREFUSED",description:"connection refused"},{errno:13,code:"ECONNRESET",description:"connection reset by peer"},{errno:14,code:"EDESTADDRREQ",description:"destination address required"},{errno:15,code:"EFAULT",description:"bad address in system call argument"},{errno:16,code:"EHOSTUNREACH",description:"host is unreachable"},{errno:17,code:"EINTR",description:"interrupted system call"},{errno:18,code:"EINVAL",description:"invalid argument"},{errno:19,code:"EISCONN",description:"socket is already connected"},{errno:20,code:"EMFILE",description:"too many open files"},{errno:21,code:"EMSGSIZE",description:"message too long"},{errno:22,code:"ENETDOWN",description:"network is down"},{errno:23,code:"ENETUNREACH",description:"network is unreachable"},{errno:24,code:"ENFILE",description:"file table overflow"},{errno:25,code:"ENOBUFS",description:"no buffer space available"},{errno:26,code:"ENOMEM",description:"not enough memory"},{errno:27,code:"ENOTDIR",description:"not a directory"},{errno:28,code:"EISDIR",description:"illegal operation on a directory"},{errno:29,code:"ENONET",description:"machine is not on the network"},{errno:31,code:"ENOTCONN",description:"socket is not connected"},{errno:32,code:"ENOTSOCK",description:"socket operation on non-socket"},{errno:33,code:"ENOTSUP",description:"operation not supported on socket"},{errno:34,code:"ENOENT",description:"no such file or directory"},{errno:35,code:"ENOSYS",description:"function not implemented"},{errno:36,code:"EPIPE",description:"broken pipe"},{errno:37,code:"EPROTO",description:"protocol error"},{errno:38,code:"EPROTONOSUPPORT",description:"protocol not supported"},{errno:39,code:"EPROTOTYPE",description:"protocol wrong type for socket"},{errno:40,code:"ETIMEDOUT",description:"connection timed out"},{errno:41,code:"ECHARSET",description:"invalid Unicode character"},{errno:42,code:"EAIFAMNOSUPPORT",description:"address family for hostname not supported"},{errno:44,code:"EAISERVICE",description:"servname not supported for ai_socktype"},{errno:45,code:"EAISOCKTYPE",description:"ai_socktype not supported"},{errno:46,code:"ESHUTDOWN",description:"cannot send after transport endpoint shutdown"},{errno:47,code:"EEXIST",description:"file already exists"},{errno:48,code:"ESRCH",description:"no such process"},{errno:49,code:"ENAMETOOLONG",description:"name too long"},{errno:50,code:"EPERM",description:"operation not permitted"},{errno:51,code:"ELOOP",description:"too many symbolic links encountered"},{errno:52,code:"EXDEV",description:"cross-device link not permitted"},{errno:53,code:"ENOTEMPTY",description:"directory not empty"},{errno:54,code:"ENOSPC",description:"no space left on device"},{errno:55,code:"EIO",description:"i/o error"},{errno:56,code:"EROFS",description:"read-only file system"},{errno:57,code:"ENODEV",description:"no such device"},{errno:58,code:"ESPIPE",description:"invalid seek"},{errno:59,code:"ECANCELED",description:"operation canceled"}];module.exports.errno={"-1":all[0],0:all[1],1:all[2],2:all[3],3:all[4],4:all[5],5:all[6],6:all[7],7:all[8],8:all[9],9:all[10],10:all[11],11:all[12],12:all[13],13:all[14],14:all[15],15:all[16],16:all[17],17:all[18],18:all[19],19:all[20],20:all[21],21:all[22],22:all[23],23:all[24],24:all[25],25:all[26],26:all[27],27:all[28],28:all[29],29:all[30],31:all[31],32:all[32],33:all[33],34:all[34],35:all[35],36:all[36],37:all[37],38:all[38],39:all[39],40:all[40],41:all[41],42:all[42],44:all[43],45:all[44],46:all[45],47:all[46],48:all[47],49:all[48],50:all[49],51:all[50],52:all[51],53:all[52],54:all[53],55:all[54],56:all[55],57:all[56],58:all[57],59:all[58]};module.exports.code={UNKNOWN:all[0],OK:all[1],EOF:all[2],EADDRINFO:all[3],EACCES:all[4],EAGAIN:all[5],EADDRINUSE:all[6],EADDRNOTAVAIL:all[7],EAFNOSUPPORT:all[8],EALREADY:all[9],EBADF:all[10],EBUSY:all[11],ECONNABORTED:all[12],ECONNREFUSED:all[13],ECONNRESET:all[14],EDESTADDRREQ:all[15],EFAULT:all[16],EHOSTUNREACH:all[17],EINTR:all[18],EINVAL:all[19],EISCONN:all[20],EMFILE:all[21],EMSGSIZE:all[22],ENETDOWN:all[23],ENETUNREACH:all[24],ENFILE:all[25],ENOBUFS:all[26],ENOMEM:all[27],ENOTDIR:all[28],EISDIR:all[29],ENONET:all[30],ENOTCONN:all[31],ENOTSOCK:all[32],ENOTSUP:all[33],ENOENT:all[34],ENOSYS:all[35],EPIPE:all[36],EPROTO:all[37],EPROTONOSUPPORT:all[38],EPROTOTYPE:all[39],ETIMEDOUT:all[40],ECHARSET:all[41],EAIFAMNOSUPPORT:all[42],EAISERVICE:all[43],EAISOCKTYPE:all[44],ESHUTDOWN:all[45],EEXIST:all[46],ESRCH:all[47],ENAMETOOLONG:all[48],EPERM:all[49],ELOOP:all[50],EXDEV:all[51],ENOTEMPTY:all[52],ENOSPC:all[53],EIO:all[54],EROFS:all[55],ENODEV:all[56],ESPIPE:all[57],ECANCELED:all[58]};module.exports.custom=require("./custom")(module.exports);module.exports.create=module.exports.custom.createError},{"./custom":373}],375:[function(require,module,exports){(function(name,context,definition){if(typeof module!="undefined"&&module.exports)module.exports=definition();else context[name]=definition()})("prr",this,function(){var setProperty=typeof Object.defineProperty=="function"?function(obj,key,options){Object.defineProperty(obj,key,options);return obj}:function(obj,key,options){obj[key]=options.value;return obj},makeOptions=function(value,options){var oo=typeof options=="object",os=!oo&&typeof options=="string",op=function(p){return oo?!!options[p]:os?options.indexOf(p[0])>-1:false};return{enumerable:op("enumerable"),configurable:op("configurable"),writable:op("writable"),value:value}},prr=function(obj,key,value,options){var k;options=makeOptions(value,options);if(typeof key=="object"){for(k in key){if(Object.hasOwnProperty.call(key,k)){options.value=key[k];setProperty(obj,k,options)}}return obj}return setProperty(obj,key,options)};return prr})},{}],376:[function(require,module,exports){(function(process){module.exports=Duplex;var objectKeys=Object.keys||function(obj){var keys=[];for(var key in obj)keys.push(key);return keys};var util=require("core-util-is");util.inherits=require("inherits");var Readable=require("./_stream_readable");var Writable=require("./_stream_writable");util.inherits(Duplex,Readable);forEach(objectKeys(Writable.prototype),function(method){if(!Duplex.prototype[method])Duplex.prototype[method]=Writable.prototype[method]});function Duplex(options){if(!(this instanceof Duplex))return new Duplex(options);Readable.call(this,options);Writable.call(this,options);if(options&&options.readable===false)this.readable=false;if(options&&options.writable===false)this.writable=false;this.allowHalfOpen=true;if(options&&options.allowHalfOpen===false)this.allowHalfOpen=false;this.once("end",onend)}function onend(){if(this.allowHalfOpen||this._writableState.ended)return;process.nextTick(this.end.bind(this))}function forEach(xs,f){for(var i=0,l=xs.length;i<l;i++){f(xs[i],i)}}}).call(this,require("_process"))},{"./_stream_readable":378,"./_stream_writable":380,_process:10,"core-util-is":381,inherits:382}],377:[function(require,module,exports){arguments[4][13][0].apply(exports,arguments)},{"./_stream_transform":379,"core-util-is":381,dup:13,inherits:382}],378:[function(require,module,exports){(function(process){module.exports=Readable;var isArray=require("isarray");var Buffer=require("buffer").Buffer;Readable.ReadableState=ReadableState;var EE=require("events").EventEmitter;if(!EE.listenerCount)EE.listenerCount=function(emitter,type){return emitter.listeners(type).length};var Stream=require("stream");var util=require("core-util-is");util.inherits=require("inherits");var StringDecoder;util.inherits(Readable,Stream);function ReadableState(options,stream){options=options||{};var hwm=options.highWaterMark;this.highWaterMark=hwm||hwm===0?hwm:16*1024;this.highWaterMark=~~this.highWaterMark;this.buffer=[];this.length=0;this.pipes=null;this.pipesCount=0;this.flowing=false;this.ended=false;this.endEmitted=false;this.reading=false;this.calledRead=false;this.sync=true;this.needReadable=false;this.emittedReadable=false;this.readableListening=false;this.objectMode=!!options.objectMode;this.defaultEncoding=options.defaultEncoding||"utf8";this.ranOut=false;this.awaitDrain=0;this.readingMore=false;this.decoder=null;this.encoding=null;if(options.encoding){if(!StringDecoder)StringDecoder=require("string_decoder/").StringDecoder;this.decoder=new StringDecoder(options.encoding);this.encoding=options.encoding}}function Readable(options){if(!(this instanceof Readable))return new Readable(options);this._readableState=new ReadableState(options,this);this.readable=true;Stream.call(this)}Readable.prototype.push=function(chunk,encoding){var state=this._readableState;if(typeof chunk==="string"&&!state.objectMode){encoding=encoding||state.defaultEncoding;if(encoding!==state.encoding){chunk=new Buffer(chunk,encoding);encoding=""}}return readableAddChunk(this,state,chunk,encoding,false)};Readable.prototype.unshift=function(chunk){var state=this._readableState;return readableAddChunk(this,state,chunk,"",true)};function readableAddChunk(stream,state,chunk,encoding,addToFront){var er=chunkInvalid(state,chunk);if(er){stream.emit("error",er)}else if(chunk===null||chunk===undefined){state.reading=false;if(!state.ended)onEofChunk(stream,state)}else if(state.objectMode||chunk&&chunk.length>0){if(state.ended&&!addToFront){var e=new Error("stream.push() after EOF");stream.emit("error",e)}else if(state.endEmitted&&addToFront){var e=new Error("stream.unshift() after end event");stream.emit("error",e)}else{if(state.decoder&&!addToFront&&!encoding)chunk=state.decoder.write(chunk);state.length+=state.objectMode?1:chunk.length;if(addToFront){state.buffer.unshift(chunk)}else{state.reading=false;state.buffer.push(chunk)}if(state.needReadable)emitReadable(stream);maybeReadMore(stream,state)}}else if(!addToFront){state.reading=false}return needMoreData(state)}function needMoreData(state){return!state.ended&&(state.needReadable||state.length<state.highWaterMark||state.length===0)}Readable.prototype.setEncoding=function(enc){if(!StringDecoder)StringDecoder=require("string_decoder/").StringDecoder;this._readableState.decoder=new StringDecoder(enc);this._readableState.encoding=enc};var MAX_HWM=8388608;function roundUpToNextPowerOf2(n){if(n>=MAX_HWM){n=MAX_HWM}else{n--;for(var p=1;p<32;p<<=1)n|=n>>p;n++}return n}function howMuchToRead(n,state){if(state.length===0&&state.ended)return 0;if(state.objectMode)return n===0?0:1;if(n===null||isNaN(n)){if(state.flowing&&state.buffer.length)return state.buffer[0].length;else return state.length}if(n<=0)return 0;if(n>state.highWaterMark)state.highWaterMark=roundUpToNextPowerOf2(n);if(n>state.length){if(!state.ended){state.needReadable=true;return 0}else return state.length}return n}Readable.prototype.read=function(n){var state=this._readableState;state.calledRead=true;var nOrig=n;var ret;if(typeof n!=="number"||n>0)state.emittedReadable=false;if(n===0&&state.needReadable&&(state.length>=state.highWaterMark||state.ended)){emitReadable(this);return null}n=howMuchToRead(n,state);if(n===0&&state.ended){ret=null;if(state.length>0&&state.decoder){ret=fromList(n,state);state.length-=ret.length}if(state.length===0)endReadable(this);return ret}var doRead=state.needReadable;if(state.length-n<=state.highWaterMark)doRead=true;if(state.ended||state.reading)doRead=false;if(doRead){state.reading=true;state.sync=true;if(state.length===0)state.needReadable=true;this._read(state.highWaterMark);state.sync=false}if(doRead&&!state.reading)n=howMuchToRead(nOrig,state);if(n>0)ret=fromList(n,state);else ret=null;if(ret===null){state.needReadable=true;n=0}state.length-=n;if(state.length===0&&!state.ended)state.needReadable=true;if(state.ended&&!state.endEmitted&&state.length===0)endReadable(this);return ret};function chunkInvalid(state,chunk){var er=null;if(!Buffer.isBuffer(chunk)&&"string"!==typeof chunk&&chunk!==null&&chunk!==undefined&&!state.objectMode){er=new TypeError("Invalid non-string/buffer chunk")}return er}function onEofChunk(stream,state){if(state.decoder&&!state.ended){var chunk=state.decoder.end();if(chunk&&chunk.length){state.buffer.push(chunk);state.length+=state.objectMode?1:chunk.length}}state.ended=true;if(state.length>0)emitReadable(stream);else endReadable(stream)}function emitReadable(stream){var state=stream._readableState;state.needReadable=false;if(state.emittedReadable)return;state.emittedReadable=true;if(state.sync)process.nextTick(function(){emitReadable_(stream)});else emitReadable_(stream)}function emitReadable_(stream){stream.emit("readable")}function maybeReadMore(stream,state){if(!state.readingMore){state.readingMore=true;process.nextTick(function(){maybeReadMore_(stream,state)})}}function maybeReadMore_(stream,state){var len=state.length;while(!state.reading&&!state.flowing&&!state.ended&&state.length<state.highWaterMark){stream.read(0);if(len===state.length)break;else len=state.length}state.readingMore=false}Readable.prototype._read=function(n){this.emit("error",new Error("not implemented"))};Readable.prototype.pipe=function(dest,pipeOpts){var src=this;var state=this._readableState;switch(state.pipesCount){case 0:state.pipes=dest;break;case 1:state.pipes=[state.pipes,dest];break;default:state.pipes.push(dest);break}state.pipesCount+=1;var doEnd=(!pipeOpts||pipeOpts.end!==false)&&dest!==process.stdout&&dest!==process.stderr;var endFn=doEnd?onend:cleanup;if(state.endEmitted)process.nextTick(endFn);else src.once("end",endFn);dest.on("unpipe",onunpipe);function onunpipe(readable){if(readable!==src)return;cleanup()}function onend(){dest.end()}var ondrain=pipeOnDrain(src);dest.on("drain",ondrain);function cleanup(){dest.removeListener("close",onclose);dest.removeListener("finish",onfinish);dest.removeListener("drain",ondrain);dest.removeListener("error",onerror);dest.removeListener("unpipe",onunpipe);src.removeListener("end",onend);src.removeListener("end",cleanup);if(!dest._writableState||dest._writableState.needDrain)ondrain()}function onerror(er){unpipe();dest.removeListener("error",onerror);if(EE.listenerCount(dest,"error")===0)dest.emit("error",er)}if(!dest._events||!dest._events.error)dest.on("error",onerror);else if(isArray(dest._events.error))dest._events.error.unshift(onerror);else dest._events.error=[onerror,dest._events.error];function onclose(){dest.removeListener("finish",onfinish);unpipe()}dest.once("close",onclose);function onfinish(){dest.removeListener("close",onclose);unpipe()}dest.once("finish",onfinish);function unpipe(){src.unpipe(dest)}dest.emit("pipe",src);if(!state.flowing){this.on("readable",pipeOnReadable);state.flowing=true;process.nextTick(function(){flow(src)})}return dest};function pipeOnDrain(src){return function(){var dest=this;var state=src._readableState;state.awaitDrain--;if(state.awaitDrain===0)flow(src)}}function flow(src){var state=src._readableState;var chunk;state.awaitDrain=0;function write(dest,i,list){var written=dest.write(chunk);if(false===written){state.awaitDrain++}}while(state.pipesCount&&null!==(chunk=src.read())){if(state.pipesCount===1)write(state.pipes,0,null);else forEach(state.pipes,write);src.emit("data",chunk);if(state.awaitDrain>0)return}if(state.pipesCount===0){state.flowing=false;if(EE.listenerCount(src,"data")>0)emitDataEvents(src);return}state.ranOut=true}function pipeOnReadable(){if(this._readableState.ranOut){this._readableState.ranOut=false;flow(this)}}Readable.prototype.unpipe=function(dest){var state=this._readableState;if(state.pipesCount===0)return this;if(state.pipesCount===1){if(dest&&dest!==state.pipes)return this;if(!dest)dest=state.pipes;state.pipes=null;state.pipesCount=0;this.removeListener("readable",pipeOnReadable);state.flowing=false;if(dest)dest.emit("unpipe",this);return this}if(!dest){var dests=state.pipes;var len=state.pipesCount;state.pipes=null;state.pipesCount=0;this.removeListener("readable",pipeOnReadable);state.flowing=false;for(var i=0;i<len;i++)dests[i].emit("unpipe",this);return this}var i=indexOf(state.pipes,dest);if(i===-1)return this;state.pipes.splice(i,1);state.pipesCount-=1;if(state.pipesCount===1)state.pipes=state.pipes[0];dest.emit("unpipe",this);return this};Readable.prototype.on=function(ev,fn){var res=Stream.prototype.on.call(this,ev,fn);if(ev==="data"&&!this._readableState.flowing)emitDataEvents(this);if(ev==="readable"&&this.readable){var state=this._readableState;if(!state.readableListening){state.readableListening=true;state.emittedReadable=false;state.needReadable=true;if(!state.reading){this.read(0)}else if(state.length){emitReadable(this,state)}}}return res};Readable.prototype.addListener=Readable.prototype.on;Readable.prototype.resume=function(){emitDataEvents(this);this.read(0);this.emit("resume")};Readable.prototype.pause=function(){emitDataEvents(this,true);this.emit("pause")};function emitDataEvents(stream,startPaused){var state=stream._readableState;if(state.flowing){throw new Error("Cannot switch to old mode now.")}var paused=startPaused||false;var readable=false;stream.readable=true;stream.pipe=Stream.prototype.pipe;stream.on=stream.addListener=Stream.prototype.on;stream.on("readable",function(){readable=true;var c;while(!paused&&null!==(c=stream.read()))stream.emit("data",c);if(c===null){readable=false;stream._readableState.needReadable=true}});stream.pause=function(){paused=true;this.emit("pause")};stream.resume=function(){paused=false;if(readable)process.nextTick(function(){stream.emit("readable")});else this.read(0);this.emit("resume")};stream.emit("readable")}Readable.prototype.wrap=function(stream){var state=this._readableState;var paused=false;var self=this;stream.on("end",function(){if(state.decoder&&!state.ended){var chunk=state.decoder.end();if(chunk&&chunk.length)self.push(chunk)}self.push(null)});stream.on("data",function(chunk){if(state.decoder)chunk=state.decoder.write(chunk);if(state.objectMode&&(chunk===null||chunk===undefined))return;else if(!state.objectMode&&(!chunk||!chunk.length))return;var ret=self.push(chunk);if(!ret){paused=true;stream.pause()}});for(var i in stream){if(typeof stream[i]==="function"&&typeof this[i]==="undefined"){this[i]=function(method){return function(){return stream[method].apply(stream,arguments)}}(i)}}var events=["error","close","destroy","pause","resume"];forEach(events,function(ev){stream.on(ev,self.emit.bind(self,ev))});self._read=function(n){if(paused){paused=false;stream.resume()}};return self};Readable._fromList=fromList;function fromList(n,state){var list=state.buffer;var length=state.length;var stringMode=!!state.decoder;var objectMode=!!state.objectMode;var ret;if(list.length===0)return null;if(length===0)ret=null;else if(objectMode)ret=list.shift();else if(!n||n>=length){if(stringMode)ret=list.join("");else ret=Buffer.concat(list,length);list.length=0}else{if(n<list[0].length){var buf=list[0];ret=buf.slice(0,n);list[0]=buf.slice(n)}else if(n===list[0].length){ret=list.shift()}else{if(stringMode)ret="";else ret=new Buffer(n);var c=0;for(var i=0,l=list.length;i<l&&c<n;i++){var buf=list[0];var cpy=Math.min(n-c,buf.length);if(stringMode)ret+=buf.slice(0,cpy);else buf.copy(ret,c,0,cpy);if(cpy<buf.length)list[0]=buf.slice(cpy);else list.shift();c+=cpy}}}return ret}function endReadable(stream){var state=stream._readableState;if(state.length>0)throw new Error("endReadable called on non-empty stream");if(!state.endEmitted&&state.calledRead){state.ended=true;process.nextTick(function(){if(!state.endEmitted&&state.length===0){state.endEmitted=true;stream.readable=false;stream.emit("end")}})}}function forEach(xs,f){for(var i=0,l=xs.length;i<l;i++){f(xs[i],i)}}function indexOf(xs,x){for(var i=0,l=xs.length;i<l;i++){if(xs[i]===x)return i}return-1}}).call(this,require("_process"))},{_process:10,buffer:2,"core-util-is":381,events:6,inherits:382,isarray:383,stream:22,"string_decoder/":384}],379:[function(require,module,exports){arguments[4][15][0].apply(exports,arguments)},{"./_stream_duplex":376,"core-util-is":381,dup:15,inherits:382}],380:[function(require,module,exports){(function(process){module.exports=Writable;var Buffer=require("buffer").Buffer;Writable.WritableState=WritableState;var util=require("core-util-is");util.inherits=require("inherits");var Stream=require("stream");util.inherits(Writable,Stream);function WriteReq(chunk,encoding,cb){this.chunk=chunk;this.encoding=encoding;this.callback=cb}function WritableState(options,stream){options=options||{};var hwm=options.highWaterMark;this.highWaterMark=hwm||hwm===0?hwm:16*1024;this.objectMode=!!options.objectMode;this.highWaterMark=~~this.highWaterMark;this.needDrain=false;this.ending=false;this.ended=false;this.finished=false;var noDecode=options.decodeStrings===false;this.decodeStrings=!noDecode;this.defaultEncoding=options.defaultEncoding||"utf8";this.length=0;this.writing=false;this.sync=true;this.bufferProcessing=false;this.onwrite=function(er){onwrite(stream,er)};this.writecb=null;this.writelen=0;this.buffer=[];this.errorEmitted=false}function Writable(options){var Duplex=require("./_stream_duplex");if(!(this instanceof Writable)&&!(this instanceof Duplex))return new Writable(options);this._writableState=new WritableState(options,this);this.writable=true;Stream.call(this)}Writable.prototype.pipe=function(){this.emit("error",new Error("Cannot pipe. Not readable."))};function writeAfterEnd(stream,state,cb){var er=new Error("write after end");stream.emit("error",er);process.nextTick(function(){cb(er)})}function validChunk(stream,state,chunk,cb){var valid=true;if(!Buffer.isBuffer(chunk)&&"string"!==typeof chunk&&chunk!==null&&chunk!==undefined&&!state.objectMode){var er=new TypeError("Invalid non-string/buffer chunk");stream.emit("error",er);process.nextTick(function(){cb(er)});valid=false}return valid}Writable.prototype.write=function(chunk,encoding,cb){var state=this._writableState;var ret=false;if(typeof encoding==="function"){cb=encoding;encoding=null}if(Buffer.isBuffer(chunk))encoding="buffer";else if(!encoding)encoding=state.defaultEncoding;if(typeof cb!=="function")cb=function(){};if(state.ended)writeAfterEnd(this,state,cb);else if(validChunk(this,state,chunk,cb))ret=writeOrBuffer(this,state,chunk,encoding,cb);return ret};function decodeChunk(state,chunk,encoding){if(!state.objectMode&&state.decodeStrings!==false&&typeof chunk==="string"){chunk=new Buffer(chunk,encoding)}return chunk}function writeOrBuffer(stream,state,chunk,encoding,cb){chunk=decodeChunk(state,chunk,encoding);if(Buffer.isBuffer(chunk))encoding="buffer";var len=state.objectMode?1:chunk.length;state.length+=len;var ret=state.length<state.highWaterMark;if(!ret)state.needDrain=true;if(state.writing)state.buffer.push(new WriteReq(chunk,encoding,cb));else doWrite(stream,state,len,chunk,encoding,cb);return ret}function doWrite(stream,state,len,chunk,encoding,cb){state.writelen=len;state.writecb=cb;state.writing=true;state.sync=true;stream._write(chunk,encoding,state.onwrite);state.sync=false}function onwriteError(stream,state,sync,er,cb){if(sync)process.nextTick(function(){cb(er)});else cb(er);stream._writableState.errorEmitted=true;stream.emit("error",er)}function onwriteStateUpdate(state){state.writing=false;state.writecb=null;state.length-=state.writelen;state.writelen=0}function onwrite(stream,er){var state=stream._writableState;var sync=state.sync;var cb=state.writecb;onwriteStateUpdate(state);if(er)onwriteError(stream,state,sync,er,cb);else{var finished=needFinish(stream,state);if(!finished&&!state.bufferProcessing&&state.buffer.length)clearBuffer(stream,state);if(sync){process.nextTick(function(){afterWrite(stream,state,finished,cb)})}else{afterWrite(stream,state,finished,cb)}}}function afterWrite(stream,state,finished,cb){if(!finished)onwriteDrain(stream,state);cb();if(finished)finishMaybe(stream,state)}function onwriteDrain(stream,state){if(state.length===0&&state.needDrain){state.needDrain=false;stream.emit("drain")}}function clearBuffer(stream,state){state.bufferProcessing=true;for(var c=0;c<state.buffer.length;c++){var entry=state.buffer[c];var chunk=entry.chunk;var encoding=entry.encoding;var cb=entry.callback;var len=state.objectMode?1:chunk.length;doWrite(stream,state,len,chunk,encoding,cb);if(state.writing){c++;break}}state.bufferProcessing=false;if(c<state.buffer.length)state.buffer=state.buffer.slice(c);else state.buffer.length=0}Writable.prototype._write=function(chunk,encoding,cb){cb(new Error("not implemented"))};Writable.prototype.end=function(chunk,encoding,cb){var state=this._writableState;if(typeof chunk==="function"){cb=chunk;chunk=null;encoding=null}else if(typeof encoding==="function"){cb=encoding;encoding=null}if(typeof chunk!=="undefined"&&chunk!==null)this.write(chunk,encoding);if(!state.ending&&!state.finished)endWritable(this,state,cb)};function needFinish(stream,state){return state.ending&&state.length===0&&!state.finished&&!state.writing}function finishMaybe(stream,state){var need=needFinish(stream,state);if(need){state.finished=true;stream.emit("finish")}return need}function endWritable(stream,state,cb){state.ending=true;finishMaybe(stream,state);if(cb){if(state.finished)process.nextTick(cb);else stream.once("finish",cb)}state.ended=true}}).call(this,require("_process"))},{"./_stream_duplex":376,_process:10,buffer:2,"core-util-is":381,inherits:382,stream:22}],381:[function(require,module,exports){(function(Buffer){function isArray(ar){return Array.isArray(ar)}exports.isArray=isArray;function isBoolean(arg){return typeof arg==="boolean"}exports.isBoolean=isBoolean;function isNull(arg){return arg===null}exports.isNull=isNull;function isNullOrUndefined(arg){return arg==null}exports.isNullOrUndefined=isNullOrUndefined;function isNumber(arg){return typeof arg==="number"}exports.isNumber=isNumber;function isString(arg){return typeof arg==="string"}exports.isString=isString;function isSymbol(arg){return typeof arg==="symbol"}exports.isSymbol=isSymbol;function isUndefined(arg){return arg===void 0}exports.isUndefined=isUndefined;function isRegExp(re){return isObject(re)&&objectToString(re)==="[object RegExp]"}exports.isRegExp=isRegExp;function isObject(arg){return typeof arg==="object"&&arg!==null}exports.isObject=isObject;function isDate(d){return isObject(d)&&objectToString(d)==="[object Date]"}exports.isDate=isDate;function isError(e){return isObject(e)&&(objectToString(e)==="[object Error]"||e instanceof Error)}exports.isError=isError;function isFunction(arg){return typeof arg==="function"}exports.isFunction=isFunction;function isPrimitive(arg){return arg===null||typeof arg==="boolean"||typeof arg==="number"||typeof arg==="string"||typeof arg==="symbol"||typeof arg==="undefined"}exports.isPrimitive=isPrimitive;function isBuffer(arg){return Buffer.isBuffer(arg)}exports.isBuffer=isBuffer;function objectToString(o){return Object.prototype.toString.call(o)}}).call(this,require("buffer").Buffer)},{buffer:2}],382:[function(require,module,exports){arguments[4][7][0].apply(exports,arguments)},{dup:7}],383:[function(require,module,exports){arguments[4][8][0].apply(exports,arguments)},{dup:8}],384:[function(require,module,exports){arguments[4][23][0].apply(exports,arguments)},{buffer:2,dup:23}],385:[function(require,module,exports){arguments[4][19][0].apply(exports,arguments)},{"./lib/_stream_duplex.js":376,"./lib/_stream_passthrough.js":377,"./lib/_stream_readable.js":378,"./lib/_stream_transform.js":379,"./lib/_stream_writable.js":380,dup:19,stream:22}],386:[function(require,module,exports){arguments[4][349][0].apply(exports,arguments)},{dup:349}],387:[function(require,module,exports){module.exports={name:"levelup",description:"Fast & simple storage - a Node.js-style LevelDB wrapper",version:"0.19.0",contributors:[{name:"Rod Vagg",email:"r@va.gg",url:"https://github.com/rvagg"},{name:"John Chesley",email:"john@chesl.es",url:"https://github.com/chesles/"},{name:"Jake Verbaten",email:"raynos2@gmail.com",url:"https://github.com/raynos"},{name:"Dominic Tarr",email:"dominic.tarr@gmail.com",url:"https://github.com/dominictarr"},{name:"Max Ogden",email:"max@maxogden.com",url:"https://github.com/maxogden"},{name:"Lars-Magnus Skog",email:"lars.magnus.skog@gmail.com",url:"https://github.com/ralphtheninja"},{name:"David Bjrklund",email:"david.bjorklund@gmail.com",url:"https://github.com/kesla"},{name:"Julian Gruber",email:"julian@juliangruber.com",url:"https://github.com/juliangruber"},{name:"Paolo Fragomeni",email:"paolo@async.ly",url:"https://github.com/hij1nx"},{name:"Anton Whalley",email:"anton.whalley@nearform.com",url:"https://github.com/No9"},{name:"Matteo Collina",email:"matteo.collina@gmail.com",url:"https://github.com/mcollina"},{name:"Pedro Teixeira",email:"pedro.teixeira@gmail.com",url:"https://github.com/pgte"},{name:"James Halliday",email:"mail@substack.net",url:"https://github.com/substack"}],repository:{type:"git",url:"https://github.com/rvagg/node-levelup.git"},homepage:"https://github.com/rvagg/node-levelup",keywords:["leveldb","stream","database","db","store","storage","json"],main:"lib/levelup.js",dependencies:{bl:"~0.8.1","deferred-leveldown":"~0.2.0",errno:"~0.1.1",prr:"~0.0.0","readable-stream":"~1.0.26",semver:"~2.3.1",xtend:"~3.0.0"},devDependencies:{leveldown:"~0.10.0",bustermove:"*",tap:"*",referee:"*",rimraf:"*",async:"*",fstream:"*",tar:"*",mkfiletree:"*",readfiletree:"*","slow-stream":">=0.0.4",delayed:"*",boganipsum:"*",du:"*",memdown:"*","msgpack-js":"*"},browser:{leveldown:false,"leveldown/package":false,semver:false},scripts:{test:"tap test/*-test.js --stderr",functionaltests:"node ./test/functional/fstream-test.js && node ./test/functional/binary-data-test.js && node ./test/functional/compat-test.js",alltests:"npm test && npm run-script functionaltests"},license:"MIT",gitHead:"fb742b01990139b44b1816de87a6e1b2de629627",bugs:{url:"https://github.com/rvagg/node-levelup/issues"},_id:"levelup@0.19.0",_shasum:"f6b60a168c86c2fe5d5953476cbe9786ccf0a3f7",_from:"levelup@~0.19.0",_npmVersion:"1.4.23",_npmUser:{name:"rvagg",email:"rod@vagg.org"},maintainers:[{name:"rvagg",email:"rod@vagg.org"}],dist:{shasum:"f6b60a168c86c2fe5d5953476cbe9786ccf0a3f7",tarball:"http://registry.npmjs.org/levelup/-/levelup-0.19.0.tgz"},directories:{},_resolved:"https://registry.npmjs.org/levelup/-/levelup-0.19.0.tgz"}},{}],388:[function(require,module,exports){arguments[4][294][0].apply(exports,arguments)},{dup:294}],389:[function(require,module,exports){"use strict";var assign=require("./Object.assign");var merge=function(one,two){return assign({},one,two)};module.exports=merge;console.warn("react/lib/merge has been deprecated and will be removed in the "+"next version of React. All uses can be replaced with "+"Object.assign({}, a, b) or _.extend({}, a, b).")},{"./Object.assign":388}],390:[function(require,module,exports){var fix=require("level-fix-range");var extend=require("xtend");var through=require("through");var Emitter=require("events").EventEmitter;var inherits=require("util").inherits;module.exports=Sub;var sep="/";function Sub(db,path,options){if(!(this instanceof Sub))return new Sub(db,path,options);if("object"==typeof path){options=path;path=""}this.parent=db;this.db=this.top();this.path=this.pathJoin("\x00"+(path||""));this.options=options||{}}inherits(Sub,Emitter);Sub.prototype.top=function(){if(this.parent.top){return this.parent.top()}else{return this.parent}};Sub.prototype.pathJoin=function(path){if(this.parent.path){return this.parent.path+path+sep
}else{return path+sep}};Sub.prototype.prefix=function(key){return this.path+""+key};Sub.prototype.prefixer=function(){var prefix=this.path+"";return function(key){return prefix+key}};Sub.prototype.prefixRange=function(range){range=range||{};range.start=this.prefix(range.start||"");range.end=this.prefix(range.end||"");return fix(range)};Sub.prototype.unprefixReadStream=function(){var len=this.path.length+1;return through(function(data){data.key=data.key.substr(len);this.queue(data)})};Sub.prototype.unprefixKeyStream=function(){var len=this.path.length+1;return through(function(key){key=key.substr(len);this.queue(key)})};Sub.prototype.sublevel=function(name,options){return new Sub(this,name,extend(this.options,options))};Sub.prototype.normalize=function(options,fn){var args={};if("function"==typeof options){args.options=this.options;args.fn=options}else{args.options=extend(this.options,options);args.fn=fn}return args};Sub.prototype.put=function(key,value,options,fn){var args=this.normalize(options,fn);return this.db.put(this.prefix(key),value,args.options,args.fn)};Sub.prototype.get=function(key,options,fn){var args=this.normalize(options,fn);return this.db.get(this.prefix(key),args.options,args.fn)};Sub.prototype.del=function(key,options,fn){var args=this.normalize(options,fn);return this.db.del(this.prefix(key),args.options,args.fn)};Sub.prototype.batch=function(ops,options,fn){if(!arguments.length){return this.decorateChainedBatch(this.db.batch())}var args=this.normalize(options,fn);var prefix=this.prefixer();ops.forEach(function(op){op.key=op.prefix?op.prefix.prefix(op.key):prefix(op.key)});this.db.batch(ops,args.options,args.fn)};Sub.prototype.decorateChainedBatch=function(batch){var prefix=this.prefixer();var methods=["put","del"];methods.forEach(function(method){var original=batch[method];batch[method]=function(){var args=[].slice.call(arguments);args[0]=prefix(args[0]);return original.apply(batch,args)}});return batch};Sub.prototype.createReadStream=function(options){options=this.prefixRange(options);options=extend(this.options,options);var stream=this.db.createReadStream(options);return stream.pipe(this.unprefixReadStream())};Sub.prototype.createKeyStream=function(options){options=this.prefixRange(options);options=extend(this.options,options);var stream=this.db.createKeyStream(options);return stream.pipe(this.unprefixKeyStream())};Sub.prototype.createValueStream=function(options){options=this.prefixRange(options);options=extend(this.options,options);var stream=this.db.createValueStream(options);return stream};Sub.prototype.createWriteStream=function(options){options=extend(this.options,options);var stream=this.db.createWriteStream(options);var prefix=this.prefixer();var write=stream.write;stream.write=function(data){data.key=prefix(data.key);write.call(this,data)};return stream}},{events:6,"level-fix-range":391,through:393,util:25,xtend:395}],391:[function(require,module,exports){var clone=require("clone");module.exports=function fixRange(opts){opts=clone(opts);var reverse=opts.reverse;var end=opts.max||opts.end;var start=opts.min||opts.start;var range=[start,end];if(start!=null&&end!=null)range.sort();if(reverse)range=range.reverse();opts.start=range[0];opts.end=range[1];delete opts.min;delete opts.max;return opts}},{clone:392}],392:[function(require,module,exports){(function(Buffer){"use strict";function objectToString(o){return Object.prototype.toString.call(o)}var util={isArray:function(ar){return Array.isArray(ar)||typeof ar==="object"&&objectToString(ar)==="[object Array]"},isDate:function(d){return typeof d==="object"&&objectToString(d)==="[object Date]"},isRegExp:function(re){return typeof re==="object"&&objectToString(re)==="[object RegExp]"},getRegExpFlags:function(re){var flags="";re.global&&(flags+="g");re.ignoreCase&&(flags+="i");re.multiline&&(flags+="m");return flags}};if(typeof module==="object")module.exports=clone;function clone(parent,circular,depth,prototype){var allParents=[];var allChildren=[];var useBuffer=typeof Buffer!="undefined";if(typeof circular=="undefined")circular=true;if(typeof depth=="undefined")depth=Infinity;function _clone(parent,depth){if(parent===null)return null;if(depth==0)return parent;var child;var proto;if(typeof parent!="object"){return parent}if(util.isArray(parent)){child=[]}else if(util.isRegExp(parent)){child=new RegExp(parent.source,util.getRegExpFlags(parent));if(parent.lastIndex)child.lastIndex=parent.lastIndex}else if(util.isDate(parent)){child=new Date(parent.getTime())}else if(useBuffer&&Buffer.isBuffer(parent)){child=new Buffer(parent.length);parent.copy(child);return child}else{if(typeof prototype=="undefined"){proto=Object.getPrototypeOf(parent);child=Object.create(proto)}else{child=Object.create(prototype);proto=prototype}}if(circular){var index=allParents.indexOf(parent);if(index!=-1){return allChildren[index]}allParents.push(parent);allChildren.push(child)}for(var i in parent){var attrs;if(proto){attrs=Object.getOwnPropertyDescriptor(proto,i)}if(attrs&&attrs.set==null){continue}child[i]=_clone(parent[i],depth-1)}return child}return _clone(parent,depth)}clone.clonePrototype=function(parent){if(parent===null)return null;var c=function(){};c.prototype=parent;return new c}}).call(this,require("buffer").Buffer)},{buffer:2}],393:[function(require,module,exports){(function(process){var Stream=require("stream");exports=module.exports=through;through.through=through;function through(write,end,opts){write=write||function(data){this.queue(data)};end=end||function(){this.queue(null)};var ended=false,destroyed=false,buffer=[],_ended=false;var stream=new Stream;stream.readable=stream.writable=true;stream.paused=false;stream.autoDestroy=!(opts&&opts.autoDestroy===false);stream.write=function(data){write.call(this,data);return!stream.paused};function drain(){while(buffer.length&&!stream.paused){var data=buffer.shift();if(null===data)return stream.emit("end");else stream.emit("data",data)}}stream.queue=stream.push=function(data){if(_ended)return stream;if(data==null)_ended=true;buffer.push(data);drain();return stream};stream.on("end",function(){stream.readable=false;if(!stream.writable&&stream.autoDestroy)process.nextTick(function(){stream.destroy()})});function _end(){stream.writable=false;end.call(stream);if(!stream.readable&&stream.autoDestroy)stream.destroy()}stream.end=function(data){if(ended)return;ended=true;if(arguments.length)stream.write(data);_end();return stream};stream.destroy=function(){if(destroyed)return;destroyed=true;ended=true;buffer.length=0;stream.writable=stream.readable=false;stream.emit("close");return stream};stream.pause=function(){if(stream.paused)return;stream.paused=true;return stream};stream.resume=function(){if(stream.paused){stream.paused=false;stream.emit("resume")}drain();if(!stream.paused)stream.emit("drain");return stream};return stream}}).call(this,require("_process"))},{_process:10,stream:22}],394:[function(require,module,exports){arguments[4][354][0].apply(exports,arguments)},{dup:354}],395:[function(require,module,exports){arguments[4][355][0].apply(exports,arguments)},{"./has-keys":394,dup:355,"object-keys":397}],396:[function(require,module,exports){arguments[4][356][0].apply(exports,arguments)},{dup:356}],397:[function(require,module,exports){arguments[4][357][0].apply(exports,arguments)},{"./shim":399,dup:357}],398:[function(require,module,exports){arguments[4][358][0].apply(exports,arguments)},{dup:358}],399:[function(require,module,exports){arguments[4][359][0].apply(exports,arguments)},{"./foreach":396,"./isArguments":398,dup:359}],400:[function(require,module,exports){var Level=require("./level"),leveljs=require("level-js");module.exports=Ixdb;function Ixdb(opts){Level.call(this,leveljs,opts)}Ixdb.prototype=Object.create(Level.prototype);Ixdb.prototype.constructor=Ixdb},{"./level":401,"level-js":344}],401:[function(require,module,exports){var levelup=require("levelup"),sublevel=require("sublevel"),async=require("async");module.exports=Level;function Level(backend,opts){this.prefix=(opts&&opts.prefix||"ixdb")+":";this._db=sublevel(levelup(this.prefix,{db:backend,valueEncoding:"json"}));this._subs={}}Level.prototype={findAll:function(type,done){if(!this._subs[type]){this._subs[type]=this._db.sublevel(type)}var nodes=[];this._subs[type].createValueStream().on("data",function(data){return nodes.push(data)}).on("error",function(err){return done(err)}).on("end",function(){return done(null,nodes)})},save:function(type,id,value,done){if(!this._subs[type]){this._subs[type]=this._db.sublevel(type)}this._subs[type].put(id,value,done)},set:function(type,id,attr,value,done){if(!this._subs[type]){this._subs[type]=this._db.sublevel(type)}this._subs[type].get(id,function(err,val){if(err)return done(err);val[attr]=value;this._subs[type].put(id,val,done)}.bind(this))},batchSave:function(type,nodes,done){if(!this._subs[type]){this._subs[type]=this._db.sublevel(type)}var ops=[];for(var id in nodes){ops.push({type:"put",key:id,value:nodes[id]})}this._subs[type].batch(ops,done)},batchSet:function(type,attr,ids,value,done){if(!this._subs[type]){this._subs[type]=this._db.sublevel(type)}var gets={};ids.forEach(function(id){return gets[id]=function(next){return this._subs[type].get(id,next)}.bind(this)}.bind(this));async.parallel(gets,function(err,items){if(err)return done(err);console.log(items,ids);var ops=ids.map(function(id,i){var node=items[id];if(Array.isArray(value)){node[attr]=value[i]}else{node[attr]=value}return{type:"put",key:id,value:node}});console.log("batch-set",ops);this._subs[type].batch(ops,done)}.bind(this))},update:function(type,id,update,done){if(!this._subs[type]){this._subs[type]=this._db.sublevel(type)}this._subs[type].get(id,function(err,val){if(err)return done(err);for(var name in update){val[name]=update[name]}this._subs[type].put(id,val,done)}.bind(this))},remove:function(type,id,done){if(!this._subs[type]){this._subs[type]=this._db.sublevel(type)}this._subs[type].del(id,done)}}},{async:"async",levelup:364,sublevel:390}],402:[function(require,module,exports){module.exports=Mem;function Mem(options){this.o=options;this.data={}}Mem.prototype={findAll:function(type,done){var res=[];if(!this.data[type])return done(null,res);for(var id in this.data[type]){res.push(this.data[type][id])}done(null,res)},save:function(type,id,value,done){if(!this.data[type]){this.data[type]={}}this.data[type][id]=value;done&&done()},set:function(type,id,attr,value,done){this.data[type][id][attr]=value;done&&done()},batchSave:function(type,nodes,done){if(!this.data[type]){this.data[type]={}}for(var id in nodes){this.data[type][id]=nodes[id]}done&&done()},batchSet:function(type,attr,ids,value,done){if(Array.isArray(value)){for(var i=0;i<ids.length;i++){this.data[type][ids[i]][attr]=value[i]}}else{for(var i=0;i<ids.length;i++){this.data[type][ids[i]][attr]=value}}done&&done()},update:function(type,id,update,done){for(var name in update){this.data[type][id][name]=update[name]}done&&done()},remove:function(type,id,done){delete this.data[type][id];done&&done()}}},{}],403:[function(require,module,exports){module.exports=Queue;function Queue(db){this.db=db;this._queue=[]}Queue.prototype={findAll:function(){return this.db.findAll.apply(this.db,arguments)},opper:function(name,args,done){this._queue.push([name,args,done]);if(!this.busy){this.advance()}},advance:function(){if(!this._queue.length){this.busy=false;return}this.busy=true;var item=this._queue.shift();this.db[item[0]].apply(this.db,item[1].concat([function(err){if(err)console.error("DB ERROR",err);this.advance();if(item[2])item[2].apply(null,arguments)}.bind(this)]))},save:function(type,id,value,done){this.opper("save",[type,id,value],done)},set:function(type,id,attr,value,done){this.opper("set",[type,id,attr,value],done)},batchSave:function(type,nodes,done){this.opper("batchSave",[type,nodes],done)},batchSet:function(type,attr,ids,value,done){this.opper("batchSet",[type,attr,ids,value],done)},update:function(type,id,update,done){this.opper("update",[type,id,update],done)},remove:function(type,id,done){this.opper("remove",[type,id],done)}}},{}],404:[function(require,module,exports){var movement=require("../../util/movement");module.exports={title:"Clipboard",keys:{remove:{},cut:{normal:"d d, shift+d, ctrl+x, delete",visual:"d, shift+d, ctrl+x, delete"},copy:{normal:"y y, shift+y, ctrl+c",visual:"y, shift+y, ctrl+c"},paste:{normal:"p, ctrl+v",visual:"p, ctrl+v"},"paste above":{normal:"shift+p",visual:"shift+p"}},contextMenu:function(node,store){var plural=store.view.mode==="visual"&&store.view.selection.length>1,nodeText=plural?"nodes":"node";return[{title:"Copy "+nodeText,action:"copy",shortcut:"y y"},{title:"Cut "+nodeText,action:"cut",shortcut:"d d"},{title:"Paste after",action:"paste",shortcut:"p",disabled:!store.globals.clipboard}]},store:{init:function(store){store._globals.clipboard=null},actions:{copy:function(id){var sel=window.getSelection();if(sel.type==="Range"&&!sel.getRangeAt(0).collapsed){return true}id=id||this.view.active;if(this.view.mode==="visual"){ids=this.view.selection;this.setMode("normal")}else{ids=[id]}this.globals.clipboard=this.db.exportMany(ids)},cut:function(id){var sel=window.getSelection();if(sel.type==="Range"&&!sel.getRangeAt(0).collapsed){return true}id=id||this.view.active;if(id===this.view.root)return;if(this.view.mode==="visual"){ids=this.view.selection;next=movement.down(ids[ids.length-1],this.view.root,this.db.nodes,true);this.setMode("normal",true)}else{ids=[id];next=movement.down(id,this.view.root,this.db.nodes,true)}if(!next){next=movement.up(ids[0],this.view.root,this.db.nodes)}if(this.view.mode==="insert"){document.activeElement.blur()}this.view.active=next;this.globals.clipboard=this.db.exportMany(ids);this.executeCommand("remove",{ids:ids});this.changed(this.events.nodeChanged(next))},paste:function(id){if(!this.globals.clipboard)return;this.importTrees(id,this.globals.clipboard)},pasteAbove:function(id){if(!this.globals.clipboard)return;this.importTrees(id,this.globals.clipboard,true)}}}}},{"../../util/movement":428}],405:[function(require,module,exports){module.exports={title:"Collapser",store:require("./store"),node:require("./node"),keys:require("./keys")}},{"./keys":406,"./node":407,"./store":408}],406:[function(require,module,exports){module.exports={"toggle collapse deep":{description:"Toggle the collapse of the current item and all children",normal:"shift+z",visual:"shift+z"},"toggle collapse":{description:"Toggle the collapse of the current item",normal:"z",visual:"z"}}},{}],407:[function(require,module,exports){var React=require("react/addons");var cx=React.addons.classSet;var slide=require("../../util/slide");module.exports={classes:function(node,state){var cls=[];if(node.collapsed){cls.push("n_Collapse")}if(node.children.length){cls.push("TreeItem-parent")}return cls.join(" ")},componentDidUpdate:function(prevProps,prevState){if(this.props.isRoot)return;var c=this.state.node.collapsed;if(!this.refs||!this.refs.children)return;if(this._prev_collapsed===c)return;this._prev_collapsed=c;var el=this.refs.children.getDOMNode();if(c){slide.up(el)}else{slide.down(el)}},blocks:{left:function(node,actions){return React.DOM.div({className:cx({m_Collapser:true,"m_Collapser-collapsed":node.collapsed}),onClick:actions.toggleCollapse.bind(actions,node.id)})}}}},{"../../util/slide":429,"react/addons":"react/addons"}],408:[function(require,module,exports){module.exports={actions:{collapse:function(id){if(!arguments.length)id=this.view.active;if(id===this.view.root)return;if(this.view.mode==="visual"){var ids=this.view.selection.filter(function(id){return!!this.db.nodes[id].children.length}.bind(this));if(!ids.length)return;return this.setMany("collapsed",ids,true)}if(!this.db.nodes[id].children.length){var pid=this.db.nodes[id].parent;if(pid!==this.view.root){this.set(pid,"collapsed",true);this.setActive(id)}return}this.set(id,"collapsed",true);this.setActive(id)},expand:function(id){if(!arguments.length)id=this.view.active;if(id===this.view.root)return;if(this.view.mode==="visual"){var ids=this.view.selection.filter(function(id){return!!this.db.nodes[id].children.length}.bind(this));if(!ids.length)return;return this.setMany("collapsed",ids,true)}if(!this.db.nodes[id].children.length){return}this.set(id,"collapsed",false);this.setActive(id)},expandToAndSelect:function(id){var node=this.db.nodes[id],root=this.view.root,parent=node.parent,current=parent,toOpen=[];if(id!==root){while(current!==root){var node=this.db.nodes[current];if(node.collapsed)toOpen.push(current);current=node.parent}}if(toOpen.length)this.setMany("collapsed",toOpen,false);this.setActive(id)},toggleCollapseDeep:function(id){if(!arguments.length)id=this.view.active;if(this.view.mode==="visual"){ids=this.view.selection}else{var node=this.db.nodes[id];if(!node.children.length)return;ids=[id]}var allParents=function(id){var node=this.db.nodes[id];if(!node.children.length)return[];return[].concat.apply([id],node.children.map(allParents))}.bind(this);pedigrees=ids.map(allParents);var commands=pedigrees.map(function(ids){return["setMany",{ids:ids,attr:"collapsed",values:!this.db.nodes[ids[0]].collapsed}]}.bind(this));this.executeCommands.apply(this,[].concat.apply([],commands))},toggleCollapse:function(id){if(!arguments.length)id=this.view.active;if(id===this.view.root)return;if(this.view.mode==="visual"){var ids=this.view.selection.filter(function(id){return!!this.db.nodes[id].children.length}.bind(this));if(!ids.length)return;return this.setMany("collapsed",ids,ids.map(function(id){return!this.db.nodes[id].collapsed}.bind(this)))}if(!this.db.nodes[id].children.length){var pid=this.db.nodes[id].parent;if(pid===this.view.root)return;this.setActive(pid);this.set(pid,"collapsed",true);return}this.set(id,"collapsed",!this.db.nodes[id].collapsed);this.setActive(id)}}}},{}],409:[function(require,module,exports){module.exports=getSrc;function getSrc(file,done){if(!file)return;var reader=new FileReader;reader.onload=function(e){done(e.target.result)};reader.onerror=function(e){console.log(e)};reader.readAsDataURL(file)}},{}],410:[function(require,module,exports){var React=require("react/addons"),cx=React.addons.classSet,PT=React.PropTypes,DefaultEditor=require("../../views/body/default-editor"),DefaultRenderer=require("../../views/body/default-renderer"),Uploader=require("./uploader"),getSrc=require("./get-src");var ImageBase=React.createClass({displayName:"ImageBase",propType:{title:PT.string,onUpload:PT.func,onClick:PT.func},render:function(){if(!this.props.src){return Uploader({onUpload:this.props.onUpload})}return React.DOM.div({onClick:this.props.onClick,className:"ImageBase"},React.DOM.img({src:this.props.src,title:this.props.title}),React.DOM.div({onClick:function(e){e.stopPropagation();this.props.onUpload(null)}.bind(this),className:"ImageBase_close"},""))}});var ImageRenderer=React.createClass({displayName:"ImageRenderer",render:function(){var img=ImageBase({src:this.props.src,title:this.props.title,onClick:this.props.onClick,onUpload:this.props.setSrc});if(this.props.title&&this.props.title.trim()){return React.DOM.div(null,img,DefaultRenderer({onClick:this.props.onClick,content:this.props.title}))}return img}});var ImageEditor=React.createClass({displayName:"ImageEditor",focus:function(){return this.refs.text.focus.apply(null,arguments)},isFocused:function(){return this.refs.text.isFocused.apply(null,arguments)},_onPaste:function(e){var file=e.clipboardData.items[0].getAsFile();if(!file)return;e.preventDefault();getSrc(file,this.props.setSrc)},render:function(){var props=this.props.editProps;props.onPaste=this._onPaste;return React.DOM.div(null,ImageBase({src:this.props.src,title:this.props.title,onUpload:this.props.setSrc}),React.createElement(DefaultEditor,props))}});module.exports={title:"Image Node",types:{image:{title:"Image",shortcut:"i"}},contextMenu:function(node,store){if(node.imageSrc){return{title:"Remove image",action:"removeImage"}}},store:{actions:{removeImage:function(id){if(!id)id=this.view.active;this.set(id,"imageSrc",null)}}},node:{bodies:{image:{renderer:function(){var click=function(){if(this.props.editState)return;this.props.actions.edit(this.props.node.id)}.bind(this);var setSrc=this.props.store.actions.set.bind(this.props.store.actions,this.props.node.id,"imageSrc");return ImageRenderer({onClick:click,setSrc:setSrc,src:this.props.node.imageSrc,title:this.props.node.content})},editor:function(props){var setSrc=props.store.actions.set.bind(props.store.actions,props.node.id,"imageSrc");return ImageEditor({editProps:props,setSrc:setSrc,ref:props.ref,src:props.node.imageSrc,title:props.node.content})}}}}}},{"../../views/body/default-editor":432,"../../views/body/default-renderer":433,"./get-src":409,"./uploader":411,"react/addons":"react/addons"}],411:[function(require,module,exports){var React=require("react/addons"),cx=React.addons.classSet,PT=React.PropTypes,getSrc=require("./get-src");var Uploader=React.createClass({displayName:"Uploader",propTypes:{onUpload:PT.func},_onClick:function(){this.refs.file.getDOMNode().click()},_onChange:function(e){var files=e.target.files;if(!files||!files.length)return;getSrc(files[0],this.props.onUpload)},render:function(){return React.DOM.div({className:"Uploader"},React.DOM.h3({onClick:this._onClick},"Click to upload an image"),React.DOM.input({type:"file",ref:"file",onChange:this._onChange,style:{display:"none"}}))}});module.exports=Uploader},{"./get-src":409,"react/addons":"react/addons"}],412:[function(require,module,exports){module.exports={title:"List Item Nodes",types:{list:{shortcut:"l",title:"List"},ordered_list:{shortcut:"o",title:"Ordered List"}}}},{}],413:[function(require,module,exports){var React=require("react/addons");var cx=React.addons.classSet;var PT=React.PropTypes;var Breadcrumb=React.createClass({displayName:"Breadcrumb",propTypes:{rebase:PT.func,reload:PT.func},getInitialState:function(){return{pedigree:this.props.reload()}},componentDidMount:function(){this.props.store.on([this.props.store.events.rootChanged()],this._reload)},componentWillUnmount:function(){this.props.store.off([this.props.store.events.rootChanged()],this._reload)},_reload:function(){this.setState({pedigree:this.props.reload()})},render:function(){return React.DOM.ul({className:"Breadcrumb"},this.state.pedigree.map(function(item){return React.DOM.li({onClick:this.props.rebase.bind(null,item.id),className:"Breadcrumb_item"},item.content.slice(0,25))}.bind(this)))}});module.exports=Breadcrumb},{"react/addons":"react/addons"}],414:[function(require,module,exports){var Breadcrumb=require("./breadcrumb");module.exports={title:"Zoom In/Out",store:require("./store"),node:require("./node"),keys:require("./keys"),view:{statusbar:function(store){var actions=store.actions;return Breadcrumb({rebase:actions.rebase.bind(actions),reload:store.getters.getPedigree.bind(store.getters,true),store:store})},blocks:{top:function(actions,state,store){return Breadcrumb({rebase:actions.rebase.bind(actions),reload:store.getters.getPedigree.bind(store.getters,true),store:store})}}}}},{"./breadcrumb":413,"./keys":415,"./node":416,"./store":417}],415:[function(require,module,exports){module.exports={rebase:{title:"zoom in to active node",description:"zoom to the active node",normal:"g d"},"rebase up":{title:"zoom out one level",description:"zoom to the current root's parent",normal:"g u"},"rebase root":{title:"zoom out to document root",description:"zoom to the document root",normal:"g r"}}},{}],416:[function(require,module,exports){var React=require("react/addons");var cx=React.addons.classSet;module.exports={blocks:{left:function(node,actions,state){return React.DOM.div({className:cx({m_RebaseDot:true,"m_RebaseDot-full":node.collapsed&&node.children.length}),key:"rebase",onClick:actions.rebase.bind(actions,node.id)})}}}},{"react/addons":"react/addons"}],417:[function(require,module,exports){module.exports={actions:{rebase:function(id){id=id||this.view.active;this.view.root=id;this.setActive(this.view.root);this.changed(this.events.rootChanged())},rebaseUp:function(){if(this.view.root===this.db.root)return;this.setActive(this.view.root);this.view.root=this.db.nodes[this.view.root].parent;this.changed(this.events.rootChanged())},rebaseRoot:function(){if(this.view.root===this.db.root)return;this.setActive(this.db.root);this.view.root=this.db.root;this.changed(this.events.rootChanged())}},getters:{getPedigree:function(last){var items=[];var node=this.db.nodes[this.view.root];if(!last){node=this.db.nodes[node.parent]}while(node){items.unshift({id:node.id,content:node.content});node=this.db.nodes[node.parent]}return items}}}},{}],418:[function(require,module,exports){var React=require("react/addons");var cx=React.addons.classSet;module.exports={title:"To-Do Items",types:{todo:{shortcut:"t",title:"Todo",description:"A to-do item"}},keys:{"toggle done":{type:"todo",normal:"alt+enter",insert:"alt+enter",visual:"alt+enter"}},store:{actions:{toggleDone:function(id){if(!arguments.length)id=this.view.active;if(this.db.nodes[id].type!=="todo")return;if(this.view.mode==="visual"){this.setMany("done",this.view.selection,this.view.selection.map(function(id){return!this.db.nodes[id].done}.bind(this)))}else{this.set(id,"done",!this.db.nodes[id].done)}}}},node:{classes:function(node,state){if(node.type!=="todo")return;return node.done?"n_Done":""},blocks:{abovebody:function(node,actions){if(node.type!=="todo")return;return React.DOM.div({className:cx({m_Todo:true,"m_Todo-done":node.done}),onClick:actions.toggleDone.bind(actions,node.id)})}}}}},{"react/addons":"react/addons"}],419:[function(require,module,exports){function clone(obj){var a={};for(var name in obj){a[name]=obj[name]}return a}function cap(text){return text[0].toUpperCase()+text.slice(1)}module.exports={title:"Set type to",keys:function(plugins){var keys={};plugins.forEach(function(plugin){if(!plugin.types)return;for(var name in plugin.types){var sh=plugin.types[name].shortcut||plugin.types[name];keys["type "+name]={title:plugin.types[name].title||name,visual:"t "+sh+", alt+t "+sh,normal:"t "+sh+", alt+t "+sh,insert:"alt+t "+sh}}});return keys},contextMenu:function(node,store){if(!node)return;var items=[],plugins=store.parent.allPlugins;plugins.forEach(function(plugin){if(!plugin.types)return;for(var name in plugin.types){var type=plugin.types[name];var sh=type.shortcut||type;items.push({title:type.title||name,shortcut:"t "+sh,icon:type.icon,action:"type"+cap(name),disabled:name===node.type})}});return{title:"Set type",children:items}},types:{base:{shortcut:"n",title:"Normal"}},store:{actions:function(plugins){var actions={changeType:function(id,type,update){if(!id){ids=this.view.mode==="visual"?this.view.selection:[this.view.active]}else{ids=[id]}var refocus;if(this.view.mode==="insert"){refocus=document.activeElement;document.activeElement.blur()}update.type=type;if(ids.length>1){this.updateMany(ids,ids.map(function(){return clone(update)}))}else{this.update(ids[0],clone(update))}if(refocus){refocus.focus();this.setMode("insert")}}};plugins.forEach(function(plugin){if(!plugin.types)return;Object.keys(plugin.types).forEach(function(name){var defn=plugin.types[name];actions["type"+cap(name)]=function(id){var update={};if(defn.update){if("function"===typeof defn.update){update=defn.update()}else{update=defn.update}}this.changeType(id,name,update)}})}.bind(this));return actions}}}},{}],420:[function(require,module,exports){module.exports={title:"Undo/Redo",keys:{undo:{normal:"u, ctrl+z",visual:"u, ctrl+z"},redo:{normal:"shift+r, ctrl+shift+z",visual:"shift+r, ctrl+shift+z"}},store:{actions:{undo:function(){this.parent.cmd.undoCommands()},redo:function(){this.parent.cmd.redoCommands()}}}}},{}],421:[function(require,module,exports){var movement=require("../util/movement"),Menu=require("../lib/context-menu");module.exports={set:function(id,attr,value,squash){return this.executeCommand("set",{id:id,attr:attr,value:value},squash)},updateMany:function(ids,updates,squash){return this.executeCommand("updateMany",{ids:ids,updates:updates},squash)},update:function(id,update,squash){return this.executeCommand("update",{id:id,update:update},squash)},importTrees:function(id,trees,above){id=id||this.view.active;if(above&&id===this.root)return;var node=this.db.nodes[id],pid,ix;if(above){pid=node.parent;ix=this.db.nodes[pid].children.indexOf(id)}else{if(node.children.length&&!node.collapsed||id===this.view.root){pid=id;ix=0}else{pid=node.parent;ix=this.db.nodes[pid].children.indexOf(id)+1}}this.executeCommand("importTrees",{pid:pid,index:ix,data:trees},function(err,cState){if(cState.created.ids.length>1){this.setMode("visual");this.setSelection(cState.created.ids)}this.setActive(cState.created.ids[0])}.bind(this))},setMany:function(attr,ids,values){this.executeCommand("setMany",{ids:ids,attr:attr,values:values})},setContent:function(id,value){this.set(id,"content",value)},setActiveView:function(){if(this.view.id!==this.parent.activeView){console.log("changing active view",this.view.id);this.parent.activeView=this.view.id;this.changed(this.events.activeViewChanged())}},setActive:function(id){if(!id||!this.db.nodes[id])return;var old=this.view.active;this.setActiveView();if(id===this.view.active)return;this.view.active=id;if(this.view.mode==="visual"){var vix=this.view.selection.indexOf(id);if(vix===-1){this.setMode("normal")}else if(vix!==0&&vix!==this.view.selection.length-1){this.pullBackSelectionTo(id)}}if(this.view.mode==="insert")this.view.editPos="end";if(!this.db.nodes[old]){this.changed(this.events.nodeViewChanged(id))}else{this.changed(this.events.nodeViewChanged(old),this.events.nodeViewChanged(id))}return true},goUp:function(){var up=movement.up(this.view.active,this.view.root,this.db.nodes);if(!up)return false;this.setActive(up);return},pageUp:function(){var curr=this.view.active,up;for(var i=0;i<10;i++){up=movement.up(curr,this.view.root,this.db.nodes);if(!up)break;curr=up}this.setActive(curr);return},pageDown:function(){var curr=this.view.active,down;for(var i=0;i<10;i++){down=movement.down(curr,this.view.root,this.db.nodes);if(!down)break;curr=down}this.setActive(curr);return},goDown:function(editStart){var down=movement.down(this.view.active,this.view.root,this.db.nodes);if(!down)return false;this.setActive(down);if(editStart)this.view.editPos="start";return},goLeft:function(){this.setActive(movement.left(this.view.active,this.view.root,this.db.nodes))},goRight:function(){this.setActive(movement.right(this.view.active,this.view.root,this.db.nodes))},pullBackSelectionTo:function(id){this.setSelection(this.view.selection.slice(0,this.view.selection.indexOf(id)+1))},setSelection:function(ids){var changed=ids;if(this.view.selection){changed=this.view.selection.concat(ids)}this.view.selection=ids;this.changed.apply(this,changed.map(function(id){return this.events.nodeViewChanged(id)}.bind(this)))},toggleSelectionEdge:function(){if(this.view.mode!=="visual"||this.view.selection.length<=1)return;if(this.view.active===this.view.selection[0]){this.setActive(this.view.selection[this.view.selection.length-1])}else{this.setActive(this.view.selection[0])}},extendToFirstSibling:function(){if(this.view.active===this.view.root)return;var pid=this.db.nodes[this.view.active].parent,parent=this.db.nodes[pid],i=parent.children.indexOf(this.view.active);if(i===0)return;if(this.view.selection[0]===this.view.active){this.view.selection=parent.children.slice(0,i).concat(this.view.selection);this.changed(this.view.selection.map(function(id){return this.events.nodeViewChanged(id)}.bind(this)))}else{this.changed(this.view.selection.map(function(id){return this.events.nodeViewChanged(id)}.bind(this)));this.view.selection=parent.children.slice(0,i+1);this.changed(this.view.selection.map(function(id){return this.events.nodeViewChanged(id)}.bind(this)))}this.setActive(parent.children[0])},extendToLastSibling:function(){if(this.view.active===this.view.root)return;var pid=this.db.nodes[this.view.active].parent,parent=this.db.nodes[pid],i=parent.children.indexOf(this.view.active);
if(i===parent.children.length-1)return;if(this.view.selection[0]===this.view.active){this.changed(this.view.selection.map(function(id){return this.events.nodeViewChanged(id)}.bind(this)));this.view.selection=parent.children.slice(i);this.changed(this.view.selection.map(function(id){return this.events.nodeViewChanged(id)}.bind(this)))}else{this.view.selection=this.view.selection.concat(parent.children.slice(i+1));this.changed(this.view.selection.map(function(id){return this.events.nodeViewChanged(id)}.bind(this)))}this.setActive(parent.children[parent.children.length-1])},extendSelectionUp:function(){if(this.view.active===this.view.root)return;var pid=this.db.nodes[this.view.active].parent,parent=this.db.nodes[pid],i=parent.children.indexOf(this.view.active);if(i===0)return;var prev=parent.children[i-1];if(this.view.selection[0]===this.view.active){this.view.selection.unshift(prev)}else{this.view.selection.pop()}this.setActive(prev)},extendSelectionDown:function(){if(this.view.active===this.view.root)return;var pid=this.db.nodes[this.view.active].parent,parent=this.db.nodes[pid],i=parent.children.indexOf(this.view.active);if(i===parent.children.length-1)return;var next=parent.children[i+1];if(this.view.selection[this.view.selection.length-1]===this.view.active){this.view.selection.push(next)}else{this.view.selection.shift()}this.setActive(next)},joinUp:function(id,text){id=id||this.view.active;if(id===this.view.root)return;var prev=movement.up(id,this.view.root,this.db.nodes);if(prev===id)return;if(!prev)return;var content=this.db.nodes[prev].content+text,at=this.db.nodes[prev].content.length;this.executeCommands("remove",{ids:[id]},"set",{id:prev,attr:"content",value:content},function(){setTimeout(function(){this.editAt(prev,at)}.bind(this),0)}.bind(this))},joinDown:function(id){if(!arguments.length&&this.view.mode==="visual"){return this.joinMany()}id=id||this.view.active;if(id===this.view.root)return;var next=movement.down(id,this.view.root,this.db.nodes);if(!next)return;var content=this.db.nodes[id].content+"\n"+this.db.nodes[next].content;this.executeCommands("set",{id:id,attr:"content",value:content},"remove",{ids:[next]})},joinMany:function(){if(this.view.mode!=="visual")return;var ids=this.view.selection;var contents=this.db.nodes[ids[0]].content;for(var i=1;i<ids.length;i++){contents+="\n"+this.db.nodes[ids[i]].content}this.executeCommands("set",{id:ids[0],attr:"content",value:contents},"remove",{ids:ids.slice(1)});this.setActive(ids[0])},removeEmpty:function(id){id=id||this.view.active;if(id===this.view.root)return;var next=movement.up(id,this.view.root,this.db.nodes);this.view.active=next;this.executeCommand("remove",{ids:[id]});this.changed(this.events.nodeChanged(next))},remove:function(id){id=id||this.view.active;if(id===this.view.root)return;var next,ids;if(this.view.mode==="visual"){ids=this.view.selection;next=movement.down(ids[ids.length-1],this.view.root,this.db.nodes,true);this.setMode("normal",true)}else{ids=[id];next=movement.down(id,this.view.root,this.db.nodes,true)}if(!next){next=movement.up(ids[0],this.view.root,this.db.nodes)}this.view.active=next;this.executeCommand("remove",{ids:ids});this.changed(this.events.nodeChanged(next))},indent:function(id){if(!arguments.length&&this.view.mode==="visual"){return this.indentMany()}id=id||this.view.active;var pos=movement.indent(id,this.view.root,this.db.nodes);if(!pos)return;var wasEditing=false;if(this.view.mode==="insert"){document.activeElement.blur();wasEditing=true}this.executeCommand("move",{id:id,npid:pos.npid,nextIsRoot:pos.npid===this.view.root,nindex:pos.nindex});if(wasEditing){this.edit()}},indentMany:function(){if(this.view.mode!=="visual")return;var ids=this.view.selection;var pos=movement.indent(ids[0],this.view.root,this.db.nodes);if(!pos)return;this.executeCommand("moveMany",{ids:ids,npid:pos.npid,nextIsRoot:pos.npid===this.view.root,nindex:pos.nindex})},dedentMany:function(){if(this.view.mode!=="visual")return;var ids=this.view.selection;var pos=movement.dedent(ids[0],this.view.root,this.db.nodes);if(!pos)return;this.executeCommand("moveMany",{ids:ids,npid:pos.npid,nextIsRoot:pos.npid===this.view.root,nindex:pos.nindex})},dedent:function(id){if(!arguments.length&&this.view.mode==="visual"){return this.dedentMany()}id=id||this.view.active;var pos=movement.dedent(id,this.view.root,this.db.nodes);if(!pos)return;var wasEditing=false;if(this.view.mode==="insert"){document.activeElement.blur();wasEditing=true}this.executeCommand("move",{id:id,npid:pos.npid,nextIsRoot:pos.npid===this.view.root,nindex:pos.nindex});if(wasEditing){this.edit()}},moveDown:function(id){id=id||this.view.active;if(this.view.mode==="visual"){ids=this.view.selection}else{ids=[id]}var pos=movement.below(ids[ids.length-1],this.view.root,this.db.nodes);if(!pos)return;this.executeCommand("moveMany",{ids:ids,npid:pos.pid,nextIsRoot:pos.pid===this.view.root,nindex:pos.ix})},moveUp:function(id){id=id||this.view.active;if(this.view.mode==="visual"){ids=this.view.selection}else{ids=[id]}var pos=movement.above(ids[0],this.view.root,this.db.nodes);if(!pos)return;this.executeCommand("moveMany",{ids:ids,npid:pos.pid,nextIsRoot:pos.pid===this.view.root,nindex:pos.ix})},createBefore:function(id){id=id||this.view.active;var node=this.db.nodes[id];if(id===this.view.root)return;this.executeCommand("create",{pid:node.parent,type:node.type,ix:this.db.nodes[node.parent].children.indexOf(id)},function(err,cmd){this.edit(cmd.id)}.bind(this))},createAfter:function(id,split,after){id=id||this.view.active;var node=this.db.nodes[id],pos;if(id===this.view.root||node.children.length&&!node.collapsed){pos={pid:id,type:node.type,ix:0}}else{pos={pid:node.parent,type:node.type,ix:this.db.nodes[node.parent].children.indexOf(id)+1}}if(arguments.length===3){pos.content=after;this.executeCommands("set",{id:id,attr:"content",value:split},"create",pos,function(err,cmd){this.editStart(cmd.id)}.bind(this))}else{this.executeCommand("create",pos,function(err,cmd){this.edit(cmd.id)}.bind(this))}},visualMode:function(){this.view.selection=[this.view.active];this.changed(this.events.nodeViewChanged(this.view.active));this.setMode("visual")},setMode:function(mode,quiet){if(this.view.mode===mode)return;if(this.view.mode==="visual"){if(!quiet){this.changed(this.view.selection.map(function(id){return this.events.nodeViewChanged(id)}.bind(this)))}this.view.selection=null}this.view.mode=mode;if(this.view.id===this.parent.activeView){this.changed(this.events.activeModeChanged())}this.changed(this.events.modeChanged(this.view.id))},normalMode:function(id){id=id||this.view.active;if(this.view.mode==="normal"&&this.view.active===id)return;if(!this.setActive(id)){this.changed(this.events.nodeViewChanged(this.view.active))}document.activeElement.blur();this.setMode("normal")},edit:function(id){this.editAt(id,"end")},editStart:function(id){this.editAt(id,"start")},editAt:function(id,at){id=id||this.view.active;if(this.view.mode==="edit"&&this.view.active===id)return;if(!this.setActive(id)){this.changed(this.events.nodeViewChanged(this.view.active))}if(!at)at="start";this.view.lastEdited=id;this.view.editPos=at;this.setMode("insert")},change:function(id){id=id||this.view.active;if(this.view.mode==="edit"&&this.view.active===id)return;if(!this.setActive(id)){this.changed(this.events.nodeViewChanged(this.view.active))}this.view.editPos="change";this.setMode("insert")},goToFirstSibling:function(id){id=id||this.view.active;var first=movement.firstSibling(id,this.view.root,this.db.nodes);if(first===id){first=movement.up(id,this.view.root,this.db.nodes)}this.setActive(first)},moveToFirstSibling:function(id){id=id||this.view.active;if(id===this.view.root)return;var pid=this.db.nodes[id].parent,ch=this.db.nodes[pid].children,cix=ch.indexOf(id);if(cix===0)return;this.executeCommand("move",{id:id,nindex:0})},moveToLastSibling:function(id){id=id||this.view.active;if(id===this.view.root)return;var pid=this.db.nodes[id].parent,ch=this.db.nodes[pid].children,cix=ch.indexOf(id);if(cix===ch.length-1)return;this.executeCommand("move",{id:id,nindex:ch.length})},goToLastSibling:function(id){id=id||this.view.active;var last=movement.lastSibling(id,this.view.root,this.db.nodes);if(last===id){last=movement.down(id,this.view.root,this.db.nodes)}this.setActive(last)},goToBottom:function(){this.setActive(movement.bottom(this.view.root,this.db.nodes))},goToTop:function(){this.setActive(this.view.root)},goToLastEdited:function(){var id=this.view.lastEdited||this.view.root;this.edit(id)},goToNextSibling:function(id){id=id||this.view.active;if(id===this.view.root)return;var next=movement.nextSibling(id,this.view.root,this.db.nodes);if(!next){var parent=this.db.nodes[id].parent;if(parent){next=movement.nextSibling(parent,this.view.root,this.db.nodes)}if(!next){next=movement.down(id,this.view.root,this.db.nodes)}}this.setActive(next)},goToPreviousSibling:function(id){id=id||this.view.active;var prev=movement.prevSibling(id,this.view.root,this.db.nodes);if(!prev){prev=movement.up(id,this.view.root,this.db.nodes)}this.setActive(prev)},showCustomMenu:function(x,y,menu){if(this.globals.clearContextMenu){this.globals.clearContextMenu()}this.globals.clearContextMenu=Menu.show(menu,x,y)},showContextMenu:function(x,y,id){var items=[];if(!id)id=this.view.active;this.parent.allPlugins.forEach(function(plugin){if(!plugin.contextMenu)return;var created=plugin.contextMenu(this.db.nodes[id],this);if(!created)return;if(!Array.isArray(created)){created=[created]}items=items.concat(created)}.bind(this));var replaceActions=function(items){items.forEach(function(item){if("string"===typeof item.action){if(!this[item.action]){return console.warn("Unknown context menu action")}item.action=this[item.action].bind(this,id)}if(item.children)replaceActions(item.children)}.bind(this))}.bind(this);replaceActions(items);this.showCustomMenu(x,y,items)},hideContextMenu:function(){if(this.globals.clearContextMenu){this.globals.clearContextMenu();this.globals.clearContextMenu=null}}}},{"../lib/context-menu":303,"../util/movement":428}],422:[function(require,module,exports){var Promise=require("bluebird");var merge=require("react/lib/merge");module.exports=BaseStore;function BaseStore(options){this._listeners={};this._plugin_teardowns=[];if(options.plugins){options.plugins.forEach(function(plugin){return this.addPlugin(plugin,options.allPlugins)}.bind(this))}this.allPlugins=options.allPlugins}BaseStore.prototype={actions:{},teardown:function(){this._plugin_teardowns.forEach(function(fn){return fn(this)}.bind(this))},addPlugin:function(plugin,allPlugins){if(plugin.init){plugin.init(this)}if(plugin.teardown){this._plugin_teardowns.push(plugin.teardown)}var name,actions;if(plugin.actions){if("function"===typeof plugin.actions){actions=plugin.actions(allPlugins)}else{actions=plugin.actions}for(name in actions){this.actions[name]=actions[name]}}if(plugin.extend){for(name in plugin.extend){this[name]=plugin.extend[name]}}},on:function(changes,listener){if("string"===typeof changes)changes=[changes];for(var i=0;i<changes.length;i++){if(!this._listeners[changes[i]]){this._listeners[changes[i]]=[listener]}else if(this._listeners[changes[i]].indexOf(listener)===-1){this._listeners[changes[i]].push(listener)}}},off:function(changes,listener){if("string"===typeof changes)changes=[changes];for(var i=0;i<changes.length;i++){var ix=this._listeners[changes[i]].indexOf(listener);if(ix!==-1){this._listeners[changes[i]].splice(ix,1)}}},changed:function(){var what=[].slice.call(arguments);if(what.length===1&&Array.isArray(what[0])){what=what[0]}if(this._changed){this._changed=this._changed.concat(what)}else{this._changed=what;setTimeout(function(){if(window.DEBUG_CHANGES){console.log("emitting",this._changed)}var changes=this._changed;this._changed=null;this.emitChanged(changes)}.bind(this),0)}if(window.DEBUG_CHANGES){console.log("changed",what)}},emitChanged:function(what){var called=[];var promises=[];for(var i=0;i<what.length;i++){var listeners=this._listeners[what[i]];if(!listeners)continue;for(var j=0;j<listeners.length;j++){if(called.indexOf(listeners[j])!==-1){continue}var p=listeners[j]();if(p){promises.push(p)}called.push(listeners[j])}}if(this._done_listener){Promise.all(promises).then(this._done_listener)}},onDone:function(fn){this._done_listener=fn}}},{bluebird:309,"react/lib/merge":389}],423:[function(require,module,exports){var async=require("async");module.exports=Commandeger;function Commandeger(changed,setActive,db,events){this.history=[];this.histpos=0;this.changed=changed;this.setActive=setActive;this.events=events;this._transaction_ix=null;this._transactioning=0;this.db=db}Commandeger.prototype={commands:require("./commands"),addCommands:function(commands){for(var name in commands){this.commands[name]=commands[name]}},startTransaction:function(){if(!this._transactioning){this._transaction_ix=null}this._transactioning+=1},stopTransaction:function(){this._transactioning-=1;if(!this._transactioning){this._transaction_ix=null}},execute:function(command){return this.executeCommands(command)},executeCommands:function(){var commands=Array.prototype.slice.call(arguments,0);var time=Date.now();var changed=["changed"];var squash=null;if(null!==this._transaction_ix){squash=this._transaction_ix}else{commands.some(function(cmd){if("number"==typeof cmd.squash){squash=cmd.squash;return true}})}if("number"==typeof squash){var past=this.history[squash];past.changes=past.changes.concat(commands)}else{this.history=this.history.slice(0,this.histpos);this.history.push({time:time,changes:commands});this.histpos=this.history.length;if(this._transactioning){this._transaction_ix=this.histpos-1}}async.mapSeries(commands,function(command,next){this.doCommand(command,function(err,newChanged){changed=changed.concat(newChanged);next(err,command.state)})}.bind(this),function(err,states){if(err)return console.error("Failed to execute commands!!!",err);this.changed.apply(this,changed)}.bind(this));if(squash!==null)return squash;return this.histpos-1},undoCommands:function(){if(this.histpos<=0)return;this.histpos-=1;var last=this.history[this.histpos];var changed=["changed"];var time=Date.now();var items=[];for(var i=last.changes.length-1;i>=0;i--){items.push(last.changes[i])}async.mapSeries(items,function(item,next){this.undoCommand(item,function(err,newChanges){changed=changed.concat(newChanges);next()})}.bind(this),function(err){return this.changed.apply(this,changed)}.bind(this))},redoCommands:function(){if(this.histpos>=this.history.length)return;var last=this.history[this.histpos];this.histpos+=1;var changed=["changed"];var time=Date.now();async.mapSeries(last.changes,function(item,next){this.redoCommand(item,function(err,changes){changed=changed.concat(changes);next()})}.bind(this),function(err){return this.changed.apply(this,changed)}.bind(this))},doCommand:function(command,done){var cmd=this.commands[command.cmd];if(cmd.async){cmd.apply.call(command.state,this.db,this.events[command.view],function(err,changed){if("string"===typeof changed){changed=[changed]}if(command.done){command.done(null,command.state)}done(err,changed)});return}var changed=cmd.apply.call(command.state,this.db,this.events[command.view]);if("string"===typeof changed){changed=[changed]}if(command.done){command.done(null,command.state)}done(null,changed)},undoCommand:function(command,done){var cmd=this.commands[command.cmd];if(cmd.async){cmd.undo.call(command.state,this.db,this.events[command.view],function(err,changed){if("string"===typeof changed){changed=[changed]}this.setActive(command.active,command.view);done(err,changed)}.bind(this));return}var changed=cmd.undo.call(command.state,this.db,this.events[command.view]);if("string"===typeof changed){changed=[changed]}this.setActive(command.active,command.view);done(null,changed)},redoCommand:function(command,done){var cmd=this.commands[command.cmd];var action=cmd.redo||cmd.apply;if(cmd.async){action.call(command.state,this.db,this.events[command.view],function(err,changed){if("string"===typeof changed){changed=[changed]}this.setActive(command.active,command.view);done(err,changed)}.bind(this));return}var changed=action.call(command.state,this.db,this.events[command.view]);if("string"===typeof changed){changed=[changed]}this.setActive(command.active,command.view);done(null,changed)}}},{"./commands":424,async:"async"}],424:[function(require,module,exports){module.exports={update:{args:["id","update"],apply:function(db,events){this.old={};for(var name in this.update){this.old[name]=db.nodes[this.id][name]}db.update(this.id,this.update);return events.nodeChanged(this.id)},undo:function(db,events){db.update(this.id,this.old);return events.nodeChanged(this.id)}},updateMany:{args:["ids","updates"],apply:function(db,events){this.olds=this.ids.map(function(id,i){var old={};for(var name in this.updates[i]){old[name]=db.nodes[id][name]}db.update(id,this.updates[i]);return old}.bind(this));return this.ids.map(function(id){return events.nodeChanged(id)})},undo:function(db,events){this.ids.forEach(function(id,i){db.update(id,this.olds[i])}.bind(this));return this.ids.map(function(id){return events.nodeChanged(id)})}},set:{args:["id","attr","value"],apply:function(db,events){this.old=db.nodes[this.id][this.attr];db.set(this.id,this.attr,this.value);return events.nodeChanged(this.id)},undo:function(db,events){db.set(this.id,this.attr,this.old);return events.nodeChanged(this.id)}},setMany:{args:["attr","ids","values"],apply:function(db,events){this.old=this.ids.map(function(id){return db.nodes[id][this.attr]}.bind(this));db.setMany(this.attr,this.ids,this.values);return this.ids.map(function(id){return events.nodeChanged(id)})},undo:function(db,events){db.setMany(this.attr,this.ids,this.old);return this.ids.map(function(id){return events.nodeChanged(id)})}},remove:{args:["ids"],apply:function(db,events){var node=db.nodes[this.ids[0]],parent=db.nodes[node.parent],children=parent.children.slice(),ix=children.indexOf(this.ids[0]);if(ix===-1){throw new Error("node is not a child of its parent")}this.saved={nodes:this.ids.map(function(id){return db.nodes[id]}),ix:ix};children.splice(ix,this.ids.length);db.set(node.parent,"children",children);db.removeMany(this.ids);return events.nodeChanged(node.parent)},undo:function(db,events){var node=this.saved.nodes[0],parent=db.nodes[node.parent],children=parent.children.slice(),ix=this.saved.ix;children.splice.apply(children,[ix,0].concat(this.ids));db.saveMany(this.saved.nodes);db.set(node.parent,"children",children);return events.nodeChanged(node.parent)}},importTrees:{args:["pid","index","data"],async:true,apply:function(db,events,done){db.dump(this.pid,this.data,this.index,function(err,created){this.created=created;done(err,events.nodeChanged(this.pid))}.bind(this))},undo:function(db,events,done){db.set(this.pid,"children",this.created.oldChildren);db.removeMany(this.created.ids);done(null,events.nodeChanged(this.pid))}},move:{args:["id","npid","nindex","nextIsRoot"],apply:function(db,events){this.opid=db.nodes[this.id].parent;this.oindex=db.removeChild(this.opid,this.id);if(this.oindex===-1){throw new Error("node is not a child of its parent")}var unCollapse=!this.nextIsRoot;if(!this.npid){unCollapse=false;this.npid=this.opid;if(this.oindex<this.nindex){this.nindex-=1}}db.insertChild(this.npid,this.id,this.nindex);db.set(this.id,"parent",this.npid);if(unCollapse&&db.nodes[this.npid].collapsed){db.set(this.npid,"collapsed",false);this.wasCollapsed=true}if(this.opid===this.npid){return events.nodeChanged(this.npid)}return[events.nodeChanged(this.opid),events.nodeChanged(this.npid)]},undo:function(db,events){db.removeChild(this.npid,this.id);db.insertChild(this.opid,this.id,this.oindex);db.set(this.id,"parent",this.opid);if(this.wasCollapsed){db.set(this.npid,"collapsed",true)}if(this.opid===this.npid){return events.nodeChanged(this.npid)}return[events.nodeChanged(this.opid),events.nodeChanged(this.npid)]}},moveMany:{args:["ids","npid","nindex","nextIsRoot"],apply:function(db,events){this.opid=db.nodes[this.ids[0]].parent;this.oindex=db.removeChild(this.opid,this.ids[0],this.ids.length);if(this.oindex===-1){throw new Error("node is not a child of its parent")}var unCollapse=!this.nextIsRoot;if(!this.npid){unCollapse=false;this.npid=this.opid}if(this.npid===this.opid){if(this.oindex<this.nindex){this.nindex-=this.ids.length-1}}db.insertChildren(this.npid,this.ids,this.nindex);db.setMany("parent",this.ids,this.npid);if(unCollapse&&db.nodes[this.npid].collapsed){db.set(this.npid,"collapsed",false);this.wasCollapsed=true}if(this.opid===this.npid){return events.nodeChanged(this.npid)}return[events.nodeChanged(this.opid),events.nodeChanged(this.npid)]},undo:function(db,events){db.removeChild(this.npid,this.ids[0],this.ids.length);db.insertChildren(this.opid,this.ids,this.oindex);db.setMany("parent",this.ids,this.opid);if(this.wasCollapsed){db.set(this.npid,"collapsed",true)}if(this.opid===this.npid){return"node:"+this.npid}return["node:"+this.opid,"node:"+this.npid]}},create:{args:["pid","ix","type","content"],apply:function(db){this.id=db.create(this.pid,this.ix,this.content,this.type);return"node:"+this.pid},undo:function(db){db.removeChild(this.pid,this.id);this.saved=db.nodes[this.id];db.remove(this.id);return"node:"+this.pid},redo:function(db){db.save(this.id,this.saved);db.insertChild(this.pid,this.id,this.ix);return"node:"+this.pid}}}},{}],425:[function(require,module,exports){var BaseStore=require("./base");var extend=require("../util/extend");var Commandeger=require("./commandeger");module.exports=MainStore;function MainStore(options){this.db=options.db;this.clearViews();this._globals={};this._contextMenu=null;BaseStore.apply(this,arguments);this.cmd=new Commandeger(this.changed.bind(this),function(id,vid){return this.viewAction("setActive",vid,id)}.bind(this),this.db,this._events)}MainStore.prototype=extend(Object.create(BaseStore.prototype),{constructor:MainStore,clearViews:function(){this.views={};this._actions={};this._events={};if(this.cmd){this.cmd.events=this._events}this._getters={};this._nextViewId=1;this.activeView=1},headerView:function(){var view={};view.events=this.events,view.on=this.on.bind(this);view.off=this.off.bind(this);view.globals=this._globals;view.actions=extend({db:this.db,events:view.events,parent:this,globals:this._globals,changed:this.changed.bind(this)},this.actions);view.getters=extend({globals:this._globals,parent:this,db:this.db},this.getters);return view},unregisterView:function(id){delete this.views[id];delete this._events[id];delete this._actions[id];delete this._getters[id];if(id===this.activeView){this.activeView=+Object.keys(this.views)[0];this.changed(this.events.activeViewChanged())}},registerView:function(root){var id=this._nextViewId++;if(!root||!this.db.nodes[root])root=this.db.root;this.views[id]={id:id,root:root,active:root,selected:null,editPos:null,mode:"normal"};this._events[id]=extend({vid:id},this.events);this._actions[id]=extend({view:this.views[id],db:this.db,events:this._events[id],changed:this.changed.bind(this),parent:this,globals:this._globals,startTransaction:function(){return this.cmd.startTransaction()}.bind(this),stopTransaction:function(){return this.cmd.stopTransaction()}.bind(this),executeCommand:function(cmd,state,squash,done){if(arguments.length===3&&"function"===typeof squash){done=squash;squash=undefined}return this.cmd.execute({cmd:cmd,state:state,view:id,active:this.views[id].active,squash:squash,done:done})}.bind(this),executeCommands:function(){var commands=[];for(var i=0;i<arguments.length-1;i+=2){commands.push({cmd:arguments[i],state:arguments[i+1],view:id,active:this.views[id].active})}if(arguments.length%2==1){commands[commands.length-1].done=arguments[arguments.length-1]}return this.cmd.executeCommands.apply(this.cmd,commands)}.bind(this)},this.actions);this._getters[id]=extend({view:this.views[id],globals:this._globals,parent:this,db:this.db},this.getters);if(!this.activeView){this.activeView=id}this.changed(this.events.activeViewChanged());return{id:id,view:this.views[id],actions:this._actions[id],getters:this._getters[id],events:this._events[id],globals:this._globals,on:this.on.bind(this),off:this.off.bind(this)}},currentViewActions:function(){return this._actions[this.activeView]},addPlugin:function(plugin,allPlugins){BaseStore.prototype.addPlugin.call(this,plugin,allPlugins);if(plugin.getters){for(var name in plugin.getters){this.getters[name]=plugin.getters[name]}}if(plugin.events){for(var name in plugin.events){this.events[name]=plugin.events[name]}}if(plugin.commands){this.cmds.addCommands(plugin.commands)}},viewAction:function(name,id){var args=Array.prototype.slice.call(arguments,2);return this._actions[id][name].apply(this._actions[id],args)},events:{nodeChanged:function(id){return"node:"+id},nodeViewChanged:function(id){return this.nodeChanged(id)+":view:"+this.vid},activeViewChanged:function(){return"active-view"},rootChanged:function(){return"root:"+this.vid},modeChanged:function(){return"mode:"+this.vid},activeModeChanged:function(){return"mode:active"}},actions:require("./actions"),getters:{getNode:function(id){return this.db.nodes[id]},isActiveView:function(){return this.view.id===this.parent.activeView},isActive:function(id){return id===this.view.active},isSelected:function(id){return this.view.selection&&this.view.selection.indexOf(id)!==-1},editState:function(id){var editing=this.view.mode==="insert"&&id===this.view.active;return editing&&this.view.editPos}}})},{"../util/extend":427,"./actions":421,"./base":422,"./commandeger":423}],426:[function(require,module,exports){module.exports=ensureInView;function ensureInView(item){var bb=item.getBoundingClientRect();var parent=item.offsetParent;var rx=/(auto|scroll)/;var st=window.getComputedStyle(parent);while(parent.offsetParent&&!rx.test(st.overflow+st.overflowY)){parent=parent.offsetParent;st=window.getComputedStyle(parent)}var pox=parent.getBoundingClientRect(),height=bb.bottom-bb.top,pHeight=pox.bottom-pox.top,margin=100;if(height+margin*2>pHeight){margin=10}if(height+margin*2>pHeight){if(bb.top>pox.top+margin){scrollMe(parent,bb.top-pox.top-margin)}else if(bb.bottom<pox.bottom-margin){scrollMe(parent,-(pox.bottom-bb.bottom-margin))}return}if(bb.top<pox.top+margin){scrollMe(parent,-(pox.top-bb.top+margin));return}if(bb.bottom>pox.bottom-margin){scrollMe(parent,bb.bottom-pox.bottom+margin)}}var scrolling=[],timers=[];function scrollMe(parent,by){var ix=scrolling.indexOf(parent);if(ix!==-1){clearInterval(timers[ix])}else{ix=scrolling.length;scrolling.push(parent)}var dest=parent.scrollTop+by;if(Math.abs(parent.scrollTop-dest)<150){parent.scrollTop=dest;return scrolling.pop()}var ival=setInterval(function(){if(Math.abs(parent.scrollTop-dest)<5){parent.scrollTop=dest;var ix=scrolling.indexOf(parent);scrolling.splice(ix,1);timers.splice(ix,1);clearInterval(ival);return}parent.scrollTop+=(dest-parent.scrollTop)/5},10);timers[ix]=ival}},{}],427:[function(require,module,exports){module.exports=function(target){for(var i=1;i<arguments.length;i++){for(var name in arguments[i]){target[name]=arguments[i][name]}}return target}},{}],428:[function(require,module,exports){module.exports={indent:function(id,root,nodes){if(id===root)return;var pid=nodes[id].parent,ix=nodes[pid].children.indexOf(id);if(ix===-1)return;if(ix===0)return;var npid=nodes[pid].children[ix-1];return{opid:pid,npid:npid,nindex:nodes[npid].children.length}},dedent:function(id,root,nodes){if(id===root)return;var pid=nodes[id].parent;if(pid===root)return;var npid=nodes[pid].parent,ix=nodes[npid].children.indexOf(pid);if(pid===root)return;return{opid:pid,npid:npid,nindex:ix+1}},nextSibling:function(id,root,nodes){if(id===root)return;var pid=nodes[id].parent,ch=nodes[pid].children,ix=ch.indexOf(id);if(ix===ch.length-1)return;return ch[ix+1]},prevSibling:function(id,root,nodes){if(id===root)return;var pid=nodes[id].parent,ch=nodes[pid].children,ix=ch.indexOf(id);if(ix===0)return;return ch[ix-1]},firstSibling:function(id,root,nodes){if(id===root)return;var pid=nodes[id].parent;return nodes[pid].children[0]},lastSibling:function(id,root,nodes){if(id===root)return;var pid=nodes[id].parent;return nodes[pid].children[nodes[pid].children.length-1]},bottom:function(root,nodes){var node=nodes[root];if(!node.children.length)return;node=nodes[node.children[node.children.length-1]];while(node.children.length&&!node.collapsed){node=nodes[node.children[node.children.length-1]]}return node.id},up:function(active,root,nodes){if(active===root)return false;var pid=nodes[active].parent,i=nodes[pid].children.indexOf(active);if(i===0)return pid;var sid=nodes[pid].children[i-1],sib=nodes[sid];while(sib.children.length&&!sib.collapsed){sid=sib.children[sib.children.length-1];sib=nodes[sid]}return sid},below:function(active,root,nodes){if(active===root)return false;var pid=nodes[active].parent,parent=nodes[pid],ix=parent.children.indexOf(active);if(ix===parent.children.length-1){if(pid===root)return;return{opid:pid,pid:parent.parent,ix:nodes[parent.parent].children.indexOf(pid)+1}}var nid=parent.children[ix+1],next=nodes[nid];if(next.children.length&&!next.collapsed){return{opid:pid,pid:nid,ix:0}}return{pid:pid,ix:ix+1}},above:function(active,root,nodes){if(active===root)return false;var pid=nodes[active].parent,parent=nodes[pid],ix=parent.children.indexOf(active);if(ix===0){if(pid===root)return;return{opid:pid,pid:parent.parent,ix:nodes[parent.parent].children.indexOf(pid)}}var nid=parent.children[ix-1],next=nodes[nid];if(next.children.length&&!next.collapsed){return{opid:pid,pid:nid,ix:next.children.length}}return{pid:pid,ix:ix-1}},down:function(active,root,nodes,noChildren){if(nodes[active].children.length&&!noChildren&&(active===root||!nodes[active].collapsed)){return nodes[active].children[0]}if(active===root)return false;var pid=nodes[active].parent,parent=nodes[pid],i=parent.children.indexOf(active);while(pid!==root&&i===parent.children.length-1){parent=nodes[parent.parent];i=parent.children.indexOf(pid);pid=parent.id}if(parent===root)return false;return parent.children[i+1]},left:function(active,root,nodes){if(active===root)return false;return nodes[active].parent},right:function(active,root,nodes){var node=nodes[active];if(node.children.length&&!node.collapsed){return node.children[0]}return false}}},{}],429:[function(require,module,exports){module.exports={up:slideUp,down:slideDown};function slideDown(el,speed,maxtime){speed=speed||.2;maxtime=maxtime||1;var curh=window.getComputedStyle(el).height;el.style.transition="none";el.style.height="auto";var h=window.getComputedStyle(el).height;if(curh===h)return;el.style.height=curh;el.style.overflow="hidden";var dur=parseInt(h,10)*speed/100;if(dur>maxtime)dur=maxtime;window.getComputedStyle(el).height;el.style.transition="height "+dur+"s ease";el.style.height=h;afterTransition(el,function(){el.style.transition="";el.style.overflow="visible";el.style.height="auto"})}function slideUp(el,speed,maxtime){speed=speed||.2;maxtime=maxtime||1;var curh=window.getComputedStyle(el).height;if(curh==="0")return;el.style.transition="none";el.style.height=curh;var dur=parseInt(curh,10)*speed/100;if(dur>maxtime)dur=maxtime;el.style.overflow="hidden";window.getComputedStyle(el).height;el.style.transition="height "+dur+"s ease";el.style.height="0";afterTransition(el,function(){el.style.height="0";el.style.transition="";el.style.overflow="hidden"})}function afterTransition(el,fn){el.addEventListener("transitionend",function done(){el.removeEventListener("transitionend",done);fn()})}},{}],430:[function(require,module,exports){var uuid=require("../lib/uuid");module.exports=treesToMap;function treesToMap(trees,pid,keepIds){var nodes={};if(!Array.isArray(trees)){trees=[trees]}var processChild=function(pid,child){var id=keepIds&&child.id?child.id:uuid();var node={id:id,content:child.content,children:[],parent:pid};nodes[id]=node;for(var name in child){if(["content","children","id"].indexOf(name)!==-1)continue;node[name]=child[name]}if(child.children&&child.children.length){node.children=child.children.map(processChild.bind(this,id))
}return id}.bind(this);var roots=trees.map(processChild.bind(this,pid));return{nodes:nodes,roots:roots}}},{"../lib/uuid":305}],431:[function(require,module,exports){module.exports=verifyNodes;function verifyNodes(root,map){if(!map[root])return new Error("Root node not found");return verifyNode(map[root],map)}function verifyNode(node,map){if(node.children){for(var i=0;i<node.children.length;i++){var child=map[node.children[i]];if(!child){child=map[node.children[i]]={id:node.children[i],content:"*contents missing*",parent:node.id,children:[]};console.log("Child node not found: "+node.children[i]+" of "+node.id)}if(child.parent!==node.id){console.log("Misparent");console.log(node);console.log(child);child.parent=node.id}var err=verifyNode(child,map);if(err)return err}}}},{}],432:[function(require,module,exports){var React=require("react"),PT=React.PropTypes;var Textarea=require("./textarea-grow");var Editor=React.createClass({displayName:"Editor",propTypes:{value:PT.string,onBlur:PT.func,onChange:PT.func,createAfter:PT.func,goDown:PT.func,goUp:PT.func},componentDidMount:function(){this.focus()},isFocused:function(){return this.refs.text.isFocused()},focus:function(){this.refs.text.focus.apply(this.refs.text,arguments)},_onChange:function(e){this.props.onChange(e.target.value)},_onKeyDown:function(e){if(e.shiftKey&&e.key==="Enter"){return e.stopPropagation()}var text=this.refs.text,line,pos;if(e.key==="ArrowDown"&&!e.shiftKey){line=text.getCursorLine();if(line===-1||line===1){if(this.props.goDown()){e.preventDefault()}}}else if(e.key==="ArrowUp"&&!e.shiftKey){line=text.getCursorLine();if(line===0||line===1){if(this.props.goUp()){e.preventDefault()}}}else if(e.key==="ArrowRight"&&!e.shiftKey){pos=text.getCursorPos();if(pos===-1||pos===1){this.props.goDown(true);e.preventDefault()}}else if(e.key==="ArrowLeft"&&!e.shiftKey){pos=text.getCursorPos();if(pos===0||pos===1){this.props.goUp();e.preventDefault()}}else if(e.key==="Backspace"){if(!this.props.value.length){this.props.removeEmpty();e.preventDefault()}else if(text.getCursorSplit()===0){e.preventDefault();this.props.joinUp(null,this.props.value)}}else if(e.key==="Enter"){if(!e.shiftKey&&!e.ctrlKey&&!e.altKey&&this.props.value.indexOf("\n")===-1){text.blur();pos=text.getCursorSplit();if(pos<this.props.value.length){this.props.onChange(this.props.value.slice(0,pos));this.props.createAfter(null,this.props.value.slice(0,pos),this.props.value.slice(pos))}else{this.props.createAfter()}e.preventDefault()}else if(e.ctrlKey&&this.props.value.indexOf("\n")!==-1){pos=text.getCursorSplit();if(pos<this.props.value.length){this.props.onChange(this.props.value.slice(0,pos));this.props.createAfter(null,this.props.value.slice(0,pos),this.props.value.slice(pos))}else{this.props.createAfter()}e.preventDefault()}}},render:function(){return Textarea({ref:"text",value:this.props.value,onChange:this._onChange,onPaste:this.props.onPaste,onBlur:this.props.onBlur,onKeyDown:this._onKeyDown})}});module.exports=Editor},{"./textarea-grow":435,react:"react"}],433:[function(require,module,exports){var React=require("react/addons");var cx=React.addons.classSet;var PT=React.PropTypes;var marked=require("marked");var renderer=new marked.Renderer;renderer.link=function(href,title,text){return'<a href="'+href+'" target="_blank" title="'+title+'">'+text+"</a>"};marked.setOptions({gfm:true,sanitize:true,tables:true,breaks:true,pedantic:false,sanitize:false,smartLists:true,smartypants:true,renderer:renderer});var DefaultRenderer=React.createClass({displayName:"DefaultRenderer",render:function(){return React.DOM.span({className:"treed_body_rendered",onClick:this.props.onClick,dangerouslySetInnerHTML:{__html:this.props.content?marked(this.props.content+""):""}})}});module.exports=DefaultRenderer},{marked:"marked","react/addons":"react/addons"}],434:[function(require,module,exports){var React=require("react/addons"),cx=React.addons.classSet,PT=React.PropTypes,ensureInView=require("../../util/ensure-in-view"),DefaultEditor=require("./default-editor"),DefaultRenderer=require("./default-renderer");var SimpleBody=React.createClass({displayName:"SimpleBody",propTypes:{editor:PT.func,renderer:PT.func,node:PT.object,isActive:PT.bool,editState:PT.oneOfType([PT.string,PT.bool]),actions:PT.object,store:PT.object},_onClick:function(){if(this.props.editState){}else{this.props.actions.edit(this.props.node.id)}},getDefaultProps:function(){return{renderer:null,editor:null}},getInitialState:function(){return{content:this.props.node.content}},componentWillReceiveProps:function(nextProps){if(!nextProps.editState&&this.props.editState){if(this.state.content!==this.props.node.content){this.props.actions.setContent(this.props.node.id,this.state.content)}}this.setState({content:nextProps.node.content})},_onChange:function(value){this.setState({content:value})},_onBlur:function(){if(this.state.content!==this.props.node.content){this.props.actions.setContent(this.props.node.id,this.state.content)}setTimeout(function(){if(this.isMounted()&&!this.props.store.view.windowBlur&&this.props.isActive&&this.refs.text&&(this.refs.text.isFocused&&!this.refs.text.isFocused())){this.props.actions.normalMode()}}.bind(this),80)},_onContextMenu:function(e){if(this.props.store.view.mode==="insert"&&this.props.node.id===this.props.store.view.active)return;this.props.actions.setActive(this.props.node.id);this.props.actions.showContextMenu(e.clientX,e.clientY,this.props.node.id);e.preventDefault();e.stopPropagation()},componentDidMount:function(){if(!this.props.editState)return;ensureInView(this.refs.text.getDOMNode());if(this.props.editState==="change"){this.setState({content:""},function(){this.refs.text.focus()}.bind(this))}else{this.refs.text.focus(this.props.editState)}},componentDidUpdate:function(prevProps){if(!prevProps.editState&&this.props.editState){ensureInView(this.refs.text.getDOMNode());if(this.props.editState==="change"){this.setState({content:""},function(){this.refs.text.focus()}.bind(this))}else{this.refs.text.focus(this.props.editState)}}},editor:function(){var Ctrl=this.props.editor||DefaultEditor;return Ctrl({ref:"text",value:this.state.content,node:this.props.node,store:this.props.store,goDown:this.props.actions.goDown.bind(this.props.actions),goUp:this.props.actions.goUp.bind(this.props.actions),joinUp:this.props.actions.joinUp.bind(this.props.actions),createAfter:this.props.actions.createAfter.bind(this.props.actions),removeEmpty:this.props.actions.removeEmpty.bind(this.props.actions),onChange:this._onChange,onBlur:this._onBlur})},renderer:function(){if(!this.props.renderer){return DefaultRenderer({onClick:this._onClick,content:this.props.node.content})}return this.props.renderer.call(this)},render:function(){var className=cx({treed_body:true});className+=" treed_body-type-"+this.props.node.type;return React.DOM.div({className:className,onContextMenu:this._onContextMenu},this.props.editState?this.editor():this.renderer())}});module.exports=SimpleBody},{"../../util/ensure-in-view":426,"./default-editor":432,"./default-renderer":433,"react/addons":"react/addons"}],435:[function(require,module,exports){var React=require("react");var Textarea=React.createClass({displayName:"Textarea",getCursorSplit:function(){var a=this.refs.area.getDOMNode();return a.selectionEnd},getCursorPos:function(){var a=this.refs.area.getDOMNode();if(a.selectionStart!==a.selectionEnd){return 2}if(!a.value.length)return 1;if(a.selectionStart===0)return 0;if(a.selectionStart===a.value.length)return-1;return 3},getCursorLine:function(){var s=this.refs.shadow.getDOMNode(),a=this.refs.area.getDOMNode(),style=window.getComputedStyle(s),lineHeight=this._fontSize/.875;if(s.getBoundingClientRect().height-parseInt(style.paddingTop)-parseInt(style.paddingBottom)<=lineHeight*1.5){return 1}if(a!==document.activeElement)return 2;if(a.selectionStart!==a.selectionEnd)return 2;if(a.selectionStart===0)return 0;if(a.selectionEnd===this.props.value.length)return-1;var t=s.firstChild.nodeValue,bt=this.props.value.slice(0,a.selectionStart),at=this.props.value[a.selectionStart];if(at!==" "&&at!=="\n"&&at){bt+=this.props.value.slice(a.selectionStart).match(/[^\s]+/)[0]}s.firstChild.nodeValue=bt+" ";var h=s.getBoundingClientRect().height;s.firstChild.nodeValue=t;if(h<=lineHeight*1.5)return 0;var full=a.getBoundingClientRect().height;if(full-lineHeight*.5<h){return-1}},resize:function(){var shadow=this.refs.shadow.getDOMNode(),area=this.refs.area.getDOMNode();var style=window.getComputedStyle(shadow);this._fontSize=parseInt(style.fontSize,10);area.style.height=style.height},componentDidUpdate:function(){this.resize()},componentDidMount:function(){this.resize();window.addEventListener("resize",this.resize)},componentWillUnmount:function(){window.removeEventListener("resize",this.resize)},blur:function(){var inp=this.refs.area.getDOMNode();inp.blur()},isFocused:function(){return this.refs.area.getDOMNode()===document.activeElement},focus:function(at){var inp=this.refs.area.getDOMNode(),pos=0;if(at==="end"||!at)pos=inp.value.length;if("number"===typeof at){pos=at}if(inp!==document.activeElement)inp.focus();inp.selectionStart=inp.selectionEnd=pos},render:function(){return React.DOM.div({className:"textarea-grow "+this.props.className},this.transferPropsTo(React.DOM.textarea({ref:"area",className:"body_input"})),React.DOM.div({ref:"shadow",className:"shadow"},this.props.value+" "))}});module.exports=Textarea},{react:"react"}],436:[function(require,module,exports){var React=require("react/addons");var cx=React.addons.classSet;var PT=React.PropTypes;var FlexPanes=React.createClass({displayName:"FlexPanes",propTypes:{flex:PT.object,onChange:PT.func.isRequired,main:PT.renderable,second:PT.renderable},getInitialState:function(){return{moving:false,tmpSize:this.props.flex.size}},_startDrag:function(e){e.preventDefault();e.stopPropagation();this.setState({dragging:true})},_onDrag:function(e){var second=this.refs.second.getDOMNode().getBoundingClientRect();this.setState({tmpSize:this.props.flex.pos==="bottom"?second.bottom-e.clientY:second.right-e.clientX})},_endDrag:function(){var data=this.props.flex;data.size=this.state.tmpSize;this.setState({dragging:false},function(){return this.props.onChange(data)}.bind(this))},componentWillReceiveProps:function(props){if(props.flex.size!==this.props.flex.size){this.setState({tmpSize:props.flex.size})}},componentDidUpdate:function(prevProps,prevState){if(!prevState.dragging&&this.state.dragging){parent.addEventListener("mousemove",this._onDrag);parent.addEventListener("mouseup",this._endDrag)}else if(prevState.dragging&&!this.state.dragging){parent.removeEventListener("mousemove",this._onDrag);parent.removeEventListener("mouseup",this._endDrag)}},_switch:function(){var data=this.props.flex;data.pos=data.pos==="bottom"?"side":"bottom";this.props.onChange(data)},render:function(){var bottom=this.props.flex.pos==="bottom",secondStyle={overflow:"auto"};secondStyle[bottom?"height":"width"]=this.state.tmpSize;return React.DOM.div({className:"flex-panes flex-panes-"+(bottom?"horiz":"vert"),style:{flexDirection:bottom?"column":"row"}},React.DOM.div({className:"flex-main"},this.props.main),React.DOM.div({className:"flex-bar",onMouseDown:this._startDrag},React.DOM.div({className:"flex-switch",onClick:this._switch,onMouseDown:function(e){return e.stopPropagation()}})),React.DOM.div({ref:"second",className:"flex-second",style:secondStyle},this.props.second))}});module.exports=FlexPanes},{"react/addons":"react/addons"}],437:[function(require,module,exports){var React=require("react/addons");var cx=React.addons.classSet;var PT=React.PropTypes;var extend=require("../../util/extend");var Listener=require("../../listener");var FocusItem=require("./item");var TreeView=React.createClass({displayName:"TreeView",mixins:[Listener(function(store,props){return{root:store.view.root,mode:store.view.mode,isActive:store.isActiveView()}})],propTypes:{plugins:PT.array,nodePlugins:PT.array,skipMix:PT.array},getDefaultProps:function(){return{skipMix:[]}},componentDidUpdate:function(prevProps){if(this.props.store!==prevProps.store){var e=this.props.store.events;this.listen(e.rootChanged(),e.modeChanged(),e.activeViewChanged())}},componentWillMount:function(){var e=this.props.store.events;this.listen(e.rootChanged(),e.modeChanged(),e.activeViewChanged())},fromMix:function(part){if(!this.props.plugins)return;if(this.props.skipMix.indexOf(part)!==-1)return;var items=[];for(var i=0;i<this.props.plugins.length;i++){var plugin=this.props.plugins[i].blocks;if(!plugin||!plugin[part])continue;items.push(plugin[part](this.props.store.actions,this.state,this.props.store))}if(!items.length)return null;return items},render:function(){var className="focus";if(this.state.isActive)className+=" focus-active";var bodies={default:{editor:null,renderer:null}};if(this.props.nodePlugins){for(var i=0;i<this.props.nodePlugins.length;i++){if(this.props.nodePlugins[i].bodies){bodies=extend(bodies,this.props.nodePlugins[i].bodies)}}}return FocusItem({store:this.props.store,plugins:this.props.nodePlugins,bodies:bodies,id:this.state.root})}});module.exports=TreeView},{"../../listener":306,"../../util/extend":427,"./item":438,"react/addons":"react/addons"}],438:[function(require,module,exports){var React=require("react/addons");var cx=React.addons.classSet;var PT=React.PropTypes;var SimpleBody=require("../body/simple");var FlexPanes=require("./flex-panes");var Listener=require("../../listener");var FocusItem=React.createClass({displayName:"FocusItem",mixins:[Listener({storeAttrs:function(getters,props){return{node:getters.getNode(props.id),isActiveView:getters.isActiveView(),editState:getters.editState(props.id)}},shouldGetNew:function(nextProps){return nextProps.id!==this.props.id||nextProps.store!==this.props.store},getListeners:function(props,events){return[events.nodeChanged(props.id),events.nodeViewChanged(props.id)]}})],componentWillMount:function(){this._plugin_updates=null;this.props.plugins.forEach(function(plugin){if(!plugin.componentDidUpdate)return;if(!this._plugin_updates){this._plugin_updates=[plugin.componentDidUpdate]}else{this._plugin_updates.push(plugin.componentDidUpdate)}}.bind(this))},propTypes:{id:PT.string.isRequired,plugins:PT.array,bodies:PT.object,isRoot:PT.bool},shouldComponentUpdate:function(nextProps,nextState){return nextState!==this.state||nextProps.index!==this.props.index&&nextState.isActive},componentDidUpdate:function(prevProps,prevState){if(this._plugin_updates){this._plugin_updates.map(function(fn){return fn.call(this,prevProps,prevState)}.bind(this))}},fromMix:function(part){if(!this.props.plugins)return;var items=[];for(var i=0;i<this.props.plugins.length;i++){var plugin=this.props.plugins[i].blocks;if(!plugin||!plugin[part])continue;items.push(plugin[part](this.state.node,this.props.store.actions,this.state,this.props.store))}if(!items.length)return null;return items},body:function(){var body=this.props.bodies[this.state.node.type]||this.props.bodies["default"];return React.DOM.div({ref:"body",className:"focus_item_body",style:{flex:1}},SimpleBody({editor:body.editor,renderer:body.renderer,node:this.state.node,isActive:true,editState:this.state.editState,actions:this.props.store.actions,store:this.props.store}))},_onChange:function(focus){this.props.store.actions.set(this.props.id,"focus",focus)},render:function(){var className=cx({focus:true,"focus-actove":this.state.isActiveView,"focus-editing":this.state.editState});className+=" focus_item-type-"+this.state.node.type;if(this.props.plugins){this.props.plugins.forEach(function(plugin){if(!plugin.classes)return;var classes=plugin.classes(this.state.node,this.state);if(classes)className+=" "+classes}.bind(this))}var body=this.body();var focusPane=this.fromMix("focus-pane");if(!focusPane){return React.DOM.div({className:className},body)}var focus=this.state.node.focus||{pos:"bottom",size:300};return FlexPanes({onChange:this._onChange,flex:focus,main:body,second:focusPane})}});module.exports=FocusItem},{"../../listener":306,"../body/simple":434,"./flex-panes":436,"react/addons":"react/addons"}],439:[function(require,module,exports){var React=require("react/addons");var cx=React.addons.classSet;var PT=React.PropTypes;var PaperItem=require("./item");var extend=require("../../util/extend");var Listener=require("../../listener");var PaperView=React.createClass({displayName:"PaperView",mixins:[Listener(function(store,props){return{root:store.view.root,mode:store.view.mode,isActive:store.isActiveView()}})],propTypes:{plugins:PT.array,nodePlugins:PT.array},componentDidUpdate:function(prevProps){if(this.props.store!==prevProps.store){var e=this.props.store.events;this.listen(e.rootChanged(),e.modeChanged(),e.activeViewChanged())}},componentWillMount:function(){var e=this.props.store.events;this.listen(e.rootChanged(),e.modeChanged(),e.activeViewChanged())},fromMix:function(part){if(!this.props.plugins)return;if(this.props.skipMix&&this.props.skipMix.indexOf(part)!==-1)return;var items=[];for(var i=0;i<this.props.plugins.length;i++){var plugin=this.props.plugins[i].blocks;if(!plugin||!plugin[part])continue;items.push(plugin[part](this.props.store.actions,this.state,this.props.store))}if(!items.length)return null;return items},render:function(){var className="paper paper-"+this.state.mode;if(this.state.isActive)className+=" paper-active";var bodies={default:{editor:null,renderer:null}};if(this.props.nodePlugins){for(var i=0;i<this.props.nodePlugins.length;i++){if(this.props.nodePlugins[i].bodies){bodies=extend(bodies,this.props.nodePlugins[i].bodies)}}}return React.DOM.div({className:className},this.fromMix("top"),PaperItem({depth:0,store:this.props.store,plugins:this.props.nodePlugins,bodies:bodies,isRoot:true,id:this.state.root}),this.fromMix("bottom"))}});module.exports=PaperView},{"../../listener":306,"../../util/extend":427,"./item":440,"react/addons":"react/addons"}],440:[function(require,module,exports){var React=require("react/addons");var cx=React.addons.classSet;var PT=React.PropTypes;var marked=require("marked");var Listener=require("../../listener");var renderer=new marked.Renderer;renderer.link=function(href,title,text){return'<a href="'+href+'" target="_blank" title="'+title+'">'+text+"</a>"};marked.setOptions({gfm:true,sanitize:true,tables:true,breaks:true,pedantic:false,sanitize:false,smartLists:true,smartypants:true,renderer:renderer});var PaperItem=React.createClass({displayName:"PaperItem",mixins:[Listener({storeAttrs:function(getters,props){return{node:getters.getNode(props.id),isActiveView:getters.isActiveView(),isActive:getters.isActive(props.id),isSelected:getters.isSelected(props.id),editState:getters.editState(props.id)}},initStoreState:function(state,getters,props){var node=state.node;return{lazyChildren:!props.isRoot&&node.collapsed&&node.children.length}},updateStoreState:function(state,getters,props){var node=state.node;return{lazyChildren:this.state.lazyChildren&&node.collapsed}},shouldGetNew:function(nextProps){return nextProps.id!==this.props.id||nextProps.store!==this.props.store},getListeners:function(props,events){return[events.nodeChanged(props.id),events.nodeViewChanged(props.id)]}})],componentWillMount:function(){this._plugin_updates=null;this.props.plugins.forEach(function(plugin){if(!plugin.componentDidUpdate)return;if(!this._plugin_updates){this._plugin_updates=[plugin.componentDidUpdate]}else{this._plugin_updates.push(plugin.componentDidUpdate)}}.bind(this))},componentDidUpdate:function(prevProps,prevState){if(this._plugin_updates){this._plugin_updates.map(function(fn){return fn.call(this,prevProps,prevState)}.bind(this))}},header:function(){switch(this.props.depth){case 0:return React.DOM.h1(null,this.state.node.content);case 1:return React.DOM.h2(null,this.state.node.content);case 2:return React.DOM.h3(null,this.state.node.content);case 3:return React.DOM.h4(null,this.state.node.content);default:return React.DOM.h5(null,this.state.node.content)}},render:function(){if(this.state.node.children.length){var children=this.state.node.children.map(function(id,i){return PaperItem({depth:this.props.depth+1,plugins:this.props.plugins,store:this.props.store,bodies:this.props.bodies,index:i,key:id,id:id})}.bind(this));return React.DOM.div({className:"section"},this.header(),children)}var content=this.state.node.content;if(!content)return React.DOM.p(null);if(this.state.node.type==="ipython"){content="```\n"+content+"\n```"}return React.DOM.p({dangerouslySetInnerHTML:{__html:marked(content)}})}});module.exports=PaperItem},{"../../listener":306,marked:"marked","react/addons":"react/addons"}],441:[function(require,module,exports){var React=require("react/addons");var cx=React.addons.classSet;var PT=React.PropTypes;var extend=require("../../util/extend");var Listener=require("../../listener");var TreeItem=require("./item");var TreeView=React.createClass({displayName:"TreeView",mixins:[Listener(function(store,props){return{root:store.view.root,mode:store.view.mode,isActive:store.isActiveView()}})],propTypes:{plugins:PT.array,nodePlugins:PT.array,skipMix:PT.array},getDefaultProps:function(){return{skipMix:[]}},componentDidUpdate:function(prevProps){if(this.props.store!==prevProps.store){var e=this.props.store.events;this.listen(e.rootChanged(),e.modeChanged(),e.activeViewChanged())}},componentWillMount:function(){var e=this.props.store.events;this.listen(e.rootChanged(),e.modeChanged(),e.activeViewChanged());window.addEventListener("blur",this._onBlur);window.addEventListener("focus",this._onFocus)},componentWillUnmount:function(){window.removeEventListener("blur",this._onBlur);window.removeEventListener("focus",this._onFocus)},_onBlur:function(){this.props.store.view.windowBlur=true},_onFocus:function(){this.props.store.view.windowBlur=false},fromMix:function(part){if(!this.props.plugins)return;if(this.props.skipMix.indexOf(part)!==-1)return;var items=[];for(var i=0;i<this.props.plugins.length;i++){var plugin=this.props.plugins[i].blocks;if(!plugin||!plugin[part])continue;items.push(plugin[part](this.props.store.actions,this.state,this.props.store))}if(!items.length)return null;return items},render:function(){var className="TreeView TreeView-"+this.state.mode;if(this.state.isActive)className+=" TreeView-active";var bodies={default:{editor:null,renderer:null}};if(this.props.nodePlugins){for(var i=0;i<this.props.nodePlugins.length;i++){if(this.props.nodePlugins[i].bodies){bodies=extend(bodies,this.props.nodePlugins[i].bodies)}}}return React.DOM.div({className:className,onClick:this.props.store.actions.setActiveView.bind(this.props.store.actions)},this.fromMix("top"),TreeItem({store:this.props.store,plugins:this.props.nodePlugins,bodies:bodies,isRoot:true,id:this.state.root}),this.fromMix("bottom"))}});module.exports=TreeView},{"../../listener":306,"../../util/extend":427,"./item":442,"react/addons":"react/addons"}],442:[function(require,module,exports){var React=require("react/addons");var cx=React.addons.classSet;var PT=React.PropTypes;var ensureInView=require("../../util/ensure-in-view");var SimpleBody=require("../body/simple");var Listener=require("../../listener");var TreeItem=React.createClass({displayName:"TreeItem",mixins:[Listener({storeAttrs:function(getters,props){return{node:getters.getNode(props.id),isActiveView:getters.isActiveView(),isActive:getters.isActive(props.id),isSelected:getters.isSelected(props.id),editState:getters.editState(props.id)}},initStoreState:function(state,getters,props){var node=state.node;return{lazyChildren:!props.isRoot&&node.collapsed&&node.children.length}},updateStoreState:function(state,getters,props){var node=state.node;return{lazyChildren:this.state.lazyChildren&&node.collapsed}},shouldGetNew:function(nextProps){return nextProps.id!==this.props.id||nextProps.store!==this.props.store},getListeners:function(props,events){return[events.nodeChanged(props.id),events.nodeViewChanged(props.id)]}})],componentWillMount:function(){this._plugin_updates=null;this.props.plugins.forEach(function(plugin){if(!plugin.componentDidUpdate)return;if(!this._plugin_updates){this._plugin_updates=[plugin.componentDidUpdate]}else{this._plugin_updates.push(plugin.componentDidUpdate)}}.bind(this))},propTypes:{id:PT.string.isRequired,plugins:PT.array,bodies:PT.object,isRoot:PT.bool},shouldComponentUpdate:function(nextProps,nextState){return nextState!==this.state||nextProps.index!==this.props.index&&nextState.isActive},componentDidMount:function(){if(this.state.isActive&&this.state.isActiveView){ensureInView(this.refs.body.getDOMNode())}},componentDidUpdate:function(prevProps,prevState){if(this._plugin_updates){this._plugin_updates.map(function(fn){return fn.call(this,prevProps,prevState)}.bind(this))}if(this.state.isActive&&this.state.isActiveView&&(!prevState.isActive||prevProps.index!==this.props.index)){ensureInView(this.refs.body.getDOMNode())}if(window.DEBUG_UPDATE){var n=this.getDOMNode();n.style.outline="1px solid red";setTimeout(function(){n.style.outline=""},200)}},fromMix:function(part){if(!this.props.plugins)return;var items=[];for(var i=0;i<this.props.plugins.length;i++){var plugin=this.props.plugins[i].blocks;if(!plugin||!plugin[part])continue;items.push(plugin[part](this.state.node,this.props.store.actions,this.state,this.props.store))}if(!items.length)return null;return items},body:function(){var body=this.props.bodies[this.state.node.type]||this.props.bodies["default"];var abovebody=this.fromMix("abovebody");var belowbody=this.fromMix("belowbody");return React.DOM.div({ref:"body",className:"TreeItem_body"},abovebody,SimpleBody({editor:body.editor,renderer:body.renderer,node:this.state.node,isActive:this.state.isActive,editState:this.state.editState,actions:this.props.store.actions,store:this.props.store}),belowbody)},_onContextMenu:function(e){if(this.props.store.view.mode==="insert"&&this.state.node.id===this.props.store.view.active)return e.stopPropagation();e.preventDefault();e.stopPropagation();this.props.store.actions.setActive(this.state.node.id);this.props.store.actions.showContextMenu(e.clientX,e.clientY,this.state.node.id)},render:function(){var className=cx({TreeItem:true,"TreeItem-active":this.state.isActive,"TreeItem-editing":this.state.editState,"TreeItem-selected":this.state.isSelected,"TreeItem-root":this.props.isRoot});className+=" TreeItem-type-"+this.state.node.type;if(this.props.plugins){this.props.plugins.forEach(function(plugin){if(!plugin.classes)return;var classes=plugin.classes(this.state.node,this.state);if(classes)className+=" "+classes}.bind(this))}return React.DOM.div({className:className,onContextMenu:this._onContextMenu},React.DOM.div({className:"TreeItem_head"},this.fromMix("left"),this.body(),this.fromMix("right")),this.fromMix("prechildren"),this.state.node.children.length?React.DOM.div({className:"TreeItem_children",ref:"children"},!this.state.lazyChildren&&this.state.node.children.map(function(id,i){return TreeItem({plugins:this.props.plugins,store:this.props.store,bodies:this.props.bodies,index:i,key:id,id:id})}.bind(this))):this.props.isRoot?React.DOM.div({className:"TreeItem_nochildren",onClick:function(){return this.props.store.actions.createAfter(this.props.id)}.bind(this)},"Click to add a child"):null,this.fromMix("bottom"))}});module.exports=TreeItem},{"../../listener":306,"../../util/ensure-in-view":426,"../body/simple":434,"react/addons":"react/addons"}],443:[function(require,module,exports){module.exports={"movement (normal/edit mode)":{"go up":{normal:"up, k"},"go down":{normal:"down, j"},"go left":{normal:"left, h"},"go right":{normal:"right, l"},"go to previous sibling":{normal:"alt+k, alt+up"},"go to next sibling":{normal:"alt+j, alt+down"},"go to first sibling":{normal:"shift+["},"go to last sibling":{normal:"shift+]"},"go to top":{normal:"g g, home",insert:"home"},"go to bottom":{normal:"shift+g, end",insert:"end"},"page up":{normal:"page-up",insert:"page-up"},"page down":{normal:"page-down",insert:"page-down"},"go to last edited":{normal:"g i"}},editing:{edit:{normal:"enter, a, shift+a, f2"},"edit start":{title:"edit at start",normal:"i, shift+i"},change:{title:"replace contents",normal:"c c, shift+c",visual:"c, shift+c"},remove:{normal:"d d, shift+d, delete",visual:"d, shift+d, delete"},"join down":{title:"join nodes",normal:"shift+j",visual:"shift+j"},"create after":{text:"o, enter (at end)",normal:"o"},"create before":{normal:"shift+o"}},"movement (visual mode)":{"toggle selection edge":{visual:"o, shift+o"},"extend to first sibling":{visual:"shift+["},"extend to last sibling":{visual:"shift+]"},"extend selection down":{visual:"down, j"},"extend selection up":{visual:"up, k"}},rearrange:{indent:{normal:"tab, shift+alt+l, shift+alt+right, shift+.",insert:"tab, shift+alt+right",visual:"tab, shift+alt+l, shift+alt+right, shift+."},dedent:{normal:"shift+tab, shift+alt+h, shift+alt+left, shift+comma",insert:"shift+tab, shift+alt+left",visual:"shift+tab, shift+alt+h, shift+alt+left, shift+comma"},"move down":{normal:"shift+alt+j, shift+alt+down",visual:"shift+alt+j, shift+alt+down"},"move up":{normal:"shift+alt+k, shift+alt+up",visual:"shift+alt+k, shift+alt+up"},"move to first sibling":{normal:"ctrl+shift+[",visual:"ctrl+shift+["},"move to last sibling":{normal:"ctrl+shift+]",visual:"ctrl+shift+]"}},modes:{"visual mode":{normal:"v, shift+v"},"normal mode":{title:"back to normal mode",insert:"escape",visual:"escape, v, shift+v"}}}},{}],444:[function(require,module,exports){var React=require("react");var treed=require("treed");var files=require("./app/files");window.run_require=require;window.React=React;var format=require("itreed/lib/plugin/format");var formatters=[require("itreed/formatters/live"),require("itreed/formatters/live-button"),require("itreed/formatters/react"),require("itreed/formatters/vega"),require("itreed/formatters/dom"),require("itreed/formatters/latex"),require("itreed/formatters/list-like"),require("itreed/formatters/js")];formatters.map(function(plugin){if(plugin.display){format.displayer(plugin.display,plugin.mime)}if(plugin.format){format.formatter(plugin.format,plugin.mime)}});window.onload=function(){var router=require("./app/router");require("react-router").run(router,function(Handler){React.render(React.createElement(Handler,null),document.body)})}},{"./app/files":61,"./app/router":70,"itreed/formatters/dom":88,"itreed/formatters/js":92,"itreed/formatters/latex":93,"itreed/formatters/list-like":94,"itreed/formatters/live":96,"itreed/formatters/live-button":95,"itreed/formatters/react":97,"itreed/formatters/vega":98,"itreed/lib/plugin/format":118,react:"react","react-router":259,treed:300}],445:[function(require,module,exports){var Modal=require("../../app/ui/modal");module.exports=function(current,done){Modal.show({title:"Edit Custom CSS Classes",initialState:{classes:current},buttons:{ok:function(){this.props.onClose(null,this.state.classes)},cancel:function(){this.props.onClose(true)}},renderBody:function(){var change=this._onChangeEvt.bind(null,"classes");return React.createElement("div",null,React.createElement("input",{value:this.state.classes,placeholder:"Space-separated css class names",onChange:change}))},done:done})}},{"../../app/ui/modal":81}],446:[function(require,module,exports){var editCustomCSS=require("./edit-custom-css");module.exports={title:"Custom CSS",node:{classes:function(node,state){return node.customCSS||""}},contextMenu:function(node,store){if(!node)return;return{title:"Custom CSS",action:"editCustomCSS"}},store:{actions:{editCustomCSS:function(id){var current=this.db.nodes[id].customCSS;editCustomCSS(current,function(err,classNames){if(!err){this.set(id,"customCSS",classNames)}}.bind(this))}}}}},{"./edit-custom-css":445}]},{},[444]);